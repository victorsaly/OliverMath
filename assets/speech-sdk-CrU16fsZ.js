function Tf(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Bh(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var i=function u(){return this instanceof u?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(u){var n=Object.getOwnPropertyDescriptor(e,u);Object.defineProperty(i,u,n.get?n:{enumerable:!0,get:function(){return e[u]}})}),i}var ne={},se={},be={},oe={},D={},bi={},ae={},Mi={},Me={},Pi={},cs;function Ju(){if(cs)return Pi;cs=1,Object.defineProperty(Pi,"__esModule",{value:!0}),Pi.default=i;let e;const t=new Uint8Array(16);function i(){if(!e&&(e=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(t)}return Pi}var we={},Oe={},De={},us;function Fh(){if(us)return De;us=1,Object.defineProperty(De,"__esModule",{value:!0}),De.default=void 0;var e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;return De.default=e,De}var ps;function Ai(){if(ps)return Oe;ps=1,Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.default=void 0;var e=t(Fh());function t(n){return n&&n.__esModule?n:{default:n}}function i(n){return typeof n=="string"&&e.default.test(n)}var u=i;return Oe.default=u,Oe}var hs;function Ii(){if(hs)return we;hs=1,Object.defineProperty(we,"__esModule",{value:!0}),we.default=void 0,we.unsafeStringify=u;var e=t(Ai());function t(s){return s&&s.__esModule?s:{default:s}}const i=[];for(let s=0;s<256;++s)i.push((s+256).toString(16).slice(1));function u(s,r=0){return i[s[r+0]]+i[s[r+1]]+i[s[r+2]]+i[s[r+3]]+"-"+i[s[r+4]]+i[s[r+5]]+"-"+i[s[r+6]]+i[s[r+7]]+"-"+i[s[r+8]]+i[s[r+9]]+"-"+i[s[r+10]]+i[s[r+11]]+i[s[r+12]]+i[s[r+13]]+i[s[r+14]]+i[s[r+15]]}function n(s,r=0){const o=u(s,r);if(!(0,e.default)(o))throw TypeError("Stringified UUID is invalid");return o}var a=n;return we.default=a,we}var ds;function Uh(){if(ds)return Me;ds=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.default=void 0;var e=i(Ju()),t=Ii();function i(c){return c&&c.__esModule?c:{default:c}}let u,n,a=0,s=0;function r(c,p,h){let v=p&&h||0;const d=p||new Array(16);c=c||{};let f=c.node||u,g=c.clockseq!==void 0?c.clockseq:n;if(f==null||g==null){const R=c.random||(c.rng||e.default)();f==null&&(f=u=[R[0]|1,R[1],R[2],R[3],R[4],R[5]]),g==null&&(g=n=(R[6]<<8|R[7])&16383)}let m=c.msecs!==void 0?c.msecs:Date.now(),l=c.nsecs!==void 0?c.nsecs:s+1;const S=m-a+(l-s)/1e4;if(S<0&&c.clockseq===void 0&&(g=g+1&16383),(S<0||m>a)&&c.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=m,s=l,n=g,m+=122192928e5;const C=((m&268435455)*1e4+l)%4294967296;d[v++]=C>>>24&255,d[v++]=C>>>16&255,d[v++]=C>>>8&255,d[v++]=C&255;const y=m/4294967296*1e4&268435455;d[v++]=y>>>8&255,d[v++]=y&255,d[v++]=y>>>24&15|16,d[v++]=y>>>16&255,d[v++]=g>>>8|128,d[v++]=g&255;for(let R=0;R<6;++R)d[v+R]=f[R];return p||(0,t.unsafeStringify)(d)}var o=r;return Me.default=o,Me}var ke={},$={},Ne={},vs;function Gu(){if(vs)return Ne;vs=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.default=void 0;var e=t(Ai());function t(n){return n&&n.__esModule?n:{default:n}}function i(n){if(!(0,e.default)(n))throw TypeError("Invalid UUID");let a;const s=new Uint8Array(16);return s[0]=(a=parseInt(n.slice(0,8),16))>>>24,s[1]=a>>>16&255,s[2]=a>>>8&255,s[3]=a&255,s[4]=(a=parseInt(n.slice(9,13),16))>>>8,s[5]=a&255,s[6]=(a=parseInt(n.slice(14,18),16))>>>8,s[7]=a&255,s[8]=(a=parseInt(n.slice(19,23),16))>>>8,s[9]=a&255,s[10]=(a=parseInt(n.slice(24,36),16))/1099511627776&255,s[11]=a/4294967296&255,s[12]=a>>>24&255,s[13]=a>>>16&255,s[14]=a>>>8&255,s[15]=a&255,s}var u=i;return Ne.default=u,Ne}var ls;function Qu(){if(ls)return $;ls=1,Object.defineProperty($,"__esModule",{value:!0}),$.URL=$.DNS=void 0,$.default=s;var e=Ii(),t=i(Gu());function i(r){return r&&r.__esModule?r:{default:r}}function u(r){r=unescape(encodeURIComponent(r));const o=[];for(let c=0;c<r.length;++c)o.push(r.charCodeAt(c));return o}const n="6ba7b810-9dad-11d1-80b4-00c04fd430c8";$.DNS=n;const a="6ba7b811-9dad-11d1-80b4-00c04fd430c8";$.URL=a;function s(r,o,c){function p(h,v,d,f){var g;if(typeof h=="string"&&(h=u(h)),typeof v=="string"&&(v=(0,t.default)(v)),((g=v)===null||g===void 0?void 0:g.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let m=new Uint8Array(16+h.length);if(m.set(v),m.set(h,v.length),m=c(m),m[6]=m[6]&15|o,m[8]=m[8]&63|128,d){f=f||0;for(let l=0;l<16;++l)d[f+l]=m[l];return d}return(0,e.unsafeStringify)(m)}try{p.name=r}catch{}return p.DNS=n,p.URL=a,p}return $}var ze={},fs;function xh(){if(fs)return ze;fs=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.default=void 0;function e(d){if(typeof d=="string"){const f=unescape(encodeURIComponent(d));d=new Uint8Array(f.length);for(let g=0;g<f.length;++g)d[g]=f.charCodeAt(g)}return t(u(n(d),d.length*8))}function t(d){const f=[],g=d.length*32,m="0123456789abcdef";for(let l=0;l<g;l+=8){const S=d[l>>5]>>>l%32&255,C=parseInt(m.charAt(S>>>4&15)+m.charAt(S&15),16);f.push(C)}return f}function i(d){return(d+64>>>9<<4)+14+1}function u(d,f){d[f>>5]|=128<<f%32,d[i(f)-1]=f;let g=1732584193,m=-271733879,l=-1732584194,S=271733878;for(let C=0;C<d.length;C+=16){const y=g,R=m,T=l,w=S;g=o(g,m,l,S,d[C],7,-680876936),S=o(S,g,m,l,d[C+1],12,-389564586),l=o(l,S,g,m,d[C+2],17,606105819),m=o(m,l,S,g,d[C+3],22,-1044525330),g=o(g,m,l,S,d[C+4],7,-176418897),S=o(S,g,m,l,d[C+5],12,1200080426),l=o(l,S,g,m,d[C+6],17,-1473231341),m=o(m,l,S,g,d[C+7],22,-45705983),g=o(g,m,l,S,d[C+8],7,1770035416),S=o(S,g,m,l,d[C+9],12,-1958414417),l=o(l,S,g,m,d[C+10],17,-42063),m=o(m,l,S,g,d[C+11],22,-1990404162),g=o(g,m,l,S,d[C+12],7,1804603682),S=o(S,g,m,l,d[C+13],12,-40341101),l=o(l,S,g,m,d[C+14],17,-1502002290),m=o(m,l,S,g,d[C+15],22,1236535329),g=c(g,m,l,S,d[C+1],5,-165796510),S=c(S,g,m,l,d[C+6],9,-1069501632),l=c(l,S,g,m,d[C+11],14,643717713),m=c(m,l,S,g,d[C],20,-373897302),g=c(g,m,l,S,d[C+5],5,-701558691),S=c(S,g,m,l,d[C+10],9,38016083),l=c(l,S,g,m,d[C+15],14,-660478335),m=c(m,l,S,g,d[C+4],20,-405537848),g=c(g,m,l,S,d[C+9],5,568446438),S=c(S,g,m,l,d[C+14],9,-1019803690),l=c(l,S,g,m,d[C+3],14,-187363961),m=c(m,l,S,g,d[C+8],20,1163531501),g=c(g,m,l,S,d[C+13],5,-1444681467),S=c(S,g,m,l,d[C+2],9,-51403784),l=c(l,S,g,m,d[C+7],14,1735328473),m=c(m,l,S,g,d[C+12],20,-1926607734),g=p(g,m,l,S,d[C+5],4,-378558),S=p(S,g,m,l,d[C+8],11,-2022574463),l=p(l,S,g,m,d[C+11],16,1839030562),m=p(m,l,S,g,d[C+14],23,-35309556),g=p(g,m,l,S,d[C+1],4,-1530992060),S=p(S,g,m,l,d[C+4],11,1272893353),l=p(l,S,g,m,d[C+7],16,-155497632),m=p(m,l,S,g,d[C+10],23,-1094730640),g=p(g,m,l,S,d[C+13],4,681279174),S=p(S,g,m,l,d[C],11,-358537222),l=p(l,S,g,m,d[C+3],16,-722521979),m=p(m,l,S,g,d[C+6],23,76029189),g=p(g,m,l,S,d[C+9],4,-640364487),S=p(S,g,m,l,d[C+12],11,-421815835),l=p(l,S,g,m,d[C+15],16,530742520),m=p(m,l,S,g,d[C+2],23,-995338651),g=h(g,m,l,S,d[C],6,-198630844),S=h(S,g,m,l,d[C+7],10,1126891415),l=h(l,S,g,m,d[C+14],15,-1416354905),m=h(m,l,S,g,d[C+5],21,-57434055),g=h(g,m,l,S,d[C+12],6,1700485571),S=h(S,g,m,l,d[C+3],10,-1894986606),l=h(l,S,g,m,d[C+10],15,-1051523),m=h(m,l,S,g,d[C+1],21,-2054922799),g=h(g,m,l,S,d[C+8],6,1873313359),S=h(S,g,m,l,d[C+15],10,-30611744),l=h(l,S,g,m,d[C+6],15,-1560198380),m=h(m,l,S,g,d[C+13],21,1309151649),g=h(g,m,l,S,d[C+4],6,-145523070),S=h(S,g,m,l,d[C+11],10,-1120210379),l=h(l,S,g,m,d[C+2],15,718787259),m=h(m,l,S,g,d[C+9],21,-343485551),g=a(g,y),m=a(m,R),l=a(l,T),S=a(S,w)}return[g,m,l,S]}function n(d){if(d.length===0)return[];const f=d.length*8,g=new Uint32Array(i(f));for(let m=0;m<f;m+=8)g[m>>5]|=(d[m/8]&255)<<m%32;return g}function a(d,f){const g=(d&65535)+(f&65535);return(d>>16)+(f>>16)+(g>>16)<<16|g&65535}function s(d,f){return d<<f|d>>>32-f}function r(d,f,g,m,l,S){return a(s(a(a(f,d),a(m,S)),l),g)}function o(d,f,g,m,l,S,C){return r(f&g|~f&m,d,f,l,S,C)}function c(d,f,g,m,l,S,C){return r(f&m|g&~m,d,f,l,S,C)}function p(d,f,g,m,l,S,C){return r(f^g^m,d,f,l,S,C)}function h(d,f,g,m,l,S,C){return r(g^(f|~m),d,f,l,S,C)}var v=e;return ze.default=v,ze}var gs;function Wh(){if(gs)return ke;gs=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.default=void 0;var e=i(Qu()),t=i(xh());function i(a){return a&&a.__esModule?a:{default:a}}var n=(0,e.default)("v3",48,t.default);return ke.default=n,ke}var je={},Le={},ms;function Hh(){if(ms)return Le;ms=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.default=void 0;var t={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};return Le.default=t,Le}var Ss;function Kh(){if(Ss)return je;Ss=1,Object.defineProperty(je,"__esModule",{value:!0}),je.default=void 0;var e=u(Hh()),t=u(Ju()),i=Ii();function u(s){return s&&s.__esModule?s:{default:s}}function n(s,r,o){if(e.default.randomUUID&&!r&&!s)return e.default.randomUUID();s=s||{};const c=s.random||(s.rng||t.default)();if(c[6]=c[6]&15|64,c[8]=c[8]&63|128,r){o=o||0;for(let p=0;p<16;++p)r[o+p]=c[p];return r}return(0,i.unsafeStringify)(c)}var a=n;return je.default=a,je}var qe={},Be={},Cs;function Vh(){if(Cs)return Be;Cs=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.default=void 0;function e(n,a,s,r){switch(n){case 0:return a&s^~a&r;case 1:return a^s^r;case 2:return a&s^a&r^s&r;case 3:return a^s^r}}function t(n,a){return n<<a|n>>>32-a}function i(n){const a=[1518500249,1859775393,2400959708,3395469782],s=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){const p=unescape(encodeURIComponent(n));n=[];for(let h=0;h<p.length;++h)n.push(p.charCodeAt(h))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);const r=n.length/4+2,o=Math.ceil(r/16),c=new Array(o);for(let p=0;p<o;++p){const h=new Uint32Array(16);for(let v=0;v<16;++v)h[v]=n[p*64+v*4]<<24|n[p*64+v*4+1]<<16|n[p*64+v*4+2]<<8|n[p*64+v*4+3];c[p]=h}c[o-1][14]=(n.length-1)*8/Math.pow(2,32),c[o-1][14]=Math.floor(c[o-1][14]),c[o-1][15]=(n.length-1)*8&4294967295;for(let p=0;p<o;++p){const h=new Uint32Array(80);for(let l=0;l<16;++l)h[l]=c[p][l];for(let l=16;l<80;++l)h[l]=t(h[l-3]^h[l-8]^h[l-14]^h[l-16],1);let v=s[0],d=s[1],f=s[2],g=s[3],m=s[4];for(let l=0;l<80;++l){const S=Math.floor(l/20),C=t(v,5)+e(S,d,f,g)+m+a[S]+h[l]>>>0;m=g,g=f,f=t(d,30)>>>0,d=v,v=C}s[0]=s[0]+v>>>0,s[1]=s[1]+d>>>0,s[2]=s[2]+f>>>0,s[3]=s[3]+g>>>0,s[4]=s[4]+m>>>0}return[s[0]>>24&255,s[0]>>16&255,s[0]>>8&255,s[0]&255,s[1]>>24&255,s[1]>>16&255,s[1]>>8&255,s[1]&255,s[2]>>24&255,s[2]>>16&255,s[2]>>8&255,s[2]&255,s[3]>>24&255,s[3]>>16&255,s[3]>>8&255,s[3]&255,s[4]>>24&255,s[4]>>16&255,s[4]>>8&255,s[4]&255]}var u=i;return Be.default=u,Be}var ys;function Jh(){if(ys)return qe;ys=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.default=void 0;var e=i(Qu()),t=i(Vh());function i(a){return a&&a.__esModule?a:{default:a}}var n=(0,e.default)("v5",80,t.default);return qe.default=n,qe}var Fe={},Rs;function Gh(){if(Rs)return Fe;Rs=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=void 0;var e="00000000-0000-0000-0000-000000000000";return Fe.default=e,Fe}var Ue={},Ps;function Qh(){if(Ps)return Ue;Ps=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.default=void 0;var e=t(Ai());function t(n){return n&&n.__esModule?n:{default:n}}function i(n){if(!(0,e.default)(n))throw TypeError("Invalid UUID");return parseInt(n.slice(14,15),16)}var u=i;return Ue.default=u,Ue}var Es;function Xh(){return Es||(Es=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"NIL",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"v1",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"v3",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"v4",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"v5",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"validate",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return s.default}});var t=p(Uh()),i=p(Wh()),u=p(Kh()),n=p(Jh()),a=p(Gh()),s=p(Qh()),r=p(Ai()),o=p(Ii()),c=p(Gu());function p(h){return h&&h.__esModule?h:{default:h}}})(Mi)),Mi}var Ts;function Te(){if(Ts)return ae;Ts=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.createNoDashGuid=ae.createGuid=void 0;const e=Xh(),t=()=>(0,e.v4)();ae.createGuid=t;const i=()=>t().replace(new RegExp("-","g"),"").toUpperCase();return ae.createNoDashGuid=i,ae}var As;function Ci(){return As||(As=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PlatformEvent=e.EventType=void 0;const t=Te();(function(u){u[u.Debug=0]="Debug",u[u.Info=1]="Info",u[u.Warning=2]="Warning",u[u.Error=3]="Error",u[u.None=4]="None"})(e.EventType||(e.EventType={}));class i{constructor(n,a){this.privName=n,this.privEventId=(0,t.createNoDashGuid)(),this.privEventTime=new Date().toISOString(),this.privEventType=a,this.privMetadata={}}get name(){return this.privName}get eventId(){return this.privEventId}get eventTime(){return this.privEventTime}get eventType(){return this.privEventType}get metadata(){return this.privMetadata}}e.PlatformEvent=i})(bi)),bi}var Is;function Zh(){if(Is)return D;Is=1,Object.defineProperty(D,"__esModule",{value:!0}),D.AudioStreamNodeErrorEvent=D.AudioStreamNodeDetachedEvent=D.AudioStreamNodeAttachedEvent=D.AudioStreamNodeAttachingEvent=D.AudioStreamNodeEvent=D.AudioSourceErrorEvent=D.AudioSourceOffEvent=D.AudioSourceReadyEvent=D.AudioSourceInitializingEvent=D.AudioSourceEvent=void 0;const e=Ci();class t extends e.PlatformEvent{constructor(v,d,f=e.EventType.Info){super(v,f),this.privAudioSourceId=d}get audioSourceId(){return this.privAudioSourceId}}D.AudioSourceEvent=t;class i extends t{constructor(v){super("AudioSourceInitializingEvent",v)}}D.AudioSourceInitializingEvent=i;class u extends t{constructor(v){super("AudioSourceReadyEvent",v)}}D.AudioSourceReadyEvent=u;class n extends t{constructor(v){super("AudioSourceOffEvent",v)}}D.AudioSourceOffEvent=n;class a extends t{constructor(v,d){super("AudioSourceErrorEvent",v,e.EventType.Error),this.privError=d}get error(){return this.privError}}D.AudioSourceErrorEvent=a;class s extends t{constructor(v,d,f){super(v,d),this.privAudioNodeId=f}get audioNodeId(){return this.privAudioNodeId}}D.AudioStreamNodeEvent=s;class r extends s{constructor(v,d){super("AudioStreamNodeAttachingEvent",v,d)}}D.AudioStreamNodeAttachingEvent=r;class o extends s{constructor(v,d){super("AudioStreamNodeAttachedEvent",v,d)}}D.AudioStreamNodeAttachedEvent=o;class c extends s{constructor(v,d){super("AudioStreamNodeDetachedEvent",v,d)}}D.AudioStreamNodeDetachedEvent=c;class p extends s{constructor(v,d,f){super("AudioStreamNodeErrorEvent",v,d),this.privError=f}get error(){return this.privError}}return D.AudioStreamNodeErrorEvent=p,D}var k={},ws;function Yh(){if(ws)return k;ws=1,Object.defineProperty(k,"__esModule",{value:!0}),k.ConnectionRedirectEvent=k.ConnectionMessageSentEvent=k.ConnectionMessageReceivedEvent=k.ConnectionEstablishErrorEvent=k.ConnectionErrorEvent=k.ConnectionClosedEvent=k.ConnectionEstablishedEvent=k.ConnectionStartEvent=k.ConnectionEvent=k.ServiceEvent=void 0;const e=Ci();class t extends e.PlatformEvent{constructor(v,d,f=e.EventType.Info){super(v,f),this.privJsonResult=d}get jsonString(){return this.privJsonResult}}k.ServiceEvent=t;class i extends e.PlatformEvent{constructor(v,d,f=e.EventType.Info){super(v,f),this.privConnectionId=d}get connectionId(){return this.privConnectionId}}k.ConnectionEvent=i;class u extends i{constructor(v,d,f){super("ConnectionStartEvent",v),this.privUri=d,this.privHeaders=f}get uri(){return this.privUri}get headers(){return this.privHeaders}}k.ConnectionStartEvent=u;class n extends i{constructor(v){super("ConnectionEstablishedEvent",v)}}k.ConnectionEstablishedEvent=n;class a extends i{constructor(v,d,f){super("ConnectionClosedEvent",v,e.EventType.Debug),this.privReason=f,this.privStatusCode=d}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}k.ConnectionClosedEvent=a;class s extends i{constructor(v,d,f){super("ConnectionErrorEvent",v,e.EventType.Debug),this.privMessage=d,this.privType=f}get message(){return this.privMessage}get type(){return this.privType}}k.ConnectionErrorEvent=s;class r extends i{constructor(v,d,f){super("ConnectionEstablishErrorEvent",v,e.EventType.Error),this.privStatusCode=d,this.privReason=f}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}k.ConnectionEstablishErrorEvent=r;class o extends i{constructor(v,d,f){super("ConnectionMessageReceivedEvent",v),this.privNetworkReceivedTime=d,this.privMessage=f}get networkReceivedTime(){return this.privNetworkReceivedTime}get message(){return this.privMessage}}k.ConnectionMessageReceivedEvent=o;class c extends i{constructor(v,d,f){super("ConnectionMessageSentEvent",v),this.privNetworkSentTime=d,this.privMessage=f}get networkSentTime(){return this.privNetworkSentTime}get message(){return this.privMessage}}k.ConnectionMessageSentEvent=c;class p extends i{constructor(v,d,f,g){super("ConnectionRedirectEvent",v,e.EventType.Info),this.privRedirectUrl=d,this.privOriginalUrl=f,this.privContext=g}get redirectUrl(){return this.privRedirectUrl}get originalUrl(){return this.privOriginalUrl}get context(){return this.privContext}}return k.ConnectionRedirectEvent=p,k}var Oi={},G={},_s;function J(){if(_s)return G;_s=1,Object.defineProperty(G,"__esModule",{value:!0}),G.ObjectDisposedError=G.InvalidOperationError=G.ArgumentNullError=void 0;class e extends Error{constructor(n){super(n),this.name="ArgumentNull",this.message=n}}G.ArgumentNullError=e;class t extends Error{constructor(n){super(n),this.name="InvalidOperation",this.message=n}}G.InvalidOperationError=t;class i extends Error{constructor(n,a){super(a),this.name=n+"ObjectDisposed",this.message=a}}return G.ObjectDisposedError=i,G}var bs;function Xu(){return bs||(bs=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionMessage=e.MessageType=void 0;const t=J(),i=Te();var u;(function(a){a[a.Text=0]="Text",a[a.Binary=1]="Binary"})(u=e.MessageType||(e.MessageType={}));class n{constructor(s,r,o,c){if(this.privBody=null,s===u.Text&&r&&typeof r!="string")throw new t.InvalidOperationError("Payload must be a string");if(s===u.Binary&&r&&!(r instanceof ArrayBuffer))throw new t.InvalidOperationError("Payload must be ArrayBuffer");switch(this.privMessageType=s,this.privBody=r,this.privHeaders=o||{},this.privId=c||(0,i.createNoDashGuid)(),this.messageType){case u.Binary:this.privSize=this.binaryBody!==null?this.binaryBody.byteLength:0;break;case u.Text:this.privSize=this.textBody.length}}get messageType(){return this.privMessageType}get headers(){return this.privHeaders}get body(){return this.privBody}get textBody(){if(this.privMessageType===u.Binary)throw new t.InvalidOperationError("Not supported for binary message");return this.privBody}get binaryBody(){if(this.privMessageType===u.Text)throw new t.InvalidOperationError("Not supported for text message");return this.privBody}get id(){return this.privId}}e.ConnectionMessage=n})(Oi)),Oi}var xe={},Ms;function $h(){if(Ms)return xe;Ms=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.ConnectionOpenResponse=void 0;let e=class{constructor(i,u){this.privStatusCode=i,this.privReason=u}get statusCode(){return this.privStatusCode}get reason(){return this.privReason}};return xe.ConnectionOpenResponse=e,xe}var We={},Os;function ed(){if(Os)return We;Os=1,Object.defineProperty(We,"__esModule",{value:!0}),We.DeferralMap=void 0;let e=class{constructor(){this.privMap={}}add(i,u){this.privMap[i]=u}getId(i){return this.privMap[i]}complete(i,u){try{this.privMap[i].resolve(u)}catch(n){this.privMap[i].reject(n)}finally{this.privMap[i]=void 0}}};return We.DeferralMap=e,We}var ce={},Ds;function Zu(){if(Ds)return ce;Ds=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.SendingAgentContextMessageEvent=ce.DialogEvent=void 0;const e=Ci();class t extends e.PlatformEvent{constructor(n,a=e.EventType.Info){super(n,a)}}ce.DialogEvent=t;class i extends t{constructor(n){super("SendingAgentContextMessageEvent"),this.privAgentConfig=n}get agentConfig(){return this.privAgentConfig}}return ce.SendingAgentContextMessageEvent=i,ce}var He={},Ke={},ks;function Yu(){if(ks)return Ke;ks=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.EventSource=void 0;const e=J(),t=Te();let i=class{constructor(n){this.privEventListeners={},this.privIsDisposed=!1,this.privConsoleListener=void 0,this.privMetadata=n}onEvent(n){if(this.isDisposed())throw new e.ObjectDisposedError("EventSource");if(this.metadata)for(const a in this.metadata)a&&n.metadata&&(n.metadata[a]||(n.metadata[a]=this.metadata[a]));for(const a in this.privEventListeners)a&&this.privEventListeners[a]&&this.privEventListeners[a](n)}attach(n){const a=(0,t.createNoDashGuid)();return this.privEventListeners[a]=n,{detach:()=>(delete this.privEventListeners[a],Promise.resolve())}}attachListener(n){return this.attach(a=>n.onEvent(a))}attachConsoleListener(n){return this.privConsoleListener&&this.privConsoleListener.detach(),this.privConsoleListener=this.attach(a=>n.onEvent(a)),this.privConsoleListener}isDisposed(){return this.privIsDisposed}dispose(){this.privEventListeners=null,this.privIsDisposed=!0}get metadata(){return this.privMetadata}};return Ke.EventSource=i,Ke}var Ns;function td(){if(Ns)return He;Ns=1,Object.defineProperty(He,"__esModule",{value:!0}),He.Events=void 0;const e=J(),t=Yu();let i=class Hn{static setEventSource(n){if(!n)throw new e.ArgumentNullError("eventSource");Hn.privInstance=n}static get instance(){return Hn.privInstance}};return He.Events=i,i.privInstance=new t.EventSource,He}var Di={},zs;function rd(){return zs||(zs=1,Object.defineProperty(Di,"__esModule",{value:!0})),Di}var ki={},js;function id(){return js||(js=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionState=void 0,(function(t){t[t.None=0]="None",t[t.Connected=1]="Connected",t[t.Connecting=2]="Connecting",t[t.Disconnected=3]="Disconnected"})(e.ConnectionState||(e.ConnectionState={}))})(ki)),ki}var Ni={},Ls;function nd(){return Ls||(Ls=1,Object.defineProperty(Ni,"__esModule",{value:!0})),Ni}var zi={},qs;function sd(){return qs||(qs=1,Object.defineProperty(zi,"__esModule",{value:!0})),zi}var ji={},Bs;function od(){return Bs||(Bs=1,Object.defineProperty(ji,"__esModule",{value:!0})),ji}var Li={},Fs;function ad(){return Fs||(Fs=1,Object.defineProperty(Li,"__esModule",{value:!0})),Li}var qi={},Us;function cd(){return Us||(Us=1,Object.defineProperty(qi,"__esModule",{value:!0})),qi}var Bi={},xs;function ud(){return xs||(xs=1,Object.defineProperty(Bi,"__esModule",{value:!0})),Bi}var Fi={},Ws;function pd(){return Ws||(Ws=1,Object.defineProperty(Fi,"__esModule",{value:!0})),Fi}var Ui={},Hs;function hd(){return Hs||(Hs=1,Object.defineProperty(Ui,"__esModule",{value:!0})),Ui}var Ve={},Ks;function $u(){if(Ks)return Ve;Ks=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.List=void 0;const e=J();let t=class Pe{constructor(u){if(this.privSubscriptionIdCounter=0,this.privAddSubscriptions={},this.privRemoveSubscriptions={},this.privDisposedSubscriptions={},this.privDisposeReason=null,this.privList=[],u)for(const n of u)this.privList.push(n)}get(u){return this.throwIfDisposed(),this.privList[u]}first(){return this.get(0)}last(){return this.get(this.length()-1)}add(u){this.throwIfDisposed(),this.insertAt(this.privList.length,u)}insertAt(u,n){this.throwIfDisposed(),u===0?this.privList.unshift(n):u===this.privList.length?this.privList.push(n):this.privList.splice(u,0,n),this.triggerSubscriptions(this.privAddSubscriptions)}removeFirst(){return this.throwIfDisposed(),this.removeAt(0)}removeLast(){return this.throwIfDisposed(),this.removeAt(this.length()-1)}removeAt(u){return this.throwIfDisposed(),this.remove(u,1)[0]}remove(u,n){this.throwIfDisposed();const a=this.privList.splice(u,n);return this.triggerSubscriptions(this.privRemoveSubscriptions),a}clear(){this.throwIfDisposed(),this.remove(0,this.length())}length(){return this.throwIfDisposed(),this.privList.length}onAdded(u){this.throwIfDisposed();const n=this.privSubscriptionIdCounter++;return this.privAddSubscriptions[n]=u,{detach:()=>(delete this.privAddSubscriptions[n],Promise.resolve())}}onRemoved(u){this.throwIfDisposed();const n=this.privSubscriptionIdCounter++;return this.privRemoveSubscriptions[n]=u,{detach:()=>(delete this.privRemoveSubscriptions[n],Promise.resolve())}}onDisposed(u){this.throwIfDisposed();const n=this.privSubscriptionIdCounter++;return this.privDisposedSubscriptions[n]=u,{detach:()=>(delete this.privDisposedSubscriptions[n],Promise.resolve())}}join(u){return this.throwIfDisposed(),this.privList.join(u)}toArray(){const u=Array();return this.privList.forEach(n=>{u.push(n)}),u}any(u){return this.throwIfDisposed(),u?this.where(u).length()>0:this.length()>0}all(u){return this.throwIfDisposed(),this.where(u).length()===this.length()}forEach(u){this.throwIfDisposed();for(let n=0;n<this.length();n++)u(this.privList[n],n)}select(u){this.throwIfDisposed();const n=[];for(let a=0;a<this.privList.length;a++)n.push(u(this.privList[a],a));return new Pe(n)}where(u){this.throwIfDisposed();const n=new Pe;for(let a=0;a<this.privList.length;a++)u(this.privList[a],a)&&n.add(this.privList[a]);return n}orderBy(u){this.throwIfDisposed();const a=this.toArray().sort(u);return new Pe(a)}orderByDesc(u){return this.throwIfDisposed(),this.orderBy((n,a)=>u(a,n))}clone(){return this.throwIfDisposed(),new Pe(this.toArray())}concat(u){return this.throwIfDisposed(),new Pe(this.privList.concat(u.toArray()))}concatArray(u){return this.throwIfDisposed(),new Pe(this.privList.concat(u))}isDisposed(){return this.privList==null}dispose(u){this.isDisposed()||(this.privDisposeReason=u,this.privList=null,this.privAddSubscriptions=null,this.privRemoveSubscriptions=null,this.triggerSubscriptions(this.privDisposedSubscriptions))}throwIfDisposed(){if(this.isDisposed())throw new e.ObjectDisposedError("List",this.privDisposeReason)}triggerSubscriptions(u){if(u)for(const n in u)n&&u[n]()}};return Ve.List=t,Ve}var xi={},Vs;function ep(){return Vs||(Vs=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.marshalPromiseToCallbacks=e.Sink=e.Deferred=e.PromiseResultEventSource=e.PromiseResult=e.PromiseState=void 0;var t;(function(r){r[r.None=0]="None",r[r.Resolved=1]="Resolved",r[r.Rejected=2]="Rejected"})(t=e.PromiseState||(e.PromiseState={}));class i{constructor(o){this.throwIfError=()=>{if(this.isError)throw this.error},o.on(c=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!1,this.privResult=c)},c=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!0,this.privError=c)})}get isCompleted(){return this.privIsCompleted}get isError(){return this.privIsError}get error(){return this.privError}get result(){return this.privResult}}e.PromiseResult=i;class u{constructor(){this.setResult=o=>{this.privOnSetResult(o)},this.setError=o=>{this.privOnSetError(o)},this.on=(o,c)=>{this.privOnSetResult=o,this.privOnSetError=c}}}e.PromiseResultEventSource=u;class n{constructor(){this.resolve=o=>(this.privResolve(o),this),this.reject=o=>(this.privReject(o),this),this.privPromise=new Promise((o,c)=>{this.privResolve=o,this.privReject=c})}get promise(){return this.privPromise}}e.Deferred=n;class a{constructor(){this.privState=t.None,this.privPromiseResult=null,this.privPromiseResultEvents=null,this.privSuccessHandlers=[],this.privErrorHandlers=[],this.privPromiseResultEvents=new u,this.privPromiseResult=new i(this.privPromiseResultEvents)}get state(){return this.privState}get result(){return this.privPromiseResult}resolve(o){if(this.privState!==t.None)throw new Error("'Cannot resolve a completed promise'");this.privState=t.Resolved,this.privPromiseResultEvents.setResult(o);for(let c=0;c<this.privSuccessHandlers.length;c++)this.executeSuccessCallback(o,this.privSuccessHandlers[c],this.privErrorHandlers[c]);this.detachHandlers()}reject(o){if(this.privState!==t.None)throw new Error("'Cannot reject a completed promise'");this.privState=t.Rejected,this.privPromiseResultEvents.setError(o);for(const c of this.privErrorHandlers)this.executeErrorCallback(o,c);this.detachHandlers()}on(o,c){o==null&&(o=()=>{}),this.privState===t.None?(this.privSuccessHandlers.push(o),this.privErrorHandlers.push(c)):(this.privState===t.Resolved?this.executeSuccessCallback(this.privPromiseResult.result,o,c):this.privState===t.Rejected&&this.executeErrorCallback(this.privPromiseResult.error,c),this.detachHandlers())}executeSuccessCallback(o,c,p){try{c(o)}catch(h){this.executeErrorCallback(`'Unhandled callback error: ${h}'`,p)}}executeErrorCallback(o,c){if(c)try{c(o)}catch(p){throw new Error(`'Unhandled callback error: ${p}. InnerError: ${o}'`)}else throw new Error(`'Unhandled error: ${o}'`)}detachHandlers(){this.privErrorHandlers=[],this.privSuccessHandlers=[]}}e.Sink=a;function s(r,o,c){r.then(p=>{try{o&&o(p)}catch(h){if(c)try{if(h instanceof Error){const v=h;c(v.name+": "+v.message)}else c(h)}catch{}}},p=>{if(c)try{if(p instanceof Error){const h=p;c(h.name+": "+h.message)}else c(p)}catch{}})}e.marshalPromiseToCallbacks=s})(xi)),xi}var Je={},Js;function tp(){if(Js)return Je;Js=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.Queue=void 0;const e=J(),t=$u(),i=ep();var u;(function(a){a[a.Dequeue=0]="Dequeue",a[a.Peek=1]="Peek"})(u||(u={}));let n=class{constructor(s){this.privPromiseStore=new t.List,this.privIsDrainInProgress=!1,this.privIsDisposing=!1,this.privDisposeReason=null,this.privList=s||new t.List,this.privDetachables=[],this.privSubscribers=new t.List,this.privDetachables.push(this.privList.onAdded(()=>this.drain()))}enqueue(s){this.throwIfDispose(),this.enqueueFromPromise(new Promise(r=>r(s)))}enqueueFromPromise(s){this.throwIfDispose(),s.then(r=>{this.privList.add(r)},()=>{})}dequeue(){this.throwIfDispose();const s=new i.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:s,type:u.Dequeue}),this.drain()),s.promise}peek(){this.throwIfDispose();const s=new i.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:s,type:u.Peek}),this.drain()),s.promise}length(){return this.throwIfDispose(),this.privList.length()}isDisposed(){return this.privSubscribers==null}async drainAndDispose(s,r){if(!this.isDisposed()&&!this.privIsDisposing){this.privDisposeReason=r,this.privIsDisposing=!0;const o=this.privSubscribers;if(o){for(;o.length()>0;)o.removeFirst().deferral.resolve(void 0);this.privSubscribers===o&&(this.privSubscribers=o)}for(const c of this.privDetachables)await c.detach();if(this.privPromiseStore.length()>0&&s){const c=[];return this.privPromiseStore.toArray().forEach(p=>{c.push(p)}),Promise.all(c).finally(()=>{this.privSubscribers=null,this.privList.forEach(p=>{s(p)}),this.privList=null}).then()}else this.privSubscribers=null,this.privList=null}}async dispose(s){await this.drainAndDispose(null,s)}drain(){if(!this.privIsDrainInProgress&&!this.privIsDisposing){this.privIsDrainInProgress=!0;const s=this.privSubscribers,r=this.privList;if(s&&r){for(;r.length()>0&&s.length()>0&&!this.privIsDisposing;){const o=s.removeFirst();if(o.type===u.Peek)o.deferral.resolve(r.first());else{const c=r.removeFirst();o.deferral.resolve(c)}}this.privSubscribers===s&&(this.privSubscribers=s),this.privList===r&&(this.privList=r)}this.privIsDrainInProgress=!1}}throwIfDispose(){if(this.isDisposed())throw this.privDisposeReason?new e.InvalidOperationError(this.privDisposeReason):new e.ObjectDisposedError("Queue");if(this.privIsDisposing)throw new e.InvalidOperationError("Queue disposing")}};return Je.Queue=n,Je}var Ge={},Gs;function dd(){if(Gs)return Ge;Gs=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.RawWebsocketMessage=void 0;const e=Xu(),t=J(),i=Te();let u=class{constructor(a,s,r){if(this.privPayload=null,!s)throw new t.ArgumentNullError("payload");if(a===e.MessageType.Binary&&Object.getPrototypeOf(s).constructor.name!=="ArrayBuffer")throw new t.InvalidOperationError("Payload must be ArrayBuffer");if(a===e.MessageType.Text&&typeof s!="string")throw new t.InvalidOperationError("Payload must be a string");this.privMessageType=a,this.privPayload=s,this.privId=r||(0,i.createNoDashGuid)()}get messageType(){return this.privMessageType}get payload(){return this.privPayload}get textContent(){if(this.privMessageType===e.MessageType.Binary)throw new t.InvalidOperationError("Not supported for binary message");return this.privPayload}get binaryContent(){if(this.privMessageType===e.MessageType.Text)throw new t.InvalidOperationError("Not supported for text message");return this.privPayload}get id(){return this.privId}};return Ge.RawWebsocketMessage=u,Ge}var Qe={},Qs;function vd(){if(Qs)return Qe;Qs=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.RiffPcmEncoder=void 0;let e=class{constructor(i,u){this.privActualSampleRate=i,this.privDesiredSampleRate=u}encode(i){const u=this.downSampleAudioFrame(i,this.privActualSampleRate,this.privDesiredSampleRate);if(!u)return null;const n=u.length*2,a=new ArrayBuffer(n),s=new DataView(a);return this.floatTo16BitPCM(s,0,u),a}setString(i,u,n){for(let a=0;a<n.length;a++)i.setUint8(u+a,n.charCodeAt(a))}floatTo16BitPCM(i,u,n){for(let a=0;a<n.length;a++,u+=2){const s=Math.max(-1,Math.min(1,n[a]));i.setInt16(u,s<0?s*32768:s*32767,!0)}}downSampleAudioFrame(i,u,n){if(!i)return null;if(n===u||n>u)return i;const a=u/n,s=Math.round(i.length/a),r=new Float32Array(s);let o=0,c=0;for(;c<s;){const p=Math.round((c+1)*a);let h=0,v=0;for(;o<p&&o<i.length;)h+=i[o++],v++;r[c++]=h/v}return r}};return Qe.RiffPcmEncoder=e,Qe}var Xe={},Xs;function ld(){if(Xs)return Xe;Xs=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.Stream=void 0;const e=J(),t=Te(),i=tp();let u=class{constructor(a){this.privIsWriteEnded=!1,this.privIsReadEnded=!1,this.privId=a||(0,t.createNoDashGuid)(),this.privReaderQueue=new i.Queue}get isClosed(){return this.privIsWriteEnded}get isReadEnded(){return this.privIsReadEnded}get id(){return this.privId}close(){this.privIsWriteEnded||(this.writeStreamChunk({buffer:null,isEnd:!0,timeReceived:Date.now()}),this.privIsWriteEnded=!0)}writeStreamChunk(a){if(this.throwIfClosed(),!this.privReaderQueue.isDisposed())try{this.privReaderQueue.enqueue(a)}catch{}}read(){if(this.privIsReadEnded)throw new e.InvalidOperationError("Stream read has already finished");return this.privReaderQueue.dequeue().then(async a=>((a===void 0||a.isEnd)&&await this.privReaderQueue.dispose("End of stream reached"),a))}readEnded(){this.privIsReadEnded||(this.privIsReadEnded=!0,this.privReaderQueue=new i.Queue)}throwIfClosed(){if(this.privIsWriteEnded)throw new e.InvalidOperationError("Stream closed")}};return Xe.Stream=u,Xe}var Wi={},Zs;function Yn(){return Zs||(Zs=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TranslationStatus=void 0,(function(t){t[t.Success=0]="Success",t[t.Error=1]="Error"})(e.TranslationStatus||(e.TranslationStatus={}))})(Wi)),Wi}var Ze={},Ys;function fd(){if(Ys)return Ze;Ys=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.ChunkedArrayBufferStream=void 0;const e=I();let t=class extends e.Stream{constructor(u,n){super(n),this.privTargetChunkSize=Math.round(u),this.privNextBufferReadyBytes=0}writeStreamChunk(u){if(u.isEnd||this.privNextBufferReadyBytes===0&&u.buffer.byteLength===this.privTargetChunkSize){super.writeStreamChunk(u);return}let n=0;for(;n<u.buffer.byteLength;){this.privNextBufferToWrite===void 0&&(this.privNextBufferToWrite=new ArrayBuffer(this.privTargetChunkSize),this.privNextBufferStartTime=u.timeReceived);const a=Math.min(u.buffer.byteLength-n,this.privTargetChunkSize-this.privNextBufferReadyBytes),s=new Uint8Array(this.privNextBufferToWrite),r=new Uint8Array(u.buffer.slice(n,a+n));s.set(r,this.privNextBufferReadyBytes),this.privNextBufferReadyBytes+=a,n+=a,this.privNextBufferReadyBytes===this.privTargetChunkSize&&(super.writeStreamChunk({buffer:this.privNextBufferToWrite,isEnd:!1,timeReceived:this.privNextBufferStartTime}),this.privNextBufferReadyBytes=0,this.privNextBufferToWrite=void 0)}}close(){this.privNextBufferReadyBytes!==0&&!this.isClosed&&super.writeStreamChunk({buffer:this.privNextBufferToWrite.slice(0,this.privNextBufferReadyBytes),isEnd:!1,timeReceived:this.privNextBufferStartTime}),super.close()}};return Ze.ChunkedArrayBufferStream=t,Ze}var Hi={},$s;function gd(){return $s||($s=1,Object.defineProperty(Hi,"__esModule",{value:!0})),Hi}var Ye={},eo;function md(){if(eo)return Ye;eo=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.Timeout=void 0;let e=class ee{static load(){const i=new Map([[0,()=>{}]]),u=new Map,a="data:text/javascript;base64,"+btoa(`!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return d}));const r=new Map,o=new Map,i=e=>{const t=r.get(e);if(void 0===t)throw new Error('There is no interval scheduled with the given id "'.concat(e,'".'));clearTimeout(t),r.delete(e)},u=e=>{const t=o.get(e);if(void 0===t)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(t),o.delete(e)},f=(e,t)=>{let n,r;if("performance"in self){const o=performance.now();n=o,r=e-Math.max(0,o-t)}else n=Date.now(),r=e;return{expected:n+r,remainingDelay:r}},c=(e,t,n,r)=>{const o="performance"in self?performance.now():Date.now();o>n?postMessage({id:null,method:"call",params:{timerId:t}}):e.set(t,setTimeout(c,n-o,e,t,n))},a=(e,t,n)=>{const{expected:o,remainingDelay:i}=f(e,n);r.set(t,setTimeout(c,i,r,t,o))},d=(e,t,n)=>{const{expected:r,remainingDelay:i}=f(e,n);o.set(t,setTimeout(c,i,o,t,r))}},function(e,t,n){"use strict";n.r(t);var r=n(2);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(3);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(4);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o);var f=n(5);for(var o in f)"default"!==o&&function(e){n.d(t,e,(function(){return f[e]}))}(o);var c=n(6);for(var o in c)"default"!==o&&function(e){n.d(t,e,(function(){return c[e]}))}(o);var a=n(7);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var d=n(8);for(var o in d)"default"!==o&&function(e){n.d(t,e,(function(){return d[e]}))}(o);var s=n(9);for(var o in s)"default"!==o&&function(e){n.d(t,e,(function(){return s[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(11);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(12);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(13);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(1);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var u=n(10);for(var i in u)"default"!==i&&function(e){n.d(t,e,(function(){return u[e]}))}(i);addEventListener("message",({data:e})=>{try{if("clear"===e.method){const{id:t,params:{timerId:n}}=e;Object(r.b)(n),postMessage({error:null,id:t})}else{if("set"!==e.method)throw new Error('The given method "'.concat(e.method,'" is not supported'));{const{params:{delay:t,now:n,timerId:o}}=e;Object(r.d)(t,o,n)}}}catch(t){postMessage({error:{message:t.message},id:e.id,result:null})}})}]);`),s=new Worker(a);return s.addEventListener("message",({data:c})=>{if(ee.isCallNotification(c)){const{params:{timerId:p}}=c,h=i.get(p);if(typeof h=="number"){const v=u.get(h);if(v===void 0||v!==p)throw new Error("The timer is in an undefined state.")}else if(typeof h<"u")h(),i.delete(p);else throw new Error("The timer is in an undefined state.")}else if(ee.isClearResponse(c)){const{id:p}=c,h=u.get(p);if(h===void 0)throw new Error("The timer is in an undefined state.");u.delete(p),i.delete(h)}else{const{error:{message:p}}=c;throw new Error(p)}}),{clearTimeout:c=>{const p=Math.random();u.set(p,c),i.set(c,p),s.postMessage({id:p,method:"clear",params:{timerId:c}})},setTimeout:(c,p)=>{const h=Math.random();return i.set(h,c),s.postMessage({id:null,method:"set",params:{delay:p,now:performance.now(),timerId:h}}),h}}}static loadWorkerTimers(){return()=>(ee.workerTimers!==null||(ee.workerTimers=ee.load()),ee.workerTimers)}static isCallNotification(i){return i.method!==void 0&&i.method==="call"}static isClearResponse(i){return i.error===null&&typeof i.id=="number"}};return Ye.Timeout=e,e.workerTimers=null,e.clearTimeout=t=>e.timers().clearTimeout(t),e.setTimeout=(t,i)=>e.timers().setTimeout(t,i),e.timers=e.loadWorkerTimers(),Ye}var _={},to;function Sd(){if(to)return _;to=1,Object.defineProperty(_,"__esModule",{value:!0}),_.OCSPCacheUpdateErrorEvent=_.OCSPResponseRetrievedEvent=_.OCSPCacheFetchErrorEvent=_.OCSPVerificationFailedEvent=_.OCSPCacheHitEvent=_.OCSPCacheEntryNeedsRefreshEvent=_.OCSPCacheEntryExpiredEvent=_.OCSPWSUpgradeStartedEvent=_.OCSPStapleReceivedEvent=_.OCSPCacheUpdateCompleteEvent=_.OCSPDiskCacheStoreEvent=_.OCSPMemoryCacheStoreEvent=_.OCSPCacheUpdateNeededEvent=_.OCSPDiskCacheHitEvent=_.OCSPCacheMissEvent=_.OCSPMemoryCacheHitEvent=_.OCSPEvent=void 0;const e=Ci();class t extends e.PlatformEvent{constructor(C,y,R){super(C,y),this.privSignature=R}}_.OCSPEvent=t;class i extends t{constructor(C){super("OCSPMemoryCacheHitEvent",e.EventType.Debug,C)}}_.OCSPMemoryCacheHitEvent=i;class u extends t{constructor(C){super("OCSPCacheMissEvent",e.EventType.Debug,C)}}_.OCSPCacheMissEvent=u;class n extends t{constructor(C){super("OCSPDiskCacheHitEvent",e.EventType.Debug,C)}}_.OCSPDiskCacheHitEvent=n;class a extends t{constructor(C){super("OCSPCacheUpdateNeededEvent",e.EventType.Debug,C)}}_.OCSPCacheUpdateNeededEvent=a;class s extends t{constructor(C){super("OCSPMemoryCacheStoreEvent",e.EventType.Debug,C)}}_.OCSPMemoryCacheStoreEvent=s;class r extends t{constructor(C){super("OCSPDiskCacheStoreEvent",e.EventType.Debug,C)}}_.OCSPDiskCacheStoreEvent=r;class o extends t{constructor(C){super("OCSPCacheUpdateCompleteEvent",e.EventType.Debug,C)}}_.OCSPCacheUpdateCompleteEvent=o;class c extends t{constructor(){super("OCSPStapleReceivedEvent",e.EventType.Debug,"")}}_.OCSPStapleReceivedEvent=c;class p extends t{constructor(C){super("OCSPWSUpgradeStartedEvent",e.EventType.Debug,C)}}_.OCSPWSUpgradeStartedEvent=p;class h extends t{constructor(C,y){super("OCSPCacheEntryExpiredEvent",e.EventType.Debug,C),this.privExpireTime=y}}_.OCSPCacheEntryExpiredEvent=h;class v extends t{constructor(C,y,R){super("OCSPCacheEntryNeedsRefreshEvent",e.EventType.Debug,C),this.privExpireTime=R,this.privStartTime=y}}_.OCSPCacheEntryNeedsRefreshEvent=v;class d extends t{constructor(C,y,R){super("OCSPCacheHitEvent",e.EventType.Debug,C),this.privExpireTime=R,this.privExpireTimeString=new Date(R).toLocaleDateString(),this.privStartTime=y,this.privStartTimeString=new Date(y).toLocaleTimeString()}}_.OCSPCacheHitEvent=d;class f extends t{constructor(C,y){super("OCSPVerificationFailedEvent",e.EventType.Debug,C),this.privError=y}}_.OCSPVerificationFailedEvent=f;class g extends t{constructor(C,y){super("OCSPCacheFetchErrorEvent",e.EventType.Debug,C),this.privError=y}}_.OCSPCacheFetchErrorEvent=g;class m extends t{constructor(C){super("OCSPResponseRetrievedEvent",e.EventType.Debug,C)}}_.OCSPResponseRetrievedEvent=m;class l extends t{constructor(C,y){super("OCSPCacheUpdateErrorEvent",e.EventType.Debug,C),this.privError=y}}return _.OCSPCacheUpdateErrorEvent=l,_}var $e={},ro;function Cd(){if(ro)return $e;ro=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.BackgroundEvent=void 0;const e=I();class t extends e.PlatformEvent{constructor(u){super("BackgroundEvent",e.EventType.Error),this.privError=u}get error(){return this.privError}}return $e.BackgroundEvent=t,$e}var io;function I(){return io||(io=1,(function(e){var t=oe&&oe.__createBinding||(Object.create?(function(n,a,s,r){r===void 0&&(r=s),Object.defineProperty(n,r,{enumerable:!0,get:function(){return a[s]}})}):(function(n,a,s,r){r===void 0&&(r=s),n[r]=a[s]})),i=oe&&oe.__exportStar||function(n,a){for(var s in n)s!=="default"&&!Object.prototype.hasOwnProperty.call(a,s)&&t(a,n,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.TranslationStatus=void 0,i(Zh(),e),i(Yh(),e),i(Xu(),e),i($h(),e),i(ed(),e),i(Zu(),e),i(J(),e),i(td(),e),i(Yu(),e),i(Te(),e),i(rd(),e),i(id(),e),i(nd(),e),i(sd(),e),i(od(),e),i(ad(),e),i(cd(),e),i(ud(),e),i(pd(),e),i(hd(),e),i($u(),e),i(Ci(),e),i(ep(),e),i(tp(),e),i(dd(),e),i(vd(),e),i(ld(),e);var u=Yn();Object.defineProperty(e,"TranslationStatus",{enumerable:!0,get:function(){return u.TranslationStatus}}),i(fd(),e),i(gd(),e),i(md(),e),i(Sd(),e),i(Cd(),e)})(oe)),oe}var et={},no;function U(){if(no)return et;no=1,Object.defineProperty(et,"__esModule",{value:!0}),et.HeaderNames=void 0;let e=class{};return et.HeaderNames=e,e.AuthKey="Ocp-Apim-Subscription-Key",e.Authorization="Authorization",e.SpIDAuthKey="Apim-Subscription-Id",e.ConnectionId="X-ConnectionId",e.ContentType="Content-Type",e.CustomCommandsAppId="X-CommandsAppId",e.Path="Path",e.RequestId="X-RequestId",e.RequestStreamId="X-StreamId",e.RequestTimestamp="X-Timestamp",et}var tt={},so;function $n(){if(so)return tt;so=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.AuthInfo=void 0;class e{constructor(i,u){this.privHeaderName=i,this.privToken=u}get headerName(){return this.privHeaderName}get token(){return this.privToken}}return tt.AuthInfo=e,tt}var oo;function yd(){if(oo)return be;oo=1,Object.defineProperty(be,"__esModule",{value:!0}),be.CognitiveSubscriptionKeyAuthentication=void 0;const e=I(),t=U(),i=$n();let u=class{constructor(a){if(!a)throw new e.ArgumentNullError("subscriptionKey");this.privAuthInfo=new i.AuthInfo(t.HeaderNames.AuthKey,a)}fetch(a){return Promise.resolve(this.privAuthInfo)}fetchOnExpiry(a){return Promise.resolve(this.privAuthInfo)}};return be.CognitiveSubscriptionKeyAuthentication=u,be}var rt={},ao;function Rd(){if(ao)return rt;ao=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.CognitiveTokenAuthentication=void 0;const e=I(),t=$n(),i=U();let u=class Kn{constructor(a,s){if(!a)throw new e.ArgumentNullError("fetchCallback");if(!s)throw new e.ArgumentNullError("fetchOnExpiryCallback");this.privFetchCallback=a,this.privFetchOnExpiryCallback=s}fetch(a){return this.privFetchCallback(a).then(s=>new t.AuthInfo(i.HeaderNames.Authorization,s===void 0?void 0:Kn.privTokenPrefix+s))}fetchOnExpiry(a){return this.privFetchOnExpiryCallback(a).then(s=>new t.AuthInfo(i.HeaderNames.Authorization,s===void 0?void 0:Kn.privTokenPrefix+s))}};return rt.CognitiveTokenAuthentication=u,u.privTokenPrefix="Bearer ",rt}var Ki={},co;function Pd(){return co||(co=1,Object.defineProperty(Ki,"__esModule",{value:!0})),Ki}var Vi={},uo;function Ed(){return uo||(uo=1,Object.defineProperty(Vi,"__esModule",{value:!0})),Vi}var Ji={},po;function es(){return po||(po=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RecognitionEndedEvent=e.RecognitionCompletionStatus=e.RecognitionStartedEvent=e.ConnectingToServiceEvent=e.ListeningStartedEvent=e.RecognitionTriggeredEvent=e.SpeechRecognitionEvent=void 0;const t=I();class i extends t.PlatformEvent{constructor(p,h,v,d=t.EventType.Info){super(p,d),this.privRequestId=h,this.privSessionId=v}get requestId(){return this.privRequestId}get sessionId(){return this.privSessionId}}e.SpeechRecognitionEvent=i;class u extends i{constructor(p,h,v,d){super("RecognitionTriggeredEvent",p,h),this.privAudioSourceId=v,this.privAudioNodeId=d}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}e.RecognitionTriggeredEvent=u;class n extends i{constructor(p,h,v,d){super("ListeningStartedEvent",p,h),this.privAudioSourceId=v,this.privAudioNodeId=d}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}e.ListeningStartedEvent=n;class a extends i{constructor(p,h,v){super("ConnectingToServiceEvent",p,v),this.privAuthFetchEventid=h}get authFetchEventid(){return this.privAuthFetchEventid}}e.ConnectingToServiceEvent=a;class s extends i{constructor(p,h,v,d,f){super("RecognitionStartedEvent",p,f),this.privAudioSourceId=h,this.privAudioNodeId=v,this.privAuthFetchEventId=d}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}}e.RecognitionStartedEvent=s;var r;(function(c){c[c.Success=0]="Success",c[c.AudioSourceError=1]="AudioSourceError",c[c.AudioSourceTimeout=2]="AudioSourceTimeout",c[c.AuthTokenFetchError=3]="AuthTokenFetchError",c[c.AuthTokenFetchTimeout=4]="AuthTokenFetchTimeout",c[c.UnAuthorized=5]="UnAuthorized",c[c.ConnectTimeout=6]="ConnectTimeout",c[c.ConnectError=7]="ConnectError",c[c.ClientRecognitionActivityTimeout=8]="ClientRecognitionActivityTimeout",c[c.UnknownError=9]="UnknownError"})(r=e.RecognitionCompletionStatus||(e.RecognitionCompletionStatus={}));class o extends i{constructor(p,h,v,d,f,g,m,l){super("RecognitionEndedEvent",p,f,m===r.Success?t.EventType.Info:t.EventType.Error),this.privAudioSourceId=h,this.privAudioNodeId=v,this.privAuthFetchEventId=d,this.privStatus=m,this.privError=l,this.privServiceTag=g}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}get serviceTag(){return this.privServiceTag}get status(){return this.privStatus}get error(){return this.privError}}e.RecognitionEndedEvent=o})(Ji)),Ji}var it={},ue={},W={};const Td={},Ad=Object.freeze(Object.defineProperty({__proto__:null,default:Td},Symbol.toStringTag,{value:"Module"})),Ee=Bh(Ad);var Gi={},ho;function rp(){return ho||(ho=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.LogLevel=void 0;const t=I();Object.defineProperty(e,"LogLevel",{enumerable:!0,get:function(){return t.EventType}})})(Gi)),Gi}var nt={},vo;function b(){if(vo)return nt;vo=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.Contracts=void 0;let e=class te{static throwIfNullOrUndefined(i,u){if(i==null)throw new Error("throwIfNullOrUndefined:"+u)}static throwIfNull(i,u){if(i===null)throw new Error("throwIfNull:"+u)}static throwIfNullOrWhitespace(i,u){if(te.throwIfNullOrUndefined(i,u),(""+i).trim().length<1)throw new Error("throwIfNullOrWhitespace:"+u)}static throwIfNullOrTooLong(i,u,n){if(te.throwIfNullOrUndefined(i,u),(""+i).length>n)throw new Error("throwIfNullOrTooLong:"+u+" (more than "+n.toString()+" characters)")}static throwIfNullOrTooShort(i,u,n){if(te.throwIfNullOrUndefined(i,u),(""+i).length<n)throw new Error("throwIfNullOrTooShort:"+u+" (less than "+n.toString()+" characters)")}static throwIfDisposed(i){if(i)throw new Error("the object is already disposed")}static throwIfArrayEmptyOrWhitespace(i,u){if(te.throwIfNullOrUndefined(i,u),i.length===0)throw new Error("throwIfArrayEmptyOrWhitespace:"+u);for(const n of i)te.throwIfNullOrWhitespace(n,u)}static throwIfFileDoesNotExist(i,u){te.throwIfNullOrWhitespace(i,u)}static throwIfNotUndefined(i,u){if(i!==void 0)throw new Error("throwIfNotUndefined:"+u)}static throwIfNumberOutOfRange(i,u,n,a){if(te.throwIfNullOrUndefined(i,u),i<n||i>a)throw new Error("throwIfNumberOutOfRange:"+u+" (must be between "+n.toString()+" and "+a.toString()+")")}};return nt.Contracts=e,nt}var lo;function Id(){if(lo)return W;lo=1;var e=W&&W.__createBinding||(Object.create?(function(r,o,c,p){p===void 0&&(p=c),Object.defineProperty(r,p,{enumerable:!0,get:function(){return o[c]}})}):(function(r,o,c,p){p===void 0&&(p=c),r[p]=o[c]})),t=W&&W.__setModuleDefault||(Object.create?(function(r,o){Object.defineProperty(r,"default",{enumerable:!0,value:o})}):function(r,o){r.default=o}),i=W&&W.__importStar||function(r){if(r&&r.__esModule)return r;var o={};if(r!=null)for(var c in r)c!=="default"&&Object.prototype.hasOwnProperty.call(r,c)&&e(o,r,c);return t(o,r),o};Object.defineProperty(W,"__esModule",{value:!0}),W.ConsoleLoggingListener=void 0;const u=i(Ee),n=rp(),a=b();let s=class{constructor(o=n.LogLevel.None){this.privLogPath=void 0,this.privEnableConsoleOutput=!0,this.privLogLevelFilter=o}set logPath(o){a.Contracts.throwIfNullOrUndefined(u.openSync,`
File System access not available`),this.privLogPath=o}set enableConsoleOutput(o){this.privEnableConsoleOutput=o}onEvent(o){if(o.eventType>=this.privLogLevelFilter){const c=this.toString(o);if(this.logCallback&&this.logCallback(c),this.privLogPath&&u.writeFileSync(this.privLogPath,c+`
`,{flag:"a+"}),this.privEnableConsoleOutput)switch(o.eventType){case n.LogLevel.Debug:console.debug(c);break;case n.LogLevel.Info:console.info(c);break;case n.LogLevel.Warning:console.warn(c);break;case n.LogLevel.Error:console.error(c);break;default:console.log(c);break}}}toString(o){const c=[`${o.eventTime}`,`${o.name}`],p=o;for(const h in p)if(h&&o.hasOwnProperty(h)&&h!=="eventTime"&&h!=="eventType"&&h!=="eventId"&&h!=="name"&&h!=="constructor"){const v=p[h];let d="<NULL>";v!=null&&(typeof v=="number"||typeof v=="string"?d=v.toString():d=JSON.stringify(v)),c.push(`${h}: ${d}`)}return c.join(" | ")}};return W.ConsoleLoggingListener=s,W}var Qi={},fo;function wd(){return fo||(fo=1,Object.defineProperty(Qi,"__esModule",{value:!0})),Qi}var Xi={},Zi={},go;function Ae(){return go||(go=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AudioStreamFormatImpl=e.AudioStreamFormat=e.AudioFormatTag=void 0;var t;(function(n){n[n.PCM=1]="PCM",n[n.MuLaw=2]="MuLaw",n[n.Siren=3]="Siren",n[n.MP3=4]="MP3",n[n.SILKSkype=5]="SILKSkype",n[n.OGG_OPUS=6]="OGG_OPUS",n[n.WEBM_OPUS=7]="WEBM_OPUS",n[n.ALaw=8]="ALaw",n[n.FLAC=9]="FLAC",n[n.OPUS=10]="OPUS",n[n.AMR_WB=11]="AMR_WB",n[n.G722=12]="G722"})(t=e.AudioFormatTag||(e.AudioFormatTag={}));class i{static getDefaultInputFormat(){return u.getDefaultInputFormat()}static getWaveFormat(a,s,r,o){return new u(a,s,r,o)}static getWaveFormatPCM(a,s,r){return new u(a,s,r)}}e.AudioStreamFormat=i;class u extends i{constructor(a=16e3,s=16,r=1,o=t.PCM){super();let c=!0;switch(o){case t.PCM:this.formatTag=1;break;case t.ALaw:this.formatTag=6;break;case t.MuLaw:this.formatTag=7;break;default:c=!1}if(this.bitsPerSample=s,this.samplesPerSec=a,this.channels=r,this.avgBytesPerSec=this.samplesPerSec*this.channels*(this.bitsPerSample/8),this.blockAlign=this.channels*Math.max(this.bitsPerSample,8),c){this.privHeader=new ArrayBuffer(44);const p=new DataView(this.privHeader);this.setString(p,0,"RIFF"),p.setUint32(4,0,!0),this.setString(p,8,"WAVEfmt "),p.setUint32(16,16,!0),p.setUint16(20,this.formatTag,!0),p.setUint16(22,this.channels,!0),p.setUint32(24,this.samplesPerSec,!0),p.setUint32(28,this.avgBytesPerSec,!0),p.setUint16(32,this.channels*(this.bitsPerSample/8),!0),p.setUint16(34,this.bitsPerSample,!0),this.setString(p,36,"data"),p.setUint32(40,0,!0)}}static getDefaultInputFormat(){return new u}static getAudioContext(a){const s=window.AudioContext||window.webkitAudioContext||!1;if(s)return a!==void 0&&navigator.mediaDevices.getSupportedConstraints().sampleRate?new s({sampleRate:a}):new s;throw new Error("Browser does not support Web Audio API (AudioContext is not available).")}close(){}get header(){return this.privHeader}setString(a,s,r){for(let o=0;o<r.length;o++)a.setUint8(s+o,r.charCodeAt(o))}}e.AudioStreamFormatImpl=u})(Zi)),Zi}var mo;function _d(){return mo||(mo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MicAudioSource=e.AudioWorkletSourceURLPropertyName=void 0;const t=A(),i=I(),u=Ae();e.AudioWorkletSourceURLPropertyName="MICROPHONE-WorkletSourceUrl";class n{constructor(s,r,o,c){this.privRecorder=s,this.deviceId=r,this.privStreams={},this.privOutputChunkSize=n.AUDIOFORMAT.avgBytesPerSec/10,this.privId=o||(0,i.createNoDashGuid)(),this.privEvents=new i.EventSource,this.privMediaStream=c||null,this.privIsClosing=!1}get format(){return Promise.resolve(n.AUDIOFORMAT)}turnOn(){if(this.privInitializeDeferral)return this.privInitializeDeferral.promise;this.privInitializeDeferral=new i.Deferred;try{this.createAudioContext()}catch(o){if(o instanceof Error){const c=o;this.privInitializeDeferral.reject(c.name+": "+c.message)}else this.privInitializeDeferral.reject(o);return this.privInitializeDeferral.promise}const s=window.navigator;let r=s.getUserMedia||s.webkitGetUserMedia||s.mozGetUserMedia||s.msGetUserMedia;if(s.mediaDevices&&(r=(o,c,p)=>{s.mediaDevices.getUserMedia(o).then(c).catch(p)}),r){const o=()=>{this.onEvent(new i.AudioSourceInitializingEvent(this.privId)),this.privMediaStream&&this.privMediaStream.active?(this.onEvent(new i.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()):r({audio:this.deviceId?{deviceId:this.deviceId}:!0,video:!1},c=>{this.privMediaStream=c,this.onEvent(new i.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()},c=>{const p=`Error occurred during microphone initialization: ${c}`;this.privInitializeDeferral.reject(p),this.onEvent(new i.AudioSourceErrorEvent(this.privId,p))})};this.privContext.state==="suspended"?this.privContext.resume().then(o).catch(c=>{this.privInitializeDeferral.reject(`Failed to initialize audio context: ${c}`)}):o()}else{const o="Browser does not support getUserMedia.";this.privInitializeDeferral.reject(o),this.onEvent(new i.AudioSourceErrorEvent(o,""))}return this.privInitializeDeferral.promise}id(){return this.privId}attach(s){return this.onEvent(new i.AudioStreamNodeAttachingEvent(this.privId,s)),this.listen(s).then(r=>(this.onEvent(new i.AudioStreamNodeAttachedEvent(this.privId,s)),{detach:async()=>(r.readEnded(),delete this.privStreams[s],this.onEvent(new i.AudioStreamNodeDetachedEvent(this.privId,s)),this.turnOff()),id:()=>s,read:()=>r.read()}))}detach(s){s&&this.privStreams[s]&&(this.privStreams[s].close(),delete this.privStreams[s],this.onEvent(new i.AudioStreamNodeDetachedEvent(this.privId,s)))}async turnOff(){for(const s in this.privStreams)if(s){const r=this.privStreams[s];r&&r.close()}this.onEvent(new i.AudioSourceOffEvent(this.privId)),this.privInitializeDeferral&&(await this.privInitializeDeferral,this.privInitializeDeferral=null),await this.destroyAudioContext()}get events(){return this.privEvents}get deviceInfo(){return this.getMicrophoneLabel().then(s=>({bitspersample:n.AUDIOFORMAT.bitsPerSample,channelcount:n.AUDIOFORMAT.channels,connectivity:t.connectivity.Unknown,manufacturer:"Speech SDK",model:s,samplerate:n.AUDIOFORMAT.samplesPerSec,type:t.type.Microphones}))}setProperty(s,r){if(s===e.AudioWorkletSourceURLPropertyName)this.privRecorder.setWorkletUrl(r);else throw new Error("Property '"+s+"' is not supported on Microphone.")}getMicrophoneLabel(){const s="microphone";if(this.privMicrophoneLabel!==void 0)return Promise.resolve(this.privMicrophoneLabel);if(this.privMediaStream===void 0||!this.privMediaStream.active)return Promise.resolve(s);this.privMicrophoneLabel=s;const r=this.privMediaStream.getTracks()[0].getSettings().deviceId;if(r===void 0)return Promise.resolve(this.privMicrophoneLabel);const o=new i.Deferred;return navigator.mediaDevices.enumerateDevices().then(c=>{for(const p of c)if(p.deviceId===r){this.privMicrophoneLabel=p.label;break}o.resolve(this.privMicrophoneLabel)},()=>o.resolve(this.privMicrophoneLabel)),o.promise}async listen(s){await this.turnOn();const r=new i.ChunkedArrayBufferStream(this.privOutputChunkSize,s);this.privStreams[s]=r;try{this.privRecorder.record(this.privContext,this.privMediaStream,r)}catch(c){throw this.onEvent(new i.AudioStreamNodeErrorEvent(this.privId,s,c)),c}return r}onEvent(s){this.privEvents.onEvent(s),i.Events.instance.onEvent(s)}createAudioContext(){this.privContext||(this.privContext=u.AudioStreamFormatImpl.getAudioContext(n.AUDIOFORMAT.samplesPerSec))}async destroyAudioContext(){if(!this.privContext)return;this.privRecorder.releaseMediaResources(this.privContext);let s=!1;"close"in this.privContext&&(s=!0),s?this.privIsClosing||(this.privIsClosing=!0,await this.privContext.close(),this.privContext=null,this.privIsClosing=!1):this.privContext!==null&&this.privContext.state==="running"&&await this.privContext.suspend()}}e.MicAudioSource=n,n.AUDIOFORMAT=u.AudioStreamFormat.getDefaultInputFormat()})(Xi)),Xi}var st={},So;function bd(){if(So)return st;So=1,Object.defineProperty(st,"__esModule",{value:!0}),st.FileAudioSource=void 0;const e=A(),t=I(),i=Ae();let u=class{constructor(a,s,r){this.privStreams={},this.privHeaderEnd=44,this.privId=r||(0,t.createNoDashGuid)(),this.privEvents=new t.EventSource,this.privSource=a,typeof window<"u"&&typeof Blob<"u"&&this.privSource instanceof Blob?this.privFilename=a.name:this.privFilename=s||"unknown.wav",this.privAudioFormatPromise=this.readHeader()}get format(){return this.privAudioFormatPromise}turnOn(){if(this.privFilename.lastIndexOf(".wav")!==this.privFilename.length-4){const a=this.privFilename+" is not supported. Only WAVE files are allowed at the moment.";return this.onEvent(new t.AudioSourceErrorEvent(a,"")),Promise.reject(a)}this.onEvent(new t.AudioSourceInitializingEvent(this.privId)),this.onEvent(new t.AudioSourceReadyEvent(this.privId))}id(){return this.privId}async attach(a){this.onEvent(new t.AudioStreamNodeAttachingEvent(this.privId,a));const s=await this.upload(a);return this.onEvent(new t.AudioStreamNodeAttachedEvent(this.privId,a)),Promise.resolve({detach:async()=>{s.readEnded(),delete this.privStreams[a],this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,a)),await this.turnOff()},id:()=>a,read:()=>s.read()})}detach(a){a&&this.privStreams[a]&&(this.privStreams[a].close(),delete this.privStreams[a],this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,a)))}turnOff(){for(const a in this.privStreams)if(a){const s=this.privStreams[a];s&&!s.isClosed&&s.close()}return this.onEvent(new t.AudioSourceOffEvent(this.privId)),Promise.resolve()}get events(){return this.privEvents}get deviceInfo(){return this.privAudioFormatPromise.then(a=>Promise.resolve({bitspersample:a.bitsPerSample,channelcount:a.channels,connectivity:e.connectivity.Unknown,manufacturer:"Speech SDK",model:"File",samplerate:a.samplesPerSec,type:e.type.File}))}readHeader(){const s=this.privSource.slice(0,4296),r=new t.Deferred,o=c=>{const p=new DataView(c),h=l=>String.fromCharCode(p.getUint8(l),p.getUint8(l+1),p.getUint8(l+2),p.getUint8(l+3));if(h(0)!=="RIFF"){r.reject("Invalid WAV header in file, RIFF was not found");return}if(h(8)!=="WAVE"||h(12)!=="fmt "){r.reject("Invalid WAV header in file, WAVEfmt was not found");return}const v=p.getInt32(16,!0),d=p.getUint16(22,!0),f=p.getUint32(24,!0),g=p.getUint16(34,!0);let m=36+Math.max(v-16,0);for(;h(m)!=="data";m+=2)if(m>4288){r.reject("Invalid WAV header in file, data block was not found");return}this.privHeaderEnd=m+8,r.resolve(i.AudioStreamFormat.getWaveFormatPCM(f,g,d))};if(typeof window<"u"&&typeof Blob<"u"&&s instanceof Blob){const c=new FileReader;c.onload=p=>{const h=p.target.result;o(h)},c.readAsArrayBuffer(s)}else{const c=s;o(c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength))}return r.promise}async upload(a){const s=r=>{const o=`Error occurred while processing '${this.privFilename}'. ${r}`;throw this.onEvent(new t.AudioStreamNodeErrorEvent(this.privId,a,o)),new Error(o)};try{await this.turnOn();const r=await this.privAudioFormatPromise,o=new t.ChunkedArrayBufferStream(r.avgBytesPerSec/10,a);this.privStreams[a]=o;const c=this.privSource.slice(this.privHeaderEnd),p=h=>{o.isClosed||(o.writeStreamChunk({buffer:h,isEnd:!1,timeReceived:Date.now()}),o.close())};if(typeof window<"u"&&typeof Blob<"u"&&c instanceof Blob){const h=new FileReader;h.onerror=v=>s(v.toString()),h.onload=v=>{const d=v.target.result;p(d)},h.readAsArrayBuffer(c)}else{const h=c;p(h.buffer.slice(h.byteOffset,h.byteOffset+h.byteLength))}return o}catch(r){s(r)}}onEvent(a){this.privEvents.onEvent(a),t.Events.instance.onEvent(a)}};return st.FileAudioSource=u,st}var ot={},Co;function Md(){if(Co)return ot;Co=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.PcmRecorder=void 0;const e=I();class t{constructor(u){this.privStopInputOnRelease=u}record(u,n,a){const r=new e.RiffPcmEncoder(u.sampleRate,16e3),o=u.createMediaStreamSource(n),c=()=>{const h=(()=>{let v=0;try{return u.createScriptProcessor(v,1,1)}catch{v=2048;let f=u.sampleRate;for(;v<16384&&f>=32e3;)v<<=1,f>>=1;return u.createScriptProcessor(v,1,1)}})();h.onaudioprocess=v=>{const d=v.inputBuffer.getChannelData(0);if(a&&!a.isClosed){const f=r.encode(d);f&&a.writeStreamChunk({buffer:f,isEnd:!1,timeReceived:Date.now()})}},o.connect(h),h.connect(u.destination),this.privMediaResources={scriptProcessorNode:h,source:o,stream:n}},p=!!this.privSpeechProcessorScript&&this.privSpeechProcessorScript.toLowerCase()==="ignore";if(u.audioWorklet&&!p){if(!this.privSpeechProcessorScript){const h=`class SP extends AudioWorkletProcessor {
                    constructor(options) {
                      super(options);
                    }
                    process(inputs, outputs) {
                      const input = inputs[0];
                      const output = [];
                      for (let channel = 0; channel < input.length; channel += 1) {
                        output[channel] = input[channel];
                      }
                      this.port.postMessage(output[0]);
                      return true;
                    }
                  }
                  registerProcessor('speech-processor', SP);`,v=new Blob([h],{type:"application/javascript; charset=utf-8"});this.privSpeechProcessorScript=URL.createObjectURL(v)}u.audioWorklet.addModule(this.privSpeechProcessorScript).then(()=>{const h=new AudioWorkletNode(u,"speech-processor");h.port.onmessage=v=>{const d=v.data;if(a&&!a.isClosed){const f=r.encode(d);f&&a.writeStreamChunk({buffer:f,isEnd:!1,timeReceived:Date.now()})}},o.connect(h),h.connect(u.destination),this.privMediaResources={scriptProcessorNode:h,source:o,stream:n}}).catch(()=>{c()})}else try{c()}catch(h){throw new Error(`Unable to start audio worklet node for PCMRecorder: ${h}`)}}releaseMediaResources(u){this.privMediaResources&&(this.privMediaResources.scriptProcessorNode&&(this.privMediaResources.scriptProcessorNode.disconnect(u.destination),this.privMediaResources.scriptProcessorNode=null),this.privMediaResources.source&&(this.privMediaResources.source.disconnect(),this.privStopInputOnRelease&&this.privMediaResources.stream.getTracks().forEach(n=>n.stop()),this.privMediaResources.source=null))}setWorkletUrl(u){this.privSpeechProcessorScript=u}}return ot.PcmRecorder=t,ot}var at={},q={},yo;function ip(){if(yo)return q;yo=1;var e=q&&q.__createBinding||(Object.create?(function(v,d,f,g){g===void 0&&(g=f),Object.defineProperty(v,g,{enumerable:!0,get:function(){return d[f]}})}):(function(v,d,f,g){g===void 0&&(g=f),v[g]=d[f]})),t=q&&q.__setModuleDefault||(Object.create?(function(v,d){Object.defineProperty(v,"default",{enumerable:!0,value:d})}):function(v,d){v.default=d}),i=q&&q.__importStar||function(v){if(v&&v.__esModule)return v;var d={};if(v!=null)for(var f in v)f!=="default"&&Object.prototype.hasOwnProperty.call(v,f)&&e(d,v,f);return t(d,v),d},u=q&&q.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(q,"__esModule",{value:!0}),q.WebsocketMessageAdapter=void 0;const n=i(Ee),a=i(Ee),s=u(Ee),r=u(Ee),o=u(Ee),c=U(),p=I();let h=class Vn{constructor(d,f,g,m,l,S){if(!d)throw new p.ArgumentNullError("uri");if(!g)throw new p.ArgumentNullError("messageFormatter");this.proxyInfo=m,this.privConnectionEvents=new p.EventSource,this.privConnectionId=f,this.privMessageFormatter=g,this.privConnectionState=p.ConnectionState.None,this.privUri=d,this.privHeaders=l,this.privEnableCompression=S,this.privHeaders[c.HeaderNames.ConnectionId]=this.privConnectionId,this.privHeaders.connectionId=this.privConnectionId,this.privLastErrorReceived=""}get state(){return this.privConnectionState}open(){if(this.privConnectionState===p.ConnectionState.Disconnected)return Promise.reject(`Cannot open a connection that is in ${this.privConnectionState} state`);if(this.privConnectionEstablishDeferral)return this.privConnectionEstablishDeferral.promise;this.privConnectionEstablishDeferral=new p.Deferred,this.privCertificateValidatedDeferral=new p.Deferred,this.privConnectionState=p.ConnectionState.Connecting;try{if(typeof WebSocket<"u"&&!Vn.forceNpmWebSocket)this.privCertificateValidatedDeferral.resolve(),this.privWebsocketClient=new WebSocket(this.privUri);else{let f=new URL(this.privUri).protocol;(f==null?void 0:f.toLocaleLowerCase())==="wss:"?f="https:":(f==null?void 0:f.toLocaleLowerCase())==="ws:"&&(f="http:");const g={headers:this.privHeaders,perMessageDeflate:this.privEnableCompression,followRedirects:f.toLocaleLowerCase()==="https:"};this.privCertificateValidatedDeferral.resolve(),g.agent=this.getAgent(),g.agent.protocol=f,this.privWebsocketClient=new o.default(this.privUri,g),this.privWebsocketClient.on("redirect",m=>{const l=new p.ConnectionRedirectEvent(this.privConnectionId,m,this.privUri,`Getting redirect URL from endpoint ${this.privUri} with redirect URL '${m}'`);p.Events.instance.onEvent(l)})}this.privWebsocketClient.binaryType="arraybuffer",this.privReceivingMessageQueue=new p.Queue,this.privDisconnectDeferral=new p.Deferred,this.privSendMessageQueue=new p.Queue,this.processSendQueue().catch(d=>{p.Events.instance.onEvent(new p.BackgroundEvent(d))})}catch(d){return this.privConnectionEstablishDeferral.resolve(new p.ConnectionOpenResponse(500,d)),this.privConnectionEstablishDeferral.promise}return this.onEvent(new p.ConnectionStartEvent(this.privConnectionId,this.privUri)),this.privWebsocketClient.onopen=()=>{this.privCertificateValidatedDeferral.promise.then(()=>{this.privConnectionState=p.ConnectionState.Connected,this.onEvent(new p.ConnectionEstablishedEvent(this.privConnectionId)),this.privConnectionEstablishDeferral.resolve(new p.ConnectionOpenResponse(200,""))},d=>{this.privConnectionEstablishDeferral.reject(d)})},this.privWebsocketClient.onerror=d=>{this.onEvent(new p.ConnectionErrorEvent(this.privConnectionId,d.message,d.type)),this.privLastErrorReceived=d.message},this.privWebsocketClient.onclose=d=>{this.privConnectionState===p.ConnectionState.Connecting?(this.privConnectionState=p.ConnectionState.Disconnected,this.privConnectionEstablishDeferral.resolve(new p.ConnectionOpenResponse(d.code,d.reason+" "+this.privLastErrorReceived))):(this.privConnectionState=p.ConnectionState.Disconnected,this.privWebsocketClient=null,this.onEvent(new p.ConnectionClosedEvent(this.privConnectionId,d.code,d.reason))),this.onClose(d.code,d.reason).catch(f=>{p.Events.instance.onEvent(new p.BackgroundEvent(f))})},this.privWebsocketClient.onmessage=d=>{const f=new Date().toISOString();if(this.privConnectionState===p.ConnectionState.Connected){const g=new p.Deferred;if(this.privReceivingMessageQueue.enqueueFromPromise(g.promise),d.data instanceof ArrayBuffer){const m=new p.RawWebsocketMessage(p.MessageType.Binary,d.data);this.privMessageFormatter.toConnectionMessage(m).then(l=>{this.onEvent(new p.ConnectionMessageReceivedEvent(this.privConnectionId,f,l)),g.resolve(l)},l=>{g.reject(`Invalid binary message format. Error: ${l}`)})}else{const m=new p.RawWebsocketMessage(p.MessageType.Text,d.data);this.privMessageFormatter.toConnectionMessage(m).then(l=>{this.onEvent(new p.ConnectionMessageReceivedEvent(this.privConnectionId,f,l)),g.resolve(l)},l=>{g.reject(`Invalid text message format. Error: ${l}`)})}}},this.privConnectionEstablishDeferral.promise}send(d){if(this.privConnectionState!==p.ConnectionState.Connected)return Promise.reject(`Cannot send on connection that is in ${p.ConnectionState[this.privConnectionState]} state`);const f=new p.Deferred,g=new p.Deferred;return this.privSendMessageQueue.enqueueFromPromise(g.promise),this.privMessageFormatter.fromConnectionMessage(d).then(m=>{g.resolve({Message:d,RawWebsocketMessage:m,sendStatusDeferral:f})},m=>{g.reject(`Error formatting the message. ${m}`)}),f.promise}read(){return this.privConnectionState!==p.ConnectionState.Connected?Promise.reject(`Cannot read on connection that is in ${this.privConnectionState} state`):this.privReceivingMessageQueue.dequeue()}close(d){if(this.privWebsocketClient)this.privConnectionState!==p.ConnectionState.Disconnected&&this.privWebsocketClient.close(1e3,d||"Normal closure by client");else return Promise.resolve();return this.privDisconnectDeferral.promise}get events(){return this.privConnectionEvents}sendRawMessage(d){try{if(!d)return Promise.resolve();if(this.onEvent(new p.ConnectionMessageSentEvent(this.privConnectionId,new Date().toISOString(),d.Message)),this.isWebsocketOpen)this.privWebsocketClient.send(d.RawWebsocketMessage.payload);else return Promise.reject("websocket send error: Websocket not ready "+this.privConnectionId+" "+d.Message.id+" "+new Error().stack);return Promise.resolve()}catch(f){return Promise.reject(`websocket send error: ${f}`)}}async onClose(d,f){const g=`Connection closed. ${d}: ${f}`;this.privConnectionState=p.ConnectionState.Disconnected,this.privDisconnectDeferral.resolve(),await this.privReceivingMessageQueue.drainAndDispose(()=>{},g),await this.privSendMessageQueue.drainAndDispose(m=>{m.sendStatusDeferral.reject(g)},g)}async processSendQueue(){for(;;){const f=await this.privSendMessageQueue.dequeue();if(!f)return;try{await this.sendRawMessage(f),f.sendStatusDeferral.resolve()}catch(g){f.sendStatusDeferral.reject(g)}}}onEvent(d){this.privConnectionEvents.onEvent(d),p.Events.instance.onEvent(d)}getAgent(){const d=new s.default.Agent(this.createConnection);return this.proxyInfo!==void 0&&this.proxyInfo.HostName!==void 0&&this.proxyInfo.Port>0&&(d.proxyInfo=this.proxyInfo),d}static GetProxyAgent(d){const f={host:d.HostName,port:d.Port};return d.UserName?f.headers={"Proxy-Authentication":"Basic "+Buffer.from(`${d.UserName}:${d.Password===void 0?"":d.Password}`).toString("base64")}:f.headers={},f.headers.requestOCSP="true",new r.default(f)}createConnection(d,f){let g;if(f={...f,requestOCSP:!0,servername:f.host},this.proxyInfo){const l=Vn.GetProxyAgent(this.proxyInfo);g=new Promise((S,C)=>{l.callback(d,f,(y,R)=>{y?C(y):S(R)})})}else f.secureEndpoint?g=Promise.resolve(a.connect(f)):g=Promise.resolve(n.connect(f));return g}get isWebsocketOpen(){return this.privWebsocketClient&&this.privWebsocketClient.readyState===this.privWebsocketClient.OPEN}};return q.WebsocketMessageAdapter=h,h.forceNpmWebSocket=!1,q}var Ro;function Od(){if(Ro)return at;Ro=1,Object.defineProperty(at,"__esModule",{value:!0}),at.WebsocketConnection=void 0;const e=I(),t=ip();let i=class{constructor(n,a,s,r,o,c=!1,p){if(this.privIsDisposed=!1,!n)throw new e.ArgumentNullError("uri");if(!r)throw new e.ArgumentNullError("messageFormatter");this.privMessageFormatter=r;let h="",v=0;if(a){for(const d in a)if(d){h+=v===0&&n.indexOf("?")===-1?"?":"&";const f=encodeURIComponent(d);h+=f;let g=a[d];g&&(g=encodeURIComponent(g),h+=`=${g}`),v++}}if(s){for(const d in s)if(d){h+=v===0&&n.indexOf("?")===-1?"?":"&";const f=encodeURIComponent(s[d]);h+=`${d}=${f}`,v++}}this.privUri=n+h,this.privId=p||(0,e.createNoDashGuid)(),this.privConnectionMessageAdapter=new t.WebsocketMessageAdapter(this.privUri,this.id,this.privMessageFormatter,o,s,c)}async dispose(){this.privIsDisposed=!0,this.privConnectionMessageAdapter&&await this.privConnectionMessageAdapter.close()}isDisposed(){return this.privIsDisposed}get id(){return this.privId}get uri(){return this.privUri}state(){return this.privConnectionMessageAdapter.state}open(){return this.privConnectionMessageAdapter.open()}send(n){return this.privConnectionMessageAdapter.send(n)}read(){return this.privConnectionMessageAdapter.read()}get events(){return this.privConnectionMessageAdapter.events}};return at.WebsocketConnection=i,at}var ct={},Po;function Dd(){if(Po)return ct;Po=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.ReplayableAudioNode=void 0;let e=class{constructor(u,n){this.privBuffers=[],this.privReplayOffset=0,this.privLastShrinkOffset=0,this.privBufferStartOffset=0,this.privBufferSerial=0,this.privBufferedBytes=0,this.privReplay=!1,this.privLastChunkAcquiredTime=0,this.privAudioNode=u,this.privBytesPerSecond=n}id(){return this.privAudioNode.id()}read(){if(this.privReplay&&this.privBuffers.length!==0){const u=this.privReplayOffset-this.privBufferStartOffset;let n=Math.round(u*this.privBytesPerSecond*1e-7);n%2!==0&&n++;let a=0;for(;a<this.privBuffers.length&&n>=this.privBuffers[a].chunk.buffer.byteLength;)n-=this.privBuffers[a++].chunk.buffer.byteLength;if(a<this.privBuffers.length){const s=this.privBuffers[a].chunk.buffer.slice(n);return this.privReplayOffset+=s.byteLength/this.privBytesPerSecond*1e7,a===this.privBuffers.length-1&&(this.privReplay=!1),Promise.resolve({buffer:s,isEnd:!1,timeReceived:this.privBuffers[a].chunk.timeReceived})}}return this.privAudioNode.read().then(u=>(u&&u.buffer&&this.privBuffers&&(this.privBuffers.push(new t(u,this.privBufferSerial++,this.privBufferedBytes)),this.privBufferedBytes+=u.buffer.byteLength),u))}detach(){return this.privBuffers=void 0,this.privAudioNode.detach()}replay(){this.privBuffers&&this.privBuffers.length!==0&&(this.privReplay=!0,this.privReplayOffset=this.privLastShrinkOffset)}shrinkBuffers(u){if(this.privBuffers===void 0||this.privBuffers.length===0)return;this.privLastShrinkOffset=u;const n=u-this.privBufferStartOffset;let a=Math.round(n*this.privBytesPerSecond*1e-7),s=0;for(;s<this.privBuffers.length&&a>=this.privBuffers[s].chunk.buffer.byteLength;)a-=this.privBuffers[s++].chunk.buffer.byteLength;this.privBufferStartOffset=Math.round(u-a/this.privBytesPerSecond*1e7),this.privBuffers=this.privBuffers.slice(s)}findTimeAtOffset(u){if(u<this.privBufferStartOffset||this.privBuffers===void 0)return 0;for(const n of this.privBuffers){const a=n.byteOffset/this.privBytesPerSecond*1e7,s=a+n.chunk.buffer.byteLength/this.privBytesPerSecond*1e7;if(u>=a&&u<=s)return n.chunk.timeReceived}return 0}};ct.ReplayableAudioNode=e;class t{constructor(u,n,a){this.chunk=u,this.serial=n,this.byteOffset=a}}return ct}var ut={},Yi={},Q={},H={},Eo;function np(){if(Eo)return H;Eo=1;var e=H&&H.__createBinding||(Object.create?(function(s,r,o,c){c===void 0&&(c=o),Object.defineProperty(s,c,{enumerable:!0,get:function(){return r[o]}})}):(function(s,r,o,c){c===void 0&&(c=o),s[c]=r[o]})),t=H&&H.__setModuleDefault||(Object.create?(function(s,r){Object.defineProperty(s,"default",{enumerable:!0,value:r})}):function(s,r){s.default=r}),i=H&&H.__importStar||function(s){if(s&&s.__esModule)return s;var r={};if(s!=null)for(var o in s)o!=="default"&&Object.prototype.hasOwnProperty.call(s,o)&&e(r,s,o);return t(r,s),r};Object.defineProperty(H,"__esModule",{value:!0}),H.AudioFileWriter=void 0;const u=i(Ee),n=b();let a=class{constructor(r){n.Contracts.throwIfNullOrUndefined(u.openSync,`
File System access not available, please use Push or PullAudioOutputStream`),this.privFd=u.openSync(r,"w")}set format(r){n.Contracts.throwIfNotUndefined(this.privAudioFormat,"format is already set"),this.privAudioFormat=r;let o=0;this.privAudioFormat.hasHeader&&(o=this.privAudioFormat.header.byteLength),this.privFd!==void 0&&(this.privWriteStream=u.createWriteStream("",{fd:this.privFd,start:o,autoClose:!1}))}write(r){n.Contracts.throwIfNullOrUndefined(this.privAudioFormat,"must set format before writing."),this.privWriteStream!==void 0&&this.privWriteStream.write(new Uint8Array(r.slice(0)))}close(){this.privFd!==void 0&&(this.privWriteStream.on("finish",()=>{this.privAudioFormat.hasHeader&&(this.privAudioFormat.updateHeader(this.privWriteStream.bytesWritten),u.writeSync(this.privFd,new Int8Array(this.privAudioFormat.header),0,this.privAudioFormat.header.byteLength,0)),u.closeSync(this.privFd),this.privFd=void 0}),this.privWriteStream.end())}id(){return this.privId}};return H.AudioFileWriter=a,H}var B={},To;function sp(){if(To)return B;To=1,Object.defineProperty(B,"__esModule",{value:!0}),B.PullAudioInputStreamImpl=B.PullAudioInputStream=B.PushAudioInputStreamImpl=B.PushAudioInputStream=B.AudioInputStream=void 0;const e=A(),t=I(),i=Te(),u=P(),n=Ae();let a=class{constructor(){}static createPushStream(h){return s.create(h)}static createPullStream(h,v){return o.create(h,v)}};B.AudioInputStream=a;class s extends a{static create(h){return new r(h)}}B.PushAudioInputStream=s;class r extends s{constructor(h){super(),h===void 0?this.privFormat=n.AudioStreamFormatImpl.getDefaultInputFormat():this.privFormat=h,this.privEvents=new t.EventSource,this.privId=(0,i.createNoDashGuid)(),this.privStream=new t.ChunkedArrayBufferStream(this.privFormat.avgBytesPerSec/10)}get format(){return Promise.resolve(this.privFormat)}write(h){this.privStream.writeStreamChunk({buffer:h,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}id(){return this.privId}turnOn(){this.onEvent(new t.AudioSourceInitializingEvent(this.privId)),this.onEvent(new t.AudioSourceReadyEvent(this.privId))}async attach(h){this.onEvent(new t.AudioStreamNodeAttachingEvent(this.privId,h)),await this.turnOn();const v=this.privStream;return this.onEvent(new t.AudioStreamNodeAttachedEvent(this.privId,h)),{detach:async()=>(this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,h)),this.turnOff()),id:()=>h,read:()=>v.read()}}detach(h){this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,h))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:e.connectivity.Unknown,manufacturer:"Speech SDK",model:"PushStream",samplerate:this.privFormat.samplesPerSec,type:e.type.Stream})}onEvent(h){this.privEvents.onEvent(h),t.Events.instance.onEvent(h)}toBuffer(h){const v=Buffer.alloc(h.byteLength),d=new Uint8Array(h);for(let f=0;f<v.length;++f)v[f]=d[f];return v}}B.PushAudioInputStreamImpl=r;class o extends a{constructor(){super()}static create(h,v){return new c(h,v)}}B.PullAudioInputStream=o;class c extends o{constructor(h,v){super(),v===void 0?this.privFormat=u.AudioStreamFormat.getDefaultInputFormat():this.privFormat=v,this.privEvents=new t.EventSource,this.privId=(0,i.createNoDashGuid)(),this.privCallback=h,this.privIsClosed=!1,this.privBufferSize=this.privFormat.avgBytesPerSec/10}get format(){return Promise.resolve(this.privFormat)}close(){this.privIsClosed=!0,this.privCallback.close()}id(){return this.privId}turnOn(){this.onEvent(new t.AudioSourceInitializingEvent(this.privId)),this.onEvent(new t.AudioSourceReadyEvent(this.privId))}async attach(h){return this.onEvent(new t.AudioStreamNodeAttachingEvent(this.privId,h)),await this.turnOn(),this.onEvent(new t.AudioStreamNodeAttachedEvent(this.privId,h)),{detach:()=>(this.privCallback.close(),this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,h)),this.turnOff()),id:()=>h,read:()=>{let v=0,d;for(;v<this.privBufferSize;){const f=new ArrayBuffer(this.privBufferSize-v),g=this.privCallback.read(f);if(d===void 0?d=f:new Int8Array(d).set(new Int8Array(f),v),g===0)break;v+=g}return Promise.resolve({buffer:d.slice(0,v),isEnd:this.privIsClosed||v===0,timeReceived:Date.now()})}}}detach(h){this.onEvent(new t.AudioStreamNodeDetachedEvent(this.privId,h))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:e.connectivity.Unknown,manufacturer:"Speech SDK",model:"PullStream",samplerate:this.privFormat.samplesPerSec,type:e.type.Stream})}onEvent(h){this.privEvents.onEvent(h),t.Events.instance.onEvent(h)}}return B.PullAudioInputStreamImpl=c,B}var F={},pt={},$i={},Ao;function op(){return Ao||(Ao=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpeechSynthesisOutputFormat=void 0,(function(t){t[t.Raw8Khz8BitMonoMULaw=0]="Raw8Khz8BitMonoMULaw",t[t.Riff16Khz16KbpsMonoSiren=1]="Riff16Khz16KbpsMonoSiren",t[t.Audio16Khz16KbpsMonoSiren=2]="Audio16Khz16KbpsMonoSiren",t[t.Audio16Khz32KBitRateMonoMp3=3]="Audio16Khz32KBitRateMonoMp3",t[t.Audio16Khz128KBitRateMonoMp3=4]="Audio16Khz128KBitRateMonoMp3",t[t.Audio16Khz64KBitRateMonoMp3=5]="Audio16Khz64KBitRateMonoMp3",t[t.Audio24Khz48KBitRateMonoMp3=6]="Audio24Khz48KBitRateMonoMp3",t[t.Audio24Khz96KBitRateMonoMp3=7]="Audio24Khz96KBitRateMonoMp3",t[t.Audio24Khz160KBitRateMonoMp3=8]="Audio24Khz160KBitRateMonoMp3",t[t.Raw16Khz16BitMonoTrueSilk=9]="Raw16Khz16BitMonoTrueSilk",t[t.Riff16Khz16BitMonoPcm=10]="Riff16Khz16BitMonoPcm",t[t.Riff8Khz16BitMonoPcm=11]="Riff8Khz16BitMonoPcm",t[t.Riff24Khz16BitMonoPcm=12]="Riff24Khz16BitMonoPcm",t[t.Riff8Khz8BitMonoMULaw=13]="Riff8Khz8BitMonoMULaw",t[t.Raw16Khz16BitMonoPcm=14]="Raw16Khz16BitMonoPcm",t[t.Raw24Khz16BitMonoPcm=15]="Raw24Khz16BitMonoPcm",t[t.Raw8Khz16BitMonoPcm=16]="Raw8Khz16BitMonoPcm",t[t.Ogg16Khz16BitMonoOpus=17]="Ogg16Khz16BitMonoOpus",t[t.Ogg24Khz16BitMonoOpus=18]="Ogg24Khz16BitMonoOpus",t[t.Raw48Khz16BitMonoPcm=19]="Raw48Khz16BitMonoPcm",t[t.Riff48Khz16BitMonoPcm=20]="Riff48Khz16BitMonoPcm",t[t.Audio48Khz96KBitRateMonoMp3=21]="Audio48Khz96KBitRateMonoMp3",t[t.Audio48Khz192KBitRateMonoMp3=22]="Audio48Khz192KBitRateMonoMp3",t[t.Ogg48Khz16BitMonoOpus=23]="Ogg48Khz16BitMonoOpus",t[t.Webm16Khz16BitMonoOpus=24]="Webm16Khz16BitMonoOpus",t[t.Webm24Khz16BitMonoOpus=25]="Webm24Khz16BitMonoOpus",t[t.Raw24Khz16BitMonoTrueSilk=26]="Raw24Khz16BitMonoTrueSilk",t[t.Raw8Khz8BitMonoALaw=27]="Raw8Khz8BitMonoALaw",t[t.Riff8Khz8BitMonoALaw=28]="Riff8Khz8BitMonoALaw",t[t.Webm24Khz16Bit24KbpsMonoOpus=29]="Webm24Khz16Bit24KbpsMonoOpus",t[t.Audio16Khz16Bit32KbpsMonoOpus=30]="Audio16Khz16Bit32KbpsMonoOpus",t[t.Audio24Khz16Bit48KbpsMonoOpus=31]="Audio24Khz16Bit48KbpsMonoOpus",t[t.Audio24Khz16Bit24KbpsMonoOpus=32]="Audio24Khz16Bit24KbpsMonoOpus",t[t.Raw22050Hz16BitMonoPcm=33]="Raw22050Hz16BitMonoPcm",t[t.Riff22050Hz16BitMonoPcm=34]="Riff22050Hz16BitMonoPcm",t[t.Raw44100Hz16BitMonoPcm=35]="Raw44100Hz16BitMonoPcm",t[t.Riff44100Hz16BitMonoPcm=36]="Riff44100Hz16BitMonoPcm",t[t.AmrWb16000Hz=37]="AmrWb16000Hz",t[t.G72216Khz64Kbps=38]="G72216Khz64Kbps"})(e.SpeechSynthesisOutputFormat||(e.SpeechSynthesisOutputFormat={}))})($i)),$i}var Io;function yi(){if(Io)return pt;Io=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.AudioOutputFormatImpl=void 0;const e=op(),t=Ae();class i extends t.AudioStreamFormatImpl{constructor(n,a,s,r,o,c,p,h,v){super(s,c,a,n),this.formatTag=n,this.avgBytesPerSec=r,this.blockAlign=o,this.priAudioFormatString=p,this.priRequestAudioFormatString=h,this.priHasHeader=v}static fromSpeechSynthesisOutputFormat(n){return n===void 0?i.getDefaultOutputFormat():i.fromSpeechSynthesisOutputFormatString(i.SpeechSynthesisOutputFormatToString[n])}static fromSpeechSynthesisOutputFormatString(n){switch(n){case"raw-8khz-8bit-mono-mulaw":return new i(t.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,n,n,!1);case"riff-16khz-16kbps-mono-siren":return new i(t.AudioFormatTag.Siren,1,16e3,2e3,40,0,n,"audio-16khz-16kbps-mono-siren",!0);case"audio-16khz-16kbps-mono-siren":return new i(t.AudioFormatTag.Siren,1,16e3,2e3,40,0,n,n,!1);case"audio-16khz-32kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,16e3,4096,2,16,n,n,!1);case"audio-16khz-128kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,16e3,16384,2,16,n,n,!1);case"audio-16khz-64kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,16e3,8192,2,16,n,n,!1);case"audio-24khz-48kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,24e3,6144,2,16,n,n,!1);case"audio-24khz-96kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,24e3,12288,2,16,n,n,!1);case"audio-24khz-160kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,24e3,20480,2,16,n,n,!1);case"raw-16khz-16bit-mono-truesilk":return new i(t.AudioFormatTag.SILKSkype,1,16e3,32e3,2,16,n,n,!1);case"riff-8khz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,8e3,16e3,2,16,n,"raw-8khz-16bit-mono-pcm",!0);case"riff-24khz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,24e3,48e3,2,16,n,"raw-24khz-16bit-mono-pcm",!0);case"riff-8khz-8bit-mono-mulaw":return new i(t.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,n,"raw-8khz-8bit-mono-mulaw",!0);case"raw-16khz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,16e3,32e3,2,16,n,"raw-16khz-16bit-mono-pcm",!1);case"raw-24khz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,24e3,48e3,2,16,n,"raw-24khz-16bit-mono-pcm",!1);case"raw-8khz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,8e3,16e3,2,16,n,"raw-8khz-16bit-mono-pcm",!1);case"ogg-16khz-16bit-mono-opus":return new i(t.AudioFormatTag.OGG_OPUS,1,16e3,8192,2,16,n,n,!1);case"ogg-24khz-16bit-mono-opus":return new i(t.AudioFormatTag.OGG_OPUS,1,24e3,8192,2,16,n,n,!1);case"raw-48khz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,48e3,96e3,2,16,n,"raw-48khz-16bit-mono-pcm",!1);case"riff-48khz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,48e3,96e3,2,16,n,"raw-48khz-16bit-mono-pcm",!0);case"audio-48khz-96kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,48e3,12288,2,16,n,n,!1);case"audio-48khz-192kbitrate-mono-mp3":return new i(t.AudioFormatTag.MP3,1,48e3,24576,2,16,n,n,!1);case"ogg-48khz-16bit-mono-opus":return new i(t.AudioFormatTag.OGG_OPUS,1,48e3,12e3,2,16,n,n,!1);case"webm-16khz-16bit-mono-opus":return new i(t.AudioFormatTag.WEBM_OPUS,1,16e3,4e3,2,16,n,n,!1);case"webm-24khz-16bit-mono-opus":return new i(t.AudioFormatTag.WEBM_OPUS,1,24e3,6e3,2,16,n,n,!1);case"webm-24khz-16bit-24kbps-mono-opus":return new i(t.AudioFormatTag.WEBM_OPUS,1,24e3,3e3,2,16,n,n,!1);case"audio-16khz-16bit-32kbps-mono-opus":return new i(t.AudioFormatTag.OPUS,1,16e3,4e3,2,16,n,n,!1);case"audio-24khz-16bit-48kbps-mono-opus":return new i(t.AudioFormatTag.OPUS,1,24e3,6e3,2,16,n,n,!1);case"audio-24khz-16bit-24kbps-mono-opus":return new i(t.AudioFormatTag.OPUS,1,24e3,3e3,2,16,n,n,!1);case"audio-24khz-16bit-mono-flac":return new i(t.AudioFormatTag.FLAC,1,24e3,24e3,2,16,n,n,!1);case"audio-48khz-16bit-mono-flac":return new i(t.AudioFormatTag.FLAC,1,48e3,3e4,2,16,n,n,!1);case"raw-24khz-16bit-mono-truesilk":return new i(t.AudioFormatTag.SILKSkype,1,24e3,48e3,2,16,n,n,!1);case"raw-8khz-8bit-mono-alaw":return new i(t.AudioFormatTag.ALaw,1,8e3,8e3,1,8,n,n,!1);case"riff-8khz-8bit-mono-alaw":return new i(t.AudioFormatTag.ALaw,1,8e3,8e3,1,8,n,"raw-8khz-8bit-mono-alaw",!0);case"raw-22050hz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,22050,44100,2,16,n,n,!1);case"riff-22050hz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,22050,44100,2,16,n,"raw-22050hz-16bit-mono-pcm",!0);case"raw-44100hz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,44100,88200,2,16,n,n,!1);case"riff-44100hz-16bit-mono-pcm":return new i(t.AudioFormatTag.PCM,1,44100,88200,2,16,n,"raw-44100hz-16bit-mono-pcm",!0);case"amr-wb-16000h":return new i(t.AudioFormatTag.AMR_WB,1,16e3,3052,2,16,n,n,!1);case"g722-16khz-64kbps":return new i(t.AudioFormatTag.G722,1,16e3,8e3,2,16,n,n,!1);case"riff-16khz-16bit-mono-pcm":default:return new i(t.AudioFormatTag.PCM,1,16e3,32e3,2,16,"riff-16khz-16bit-mono-pcm","raw-16khz-16bit-mono-pcm",!0)}}static getDefaultOutputFormat(){return i.fromSpeechSynthesisOutputFormatString(typeof window<"u"?"audio-24khz-48kbitrate-mono-mp3":"riff-16khz-16bit-mono-pcm")}get hasHeader(){return this.priHasHeader}get header(){if(this.hasHeader)return this.privHeader}updateHeader(n){if(this.priHasHeader){const a=new DataView(this.privHeader);a.setUint32(4,n+this.privHeader.byteLength-8,!0),a.setUint32(40,n,!0)}}get requestAudioFormatString(){return this.priRequestAudioFormatString}addHeader(n){if(!this.hasHeader)return n;this.updateHeader(n.byteLength);const a=new Uint8Array(n.byteLength+this.header.byteLength);return a.set(new Uint8Array(this.header),0),a.set(new Uint8Array(n),this.header.byteLength),a.buffer}}return pt.AudioOutputFormatImpl=i,i.SpeechSynthesisOutputFormatToString={[e.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoMULaw]:"raw-8khz-8bit-mono-mulaw",[e.SpeechSynthesisOutputFormat.Riff16Khz16KbpsMonoSiren]:"riff-16khz-16kbps-mono-siren",[e.SpeechSynthesisOutputFormat.Audio16Khz16KbpsMonoSiren]:"audio-16khz-16kbps-mono-siren",[e.SpeechSynthesisOutputFormat.Audio16Khz32KBitRateMonoMp3]:"audio-16khz-32kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Audio16Khz128KBitRateMonoMp3]:"audio-16khz-128kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Audio16Khz64KBitRateMonoMp3]:"audio-16khz-64kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Audio24Khz48KBitRateMonoMp3]:"audio-24khz-48kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Audio24Khz96KBitRateMonoMp3]:"audio-24khz-96kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Audio24Khz160KBitRateMonoMp3]:"audio-24khz-160kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoTrueSilk]:"raw-16khz-16bit-mono-truesilk",[e.SpeechSynthesisOutputFormat.Riff16Khz16BitMonoPcm]:"riff-16khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Riff8Khz16BitMonoPcm]:"riff-8khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm]:"riff-24khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoMULaw]:"riff-8khz-8bit-mono-mulaw",[e.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoPcm]:"raw-16khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoPcm]:"raw-24khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Raw8Khz16BitMonoPcm]:"raw-8khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Ogg16Khz16BitMonoOpus]:"ogg-16khz-16bit-mono-opus",[e.SpeechSynthesisOutputFormat.Ogg24Khz16BitMonoOpus]:"ogg-24khz-16bit-mono-opus",[e.SpeechSynthesisOutputFormat.Raw48Khz16BitMonoPcm]:"raw-48khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Riff48Khz16BitMonoPcm]:"riff-48khz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Audio48Khz96KBitRateMonoMp3]:"audio-48khz-96kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Audio48Khz192KBitRateMonoMp3]:"audio-48khz-192kbitrate-mono-mp3",[e.SpeechSynthesisOutputFormat.Ogg48Khz16BitMonoOpus]:"ogg-48khz-16bit-mono-opus",[e.SpeechSynthesisOutputFormat.Webm16Khz16BitMonoOpus]:"webm-16khz-16bit-mono-opus",[e.SpeechSynthesisOutputFormat.Webm24Khz16BitMonoOpus]:"webm-24khz-16bit-mono-opus",[e.SpeechSynthesisOutputFormat.Webm24Khz16Bit24KbpsMonoOpus]:"webm-24khz-16bit-24kbps-mono-opus",[e.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoTrueSilk]:"raw-24khz-16bit-mono-truesilk",[e.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoALaw]:"raw-8khz-8bit-mono-alaw",[e.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoALaw]:"riff-8khz-8bit-mono-alaw",[e.SpeechSynthesisOutputFormat.Audio16Khz16Bit32KbpsMonoOpus]:"audio-16khz-16bit-32kbps-mono-opus",[e.SpeechSynthesisOutputFormat.Audio24Khz16Bit48KbpsMonoOpus]:"audio-24khz-16bit-48kbps-mono-opus",[e.SpeechSynthesisOutputFormat.Audio24Khz16Bit24KbpsMonoOpus]:"audio-24khz-16bit-24kbps-mono-opus",[e.SpeechSynthesisOutputFormat.Raw22050Hz16BitMonoPcm]:"raw-22050hz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Riff22050Hz16BitMonoPcm]:"riff-22050hz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Raw44100Hz16BitMonoPcm]:"raw-44100hz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.Riff44100Hz16BitMonoPcm]:"riff-44100hz-16bit-mono-pcm",[e.SpeechSynthesisOutputFormat.AmrWb16000Hz]:"amr-wb-16000hz",[e.SpeechSynthesisOutputFormat.G72216Khz64Kbps]:"g722-16khz-64kbps"},pt}var wo;function _e(){if(wo)return F;wo=1,Object.defineProperty(F,"__esModule",{value:!0}),F.PushAudioOutputStreamImpl=F.PushAudioOutputStream=F.PullAudioOutputStreamImpl=F.PullAudioOutputStream=F.AudioOutputStream=void 0;const e=I(),t=b(),i=yi();let u=class{constructor(){}static createPullStream(){return n.create()}};F.AudioOutputStream=u;class n extends u{static create(){return new a}}F.PullAudioOutputStream=n;class a extends n{constructor(){super(),this.privId=(0,e.createNoDashGuid)(),this.privStream=new e.Stream}set format(c){c==null&&(this.privFormat=i.AudioOutputFormatImpl.getDefaultOutputFormat()),this.privFormat=c}get format(){return this.privFormat}get isClosed(){return this.privStream.isClosed}id(){return this.privId}async read(c){const p=new Int8Array(c);let h=0;if(this.privLastChunkView!==void 0){if(this.privLastChunkView.length>c.byteLength)return p.set(this.privLastChunkView.slice(0,c.byteLength)),this.privLastChunkView=this.privLastChunkView.slice(c.byteLength),Promise.resolve(c.byteLength);p.set(this.privLastChunkView),h=this.privLastChunkView.length,this.privLastChunkView=void 0}for(;h<c.byteLength&&!this.privStream.isReadEnded;){const v=await this.privStream.read();if(v!==void 0&&!v.isEnd){let d;v.buffer.byteLength>c.byteLength-h?(d=v.buffer.slice(0,c.byteLength-h),this.privLastChunkView=new Int8Array(v.buffer.slice(c.byteLength-h))):d=v.buffer,p.set(new Int8Array(d),h),h+=d.byteLength}else this.privStream.readEnded()}return h}write(c){t.Contracts.throwIfNullOrUndefined(this.privStream,"must set format before writing"),this.privStream.writeStreamChunk({buffer:c,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}}F.PullAudioOutputStreamImpl=a;class s extends u{constructor(){super()}static create(c){return new r(c)}}F.PushAudioOutputStream=s;class r extends s{constructor(c){super(),this.privId=(0,e.createNoDashGuid)(),this.privCallback=c}set format(c){}write(c){this.privCallback.write&&this.privCallback.write(c)}close(){this.privCallback.close&&this.privCallback.close()}id(){return this.privId}}return F.PushAudioOutputStreamImpl=r,F}var _o;function kd(){if(_o)return Q;_o=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.AudioOutputConfigImpl=Q.AudioConfigImpl=Q.AudioConfig=void 0;const e=L(),t=b(),i=P(),u=np(),n=sp(),a=_e();let s=class ap{static fromDefaultMicrophoneInput(){const p=new e.PcmRecorder(!0);return new r(new e.MicAudioSource(p))}static fromMicrophoneInput(p){const h=new e.PcmRecorder(!0);return new r(new e.MicAudioSource(h,p))}static fromWavFileInput(p,h="unnamedBuffer.wav"){return new r(new e.FileAudioSource(p,h))}static fromStreamInput(p){if(p instanceof i.PullAudioInputStreamCallback)return new r(new n.PullAudioInputStreamImpl(p));if(p instanceof i.AudioInputStream)return new r(p);if(typeof MediaStream<"u"&&p instanceof MediaStream){const h=new e.PcmRecorder(!1);return new r(new e.MicAudioSource(h,null,null,p))}throw new Error("Not Supported Type")}static fromDefaultSpeakerOutput(){return new o(new i.SpeakerAudioDestination)}static fromSpeakerOutput(p){if(p===void 0)return ap.fromDefaultSpeakerOutput();if(p instanceof i.SpeakerAudioDestination)return new o(p);throw new Error("Not Supported Type")}static fromAudioFileOutput(p){return new o(new u.AudioFileWriter(p))}static fromStreamOutput(p){if(p instanceof i.PushAudioOutputStreamCallback)return new o(new a.PushAudioOutputStreamImpl(p));if(p instanceof i.PushAudioOutputStream)return new o(p);if(p instanceof i.PullAudioOutputStream)return new o(p);throw new Error("Not Supported Type")}};Q.AudioConfig=s;class r extends s{constructor(p){super(),this.privSource=p}get format(){return this.privSource.format}close(p,h){this.privSource.turnOff().then(()=>{p&&p()},v=>{h&&h(v)})}id(){return this.privSource.id()}turnOn(){return this.privSource.turnOn()}attach(p){return this.privSource.attach(p)}detach(p){return this.privSource.detach(p)}turnOff(){return this.privSource.turnOff()}get events(){return this.privSource.events}setProperty(p,h){if(t.Contracts.throwIfNull(h,"value"),this.privSource.setProperty!==void 0)this.privSource.setProperty(p,h);else throw new Error("This AudioConfig instance does not support setting properties.")}getProperty(p,h){if(this.privSource.getProperty!==void 0)return this.privSource.getProperty(p,h);throw new Error("This AudioConfig instance does not support getting properties.")}get deviceInfo(){return this.privSource.deviceInfo}}Q.AudioConfigImpl=r;class o extends s{constructor(p){super(),this.privDestination=p}set format(p){this.privDestination.format=p}write(p){this.privDestination.write(p)}close(){this.privDestination.close()}id(){return this.privDestination.id()}setProperty(){throw new Error("This AudioConfig instance does not support setting properties.")}getProperty(){throw new Error("This AudioConfig instance does not support getting properties.")}}return Q.AudioOutputConfigImpl=o,Q}var en={},bo;function Nd(){return bo||(bo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CancellationReason=void 0,(function(t){t[t.Error=0]="Error",t[t.EndOfStream=1]="EndOfStream"})(e.CancellationReason||(e.CancellationReason={}))})(en)),en}var ht={},Mo;function zd(){if(Mo)return ht;Mo=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.PullAudioInputStreamCallback=void 0;let e=class{};return ht.PullAudioInputStreamCallback=e,ht}var dt={},Oo;function jd(){if(Oo)return dt;Oo=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.PushAudioOutputStreamCallback=void 0;let e=class{};return dt.PushAudioOutputStreamCallback=e,dt}var vt={},Do;function Ld(){if(Do)return vt;Do=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.KeywordRecognitionModel=void 0;const e=b();let t=class{constructor(){this.privDisposed=!1}static fromFile(u){throw e.Contracts.throwIfFileDoesNotExist(u,"fileName"),new Error("Not yet implemented.")}static fromStream(u){throw e.Contracts.throwIfNull(u,"file"),new Error("Not yet implemented.")}close(){this.privDisposed||(this.privDisposed=!0)}};return vt.KeywordRecognitionModel=t,vt}var lt={},ko;function qd(){if(ko)return lt;ko=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.SessionEventArgs=void 0;let e=class{constructor(i){this.privSessionId=i}get sessionId(){return this.privSessionId}};return lt.SessionEventArgs=e,lt}var ft={},No;function Bd(){if(No)return ft;No=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.RecognitionEventArgs=void 0;const e=P();let t=class extends e.SessionEventArgs{constructor(u,n){super(n),this.privOffset=u}get offset(){return this.privOffset}};return ft.RecognitionEventArgs=t,ft}var tn={},zo;function Fd(){return zo||(zo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.OutputFormat=void 0,(function(t){t[t.Simple=0]="Simple",t[t.Detailed=1]="Detailed"})(e.OutputFormat||(e.OutputFormat={}))})(tn)),tn}var gt={},jo;function Ud(){if(jo)return gt;jo=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.RecognitionResult=void 0;let e=class{constructor(i,u,n,a,s,r,o,c,p,h){this.privResultId=i,this.privReason=u,this.privText=n,this.privDuration=a,this.privOffset=s,this.privLanguage=r,this.privLanguageDetectionConfidence=o,this.privErrorDetails=c,this.privJson=p,this.privProperties=h}get resultId(){return this.privResultId}get reason(){return this.privReason}get text(){return this.privText}get duration(){return this.privDuration}get offset(){return this.privOffset}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}get errorDetails(){return this.privErrorDetails}get json(){return this.privJson}get properties(){return this.privProperties}};return gt.RecognitionResult=e,gt}var mt={},Lo;function xd(){if(Lo)return mt;Lo=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.SpeechRecognitionResult=void 0;const e=P();let t=class extends e.RecognitionResult{constructor(u,n,a,s,r,o,c,p,h,v,d){super(u,n,a,s,r,o,c,h,v,d),this.privSpeakerId=p}get speakerId(){return this.privSpeakerId}};return mt.SpeechRecognitionResult=t,mt}var X={},qo;function Wd(){if(qo)return X;qo=1,Object.defineProperty(X,"__esModule",{value:!0}),X.MeetingTranscriptionEventArgs=X.ConversationTranscriptionEventArgs=X.SpeechRecognitionEventArgs=void 0;const e=P();let t=class extends e.RecognitionEventArgs{constructor(a,s,r){super(s,r),this.privResult=a}get result(){return this.privResult}};X.SpeechRecognitionEventArgs=t;class i extends e.RecognitionEventArgs{constructor(a,s,r){super(s,r),this.privResult=a}get result(){return this.privResult}}X.ConversationTranscriptionEventArgs=i;class u extends t{}return X.MeetingTranscriptionEventArgs=u,X}var St={},Ct={},Bo;function Ri(){if(Bo)return Ct;Bo=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.CancellationEventArgsBase=void 0;const e=P();let t=class extends e.RecognitionEventArgs{constructor(u,n,a,s,r){super(s,r),this.privReason=u,this.privErrorDetails=n,this.privErrorCode=a}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}};return Ct.CancellationEventArgsBase=t,Ct}var Fo;function Hd(){if(Fo)return St;Fo=1,Object.defineProperty(St,"__esModule",{value:!0}),St.SpeechRecognitionCanceledEventArgs=void 0;const e=Ri();let t=class extends e.CancellationEventArgsBase{};return St.SpeechRecognitionCanceledEventArgs=t,St}var yt={},Uo;function Kd(){if(Uo)return yt;Uo=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.TranslationRecognitionEventArgs=void 0;const e=P();let t=class extends e.RecognitionEventArgs{constructor(u,n,a){super(n,a),this.privResult=u}get result(){return this.privResult}};return yt.TranslationRecognitionEventArgs=t,yt}var Rt={},xo;function Vd(){if(xo)return Rt;xo=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.TranslationSynthesisEventArgs=void 0;const e=P();let t=class extends e.SessionEventArgs{constructor(u,n){super(n),this.privResult=u}get result(){return this.privResult}};return Rt.TranslationSynthesisEventArgs=t,Rt}var Pt={},Wo;function up(){if(Wo)return Pt;Wo=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.TranslationRecognitionResult=void 0;const e=P();let t=class cp extends e.SpeechRecognitionResult{constructor(u,n,a,s,r,o,c,p,h,v,d){super(n,a,s,r,o,c,p,void 0,h,v,d),this.privTranslations=u}static fromSpeechRecognitionResult(u){return new cp(void 0,u.resultId,u.reason,u.text,u.duration,u.offset,u.language,u.languageDetectionConfidence,u.errorDetails,u.json,u.properties)}get translations(){return this.privTranslations}};return Pt.TranslationRecognitionResult=t,Pt}var Et={},Ho;function Jd(){if(Ho)return Et;Ho=1,Object.defineProperty(Et,"__esModule",{value:!0}),Et.TranslationSynthesisResult=void 0;let e=class{constructor(i,u){this.privReason=i,this.privAudio=u}get audio(){return this.privAudio}get reason(){return this.privReason}};return Et.TranslationSynthesisResult=e,Et}var rn={},Ko;function Gd(){return Ko||(Ko=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ResultReason=void 0,(function(t){t[t.NoMatch=0]="NoMatch",t[t.Canceled=1]="Canceled",t[t.RecognizingSpeech=2]="RecognizingSpeech",t[t.RecognizedSpeech=3]="RecognizedSpeech",t[t.RecognizedKeyword=4]="RecognizedKeyword",t[t.TranslatingSpeech=5]="TranslatingSpeech",t[t.TranslatedSpeech=6]="TranslatedSpeech",t[t.SynthesizingAudio=7]="SynthesizingAudio",t[t.SynthesizingAudioCompleted=8]="SynthesizingAudioCompleted",t[t.SynthesizingAudioStarted=9]="SynthesizingAudioStarted",t[t.VoicesListRetrieved=10]="VoicesListRetrieved",t[t.TranslatingParticipantSpeech=11]="TranslatingParticipantSpeech",t[t.TranslatedParticipantSpeech=12]="TranslatedParticipantSpeech",t[t.TranslatedInstantMessage=13]="TranslatedInstantMessage",t[t.TranslatedParticipantInstantMessage=14]="TranslatedParticipantInstantMessage"})(e.ResultReason||(e.ResultReason={}))})(rn)),rn}var pe={},Vo;function Qd(){if(Vo)return pe;Vo=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.SpeechConfigImpl=pe.SpeechConfig=void 0;const e=A(),t=b(),i=P();let u=class{constructor(){}static fromSubscription(s,r){t.Contracts.throwIfNullOrWhitespace(s,"subscriptionKey"),t.Contracts.throwIfNullOrWhitespace(r,"region");const o=new n;return o.setProperty(i.PropertyId.SpeechServiceConnection_Region,r),o.setProperty(i.PropertyId.SpeechServiceConnection_Key,s),o}static fromEndpoint(s,r){t.Contracts.throwIfNull(s,"endpoint");const o=typeof r=="string"&&r.trim().length>0,c=typeof r=="object"&&r!==null&&typeof r.getToken=="function",p=typeof r=="object"&&r!==null&&typeof r.key=="string";if(r!==void 0&&!o&&!c&&!p)throw new Error("Invalid 'auth' parameter: expected a non-empty API key string, a TokenCredential, or a KeyCredential.");let h;return typeof r=="string"?(h=new n,h.setProperty(i.PropertyId.SpeechServiceConnection_Key,r)):typeof r=="object"&&typeof r.getToken=="function"?h=new n(r):typeof r=="object"&&typeof r.key=="string"?(h=new n,h.setProperty(i.PropertyId.SpeechServiceConnection_Key,r.key)):h=new n,h.setProperty(i.PropertyId.SpeechServiceConnection_Endpoint,s.href),h}static fromHost(s,r){t.Contracts.throwIfNull(s,"hostName");const o=new n;return o.setProperty(i.PropertyId.SpeechServiceConnection_Host,s.protocol+"//"+s.hostname+(s.port===""?"":":"+s.port)),o.setProperty(i.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"1"),r!==void 0&&o.setProperty(i.PropertyId.SpeechServiceConnection_Key,r),o}static fromAuthorizationToken(s,r){t.Contracts.throwIfNull(s,"authorizationToken"),t.Contracts.throwIfNullOrWhitespace(r,"region");const o=new n;return o.setProperty(i.PropertyId.SpeechServiceConnection_Region,r),o.authorizationToken=s,o}close(){}};pe.SpeechConfig=u;class n extends u{constructor(s){super(),this.privProperties=new i.PropertyCollection,this.speechRecognitionLanguage="en-US",this.outputFormat=i.OutputFormat.Simple,this.privTokenCredential=s}get properties(){return this.privProperties}get endPoint(){return new URL(this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_Endpoint))}get subscriptionKey(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_Key)}get region(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_Region)}get authorizationToken(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(s){this.privProperties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,s)}get speechRecognitionLanguage(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage)}set speechRecognitionLanguage(s){this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,s)}get autoDetectSourceLanguages(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)}set autoDetectSourceLanguages(s){this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,s)}get outputFormat(){return i.OutputFormat[this.privProperties.getProperty(e.OutputFormatPropertyName,void 0)]}set outputFormat(s){this.privProperties.setProperty(e.OutputFormatPropertyName,i.OutputFormat[s])}get endpointId(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(s){this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_EndpointId,s)}get tokenCredential(){return this.privTokenCredential}setProperty(s,r){t.Contracts.throwIfNull(r,"value"),this.privProperties.setProperty(s,r)}getProperty(s,r){return this.privProperties.getProperty(s,r)}setProxy(s,r,o,c){this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyHostName],s),this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyPort],r),this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyUserName],o),this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyPassword],c)}setServiceProperty(s,r){const o=JSON.parse(this.privProperties.getProperty(e.ServicePropertiesPropertyName,"{}"));o[s]=r,this.privProperties.setProperty(e.ServicePropertiesPropertyName,JSON.stringify(o))}setProfanity(s){this.privProperties.setProperty(i.PropertyId.SpeechServiceResponse_ProfanityOption,i.ProfanityOption[s])}enableAudioLogging(){this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privProperties.setProperty(i.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true"),this.privProperties.setProperty(e.OutputFormatPropertyName,i.OutputFormat[i.OutputFormat.Detailed])}enableDictation(){this.privProperties.setProperty(e.ForceDictationPropertyName,"true")}clone(){const s=new n(this.tokenCredential);return s.privProperties=this.privProperties.clone(),s}get speechSynthesisLanguage(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(s){this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_SynthLanguage,s)}get speechSynthesisVoiceName(){return this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(s){this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_SynthVoice,s)}get speechSynthesisOutputFormat(){return i.SpeechSynthesisOutputFormat[this.privProperties.getProperty(i.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(s){this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_SynthOutputFormat,i.SpeechSynthesisOutputFormat[s])}}return pe.SpeechConfigImpl=n,pe}var he={},Jo;function Xd(){if(Jo)return he;Jo=1,Object.defineProperty(he,"__esModule",{value:!0}),he.SpeechTranslationConfigImpl=he.SpeechTranslationConfig=void 0;const e=A(),t=b(),i=P();let u=class extends i.SpeechConfig{constructor(){super()}static fromSubscription(s,r){t.Contracts.throwIfNullOrWhitespace(s,"subscriptionKey"),t.Contracts.throwIfNullOrWhitespace(r,"region");const o=new n;return o.properties.setProperty(i.PropertyId.SpeechServiceConnection_Key,s),o.properties.setProperty(i.PropertyId.SpeechServiceConnection_Region,r),o}static fromAuthorizationToken(s,r){t.Contracts.throwIfNullOrWhitespace(s,"authorizationToken"),t.Contracts.throwIfNullOrWhitespace(r,"region");const o=new n;return o.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,s),o.properties.setProperty(i.PropertyId.SpeechServiceConnection_Region,r),o}static fromHost(s,r){t.Contracts.throwIfNull(s,"hostName");const o=new n;return o.setProperty(i.PropertyId.SpeechServiceConnection_Host,s.protocol+"//"+s.hostname+(s.port===""?"":":"+s.port)),r!==void 0&&o.setProperty(i.PropertyId.SpeechServiceConnection_Key,r),o}static fromEndpoint(s,r){t.Contracts.throwIfNull(s,"endpoint");const o=typeof r=="string"&&r.trim().length>0,c=typeof r=="object"&&r!==null&&typeof r.getToken=="function",p=typeof r=="object"&&r!==null&&typeof r.key=="string";if(r!==void 0&&!o&&!c&&!p)throw new Error("Invalid 'auth' parameter: expected a non-empty API key string, a TokenCredential, or a KeyCredential.");let h;return typeof r=="string"?(h=new n,h.setProperty(i.PropertyId.SpeechServiceConnection_Key,r)):typeof r=="object"&&typeof r.getToken=="function"?h=new n(r):typeof r=="object"&&typeof r.key=="string"?(h=new n,h.setProperty(i.PropertyId.SpeechServiceConnection_Key,r.key)):h=new n,h.setProperty(i.PropertyId.SpeechServiceConnection_Endpoint,s.href),h}};he.SpeechTranslationConfig=u;class n extends u{constructor(s){super(),this.privSpeechProperties=new i.PropertyCollection,this.outputFormat=i.OutputFormat.Simple,this.privTokenCredential=s}set authorizationToken(s){t.Contracts.throwIfNullOrWhitespace(s,"value"),this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,s)}set speechRecognitionLanguage(s){t.Contracts.throwIfNullOrWhitespace(s,"value"),this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,s)}get speechRecognitionLanguage(){return this.privSpeechProperties.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage])}get subscriptionKey(){return this.privSpeechProperties.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_Key])}get outputFormat(){return i.OutputFormat[this.privSpeechProperties.getProperty(e.OutputFormatPropertyName,void 0)]}set outputFormat(s){this.privSpeechProperties.setProperty(e.OutputFormatPropertyName,i.OutputFormat[s])}get endpointId(){return this.privSpeechProperties.getProperty(i.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(s){this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_EndpointId,s)}addTargetLanguage(s){t.Contracts.throwIfNullOrWhitespace(s,"value");const r=this.targetLanguages;r.includes(s)||(r.push(s),this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_TranslationToLanguages,r.join(",")))}get targetLanguages(){return this.privSpeechProperties.getProperty(i.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0?this.privSpeechProperties.getProperty(i.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","):[]}get voiceName(){return this.getProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_TranslationVoice])}set voiceName(s){t.Contracts.throwIfNullOrWhitespace(s,"value"),this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_TranslationVoice,s)}get region(){return this.privSpeechProperties.getProperty(i.PropertyId.SpeechServiceConnection_Region)}get tokenCredential(){return this.privTokenCredential}setProxy(s,r,o,c){this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyHostName],s),this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyPort],r),this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyUserName],o),this.setProperty(i.PropertyId[i.PropertyId.SpeechServiceConnection_ProxyPassword],c)}getProperty(s,r){return this.privSpeechProperties.getProperty(s,r)}setProperty(s,r){this.privSpeechProperties.setProperty(s,r)}get properties(){return this.privSpeechProperties}close(){}setServiceProperty(s,r){const o=JSON.parse(this.privSpeechProperties.getProperty(e.ServicePropertiesPropertyName,"{}"));o[s]=r,this.privSpeechProperties.setProperty(e.ServicePropertiesPropertyName,JSON.stringify(o))}setProfanity(s){this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceResponse_ProfanityOption,i.ProfanityOption[s])}enableAudioLogging(){this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privSpeechProperties.setProperty(e.ForceDictationPropertyName,"true")}get speechSynthesisLanguage(){return this.privSpeechProperties.getProperty(i.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(s){this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_SynthLanguage,s)}get speechSynthesisVoiceName(){return this.privSpeechProperties.getProperty(i.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(s){this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_SynthVoice,s)}get speechSynthesisOutputFormat(){return i.SpeechSynthesisOutputFormat[this.privSpeechProperties.getProperty(i.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(s){this.privSpeechProperties.setProperty(i.PropertyId.SpeechServiceConnection_SynthOutputFormat,i.SpeechSynthesisOutputFormat[s])}}return he.SpeechTranslationConfigImpl=n,he}var Tt={},Go;function hp(){if(Go)return Tt;Go=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.PropertyCollection=void 0;const e=P();let t=class pp{constructor(){this.privKeys=[],this.privValues=[]}getProperty(u,n){let a;typeof u=="string"?a=u:a=e.PropertyId[u];for(let s=0;s<this.privKeys.length;s++)if(this.privKeys[s]===a)return this.privValues[s];if(n!==void 0)return String(n)}setProperty(u,n){let a;typeof u=="string"?a=u:a=e.PropertyId[u];for(let s=0;s<this.privKeys.length;s++)if(this.privKeys[s]===a){this.privValues[s]=n;return}this.privKeys.push(a),this.privValues.push(n)}clone(){const u=new pp;for(let n=0;n<this.privKeys.length;n++)u.privKeys.push(this.privKeys[n]),u.privValues.push(this.privValues[n]);return u}mergeTo(u){this.privKeys.forEach(n=>{if(u.getProperty(n,void 0)===void 0){const a=this.getProperty(n);u.setProperty(n,a)}})}get keys(){return this.privKeys}};return Tt.PropertyCollection=t,Tt}var nn={},Qo;function ts(){return Qo||(Qo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PropertyId=void 0,(function(t){t[t.SpeechServiceConnection_Key=0]="SpeechServiceConnection_Key",t[t.SpeechServiceConnection_Endpoint=1]="SpeechServiceConnection_Endpoint",t[t.SpeechServiceConnection_Region=2]="SpeechServiceConnection_Region",t[t.SpeechServiceAuthorization_Token=3]="SpeechServiceAuthorization_Token",t[t.SpeechServiceAuthorization_Type=4]="SpeechServiceAuthorization_Type",t[t.SpeechServiceConnection_EndpointId=5]="SpeechServiceConnection_EndpointId",t[t.SpeechServiceConnection_TranslationToLanguages=6]="SpeechServiceConnection_TranslationToLanguages",t[t.SpeechServiceConnection_TranslationVoice=7]="SpeechServiceConnection_TranslationVoice",t[t.SpeechServiceConnection_TranslationFeatures=8]="SpeechServiceConnection_TranslationFeatures",t[t.SpeechServiceConnection_TranslationCategoryId=9]="SpeechServiceConnection_TranslationCategoryId",t[t.SpeechServiceConnection_ProxyHostName=10]="SpeechServiceConnection_ProxyHostName",t[t.SpeechServiceConnection_ProxyPort=11]="SpeechServiceConnection_ProxyPort",t[t.SpeechServiceConnection_ProxyUserName=12]="SpeechServiceConnection_ProxyUserName",t[t.SpeechServiceConnection_ProxyPassword=13]="SpeechServiceConnection_ProxyPassword",t[t.SpeechServiceConnection_RecoMode=14]="SpeechServiceConnection_RecoMode",t[t.SpeechServiceConnection_RecoLanguage=15]="SpeechServiceConnection_RecoLanguage",t[t.Speech_SessionId=16]="Speech_SessionId",t[t.SpeechServiceConnection_SynthLanguage=17]="SpeechServiceConnection_SynthLanguage",t[t.SpeechServiceConnection_SynthVoice=18]="SpeechServiceConnection_SynthVoice",t[t.SpeechServiceConnection_SynthOutputFormat=19]="SpeechServiceConnection_SynthOutputFormat",t[t.SpeechServiceConnection_AutoDetectSourceLanguages=20]="SpeechServiceConnection_AutoDetectSourceLanguages",t[t.SpeechServiceResponse_RequestDetailedResultTrueFalse=21]="SpeechServiceResponse_RequestDetailedResultTrueFalse",t[t.SpeechServiceResponse_RequestProfanityFilterTrueFalse=22]="SpeechServiceResponse_RequestProfanityFilterTrueFalse",t[t.SpeechServiceResponse_JsonResult=23]="SpeechServiceResponse_JsonResult",t[t.SpeechServiceResponse_JsonErrorDetails=24]="SpeechServiceResponse_JsonErrorDetails",t[t.CancellationDetails_Reason=25]="CancellationDetails_Reason",t[t.CancellationDetails_ReasonText=26]="CancellationDetails_ReasonText",t[t.CancellationDetails_ReasonDetailedText=27]="CancellationDetails_ReasonDetailedText",t[t.SpeechServiceConnection_Url=28]="SpeechServiceConnection_Url",t[t.SpeechServiceConnection_InitialSilenceTimeoutMs=29]="SpeechServiceConnection_InitialSilenceTimeoutMs",t[t.SpeechServiceConnection_EndSilenceTimeoutMs=30]="SpeechServiceConnection_EndSilenceTimeoutMs",t[t.Speech_SegmentationSilenceTimeoutMs=31]="Speech_SegmentationSilenceTimeoutMs",t[t.Speech_SegmentationMaximumTimeMs=32]="Speech_SegmentationMaximumTimeMs",t[t.Speech_SegmentationStrategy=33]="Speech_SegmentationStrategy",t[t.Speech_StartEventSensitivity=34]="Speech_StartEventSensitivity",t[t.SpeechServiceConnection_EnableAudioLogging=35]="SpeechServiceConnection_EnableAudioLogging",t[t.SpeechServiceConnection_LanguageIdMode=36]="SpeechServiceConnection_LanguageIdMode",t[t.SpeechServiceConnection_RecognitionEndpointVersion=37]="SpeechServiceConnection_RecognitionEndpointVersion",t[t.SpeechServiceResponse_ProfanityOption=38]="SpeechServiceResponse_ProfanityOption",t[t.SpeechServiceResponse_PostProcessingOption=39]="SpeechServiceResponse_PostProcessingOption",t[t.SpeechServiceResponse_RequestWordLevelTimestamps=40]="SpeechServiceResponse_RequestWordLevelTimestamps",t[t.SpeechServiceResponse_StablePartialResultThreshold=41]="SpeechServiceResponse_StablePartialResultThreshold",t[t.SpeechServiceResponse_OutputFormatOption=42]="SpeechServiceResponse_OutputFormatOption",t[t.SpeechServiceResponse_TranslationRequestStablePartialResult=43]="SpeechServiceResponse_TranslationRequestStablePartialResult",t[t.SpeechServiceResponse_RequestWordBoundary=44]="SpeechServiceResponse_RequestWordBoundary",t[t.SpeechServiceResponse_RequestPunctuationBoundary=45]="SpeechServiceResponse_RequestPunctuationBoundary",t[t.SpeechServiceResponse_RequestSentenceBoundary=46]="SpeechServiceResponse_RequestSentenceBoundary",t[t.SpeechServiceResponse_DiarizeIntermediateResults=47]="SpeechServiceResponse_DiarizeIntermediateResults",t[t.Conversation_ApplicationId=48]="Conversation_ApplicationId",t[t.Conversation_DialogType=49]="Conversation_DialogType",t[t.Conversation_Initial_Silence_Timeout=50]="Conversation_Initial_Silence_Timeout",t[t.Conversation_From_Id=51]="Conversation_From_Id",t[t.Conversation_Conversation_Id=52]="Conversation_Conversation_Id",t[t.Conversation_Custom_Voice_Deployment_Ids=53]="Conversation_Custom_Voice_Deployment_Ids",t[t.Conversation_Speech_Activity_Template=54]="Conversation_Speech_Activity_Template",t[t.Conversation_Request_Bot_Status_Messages=55]="Conversation_Request_Bot_Status_Messages",t[t.Conversation_Agent_Connection_Id=56]="Conversation_Agent_Connection_Id",t[t.SpeechServiceConnection_Host=57]="SpeechServiceConnection_Host",t[t.ConversationTranslator_Host=58]="ConversationTranslator_Host",t[t.ConversationTranslator_Name=59]="ConversationTranslator_Name",t[t.ConversationTranslator_CorrelationId=60]="ConversationTranslator_CorrelationId",t[t.ConversationTranslator_Token=61]="ConversationTranslator_Token",t[t.PronunciationAssessment_ReferenceText=62]="PronunciationAssessment_ReferenceText",t[t.PronunciationAssessment_GradingSystem=63]="PronunciationAssessment_GradingSystem",t[t.PronunciationAssessment_Granularity=64]="PronunciationAssessment_Granularity",t[t.PronunciationAssessment_EnableMiscue=65]="PronunciationAssessment_EnableMiscue",t[t.PronunciationAssessment_Json=66]="PronunciationAssessment_Json",t[t.PronunciationAssessment_Params=67]="PronunciationAssessment_Params",t[t.WebWorkerLoadType=68]="WebWorkerLoadType",t[t.TalkingAvatarService_WebRTC_SDP=69]="TalkingAvatarService_WebRTC_SDP"})(e.PropertyId||(e.PropertyId={}))})(nn)),nn}var At={},Xo;function Zd(){if(Xo)return At;Xo=1,Object.defineProperty(At,"__esModule",{value:!0}),At.Recognizer=void 0;const e=A(),t=I(),i=b(),u=P();let n=class dp{constructor(s,r,o,c){this.audioConfig=s!==void 0?s:u.AudioConfig.fromDefaultMicrophoneInput(),this.privDisposed=!1,this.privProperties=r.clone(),this.privConnectionFactory=o,this.tokenCredential=c,this.implCommonRecognizerSetup()}close(s,r){i.Contracts.throwIfDisposed(this.privDisposed),(0,t.marshalPromiseToCallbacks)(this.dispose(!0),s,r)}get internalData(){return this.privReco}async dispose(s){this.privDisposed||(this.privDisposed=!0,s&&this.privReco&&(await this.privReco.audioSource.turnOff(),await this.privReco.dispose()))}static get telemetryEnabled(){return e.ServiceRecognizerBase.telemetryDataEnabled}static enableTelemetry(s){e.ServiceRecognizerBase.telemetryDataEnabled=s}implCommonRecognizerSetup(){let s=typeof window<"u"?"Browser":"Node",r="unknown",o="unknown";typeof navigator<"u"&&(s=s+"/"+navigator.platform,r=navigator.userAgent,o=navigator.appVersion);const c=this.createRecognizerConfig(new e.SpeechServiceConfig(new e.Context(new e.OS(s,r,o))));this.privReco=this.createServiceRecognizer(dp.getAuth(this.privProperties,this.tokenCredential),this.privConnectionFactory,this.audioConfig,c)}async recognizeOnceAsyncImpl(s){i.Contracts.throwIfDisposed(this.privDisposed);const r=new t.Deferred;await this.implRecognizerStop(),await this.privReco.recognize(s,r.resolve,r.reject);const o=await r.promise;return await this.implRecognizerStop(),o}async startContinuousRecognitionAsyncImpl(s){i.Contracts.throwIfDisposed(this.privDisposed),await this.implRecognizerStop(),await this.privReco.recognize(s,void 0,void 0)}async stopContinuousRecognitionAsyncImpl(){i.Contracts.throwIfDisposed(this.privDisposed),await this.implRecognizerStop()}async implRecognizerStop(){this.privReco&&await this.privReco.stopRecognizing()}static getAuth(s,r){const o=s.getProperty(u.PropertyId.SpeechServiceConnection_Key,void 0);return o&&o!==""?new e.CognitiveSubscriptionKeyAuthentication(o):r?new e.CognitiveTokenAuthentication(async()=>{try{const c=await r.getToken("https://cognitiveservices.azure.com/.default");return(c==null?void 0:c.token)??""}catch(c){throw c}},async()=>{try{const c=await r.getToken("https://cognitiveservices.azure.com/.default");return(c==null?void 0:c.token)??""}catch(c){throw c}}):new e.CognitiveTokenAuthentication(()=>{const c=s.getProperty(u.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(c)},()=>{const c=s.getProperty(u.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(c)})}};return At.Recognizer=n,At}var It={},sn={},Zo;function V(){return Zo||(Zo=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpeechStartEventSensitivity=e.RecognitionMode=void 0,(function(t){t.Interactive="Interactive",t.Dictation="Dictation",t.Conversation="Conversation",t.None="None"})(e.RecognitionMode||(e.RecognitionMode={})),(function(t){t.Low="low",t.Medium="medium",t.High="high"})(e.SpeechStartEventSensitivity||(e.SpeechStartEventSensitivity={}))})(sn)),sn}var Yo;function Yd(){if(Yo)return It;Yo=1,Object.defineProperty(It,"__esModule",{value:!0}),It.SpeechRecognizer=void 0;const e=A(),t=V(),i=I(),u=b(),n=P();let a=class vp extends n.Recognizer{constructor(r,o){const c=r;u.Contracts.throwIfNull(c,"speechConfig"),u.Contracts.throwIfNullOrWhitespace(c.properties.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage),n.PropertyId[n.PropertyId.SpeechServiceConnection_RecoLanguage]),super(o,c.properties,new e.SpeechConnectionFactory,r.tokenCredential),this.privDisposedRecognizer=!1}static FromConfig(r,o,c){const p=r;return o.properties.mergeTo(p.properties),new vp(r,c)}get endpointId(){return u.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(n.PropertyId.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(n.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(r){u.Contracts.throwIfNullOrWhitespace(r,"token"),this.properties.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,r)}get speechRecognitionLanguage(){return u.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return u.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(e.OutputFormatPropertyName,n.OutputFormat[n.OutputFormat.Simple])===n.OutputFormat[n.OutputFormat.Simple]?n.OutputFormat.Simple:n.OutputFormat.Detailed}get properties(){return this.privProperties}recognizeOnceAsync(r,o){(0,i.marshalPromiseToCallbacks)(this.recognizeOnceAsyncImpl(t.RecognitionMode.Interactive),r,o)}startContinuousRecognitionAsync(r,o){(0,i.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(this.properties.getProperty(e.ForceDictationPropertyName,void 0)===void 0?t.RecognitionMode.Conversation:t.RecognitionMode.Dictation),r,o)}stopContinuousRecognitionAsync(r,o){(0,i.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),r,o)}startKeywordRecognitionAsync(r,o,c){u.Contracts.throwIfNull(r,"model"),c&&c("Not yet implemented.")}stopKeywordRecognitionAsync(r){r&&r()}close(r,o){u.Contracts.throwIfDisposed(this.privDisposedRecognizer),(0,i.marshalPromiseToCallbacks)(this.dispose(!0),r,o)}async dispose(r){this.privDisposedRecognizer||(r&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(r))}createRecognizerConfig(r){return new e.RecognizerConfig(r,this.privProperties)}createServiceRecognizer(r,o,c,p){const h=c;return new e.SpeechServiceRecognizer(r,o,h,p,this)}};return It.SpeechRecognizer=a,It}var wt={},_t={},de={},$o;function lp(){if($o)return de;$o=1,Object.defineProperty(de,"__esModule",{value:!0}),de.ConnectionMessageImpl=de.ConnectionMessage=void 0;const e=U(),t=I(),i=hp(),u=ts();let n=class{};de.ConnectionMessage=n;class a{constructor(r){this.privConnectionMessage=r,this.privProperties=new i.PropertyCollection,this.privConnectionMessage.headers[e.HeaderNames.ConnectionId]&&this.privProperties.setProperty(u.PropertyId.Speech_SessionId,this.privConnectionMessage.headers[e.HeaderNames.ConnectionId]),Object.keys(this.privConnectionMessage.headers).forEach(o=>{this.privProperties.setProperty(o,this.privConnectionMessage.headers[o])})}get path(){return this.privConnectionMessage.headers[Object.keys(this.privConnectionMessage.headers).find(r=>r.toLowerCase()==="path".toLowerCase())]}get isTextMessage(){return this.privConnectionMessage.messageType===t.MessageType.Text}get isBinaryMessage(){return this.privConnectionMessage.messageType===t.MessageType.Binary}get TextMessage(){return this.privConnectionMessage.textBody}get binaryMessage(){return this.privConnectionMessage.binaryBody}get properties(){return this.privProperties}toString(){return""}}return de.ConnectionMessageImpl=a,de}var ea;function fp(){if(ea)return _t;ea=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.Connection=void 0;const e=A(),t=I(),i=lp(),u=b(),n=P();let a=class Jn{static fromRecognizer(r){const o=r.internalData,c=new Jn;return c.privInternalData=o,c.setupEvents(),c}static fromSynthesizer(r){const o=r.internalData,c=new Jn;return c.privInternalData=o,c.setupEvents(),c}openConnection(r,o){(0,t.marshalPromiseToCallbacks)(this.privInternalData.connect(),r,o)}closeConnection(r,o){if(this.privInternalData instanceof e.SynthesisAdapterBase)throw new Error("Disconnecting a synthesizer's connection is currently not supported");(0,t.marshalPromiseToCallbacks)(this.privInternalData.disconnect(),r,o)}setMessageProperty(r,o,c){if(u.Contracts.throwIfNullOrWhitespace(o,"propertyName"),this.privInternalData instanceof e.ServiceRecognizerBase){if(r.toLowerCase()!=="speech.context")throw new Error("Only speech.context message property sets are currently supported for recognizer");{const p=this.privInternalData.speechContext.getContext();p[o]=c}}else if(this.privInternalData instanceof e.SynthesisAdapterBase){if(r.toLowerCase()!=="speech.config"&&r.toLowerCase()!=="synthesis.context")throw new Error("Only speech.config and synthesis.context message paths are currently supported for synthesizer");if(r.toLowerCase()==="speech.config"){if(o.toLowerCase()!=="context")throw new Error("Only context property is currently supported for speech.config message path for synthesizer");this.privInternalData.synthesizerConfig.setContextFromJson(c)}else this.privInternalData.synthesisContext.setSection(o,c)}}sendMessageAsync(r,o,c,p){(0,t.marshalPromiseToCallbacks)(this.privInternalData.sendNetworkMessage(r,o),c,p)}close(){}setupEvents(){this.privEventListener=this.privInternalData.connectionEvents.attach(r=>{r.name==="ConnectionEstablishedEvent"?this.connected&&this.connected(new n.ConnectionEventArgs(r.connectionId)):r.name==="ConnectionClosedEvent"?this.disconnected&&this.disconnected(new n.ConnectionEventArgs(r.connectionId)):r.name==="ConnectionMessageSentEvent"?this.messageSent&&this.messageSent(new n.ConnectionMessageEventArgs(new i.ConnectionMessageImpl(r.message))):r.name==="ConnectionMessageReceivedEvent"&&this.messageReceived&&this.messageReceived(new n.ConnectionMessageEventArgs(new i.ConnectionMessageImpl(r.message)))}),this.privServiceEventListener=this.privInternalData.serviceEvents.attach(r=>{this.receivedServiceMessage&&this.receivedServiceMessage(new n.ServiceEventArgs(r.jsonString,r.name))})}};return _t.Connection=a,_t}var ta;function $d(){if(ta)return wt;ta=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.TranslationRecognizer=void 0;const e=A(),t=V(),i=I(),u=fp(),n=b(),a=P();let s=class gp extends a.Recognizer{constructor(o,c,p){const h=o;n.Contracts.throwIfNull(h,"speechConfig"),super(c,h.properties,p||new e.TranslationConnectionFactory,o.tokenCredential),this.privDisposedTranslationRecognizer=!1,this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)!==void 0&&n.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationVoice),a.PropertyId[a.PropertyId.SpeechServiceConnection_TranslationVoice]),n.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages),a.PropertyId[a.PropertyId.SpeechServiceConnection_TranslationToLanguages]),n.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage),a.PropertyId[a.PropertyId.SpeechServiceConnection_RecoLanguage])}static FromConfig(o,c,p){const h=o;return c.properties.mergeTo(h.properties),c.properties.getProperty(a.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,void 0)===e.AutoDetectSourceLanguagesOpenRangeOptionName&&h.properties.setProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage,"en-US"),new gp(o,p)}get speechRecognitionLanguage(){return n.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_RecoLanguage)}get targetLanguages(){return n.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(",")}get voiceName(){return n.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(a.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(o){this.properties.setProperty(a.PropertyId.SpeechServiceAuthorization_Token,o)}recognizeOnceAsync(o,c){n.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),(0,i.marshalPromiseToCallbacks)(this.recognizeOnceAsyncImpl(t.RecognitionMode.Interactive),o,c)}startContinuousRecognitionAsync(o,c){(0,i.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(t.RecognitionMode.Conversation),o,c)}stopContinuousRecognitionAsync(o,c){(0,i.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),o,c)}removeTargetLanguage(o){if(n.Contracts.throwIfNullOrUndefined(o,"language to be removed"),this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0){const c=this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","),p=c.indexOf(o);p>-1&&(c.splice(p,1),this.properties.setProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages,c.join(",")),this.updateLanguages(c))}}addTargetLanguage(o){n.Contracts.throwIfNullOrUndefined(o,"language to be added");let c=[];this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0?(c=this.properties.getProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","),c.includes(o)||(c.push(o),this.properties.setProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages,c.join(",")))):(this.properties.setProperty(a.PropertyId.SpeechServiceConnection_TranslationToLanguages,o),c=[o]),this.updateLanguages(c)}close(o,c){n.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),(0,i.marshalPromiseToCallbacks)(this.dispose(!0),o,c)}onConnection(){}async dispose(o){this.privDisposedTranslationRecognizer||(this.privDisposedTranslationRecognizer=!0,o&&(await this.implRecognizerStop(),await super.dispose(o)))}createRecognizerConfig(o){return new e.RecognizerConfig(o,this.privProperties)}createServiceRecognizer(o,c,p,h){const v=p;return new e.TranslationServiceRecognizer(o,c,v,h,this)}updateLanguages(o){const c=u.Connection.fromRecognizer(this);c&&(c.setMessageProperty("speech.context","translationcontext",{to:o}),c.sendMessageAsync("event",JSON.stringify({id:"translation",name:"updateLanguage",to:o})))}};return wt.TranslationRecognizer=s,wt}var bt={},ra;function ev(){if(ra)return bt;ra=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.Translations=void 0;const e=P();let t=class{constructor(){this.privMap=new e.PropertyCollection}get languages(){return this.privMap.keys}get(u,n){return this.privMap.getProperty(u,n)}set(u,n){this.privMap.setProperty(u,n)}};return bt.Translations=t,bt}var on={},ia;function tv(){return ia||(ia=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NoMatchReason=void 0,(function(t){t[t.NotRecognized=0]="NotRecognized",t[t.InitialSilenceTimeout=1]="InitialSilenceTimeout",t[t.InitialBabbleTimeout=2]="InitialBabbleTimeout"})(e.NoMatchReason||(e.NoMatchReason={}))})(on)),on}var Mt={},na;function rv(){if(na)return Mt;na=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.NoMatchDetails=void 0;const e=A(),t=P();let i=class mp{constructor(n){this.privReason=n}static fromResult(n){const a=e.SimpleSpeechPhrase.fromJSON(n.json,0);let s=t.NoMatchReason.NotRecognized;switch(a.RecognitionStatus){case e.RecognitionStatus.BabbleTimeout:s=t.NoMatchReason.InitialBabbleTimeout;break;case e.RecognitionStatus.InitialSilenceTimeout:s=t.NoMatchReason.InitialSilenceTimeout;break;default:s=t.NoMatchReason.NotRecognized;break}return new mp(s)}get reason(){return this.privReason}};return Mt.NoMatchDetails=i,Mt}var Ot={},sa;function iv(){if(sa)return Ot;sa=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.TranslationRecognitionCanceledEventArgs=void 0;let e=class{constructor(i,u,n,a,s){this.privCancelReason=u,this.privErrorDetails=n,this.privResult=s,this.privSessionId=i,this.privErrorCode=a}get result(){return this.privResult}get sessionId(){return this.privSessionId}get reason(){return this.privCancelReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}};return Ot.TranslationRecognitionCanceledEventArgs=e,Ot}var Dt={},oa;function Sp(){if(oa)return Dt;oa=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.CancellationDetailsBase=void 0;let e=class{constructor(i,u,n){this.privReason=i,this.privErrorDetails=u,this.privErrorCode=n}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get ErrorCode(){return this.privErrorCode}};return Dt.CancellationDetailsBase=e,Dt}var kt={},aa;function nv(){if(aa)return kt;aa=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.CancellationDetails=void 0;const e=A(),t=Sp(),i=P();let u=class Cp extends t.CancellationDetailsBase{constructor(a,s,r){super(a,s,r)}static fromResult(a){let s=i.CancellationReason.Error,r=i.CancellationErrorCode.NoError;if(a instanceof i.RecognitionResult&&a.json){const o=e.SimpleSpeechPhrase.fromJSON(a.json,0);s=e.EnumTranslation.implTranslateCancelResult(o.RecognitionStatus)}return a.properties&&(r=i.CancellationErrorCode[a.properties.getProperty(e.CancellationErrorCodePropertyName,i.CancellationErrorCode[i.CancellationErrorCode.NoError])]),new Cp(s,a.errorDetails||e.EnumTranslation.implTranslateErrorDetails(r),r)}};return kt.CancellationDetails=u,kt}var an={},ca;function sv(){return ca||(ca=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CancellationErrorCode=void 0,(function(t){t[t.NoError=0]="NoError",t[t.AuthenticationFailure=1]="AuthenticationFailure",t[t.BadRequestParameters=2]="BadRequestParameters",t[t.TooManyRequests=3]="TooManyRequests",t[t.ConnectionFailure=4]="ConnectionFailure",t[t.ServiceTimeout=5]="ServiceTimeout",t[t.ServiceError=6]="ServiceError",t[t.RuntimeError=7]="RuntimeError",t[t.Forbidden=8]="Forbidden"})(e.CancellationErrorCode||(e.CancellationErrorCode={}))})(an)),an}var Nt={},ua;function ov(){if(ua)return Nt;ua=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.ConnectionEventArgs=void 0;const e=P();let t=class extends e.SessionEventArgs{};return Nt.ConnectionEventArgs=t,Nt}var zt={},pa;function av(){if(pa)return zt;pa=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.ServiceEventArgs=void 0;const e=P();let t=class extends e.SessionEventArgs{constructor(u,n,a){super(a),this.privJsonResult=u,this.privEventName=n}get jsonString(){return this.privJsonResult}get eventName(){return this.privEventName}};return zt.ServiceEventArgs=t,zt}var jt={},ha;function cv(){if(ha)return jt;ha=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.PhraseListGrammar=void 0;const e=b();let t=class yp{constructor(u){this.privGrammerBuilder=u.dynamicGrammar}static fromRecognizer(u){const n=u.internalData;return new yp(n)}addPhrase(u){this.privGrammerBuilder.addPhrase(u)}addPhrases(u){this.privGrammerBuilder.addPhrase(u)}clear(){this.privGrammerBuilder.clearPhrases()}setWeight(u){e.Contracts.throwIfNumberOutOfRange(u,"weight",0,2),this.privGrammerBuilder.setWeight(u)}};return jt.PhraseListGrammar=t,jt}var ve={},da;function rs(){if(da)return ve;da=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.DialogServiceConfigImpl=ve.DialogServiceConfig=void 0;const e=b(),t=P();let i=class{constructor(){}set applicationId(a){}static get DialogTypes(){return{BotFramework:"bot_framework",CustomCommands:"custom_commands"}}};ve.DialogServiceConfig=i;class u extends i{constructor(){super(),this.privSpeechConfig=new t.SpeechConfigImpl}get properties(){return this.privSpeechConfig.properties}get speechRecognitionLanguage(){return this.privSpeechConfig.speechRecognitionLanguage}set speechRecognitionLanguage(a){e.Contracts.throwIfNullOrWhitespace(a,"value"),this.privSpeechConfig.speechRecognitionLanguage=a}get outputFormat(){return this.privSpeechConfig.outputFormat}set outputFormat(a){this.privSpeechConfig.outputFormat=a}setProperty(a,s){this.privSpeechConfig.setProperty(a,s)}getProperty(a,s){return this.privSpeechConfig.getProperty(a)}setProxy(a,s,r,o){this.setProperty(t.PropertyId.SpeechServiceConnection_ProxyHostName,a),this.setProperty(t.PropertyId.SpeechServiceConnection_ProxyPort,`${s}`),r&&this.setProperty(t.PropertyId.SpeechServiceConnection_ProxyUserName,r),o&&this.setProperty(t.PropertyId.SpeechServiceConnection_ProxyPassword,o)}setServiceProperty(a,s,r){this.privSpeechConfig.setServiceProperty(a,s)}close(){}}return ve.DialogServiceConfigImpl=u,ve}var Lt={},va;function uv(){if(va)return Lt;va=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.BotFrameworkConfig=void 0;const e=b(),t=rs(),i=P();let u=class extends t.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(a,s,r){e.Contracts.throwIfNullOrWhitespace(a,"subscription"),e.Contracts.throwIfNullOrWhitespace(s,"region");const o=new t.DialogServiceConfigImpl;return o.setProperty(i.PropertyId.Conversation_DialogType,t.DialogServiceConfig.DialogTypes.BotFramework),o.setProperty(i.PropertyId.SpeechServiceConnection_Key,a),o.setProperty(i.PropertyId.SpeechServiceConnection_Region,s),r&&o.setProperty(i.PropertyId.Conversation_ApplicationId,r),o}static fromAuthorizationToken(a,s,r){e.Contracts.throwIfNullOrWhitespace(a,"authorizationToken"),e.Contracts.throwIfNullOrWhitespace(s,"region");const o=new t.DialogServiceConfigImpl;return o.setProperty(i.PropertyId.Conversation_DialogType,t.DialogServiceConfig.DialogTypes.BotFramework),o.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,a),o.setProperty(i.PropertyId.SpeechServiceConnection_Region,s),r&&o.setProperty(i.PropertyId.Conversation_ApplicationId,r),o}static fromHost(a,s,r){e.Contracts.throwIfNullOrUndefined(a,"host");const o=a instanceof URL?a:new URL(`wss://${a}.convai.speech.azure.us`);e.Contracts.throwIfNullOrUndefined(o,"resolvedHost");const c=new t.DialogServiceConfigImpl;return c.setProperty(i.PropertyId.Conversation_DialogType,t.DialogServiceConfig.DialogTypes.BotFramework),c.setProperty(i.PropertyId.SpeechServiceConnection_Host,o.toString()),s!==void 0&&c.setProperty(i.PropertyId.SpeechServiceConnection_Key,s),c}static fromEndpoint(a,s){e.Contracts.throwIfNull(a,"endpoint");const r=new t.DialogServiceConfigImpl;return r.setProperty(i.PropertyId.Conversation_DialogType,t.DialogServiceConfig.DialogTypes.BotFramework),r.setProperty(i.PropertyId.SpeechServiceConnection_Endpoint,a.toString()),s!==void 0&&r.setProperty(i.PropertyId.SpeechServiceConnection_Key,s),r}};return Lt.BotFrameworkConfig=u,Lt}var qt={},la;function pv(){if(la)return qt;la=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.CustomCommandsConfig=void 0;const e=b(),t=rs(),i=P();let u=class extends t.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(a,s,r){e.Contracts.throwIfNullOrWhitespace(a,"applicationId"),e.Contracts.throwIfNullOrWhitespace(s,"subscription"),e.Contracts.throwIfNullOrWhitespace(r,"region");const o=new t.DialogServiceConfigImpl;return o.setProperty(i.PropertyId.Conversation_DialogType,t.DialogServiceConfig.DialogTypes.CustomCommands),o.setProperty(i.PropertyId.Conversation_ApplicationId,a),o.setProperty(i.PropertyId.SpeechServiceConnection_Key,s),o.setProperty(i.PropertyId.SpeechServiceConnection_Region,r),o}static fromAuthorizationToken(a,s,r){e.Contracts.throwIfNullOrWhitespace(a,"applicationId"),e.Contracts.throwIfNullOrWhitespace(s,"authorizationToken"),e.Contracts.throwIfNullOrWhitespace(r,"region");const o=new t.DialogServiceConfigImpl;return o.setProperty(i.PropertyId.Conversation_DialogType,t.DialogServiceConfig.DialogTypes.CustomCommands),o.setProperty(i.PropertyId.Conversation_ApplicationId,a),o.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,s),o.setProperty(i.PropertyId.SpeechServiceConnection_Region,r),o}set applicationId(a){e.Contracts.throwIfNullOrWhitespace(a,"value"),this.setProperty(i.PropertyId.Conversation_ApplicationId,a)}get applicationId(){return this.getProperty(i.PropertyId.Conversation_ApplicationId)}};return qt.CustomCommandsConfig=u,qt}var Bt={},Ft={},Ut={},xt={},fa;function ie(){if(fa)return xt;fa=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.QueryParameterNames=void 0;let e=class{};return xt.QueryParameterNames=e,e.BotId="botid",e.CustomSpeechDeploymentId="cid",e.CustomVoiceDeploymentId="deploymentId",e.EnableAudioLogging="storeAudio",e.EnableLanguageId="lidEnabled",e.EnableWordLevelTimestamps="wordLevelTimestamps",e.EndSilenceTimeoutMs="endSilenceTimeoutMs",e.SegmentationSilenceTimeoutMs="segmentationSilenceTimeoutMs",e.SegmentationMaximumTimeMs="segmentationMaximumTimeMs",e.SegmentationStrategy="segmentationStrategy",e.Format="format",e.InitialSilenceTimeoutMs="initialSilenceTimeoutMs",e.Language="language",e.Profanity="profanity",e.RequestBotStatusMessages="enableBotMessageStatus",e.StableIntermediateThreshold="stableIntermediateThreshold",e.StableTranslation="stableTranslation",e.TestHooks="testhooks",e.Postprocessing="postprocessing",e.CtsMeetingId="meetingId",e.CtsDeviceId="deviceId",e.CtsIsParticipant="isParticipant",e.EnableAvatar="enableTalkingAvatar",xt}var ga;function Y(){if(ga)return Ut;ga=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.ConnectionFactoryBase=void 0;const e=A(),t=I(),i=P(),u=ie();let n=class{static getHostSuffix(s){if(s){if(s.toLowerCase().startsWith("china"))return".azure.cn";if(s.toLowerCase().startsWith("usgov"))return".azure.us"}return".microsoft.com"}setCommonUrlParams(s,r,o){new Map([[i.PropertyId.Speech_SegmentationSilenceTimeoutMs,u.QueryParameterNames.SegmentationSilenceTimeoutMs],[i.PropertyId.SpeechServiceConnection_EnableAudioLogging,u.QueryParameterNames.EnableAudioLogging],[i.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,u.QueryParameterNames.EndSilenceTimeoutMs],[i.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,u.QueryParameterNames.InitialSilenceTimeoutMs],[i.PropertyId.SpeechServiceResponse_PostProcessingOption,u.QueryParameterNames.Postprocessing],[i.PropertyId.SpeechServiceResponse_ProfanityOption,u.QueryParameterNames.Profanity],[i.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,u.QueryParameterNames.EnableWordLevelTimestamps],[i.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,u.QueryParameterNames.StableIntermediateThreshold]]).forEach((h,v)=>{this.setUrlParameter(v,h,s,r,o)});const p=JSON.parse(s.parameters.getProperty(e.ServicePropertiesPropertyName,"{}"));Object.keys(p).forEach(h=>{r[h]=p[h]})}setUrlParameter(s,r,o,c,p){const h=o.parameters.getProperty(s,void 0);h&&(!p||p.search(r)===-1)&&(c[r]=h.toLocaleLowerCase())}static async getRedirectUrlFromEndpoint(s){const r=new URL(s);r.protocol="https:",r.port="443",r.searchParams.append("GenerateRedirectResponse","true");const c=r.toString();t.Events.instance.onEvent(new t.ConnectionRedirectEvent("",c,void 0,"ConnectionFactoryBase: redirectUrl request"));const p=await fetch(c);if(p.status!==200)return s;const h=await p.text();t.Events.instance.onEvent(new t.ConnectionRedirectEvent("",h,s,"ConnectionFactoryBase: redirectUrlString"));try{return new URL(h.trim()).toString()}catch{return s}}};return Ut.ConnectionFactoryBase=n,Ut}var ma;function hv(){if(ma)return Ft;ma=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.DialogConnectionFactory=void 0;const e=L(),t=A(),i=P(),u=Y(),n=A(),a=U(),s=ie();class r extends u.ConnectionFactoryBase{create(c,p,h){const v=c.parameters.getProperty(i.PropertyId.Conversation_ApplicationId,""),d=c.parameters.getProperty(i.PropertyId.Conversation_DialogType),f=c.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Region),g=c.parameters.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,"en-US"),m=c.parameters.getProperty(i.PropertyId.Conversation_Request_Bot_Status_Messages,"true"),l={};l[a.HeaderNames.ConnectionId]=h,l[s.QueryParameterNames.Format]=c.parameters.getProperty(t.OutputFormatPropertyName,i.OutputFormat[i.OutputFormat.Simple]).toLowerCase(),l[s.QueryParameterNames.Language]=g,l[s.QueryParameterNames.RequestBotStatusMessages]=m,v&&(l[s.QueryParameterNames.BotId]=v,d===i.DialogServiceConfig.DialogTypes.CustomCommands&&(l[a.HeaderNames.CustomCommandsAppId]=v));const S=d===i.DialogServiceConfig.DialogTypes.CustomCommands?"commands/":"",C=d===i.DialogServiceConfig.DialogTypes.CustomCommands?"v1":d===i.DialogServiceConfig.DialogTypes.BotFramework?"v3":"v0",y={};p.token!=null&&p.token!==""&&(y[p.headerName]=p.token);let R=c.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Endpoint,"");if(!R){const w=u.ConnectionFactoryBase.getHostSuffix(f),E=c.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Host,`wss://${f}.${r.BaseUrl}${w}`);R=`${E.endsWith("/")?E:E+"/"}${S}${r.ApiKey}/${C}`}this.setCommonUrlParams(c,l,R);const T=c.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return Promise.resolve(new e.WebsocketConnection(R,l,y,new n.WebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(c),T,h))}}return Ft.DialogConnectionFactory=r,r.ApiKey="api",r.BaseUrl="convai.speech",Ft}var Sa;function dv(){if(Sa)return Bt;Sa=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.DialogServiceConnector=void 0;const e=hv(),t=A(),i=V(),u=I(),n=b(),a=P(),s=ts();let r=class extends a.Recognizer{constructor(c,p){const h=c;n.Contracts.throwIfNull(c,"dialogConfig"),super(p,h.properties,new e.DialogConnectionFactory),this.isTurnComplete=!0,this.privIsDisposed=!1,this.privProperties=h.properties.clone();const v=this.buildAgentConfig();this.privReco.agentConfig.set(v)}connect(c,p){(0,u.marshalPromiseToCallbacks)(this.privReco.connect(),c,p)}disconnect(c,p){(0,u.marshalPromiseToCallbacks)(this.privReco.disconnect(),c,p)}get authorizationToken(){return this.properties.getProperty(s.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(c){n.Contracts.throwIfNullOrWhitespace(c,"token"),this.properties.setProperty(s.PropertyId.SpeechServiceAuthorization_Token,c)}get properties(){return this.privProperties}get speechActivityTemplate(){return this.properties.getProperty(s.PropertyId.Conversation_Speech_Activity_Template)}set speechActivityTemplate(c){this.properties.setProperty(s.PropertyId.Conversation_Speech_Activity_Template,c)}listenOnceAsync(c,p){if(this.isTurnComplete){n.Contracts.throwIfDisposed(this.privIsDisposed);const v=(async()=>{await this.privReco.connect(),await this.implRecognizerStop(),this.isTurnComplete=!1;const d=new u.Deferred;await this.privReco.recognize(i.RecognitionMode.Conversation,d.resolve,d.reject);const f=await d.promise;return await this.implRecognizerStop(),f})();v.catch(()=>{this.dispose(!0).catch(()=>{})}),(0,u.marshalPromiseToCallbacks)(v.finally(()=>{this.isTurnComplete=!0}),c,p)}}sendActivityAsync(c,p,h){(0,u.marshalPromiseToCallbacks)(this.privReco.sendMessage(c),p,h)}close(c,p){n.Contracts.throwIfDisposed(this.privIsDisposed),(0,u.marshalPromiseToCallbacks)(this.dispose(!0),c,p)}async dispose(c){this.privIsDisposed||c&&(this.privIsDisposed=!0,await this.implRecognizerStop(),await super.dispose(c))}createRecognizerConfig(c){return new t.RecognizerConfig(c,this.privProperties)}createServiceRecognizer(c,p,h,v){const d=h;return new t.DialogServiceAdapter(c,p,d,v,this)}buildAgentConfig(){return{botInfo:{commType:this.properties.getProperty("Conversation_Communication_Type","Default"),commandsCulture:void 0,connectionId:this.properties.getProperty(s.PropertyId.Conversation_Agent_Connection_Id),conversationId:this.properties.getProperty(s.PropertyId.Conversation_Conversation_Id,void 0),fromId:this.properties.getProperty(s.PropertyId.Conversation_From_Id,void 0),ttsAudioFormat:this.properties.getProperty(s.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)},version:.2}}};return Bt.DialogServiceConnector=r,Bt}var Wt={},Ca;function vv(){if(Ca)return Wt;Ca=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.ActivityReceivedEventArgs=void 0;let e=class{constructor(i,u){this.privActivity=i,this.privAudioStream=u}get activity(){return this.privActivity}get audioStream(){return this.privAudioStream}};return Wt.ActivityReceivedEventArgs=e,Wt}var Ht={},Kt={},ya;function lv(){if(ya)return Kt;ya=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.TurnStatusResponsePayload=void 0;class e{constructor(i){this.privMessageStatusResponse=JSON.parse(i)}static fromJSON(i){return new e(i)}get interactionId(){return this.privMessageStatusResponse.interactionId}get conversationId(){return this.privMessageStatusResponse.conversationId}get statusCode(){switch(this.privMessageStatusResponse.statusCode){case"Success":return 200;case"Failed":return 400;case"TimedOut":return 429;default:return this.privMessageStatusResponse.statusCode}}}return Kt.TurnStatusResponsePayload=e,Kt}var Ra;function fv(){if(Ra)return Ht;Ra=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.TurnStatusReceivedEventArgs=void 0;const e=lv();let t=class{constructor(u){this.privTurnStatus=e.TurnStatusResponsePayload.fromJSON(u)}get interactionId(){return this.privTurnStatus.interactionId}get conversationId(){return this.privTurnStatus.conversationId}get statusCode(){return this.privTurnStatus.statusCode}};return Ht.TurnStatusReceivedEventArgs=t,Ht}var cn={},Pa;function gv(){return Pa||(Pa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ServicePropertyChannel=void 0,(function(t){t[t.UriQueryParameter=0]="UriQueryParameter"})(e.ServicePropertyChannel||(e.ServicePropertyChannel={}))})(cn)),cn}var un={},Ea;function mv(){return Ea||(Ea=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ProfanityOption=void 0,(function(t){t[t.Masked=0]="Masked",t[t.Removed=1]="Removed",t[t.Raw=2]="Raw"})(e.ProfanityOption||(e.ProfanityOption={}))})(un)),un}var Vt={},Ta;function Sv(){if(Ta)return Vt;Ta=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.BaseAudioPlayer=void 0;const e=J(),t=P(),i=Ae();let u=class{constructor(a){this.audioContext=null,this.gainNode=null,this.autoUpdateBufferTimer=0,a===void 0&&(a=t.AudioStreamFormat.getDefaultInputFormat()),this.init(a)}playAudioSample(a,s,r){try{this.ensureInitializedContext();const o=this.formatAudioData(a),c=new Float32Array(this.samples.length+o.length);c.set(this.samples,0),c.set(o,this.samples.length),this.samples=c,s&&s()}catch(o){r&&r(o)}}stopAudio(a,s){this.audioContext!==null&&(this.samples=new Float32Array,clearInterval(this.autoUpdateBufferTimer),this.audioContext.close().then(()=>{a&&a()},r=>{s&&s(r)}),this.audioContext=null)}init(a){this.audioFormat=a,this.samples=new Float32Array}ensureInitializedContext(){if(this.audioContext===null){this.createAudioContext();const a=200;this.autoUpdateBufferTimer=setInterval(()=>{this.updateAudioBuffer()},a)}}createAudioContext(){this.audioContext=i.AudioStreamFormatImpl.getAudioContext(),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioContext.destination),this.startTime=this.audioContext.currentTime}formatAudioData(a){switch(this.audioFormat.bitsPerSample){case 8:return this.formatArrayBuffer(new Int8Array(a),128);case 16:return this.formatArrayBuffer(new Int16Array(a),32768);case 32:return this.formatArrayBuffer(new Int32Array(a),2147483648);default:throw new e.InvalidOperationError("Only WAVE_FORMAT_PCM (8/16/32 bps) format supported at this time")}}formatArrayBuffer(a,s){const r=new Float32Array(a.length);for(let o=0;o<a.length;o++)r[o]=a[o]/s;return r}updateAudioBuffer(){if(this.samples.length===0)return;const a=this.audioFormat.channels,s=this.audioContext.createBufferSource(),r=this.samples.length/a,o=this.audioContext.createBuffer(a,r,this.audioFormat.samplesPerSec);for(let c=0;c<a;c++){let p=c;const h=o.getChannelData(c);for(let v=0;v<this.samples.length;v++,p+=a)h[v]=this.samples[p]}this.startTime<this.audioContext.currentTime&&(this.startTime=this.audioContext.currentTime),s.buffer=o,s.connect(this.gainNode),s.start(this.startTime),this.startTime+=o.duration,this.samples=new Float32Array}async playAudio(a){this.audioContext===null&&this.createAudioContext();const s=this.audioContext.createBufferSource(),r=this.audioContext.destination;await this.audioContext.decodeAudioData(a,o=>{s.buffer=o,s.connect(r),s.start(0)})}};return Vt.BaseAudioPlayer=u,Vt}var Jt={},Aa;function Cv(){if(Aa)return Jt;Aa=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.ConnectionMessageEventArgs=void 0;let e=class{constructor(i){this.privConnectionMessage=i}get message(){return this.privConnectionMessage}toString(){return"Message: "+this.privConnectionMessage.toString()}};return Jt.ConnectionMessageEventArgs=e,Jt}var Gt={},pn={},Ia;function Rp(){return Ia||(Ia=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.LanguageIdMode=void 0,(function(t){t[t.AtStart=0]="AtStart",t[t.Continuous=1]="Continuous"})(e.LanguageIdMode||(e.LanguageIdMode={}))})(pn)),pn}var wa;function yv(){if(wa)return Gt;wa=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.AutoDetectSourceLanguageConfig=void 0;const e=A(),t=b(),i=P(),u=Rp();let n=class Ei{constructor(){this.privProperties=new i.PropertyCollection,this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_LanguageIdMode,"AtStart"),this.privLanguageIdMode=u.LanguageIdMode.AtStart}static fromOpenRange(){const s=new Ei;return s.properties.setProperty(i.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,e.AutoDetectSourceLanguagesOpenRangeOptionName),s.properties.setProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,"en-US"),s}static fromLanguages(s){t.Contracts.throwIfArrayEmptyOrWhitespace(s,"languages");const r=new Ei;return r.properties.setProperty(i.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,s.join()),r}static fromSourceLanguageConfigs(s){if(s.length<1)throw new Error("Expected non-empty SourceLanguageConfig array.");const r=new Ei,o=[];return s.forEach(c=>{if(o.push(c.language),c.endpointId!==void 0&&c.endpointId!==""){const p=c.language+i.PropertyId.SpeechServiceConnection_EndpointId.toString();r.properties.setProperty(p,c.endpointId)}}),r.properties.setProperty(i.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,o.join()),r}get properties(){return this.privProperties}set mode(s){s===u.LanguageIdMode.Continuous?(this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2"),this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_LanguageIdMode,"Continuous")):(this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"1"),this.privProperties.setProperty(i.PropertyId.SpeechServiceConnection_LanguageIdMode,"AtStart")),this.privLanguageIdMode=s}};return Gt.AutoDetectSourceLanguageConfig=n,Gt}var Qt={},_a;function Rv(){if(_a)return Qt;_a=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.AutoDetectSourceLanguageResult=void 0;const e=b();let t=class Gn{constructor(u,n){e.Contracts.throwIfNullOrUndefined(u,"language"),e.Contracts.throwIfNullOrUndefined(n,"languageDetectionConfidence"),this.privLanguage=u,this.privLanguageDetectionConfidence=n}static fromResult(u){return new Gn(u.language,u.languageDetectionConfidence)}static fromConversationTranscriptionResult(u){return new Gn(u.language,u.languageDetectionConfidence)}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}};return Qt.AutoDetectSourceLanguageResult=t,Qt}var Xt={},ba;function Pv(){if(ba)return Xt;ba=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.SourceLanguageConfig=void 0;const e=b();let t=class Pp{constructor(u,n){e.Contracts.throwIfNullOrUndefined(u,"language"),this.privLanguage=u,this.privEndpointId=n}static fromLanguage(u,n){return new Pp(u,n)}get language(){return this.privLanguage}get endpointId(){return this.privEndpointId}};return Xt.SourceLanguageConfig=t,Xt}var hn={},le={},Ma;function Ep(){if(Ma)return le;Ma=1,Object.defineProperty(le,"__esModule",{value:!0}),le.ConversationImpl=le.Conversation=void 0;const e=A(),t=I(),i=b(),u=P();let n=class{constructor(){}static createConversationAsync(r,o,c,p){i.Contracts.throwIfNullOrUndefined(r,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","config")),i.Contracts.throwIfNullOrUndefined(r.region,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),!r.subscriptionKey&&!r.getProperty(u.PropertyId[u.PropertyId.SpeechServiceAuthorization_Token])&&i.Contracts.throwIfNullOrUndefined(r.subscriptionKey,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Key"));let h,v,d;return typeof o=="string"?(h=new a(r,o),(0,t.marshalPromiseToCallbacks)((async()=>{})(),c,p)):(h=new a(r),v=o,d=c,h.createConversationAsync((()=>{v&&v()}),f=>{d&&d(f)})),h}};le.Conversation=n;class a extends n{constructor(r,o){if(super(),this.privErrors=e.ConversationConnectionConfig.restErrors,this.onConnected=h=>{var v;this.privIsConnected=!0;try{(v=this.privConversationTranslator)!=null&&v.sessionStarted&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,h)}catch{}},this.onDisconnected=h=>{var v;try{(v=this.privConversationTranslator)!=null&&v.sessionStopped&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,h)}catch{}finally{this.close(!1)}},this.onCanceled=(h,v)=>{var d;try{(d=this.privConversationTranslator)!=null&&d.canceled&&this.privConversationTranslator.canceled(this.privConversationTranslator,v)}catch{}},this.onParticipantUpdateCommandReceived=(h,v)=>{try{const d=this.privParticipants.getParticipant(v.id);if(d!==void 0){switch(v.key){case e.ConversationTranslatorCommandTypes.changeNickname:d.displayName=v.value;break;case e.ConversationTranslatorCommandTypes.setUseTTS:d.isUsingTts=v.value;break;case e.ConversationTranslatorCommandTypes.setProfanityFiltering:d.profanity=v.value;break;case e.ConversationTranslatorCommandTypes.setMute:d.isMuted=v.value;break;case e.ConversationTranslatorCommandTypes.setTranslateToLanguages:d.translateToLanguages=v.value;break}this.privParticipants.addOrUpdateParticipant(d),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.Updated,[this.toParticipant(d)],v.sessionId))}}catch{}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(h,v)=>{try{this.privParticipants.participants.forEach(d=>d.isMuted=d.isHost?!1:v.isMuted),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.Updated,this.toParticipants(!1),v.sessionId))}catch{}},this.onParticipantJoinCommandReceived=(h,v)=>{try{const d=this.privParticipants.addOrUpdateParticipant(v.participant);d!==void 0&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.JoinedConversation,[this.toParticipant(d)],v.sessionId))}catch{}},this.onParticipantLeaveCommandReceived=(h,v)=>{try{const d=this.privParticipants.getParticipant(v.participant.id);d!==void 0&&(this.privParticipants.deleteParticipant(v.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.LeftConversation,[this.toParticipant(d)],v.sessionId)))}catch{}},this.onTranslationReceived=(h,v)=>{try{switch(v.command){case e.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new u.ConversationTranslationEventArgs(v.payload,void 0,v.sessionId));break;case e.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new u.ConversationTranslationEventArgs(v.payload,void 0,v.sessionId));break;case e.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new u.ConversationTranslationEventArgs(v.payload,void 0,v.sessionId));break}}catch{}},this.onParticipantsListReceived=(h,v)=>{var d;try{if(v.sessionToken!==void 0&&v.sessionToken!==null&&(this.privRoom.token=v.sessionToken),this.privParticipants.participants=[...v.participants],this.privParticipants.me!==void 0&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),v.sessionId)),this.me.isHost){const f=(d=this.privConversationTranslator)==null?void 0:d.properties.getProperty(u.PropertyId.ConversationTranslator_Name);f!==void 0&&f.length>0&&f!==this.me.displayName&&this.changeNicknameAsync(f)}}catch{}},this.onConversationExpiration=(h,v)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,v)}catch{}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId="",this.privProperties=new u.PropertyCollection,this.privManager=new e.ConversationManager,r.getProperty(u.PropertyId[u.PropertyId.SpeechServiceConnection_RecoLanguage])||r.setProperty(u.PropertyId[u.PropertyId.SpeechServiceConnection_RecoLanguage],e.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=r.getProperty(u.PropertyId[u.PropertyId.SpeechServiceConnection_RecoLanguage]),o)this.privConversationId=o;else{r.targetLanguages.length===0&&r.addTargetLanguage(this.privLanguage),r.getProperty(u.PropertyId[u.PropertyId.SpeechServiceResponse_ProfanityOption])||r.setProfanity(u.ProfanityOption.Masked);let v=r.getProperty(u.PropertyId[u.PropertyId.ConversationTranslator_Name]);v==null&&(v="Host"),i.Contracts.throwIfNullOrTooLong(v,"nickname",50),i.Contracts.throwIfNullOrTooShort(v,"nickname",2),r.setProperty(u.PropertyId[u.PropertyId.ConversationTranslator_Name],v)}this.privConfig=r;const p=r;i.Contracts.throwIfNull(p,"speechConfig"),this.privProperties=p.properties.clone(),this.privIsConnected=!1,this.privParticipants=new e.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get conversationId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){var r,o;return(r=this.privParticipants.me)!=null&&r.isHost?!1:(o=this.privParticipants.me)==null?void 0:o.isMuted}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get conversationInfo(){const r=this.conversationId,o=this.participants.map(h=>({id:h.id,preferredLanguage:h.preferredLanguage,voice:h.voice})),c={};for(const h of e.ConversationConnectionConfig.transcriptionEventKeys){const v=this.properties.getProperty(h,"");v!==""&&(c[h]=v)}return{id:r,participants:o,conversationProperties:c}}get canSend(){var r;return this.privIsConnected&&!((r=this.privParticipants.me)!=null&&r.isMuted)}get canSendAsHost(){var r;return this.privIsConnected&&((r=this.privParticipants.me)==null?void 0:r.isHost)}get authorizationToken(){return this.privToken}set authorizationToken(r){i.Contracts.throwIfNullOrWhitespace(r,"authorizationToken"),this.privToken=r}set conversationTranslator(r){this.privConversationTranslator=r}onToken(r){this.privConversationTranslator.onToken(r)}createConversationAsync(r,o){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),o),this.privManager.createOrJoin(this.privProperties,void 0,(c=>{c||this.handleError(new Error(this.privErrors.permissionDeniedConnect),o),this.privRoom=c,this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}startConversationAsync(r,o){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),o),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer=e.ConversationRecognizerFactory.fromConfig(this,this.privConfig),this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}addParticipantAsync(r,o,c){i.Contracts.throwIfNullOrUndefined(r,"Participant"),(0,t.marshalPromiseToCallbacks)(this.addParticipantImplAsync(r),o,c)}joinConversationAsync(r,o,c,p,h){try{i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","conversationId")),i.Contracts.throwIfNullOrWhitespace(o,this.privErrors.invalidArgs.replace("{arg}","nickname")),i.Contracts.throwIfNullOrWhitespace(c,this.privErrors.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,r,(v=>{i.Contracts.throwIfNullOrUndefined(v,this.privErrors.permissionDeniedConnect),this.privRoom=v,this.privConfig.authorizationToken=v.cognitiveSpeechAuthToken,p&&p(v.cognitiveSpeechAuthToken)}),(v=>{this.handleError(v,h)}))}catch(v){this.handleError(v,h)}}deleteConversationAsync(r,o){(0,t.marshalPromiseToCallbacks)(this.deleteConversationImplAsync(),r,o)}async deleteConversationImplAsync(){i.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),i.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),await this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()}endConversationAsync(r,o){(0,t.marshalPromiseToCallbacks)(this.endConversationImplAsync(),r,o)}endConversationImplAsync(){return this.close(!0)}lockConversationAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","lock")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}muteAllParticipantsAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","mute")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}muteParticipantAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","userId")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),!this.me.isHost&&this.me.id!==r&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),c),this.privParticipants.getParticipantIndex(r)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(r,!0),(()=>{this.handleCallback(o,c)}),(h=>{this.handleError(h,c)}))}catch(p){this.handleError(p,c)}}removeParticipantAsync(r,o,c){try{if(i.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&r.hasOwnProperty("id"))(0,t.marshalPromiseToCallbacks)(this.removeParticipantImplAsync(r),o,c);else{i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","remove")),c);let p="";typeof r=="string"?p=r:r.hasOwnProperty("id")?p=r.id:r.hasOwnProperty("userId")&&(p=r.userId),i.Contracts.throwIfNullOrWhitespace(p,this.privErrors.invalidArgs.replace("{arg}","userId")),this.participants.findIndex(v=>v.id===p)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(p),(()=>{this.handleCallback(o,c)}),(v=>{this.handleError(v,c)}))}}catch(p){this.handleError(p,c)}}unlockConversationAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unlock")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}unmuteAllParticipantsAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unmute all")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}unmuteParticipantAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","userId")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),!this.me.isHost&&this.me.id!==r&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),c),this.privParticipants.getParticipantIndex(r)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(r,!1),(()=>{this.handleCallback(o,c)}),(h=>{this.handleError(h,c)}))}catch(p){this.handleError(p,c)}}sendTextMessageAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","message")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),r.length>this.privTextMessageMaxLength&&this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","message length")),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(r),(()=>{this.handleCallback(o,c)}),(p=>{this.handleError(p,c)}))}catch(p){this.handleError(p,c)}}setTranslatedLanguagesAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfArrayEmptyOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","languages")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(r),(()=>{this.handleCallback(o,c)}),(p=>{this.handleError(p,c)}))}catch(p){this.handleError(p,c)}}changeNicknameAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","nickname")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(r),(()=>{this.handleCallback(o,c)}),(p=>{this.handleError(p,c)}))}catch(p){this.handleError(p,c)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}async connectTranscriberRecognizer(r){this.privTranscriberRecognizer&&await this.privTranscriberRecognizer.close(),await r.enforceAudioGating(),this.privTranscriberRecognizer=r,this.privTranscriberRecognizer.conversation=this}getKeepAlive(){const r=this.me?this.me.displayName:"default_nickname";return JSON.stringify({id:"0",nickname:r,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(r){if(this.privParticipants.addOrUpdateParticipant(r)!==void 0&&this.privTranscriberRecognizer){const c=this.conversationInfo;return c.participants=[r],this.privTranscriberRecognizer.pushConversationEvent(c,"join")}}removeParticipantImplAsync(r){this.privParticipants.deleteParticipant(r.id);const o=this.conversationInfo;return o.participants=[r],this.privTranscriberRecognizer.pushConversationEvent(o,"leave")}async close(r){var o;try{this.privIsConnected=!1,await((o=this.privConversationRecognizer)==null?void 0:o.close()),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(c){throw c}r&&this.dispose()}handleCallback(r,o){if(r){try{r()}catch(c){o&&o(c)}r=void 0}}handleError(r,o){if(o)if(r instanceof Error){const c=r;o(c.name+": "+c.message)}else o(r)}toParticipants(r){const o=this.privParticipants.participants.map(c=>this.toParticipant(c));return r?o:o.filter(c=>c.isHost===!1)}toParticipant(r){return new u.Participant(r.id,r.avatar,r.displayName,r.isHost,r.isMuted,r.isUsingTts,r.preferredLanguage,r.voice)}getMuteAllCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getMuteCommand(r,o){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(r,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setMute,participantId:r,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:o})}getLockCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getEjectCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(r,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.ejectParticipant,participantId:r,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getChangeNicknameCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(r,"nickname"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.changeNickname,nickname:r,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getMessageCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),i.Contracts.throwIfNullOrWhitespace(r,"message"),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:r,type:e.ConversationTranslatorMessageTypes.instantMessage})}}return le.ConversationImpl=a,le}var Zt={},Oa;function Ev(){if(Oa)return Zt;Oa=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.ConversationCommon=void 0;let e=class{constructor(i){this.privAudioConfig=i}handleCallback(i,u){if(i){try{i()}catch(n){u&&u(n)}i=void 0}}handleError(i,u){if(u)if(i instanceof Error){const n=i;u(n.name+": "+n.message)}else u(i)}};return Zt.ConversationCommon=e,Zt}var Yt={},Da;function Tv(){if(Da)return Yt;Da=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.ConversationExpirationEventArgs=void 0;const e=P();let t=class extends e.SessionEventArgs{constructor(u,n){super(n),this.privExpirationTime=u}get expirationTime(){return this.privExpirationTime}};return Yt.ConversationExpirationEventArgs=t,Yt}var $t={},ka;function Av(){if(ka)return $t;ka=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.ConversationParticipantsChangedEventArgs=void 0;const e=P();let t=class extends e.SessionEventArgs{constructor(u,n,a){super(a),this.privReason=u,this.privParticipant=n}get reason(){return this.privReason}get participants(){return this.privParticipant}};return $t.ConversationParticipantsChangedEventArgs=t,$t}var er={},Na;function Iv(){if(Na)return er;Na=1,Object.defineProperty(er,"__esModule",{value:!0}),er.ConversationTranslationCanceledEventArgs=void 0;const e=Ri();let t=class extends e.CancellationEventArgsBase{};return er.ConversationTranslationCanceledEventArgs=t,er}var tr={},za;function wv(){if(za)return tr;za=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.ConversationTranslationEventArgs=void 0;const e=P();let t=class extends e.RecognitionEventArgs{constructor(u,n,a){super(n,a),this.privResult=u}get result(){return this.privResult}};return tr.ConversationTranslationEventArgs=t,tr}var rr={},ja;function _v(){if(ja)return rr;ja=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.ConversationTranslationResult=void 0;const e=up();let t=class extends e.TranslationRecognitionResult{constructor(u,n,a,s,r,o,c,p,h,v,d){super(n,s,r,o,c,p,void 0,void 0,h,v,d),this.privId=u,this.privOrigLang=a}get participantId(){return this.privId}get originalLang(){return this.privOrigLang}};return rr.ConversationTranslationResult=t,rr}var dn={},ir={},nr={},La;function Tp(){if(La)return nr;La=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.StringUtils=void 0;let e=class{static formatString(i,u){if(!i)return"";if(!u)return i;let n="",a="";const s=c=>{n+=c},r=c=>{a+=c};let o=s;for(let c=0;c<i.length;c++){const p=i[c],h=c+1<i.length?i[c+1]:"";switch(p){case"{":h==="{"?(o("{"),c++):o=r;break;case"}":h==="}"?(o("}"),c++):(u.hasOwnProperty(a)&&(n+=u[a]),o=s,a="");break;default:o(p);break}}return n}};return nr.StringUtils=e,nr}var qa;function bv(){if(qa)return ir;qa=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.ConversationTranslatorConnectionFactory=void 0;const e=L(),t=Tp(),i=b(),u=P(),n=U(),a=ie(),s=Y(),r=A();let o=class Ap extends s.ConnectionFactoryBase{constructor(p){super(),i.Contracts.throwIfNullOrUndefined(p,"convGetter"),this.privConvGetter=p}create(p,h,v){const d=p.parameters.getProperty("ConversationTranslator_MultiChannelAudio","").toUpperCase()==="TRUE",f=this.privConvGetter().room,g=f.cognitiveSpeechRegion||p.parameters.getProperty(u.PropertyId.SpeechServiceConnection_Region,""),m={hostSuffix:s.ConnectionFactoryBase.getHostSuffix(g),path:Ap.CTS_VIRT_MIC_PATH,region:encodeURIComponent(g)};m[a.QueryParameterNames.Language]=encodeURIComponent(p.parameters.getProperty(u.PropertyId.SpeechServiceConnection_RecoLanguage,"")),m[a.QueryParameterNames.CtsMeetingId]=encodeURIComponent(f.roomId),m[a.QueryParameterNames.CtsDeviceId]=encodeURIComponent(f.participantId),m[a.QueryParameterNames.CtsIsParticipant]=f.isHost?"":"&"+a.QueryParameterNames.CtsIsParticipant;let l="";const S={},C={};if(d){l=p.parameters.getProperty(u.PropertyId.SpeechServiceConnection_Endpoint),l||(l="wss://"+p.parameters.getProperty(u.PropertyId.SpeechServiceConnection_Host,"transcribe.{region}.cts.speech{hostSuffix}")+"{path}"),l=t.StringUtils.formatString(l,m);const R=new URL(l);R.searchParams.forEach((w,E)=>{S[E]=w}),new r.TranscriberConnectionFactory().setQueryParams(S,p,l),S[a.QueryParameterNames.CtsMeetingId]=m[a.QueryParameterNames.CtsMeetingId],S[a.QueryParameterNames.CtsDeviceId]=m[a.QueryParameterNames.CtsDeviceId],f.isHost||(S[a.QueryParameterNames.CtsIsParticipant]=""),a.QueryParameterNames.Format in S||(S[a.QueryParameterNames.Format]="simple"),R.searchParams.forEach((w,E)=>{R.searchParams.set(E,S[E]),delete S[E]}),l=R.toString()}else{const R=new r.TranslationConnectionFactory;l=R.getEndpointUrl(p,!0),l=t.StringUtils.formatString(l,m),R.setQueryParams(S,p,l)}C[n.HeaderNames.ConnectionId]=v,C[e.RestConfigBase.configParams.token]=f.token,h.token&&(C[h.headerName]=h.token);const y=p.parameters.getProperty("SPEECH-EnableWebsocketCompression","").toUpperCase()==="TRUE";return Promise.resolve(new e.WebsocketConnection(l,S,C,new r.WebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(p),y,v))}};return ir.ConversationTranslatorConnectionFactory=o,o.CTS_VIRT_MIC_PATH="/speech/recognition/dynamicaudio",ir}var Ba;function Mv(){return Ba||(Ba=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConversationTranslator=e.SpeechState=void 0;const t=A(),i=bv(),u=I(),n=b(),a=P(),s=Ep(),r=is();var o;(function(h){h[h.Inactive=0]="Inactive",h[h.Connecting=1]="Connecting",h[h.Connected=2]="Connected"})(o=e.SpeechState||(e.SpeechState={}));class c extends a.TranslationRecognizer{constructor(v,d,f,g){super(v,d,new i.ConversationTranslatorConnectionFactory(g)),this.privSpeechState=o.Inactive,f&&(this.privTranslator=f,this.sessionStarted=()=>{this.privSpeechState=o.Connected},this.sessionStopped=()=>{this.privSpeechState=o.Inactive},this.recognizing=(m,l)=>{this.privTranslator.recognizing&&this.privTranslator.recognizing(this.privTranslator,l)},this.recognized=async(m,l)=>{var S;(S=l.result)!=null&&S.errorDetails?(await this.cancelSpeech(),this.fireCancelEvent(l.result.errorDetails)):this.privTranslator.recognized&&this.privTranslator.recognized(this.privTranslator,l)},this.canceled=async()=>{if(this.privSpeechState!==o.Inactive)try{await this.cancelSpeech()}catch{this.privSpeechState=o.Inactive}})}get state(){return this.privSpeechState}set state(v){this.privSpeechState=v}set authentication(v){this.privReco.authentication=v}onConnection(){this.privSpeechState=o.Connected}async onCancelSpeech(){this.privSpeechState=o.Inactive,await this.cancelSpeech()}fireCancelEvent(v){try{if(this.privTranslator.canceled){const d=new r.ConversationTranslationCanceledEventArgs(a.CancellationReason.Error,v,a.CancellationErrorCode.RuntimeError);this.privTranslator.canceled(this.privTranslator,d)}}catch{}}async cancelSpeech(){var v;try{this.stopContinuousRecognitionAsync(),await((v=this.privReco)==null?void 0:v.disconnect()),this.privSpeechState=o.Inactive}catch{}}}class p extends r.ConversationCommon{constructor(v){super(v),this.privErrors=t.ConversationConnectionConfig.restErrors,this.privIsDisposed=!1,this.privIsSpeaking=!1,this.privPlaceholderKey="abcdefghijklmnopqrstuvwxyz012345",this.privPlaceholderRegion="westus",this.privProperties=new a.PropertyCollection}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get participants(){var v;return(v=this.privConversation)==null?void 0:v.participants}get canSpeak(){return!(!this.privConversation.isConnected||!this.privCTRecognizer||this.privIsSpeaking||this.privCTRecognizer.state===o.Connected||this.privCTRecognizer.state===o.Connecting||this.privConversation.isMutedByHost)}onToken(v){this.privCTRecognizer.authentication=v}setServiceProperty(v,d){const f=JSON.parse(this.privProperties.getProperty(t.ServicePropertiesPropertyName,"{}"));f[v]=d,this.privProperties.setProperty(t.ServicePropertiesPropertyName,JSON.stringify(f))}joinConversationAsync(v,d,f,g,m){try{if(typeof v=="string"){n.Contracts.throwIfNullOrUndefined(v,this.privErrors.invalidArgs.replace("{arg}","conversation id")),n.Contracts.throwIfNullOrWhitespace(d,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privConversation&&this.handleError(new Error(this.privErrors.permissionDeniedStart),m);let l=f;(l==null||l==="")&&(l=t.ConversationConnectionConfig.defaultLanguageCode),this.privSpeechTranslationConfig=a.SpeechTranslationConfig.fromSubscription(this.privPlaceholderKey,this.privPlaceholderRegion),this.privSpeechTranslationConfig.setProfanity(a.ProfanityOption.Masked),this.privSpeechTranslationConfig.addTargetLanguage(l),this.privSpeechTranslationConfig.setProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_RecoLanguage],l),this.privSpeechTranslationConfig.setProperty(a.PropertyId[a.PropertyId.ConversationTranslator_Name],d);const S=[a.PropertyId.SpeechServiceConnection_Host,a.PropertyId.ConversationTranslator_Host,a.PropertyId.SpeechServiceConnection_Endpoint,a.PropertyId.SpeechServiceConnection_ProxyHostName,a.PropertyId.SpeechServiceConnection_ProxyPassword,a.PropertyId.SpeechServiceConnection_ProxyPort,a.PropertyId.SpeechServiceConnection_ProxyUserName,"ConversationTranslator_MultiChannelAudio","ConversationTranslator_Region"];for(const y of S){const R=this.privProperties.getProperty(y);if(R){const T=typeof y=="string"?y:a.PropertyId[y];this.privSpeechTranslationConfig.setProperty(T,R)}}const C=JSON.parse(this.privProperties.getProperty(t.ServicePropertiesPropertyName,"{}"));for(const y of Object.keys(C))this.privSpeechTranslationConfig.setServiceProperty(y,C[y],a.ServicePropertyChannel.UriQueryParameter);this.privConversation=new s.ConversationImpl(this.privSpeechTranslationConfig),this.privConversation.conversationTranslator=this,this.privConversation.joinConversationAsync(v,d,l,(y=>{y||this.handleError(new Error(this.privErrors.permissionDeniedConnect),m),this.privSpeechTranslationConfig.authorizationToken=y,this.privConversation.room.isHost=!1,this.privConversation.startConversationAsync((()=>{this.handleCallback(g,m)}),(R=>{this.handleError(R,m)}))}),(y=>{this.handleError(y,m)}))}else typeof v=="object"?(n.Contracts.throwIfNullOrUndefined(v,this.privErrors.invalidArgs.replace("{arg}","conversation id")),n.Contracts.throwIfNullOrWhitespace(d,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privProperties.setProperty(a.PropertyId.ConversationTranslator_Name,d),this.privConversation=v,this.privConversation.conversationTranslator=this,this.privConversation.room.isHost=!0,n.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedConnect),n.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privSpeechTranslationConfig=v.config,this.handleCallback(f,g)):this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","invalid conversation type")),g)}catch(l){this.handleError(l,typeof f=="string"?m:g)}}leaveConversationAsync(v,d){(0,u.marshalPromiseToCallbacks)((async()=>{await this.cancelSpeech(),await this.privConversation.endConversationImplAsync(),await this.privConversation.deleteConversationImplAsync(),this.dispose()})(),v,d)}sendTextMessageAsync(v,d,f){try{n.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),n.Contracts.throwIfNullOrWhitespace(v,this.privErrors.invalidArgs.replace("{arg}",v)),this.privConversation.sendTextMessageAsync(v,d,f)}catch(g){this.handleError(g,f)}}startTranscribingAsync(v,d){(0,u.marshalPromiseToCallbacks)((async()=>{try{n.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),n.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privCTRecognizer===void 0&&await this.connectTranslatorRecognizer(),n.Contracts.throwIfNullOrUndefined(this.privCTRecognizer,this.privErrors.permissionDeniedSend),this.canSpeak||this.handleError(new Error(this.privErrors.permissionDeniedSend),d),await this.startContinuousRecognition(),this.privIsSpeaking=!0}catch(f){throw this.privIsSpeaking=!1,await this.cancelSpeech(),f}})(),v,d)}stopTranscribingAsync(v,d){(0,u.marshalPromiseToCallbacks)((async()=>{try{if(!this.privIsSpeaking){await this.cancelSpeech();return}this.privIsSpeaking=!1,await new Promise((f,g)=>{this.privCTRecognizer.stopContinuousRecognitionAsync(f,g)})}catch{await this.cancelSpeech()}})(),v,d)}isDisposed(){return this.privIsDisposed}dispose(v,d,f){(0,u.marshalPromiseToCallbacks)((async()=>{this.isDisposed&&!this.privIsSpeaking||(await this.cancelSpeech(),this.privIsDisposed=!0,this.privSpeechTranslationConfig.close(),this.privSpeechRecognitionLanguage=void 0,this.privProperties=void 0,this.privAudioConfig=void 0,this.privSpeechTranslationConfig=void 0,this.privConversation.dispose(),this.privConversation=void 0)})(),d,f)}async cancelSpeech(){var v;try{this.privIsSpeaking=!1,await((v=this.privCTRecognizer)==null?void 0:v.onCancelSpeech()),this.privCTRecognizer=void 0}catch{}}async connectTranslatorRecognizer(){try{this.privAudioConfig===void 0&&(this.privAudioConfig=a.AudioConfig.fromDefaultMicrophoneInput()),this.privSpeechTranslationConfig.getProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_Key])===this.privPlaceholderKey&&this.privSpeechTranslationConfig.setProperty(a.PropertyId[a.PropertyId.SpeechServiceConnection_Key],"");const v=()=>this.privConversation;this.privCTRecognizer=new c(this.privSpeechTranslationConfig,this.privAudioConfig,this,v)}catch(v){throw await this.cancelSpeech(),v}}startContinuousRecognition(){return new Promise((v,d)=>{this.privCTRecognizer.startContinuousRecognitionAsync(v,d)})}}e.ConversationTranslator=p})(dn)),dn}var sr={},Fa;function Ov(){if(Fa)return sr;Fa=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.ConversationTranscriber=void 0;const e=A(),t=V(),i=I(),u=b(),n=P();let a=class Ip extends n.Recognizer{constructor(r,o){const c=r;u.Contracts.throwIfNull(c,"speechConfig"),u.Contracts.throwIfNullOrWhitespace(c.properties.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage),n.PropertyId[n.PropertyId.SpeechServiceConnection_RecoLanguage]),super(o,c.properties,new e.ConversationTranscriberConnectionFactory,r.tokenCredential),this.privProperties.setProperty(n.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2"),this.privDisposedRecognizer=!1}static FromConfig(r,o,c){const p=r;return o.properties.mergeTo(p.properties),new Ip(r,c)}get endpointId(){return u.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(n.PropertyId.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(n.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(r){u.Contracts.throwIfNullOrWhitespace(r,"token"),this.properties.setProperty(n.PropertyId.SpeechServiceAuthorization_Token,r)}get speechRecognitionLanguage(){return u.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return u.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(e.OutputFormatPropertyName,n.OutputFormat[n.OutputFormat.Simple])===n.OutputFormat[n.OutputFormat.Simple]?n.OutputFormat.Simple:n.OutputFormat.Detailed}get properties(){return this.privProperties}startTranscribingAsync(r,o){(0,i.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(t.RecognitionMode.Conversation),r,o)}stopTranscribingAsync(r,o){(0,i.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),r,o)}close(r,o){u.Contracts.throwIfDisposed(this.privDisposedRecognizer),(0,i.marshalPromiseToCallbacks)(this.dispose(!0),r,o)}async dispose(r){this.privDisposedRecognizer||(r&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(r))}createRecognizerConfig(r){return new e.RecognizerConfig(r,this.privProperties)}createServiceRecognizer(r,o,c,p){const h=c;return p.isSpeakerDiarizationEnabled=!0,new e.ConversationTranscriptionServiceRecognizer(r,o,h,p,this)}};return sr.ConversationTranscriber=a,sr}var fe={},Ua;function Dv(){if(Ua)return fe;Ua=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.Participant=fe.User=void 0;const e=P();class t{constructor(n){this.privUserId=n}get userId(){return this.privUserId}}fe.User=t;class i{constructor(n,a,s,r,o,c,p,h){this.privId=n,this.privAvatar=a,this.privDisplayName=s,this.privIsHost=r,this.privIsMuted=o,this.privIsUsingTts=c,this.privPreferredLanguage=p,this.privVoice=h,this.privProperties=new e.PropertyCollection}get avatar(){return this.privAvatar}get displayName(){return this.privDisplayName}get id(){return this.privId}get preferredLanguage(){return this.privPreferredLanguage}get isHost(){return this.privIsHost}get isMuted(){return this.privIsMuted}get isUsingTts(){return this.privIsUsingTts}get voice(){return this.privVoice}get properties(){return this.privProperties}static From(n,a,s){return new i(n,"",n,!1,!1,!1,a,s)}}return fe.Participant=i,fe}var vn={},xa;function kv(){return xa||(xa=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ParticipantChangedReason=void 0,(function(t){t[t.JoinedConversation=0]="JoinedConversation",t[t.LeftConversation=1]="LeftConversation",t[t.Updated=2]="Updated"})(e.ParticipantChangedReason||(e.ParticipantChangedReason={}))})(vn)),vn}var ge={},Wa;function Nv(){if(Wa)return ge;Wa=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.MeetingImpl=ge.Meeting=void 0;const e=A(),t=I(),i=b(),u=P();let n=class{constructor(){}static createMeetingAsync(r,o,c,p){if(i.Contracts.throwIfNullOrUndefined(r,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","config")),i.Contracts.throwIfNullOrUndefined(r.region,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),i.Contracts.throwIfNull(o,"meetingId"),o.length===0)throw new Error("meetingId cannot be empty");!r.subscriptionKey&&!r.getProperty(u.PropertyId[u.PropertyId.SpeechServiceAuthorization_Token])&&i.Contracts.throwIfNullOrUndefined(r.subscriptionKey,e.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Key"));const h=new a(r,o);return(0,t.marshalPromiseToCallbacks)((async()=>{})(),c,p),h}};ge.Meeting=n;class a extends n{constructor(r,o){super(),this.privErrors=e.ConversationConnectionConfig.restErrors,this.onConnected=h=>{var v;this.privIsConnected=!0;try{(v=this.privConversationTranslator)!=null&&v.sessionStarted&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,h)}catch{}},this.onDisconnected=h=>{var v;try{(v=this.privConversationTranslator)!=null&&v.sessionStopped&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,h)}catch{}finally{this.close(!1)}},this.onCanceled=(h,v)=>{var d;try{(d=this.privConversationTranslator)!=null&&d.canceled&&this.privConversationTranslator.canceled(this.privConversationTranslator,v)}catch{}},this.onParticipantUpdateCommandReceived=(h,v)=>{try{const d=this.privParticipants.getParticipant(v.id);if(d!==void 0){switch(v.key){case e.ConversationTranslatorCommandTypes.changeNickname:d.displayName=v.value;break;case e.ConversationTranslatorCommandTypes.setUseTTS:d.isUsingTts=v.value;break;case e.ConversationTranslatorCommandTypes.setProfanityFiltering:d.profanity=v.value;break;case e.ConversationTranslatorCommandTypes.setMute:d.isMuted=v.value;break;case e.ConversationTranslatorCommandTypes.setTranslateToLanguages:d.translateToLanguages=v.value;break}this.privParticipants.addOrUpdateParticipant(d),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.Updated,[this.toParticipant(d)],v.sessionId))}}catch{}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(h,v)=>{try{this.privParticipants.participants.forEach(d=>d.isMuted=d.isHost?!1:v.isMuted),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.Updated,this.toParticipants(!1),v.sessionId))}catch{}},this.onParticipantJoinCommandReceived=(h,v)=>{try{const d=this.privParticipants.addOrUpdateParticipant(v.participant);d!==void 0&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.JoinedConversation,[this.toParticipant(d)],v.sessionId))}catch{}},this.onParticipantLeaveCommandReceived=(h,v)=>{try{const d=this.privParticipants.getParticipant(v.participant.id);d!==void 0&&(this.privParticipants.deleteParticipant(v.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.LeftConversation,[this.toParticipant(d)],v.sessionId)))}catch{}},this.onTranslationReceived=(h,v)=>{try{switch(v.command){case e.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new u.ConversationTranslationEventArgs(v.payload,void 0,v.sessionId));break;case e.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new u.ConversationTranslationEventArgs(v.payload,void 0,v.sessionId));break;case e.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new u.ConversationTranslationEventArgs(v.payload,void 0,v.sessionId));break}}catch{}},this.onParticipantsListReceived=(h,v)=>{var d;try{if(v.sessionToken!==void 0&&v.sessionToken!==null&&(this.privRoom.token=v.sessionToken),this.privParticipants.participants=[...v.participants],this.privParticipants.me!==void 0&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new u.ConversationParticipantsChangedEventArgs(u.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),v.sessionId)),this.me.isHost){const f=(d=this.privConversationTranslator)==null?void 0:d.properties.getProperty(u.PropertyId.ConversationTranslator_Name);f!==void 0&&f.length>0&&f!==this.me.displayName&&this.changeNicknameAsync(f)}}catch{}},this.onConversationExpiration=(h,v)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,v)}catch{}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId="",this.privProperties=new u.PropertyCollection,this.privManager=new e.ConversationManager,r.getProperty(u.PropertyId[u.PropertyId.SpeechServiceConnection_RecoLanguage])||r.setProperty(u.PropertyId[u.PropertyId.SpeechServiceConnection_RecoLanguage],e.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=r.getProperty(u.PropertyId[u.PropertyId.SpeechServiceConnection_RecoLanguage]),this.privConversationId=o,this.privConfig=r;const p=r;i.Contracts.throwIfNull(p,"speechConfig"),this.privProperties=p.properties.clone(),this.privIsConnected=!1,this.privParticipants=new e.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get meetingId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){var r,o;return(r=this.privParticipants.me)!=null&&r.isHost?!1:(o=this.privParticipants.me)==null?void 0:o.isMuted}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get meetingInfo(){const r=this.meetingId,o=this.participants.map(h=>({id:h.id,preferredLanguage:h.preferredLanguage,voice:h.voice})),c={};for(const h of e.ConversationConnectionConfig.transcriptionEventKeys){const v=this.properties.getProperty(h,"");v!==""&&(c[h]=v)}return{id:r,participants:o,meetingProperties:c}}get canSend(){var r;return this.privIsConnected&&!((r=this.privParticipants.me)!=null&&r.isMuted)}get canSendAsHost(){var r;return this.privIsConnected&&((r=this.privParticipants.me)==null?void 0:r.isHost)}get authorizationToken(){return this.privToken}set authorizationToken(r){i.Contracts.throwIfNullOrWhitespace(r,"authorizationToken"),this.privToken=r}createMeetingAsync(r,o){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),o),this.privManager.createOrJoin(this.privProperties,void 0,(c=>{c||this.handleError(new Error(this.privErrors.permissionDeniedConnect),o),this.privRoom=c,this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}startMeetingAsync(r,o){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),o),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}addParticipantAsync(r,o,c){i.Contracts.throwIfNullOrUndefined(r,"Participant"),(0,t.marshalPromiseToCallbacks)(this.addParticipantImplAsync(r),o,c)}joinMeetingAsync(r,o,c,p,h){try{i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","conversationId")),i.Contracts.throwIfNullOrWhitespace(o,this.privErrors.invalidArgs.replace("{arg}","nickname")),i.Contracts.throwIfNullOrWhitespace(c,this.privErrors.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,r,(v=>{i.Contracts.throwIfNullOrUndefined(v,this.privErrors.permissionDeniedConnect),this.privRoom=v,this.privConfig.authorizationToken=v.cognitiveSpeechAuthToken,p&&p(v.cognitiveSpeechAuthToken)}),(v=>{this.handleError(v,h)}))}catch(v){this.handleError(v,h)}}deleteMeetingAsync(r,o){(0,t.marshalPromiseToCallbacks)(this.deleteMeetingImplAsync(),r,o)}async deleteMeetingImplAsync(){i.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),i.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),await this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()}endMeetingAsync(r,o){(0,t.marshalPromiseToCallbacks)(this.endMeetingImplAsync(),r,o)}endMeetingImplAsync(){return this.close(!0)}lockMeetingAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","lock")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}muteAllParticipantsAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","mute")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}muteParticipantAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","userId")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),!this.me.isHost&&this.me.id!==r&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),c),this.privParticipants.getParticipantIndex(r)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(r,!0),(()=>{this.handleCallback(o,c)}),(h=>{this.handleError(h,c)}))}catch(p){this.handleError(p,c)}}removeParticipantAsync(r,o,c){try{if(i.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&r.hasOwnProperty("id"))(0,t.marshalPromiseToCallbacks)(this.removeParticipantImplAsync(r),o,c);else{i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","remove")),c);let p="";typeof r=="string"?p=r:r.hasOwnProperty("id")?p=r.id:r.hasOwnProperty("userId")&&(p=r.userId),i.Contracts.throwIfNullOrWhitespace(p,this.privErrors.invalidArgs.replace("{arg}","userId")),this.participants.findIndex(v=>v.id===p)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(p),(()=>{this.handleCallback(o,c)}),(v=>{this.handleError(v,c)}))}}catch(p){this.handleError(p,c)}}unlockMeetingAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unlock")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}unmuteAllParticipantsAsync(r,o){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unmute all")),o),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),(()=>{this.handleCallback(r,o)}),(c=>{this.handleError(c,o)}))}catch(c){this.handleError(c,o)}}unmuteParticipantAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","userId")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),!this.me.isHost&&this.me.id!==r&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),c),this.privParticipants.getParticipantIndex(r)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(r,!1),(()=>{this.handleCallback(o,c)}),(h=>{this.handleError(h,c)}))}catch(p){this.handleError(p,c)}}sendTextMessageAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","message")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),r.length>this.privTextMessageMaxLength&&this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","message length")),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(r),(()=>{this.handleCallback(o,c)}),(p=>{this.handleError(p,c)}))}catch(p){this.handleError(p,c)}}setTranslatedLanguagesAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfArrayEmptyOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","languages")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(r),(()=>{this.handleCallback(o,c)}),(p=>{this.handleError(p,c)}))}catch(p){this.handleError(p,c)}}changeNicknameAsync(r,o,c){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),i.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","nickname")),i.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),c),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(r),(()=>{this.handleCallback(o,c)}),(p=>{this.handleError(p,c)}))}catch(p){this.handleError(p,c)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}async connectTranscriberRecognizer(r){this.privTranscriberRecognizer&&await this.privTranscriberRecognizer.close(),await r.enforceAudioGating(),this.privTranscriberRecognizer=r,this.privTranscriberRecognizer.meeting=this}getKeepAlive(){const r=this.me?this.me.displayName:"default_nickname";return JSON.stringify({id:"0",nickname:r,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(r){if(this.privParticipants.addOrUpdateParticipant(r)!==void 0&&this.privTranscriberRecognizer){const c=this.meetingInfo;return c.participants=[r],this.privTranscriberRecognizer.pushMeetingEvent(c,"join")}}removeParticipantImplAsync(r){this.privParticipants.deleteParticipant(r.id);const o=this.meetingInfo;return o.participants=[r],this.privTranscriberRecognizer.pushMeetingEvent(o,"leave")}async close(r){var o;try{this.privIsConnected=!1,await((o=this.privConversationRecognizer)==null?void 0:o.close()),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(c){throw c}r&&this.dispose()}handleCallback(r,o){if(r){try{r()}catch(c){o&&o(c)}r=void 0}}handleError(r,o){if(o)if(r instanceof Error){const c=r;o(c.name+": "+c.message)}else o(r)}toParticipants(r){const o=this.privParticipants.participants.map(c=>this.toParticipant(c));return r?o:o.filter(c=>c.isHost===!1)}toParticipant(r){return new u.Participant(r.id,r.avatar,r.displayName,r.isHost,r.isMuted,r.isUsingTts,r.preferredLanguage,r.voice)}getMuteAllCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingd"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getMuteCommand(r,o){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),i.Contracts.throwIfNullOrWhitespace(r,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setMute,participantId:r,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:o})}getLockCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getEjectCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),i.Contracts.throwIfNullOrWhitespace(r,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.ejectParticipant,participantId:r,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getChangeNicknameCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),i.Contracts.throwIfNullOrWhitespace(r,"nickname"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:e.ConversationTranslatorCommandTypes.changeNickname,nickname:r,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:e.ConversationTranslatorMessageTypes.participantCommand,value:r})}getMessageCommand(r){return i.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),i.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),i.Contracts.throwIfNullOrWhitespace(r,"message"),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:r,type:e.ConversationTranslatorMessageTypes.instantMessage})}}return ge.MeetingImpl=a,ge}var or={},Ha;function zv(){if(Ha)return or;Ha=1,Object.defineProperty(or,"__esModule",{value:!0}),or.MeetingTranscriptionCanceledEventArgs=void 0;const e=Ri();class t extends e.CancellationEventArgsBase{}return or.MeetingTranscriptionCanceledEventArgs=t,or}var ar={},Ka;function jv(){if(Ka)return ar;Ka=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.MeetingTranscriber=void 0;const e=A(),t=I(),i=b(),u=P(),n=is();let a=class{constructor(r){this.privAudioConfig=r,this.privProperties=new u.PropertyCollection,this.privRecognizer=void 0,this.privDisposedRecognizer=!1}get speechRecognitionLanguage(){return i.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(u.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get internalData(){return this.privRecognizer.internalData}get connection(){return u.Connection.fromRecognizer(this.privRecognizer)}get authorizationToken(){return this.properties.getProperty(u.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(r){i.Contracts.throwIfNullOrWhitespace(r,"token"),this.properties.setProperty(u.PropertyId.SpeechServiceAuthorization_Token,r)}joinMeetingAsync(r,o,c){const p=r;i.Contracts.throwIfNullOrUndefined(n.MeetingImpl,"Meeting"),this.privRecognizer=new e.TranscriberRecognizer(r.config,this.privAudioConfig),i.Contracts.throwIfNullOrUndefined(this.privRecognizer,"Recognizer"),this.privRecognizer.connectMeetingCallbacks(this),(0,t.marshalPromiseToCallbacks)(p.connectTranscriberRecognizer(this.privRecognizer),o,c)}startTranscribingAsync(r,o){this.privRecognizer.startContinuousRecognitionAsync(r,o)}stopTranscribingAsync(r,o){this.privRecognizer.stopContinuousRecognitionAsync(r,o)}leaveMeetingAsync(r,o){this.privRecognizer.disconnectCallbacks(),(0,t.marshalPromiseToCallbacks)((async()=>{})(),r,o)}close(r,o){i.Contracts.throwIfDisposed(this.privDisposedRecognizer),(0,t.marshalPromiseToCallbacks)(this.dispose(!0),r,o)}async dispose(r){this.privDisposedRecognizer||(this.privRecognizer&&(await this.privRecognizer.close(),this.privRecognizer=void 0),r&&(this.privDisposedRecognizer=!0))}};return ar.MeetingTranscriber=a,ar}var cr={},Va;function Lv(){if(Va)return cr;Va=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.ConversationTranscriptionResult=void 0;const e=P();let t=class extends e.RecognitionResult{constructor(u,n,a,s,r,o,c,p,h,v,d){super(u,n,a,s,r,o,c,h,v,d),this.privSpeakerId=p}get speakerId(){return this.privSpeakerId}};return cr.ConversationTranscriptionResult=t,cr}var Ja;function is(){return Ja||(Ja=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConversationTranscriptionResult=e.MeetingTranscriber=e.MeetingTranscriptionCanceledEventArgs=e.MeetingImpl=e.Meeting=e.ParticipantChangedReason=e.User=e.Participant=e.ConversationTranscriber=e.ConversationTranslator=e.ConversationTranslationResult=e.ConversationTranslationEventArgs=e.ConversationTranslationCanceledEventArgs=e.ConversationParticipantsChangedEventArgs=e.ConversationExpirationEventArgs=e.ConversationCommon=e.ConversationImpl=e.Conversation=void 0;var t=Ep();Object.defineProperty(e,"Conversation",{enumerable:!0,get:function(){return t.Conversation}}),Object.defineProperty(e,"ConversationImpl",{enumerable:!0,get:function(){return t.ConversationImpl}});var i=Ev();Object.defineProperty(e,"ConversationCommon",{enumerable:!0,get:function(){return i.ConversationCommon}});var u=Tv();Object.defineProperty(e,"ConversationExpirationEventArgs",{enumerable:!0,get:function(){return u.ConversationExpirationEventArgs}});var n=Av();Object.defineProperty(e,"ConversationParticipantsChangedEventArgs",{enumerable:!0,get:function(){return n.ConversationParticipantsChangedEventArgs}});var a=Iv();Object.defineProperty(e,"ConversationTranslationCanceledEventArgs",{enumerable:!0,get:function(){return a.ConversationTranslationCanceledEventArgs}});var s=wv();Object.defineProperty(e,"ConversationTranslationEventArgs",{enumerable:!0,get:function(){return s.ConversationTranslationEventArgs}});var r=_v();Object.defineProperty(e,"ConversationTranslationResult",{enumerable:!0,get:function(){return r.ConversationTranslationResult}});var o=Mv();Object.defineProperty(e,"ConversationTranslator",{enumerable:!0,get:function(){return o.ConversationTranslator}});var c=Ov();Object.defineProperty(e,"ConversationTranscriber",{enumerable:!0,get:function(){return c.ConversationTranscriber}});var p=Dv();Object.defineProperty(e,"Participant",{enumerable:!0,get:function(){return p.Participant}}),Object.defineProperty(e,"User",{enumerable:!0,get:function(){return p.User}});var h=kv();Object.defineProperty(e,"ParticipantChangedReason",{enumerable:!0,get:function(){return h.ParticipantChangedReason}});var v=Nv();Object.defineProperty(e,"Meeting",{enumerable:!0,get:function(){return v.Meeting}}),Object.defineProperty(e,"MeetingImpl",{enumerable:!0,get:function(){return v.MeetingImpl}});var d=zv();Object.defineProperty(e,"MeetingTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return d.MeetingTranscriptionCanceledEventArgs}});var f=jv();Object.defineProperty(e,"MeetingTranscriber",{enumerable:!0,get:function(){return f.MeetingTranscriber}});var g=Lv();Object.defineProperty(e,"ConversationTranscriptionResult",{enumerable:!0,get:function(){return g.ConversationTranscriptionResult}})})(hn)),hn}var me={},Ga;function ns(){if(Ga)return me;Ga=1,Object.defineProperty(me,"__esModule",{value:!0}),me.SynthesisRequest=me.Synthesizer=void 0;const e=A(),t=I(),i=b(),u=P();let n=class wp{constructor(r){const o=r;i.Contracts.throwIfNull(o,"speechConfig"),this.privProperties=o.properties.clone(),this.privDisposed=!1,this.privSynthesizing=!1,this.synthesisRequestQueue=new t.Queue,this.tokenCredential=r.tokenCredential}get authorizationToken(){return this.properties.getProperty(u.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(r){i.Contracts.throwIfNullOrWhitespace(r,"token"),this.properties.setProperty(u.PropertyId.SpeechServiceAuthorization_Token,r)}get properties(){return this.privProperties}get autoDetectSourceLanguage(){return this.properties.getProperty(u.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)===e.AutoDetectSourceLanguagesOpenRangeOptionName}buildSsml(r){const o={"af-ZA":"af-ZA-AdriNeural","am-ET":"am-ET-AmehaNeural","ar-AE":"ar-AE-FatimaNeural","ar-BH":"ar-BH-AliNeural","ar-DZ":"ar-DZ-AminaNeural","ar-EG":"ar-EG-SalmaNeural","ar-IQ":"ar-IQ-BasselNeural","ar-JO":"ar-JO-SanaNeural","ar-KW":"ar-KW-FahedNeural","ar-LY":"ar-LY-ImanNeural","ar-MA":"ar-MA-JamalNeural","ar-QA":"ar-QA-AmalNeural","ar-SA":"ar-SA-HamedNeural","ar-SY":"ar-SY-AmanyNeural","ar-TN":"ar-TN-HediNeural","ar-YE":"ar-YE-MaryamNeural","bg-BG":"bg-BG-BorislavNeural","bn-BD":"bn-BD-NabanitaNeural","bn-IN":"bn-IN-BashkarNeural","ca-ES":"ca-ES-JoanaNeural","cs-CZ":"cs-CZ-AntoninNeural","cy-GB":"cy-GB-AledNeural","da-DK":"da-DK-ChristelNeural","de-AT":"de-AT-IngridNeural","de-CH":"de-CH-JanNeural","de-DE":"de-DE-KatjaNeural","el-GR":"el-GR-AthinaNeural","en-AU":"en-AU-NatashaNeural","en-CA":"en-CA-ClaraNeural","en-GB":"en-GB-LibbyNeural","en-HK":"en-HK-SamNeural","en-IE":"en-IE-ConnorNeural","en-IN":"en-IN-NeerjaNeural","en-KE":"en-KE-AsiliaNeural","en-NG":"en-NG-AbeoNeural","en-NZ":"en-NZ-MitchellNeural","en-PH":"en-PH-JamesNeural","en-SG":"en-SG-LunaNeural","en-TZ":"en-TZ-ElimuNeural","en-US":"en-US-AvaMultilingualNeural","en-ZA":"en-ZA-LeahNeural","es-AR":"es-AR-ElenaNeural","es-BO":"es-BO-MarceloNeural","es-CL":"es-CL-CatalinaNeural","es-CO":"es-CO-GonzaloNeural","es-CR":"es-CR-JuanNeural","es-CU":"es-CU-BelkysNeural","es-DO":"es-DO-EmilioNeural","es-EC":"es-EC-AndreaNeural","es-ES":"es-ES-AlvaroNeural","es-GQ":"es-GQ-JavierNeural","es-GT":"es-GT-AndresNeural","es-HN":"es-HN-CarlosNeural","es-MX":"es-MX-DaliaNeural","es-NI":"es-NI-FedericoNeural","es-PA":"es-PA-MargaritaNeural","es-PE":"es-PE-AlexNeural","es-PR":"es-PR-KarinaNeural","es-PY":"es-PY-MarioNeural","es-SV":"es-SV-LorenaNeural","es-US":"es-US-AlonsoNeural","es-UY":"es-UY-MateoNeural","es-VE":"es-VE-PaolaNeural","et-EE":"et-EE-AnuNeural","fa-IR":"fa-IR-DilaraNeural","fi-FI":"fi-FI-SelmaNeural","fil-PH":"fil-PH-AngeloNeural","fr-BE":"fr-BE-CharlineNeural","fr-CA":"fr-CA-SylvieNeural","fr-CH":"fr-CH-ArianeNeural","fr-FR":"fr-FR-DeniseNeural","ga-IE":"ga-IE-ColmNeural","gl-ES":"gl-ES-RoiNeural","gu-IN":"gu-IN-DhwaniNeural","he-IL":"he-IL-AvriNeural","hi-IN":"hi-IN-MadhurNeural","hr-HR":"hr-HR-GabrijelaNeural","hu-HU":"hu-HU-NoemiNeural","id-ID":"id-ID-ArdiNeural","is-IS":"is-IS-GudrunNeural","it-IT":"it-IT-IsabellaNeural","ja-JP":"ja-JP-NanamiNeural","jv-ID":"jv-ID-DimasNeural","kk-KZ":"kk-KZ-AigulNeural","km-KH":"km-KH-PisethNeural","kn-IN":"kn-IN-GaganNeural","ko-KR":"ko-KR-SunHiNeural","lo-LA":"lo-LA-ChanthavongNeural","lt-LT":"lt-LT-LeonasNeural","lv-LV":"lv-LV-EveritaNeural","mk-MK":"mk-MK-AleksandarNeural","ml-IN":"ml-IN-MidhunNeural","mr-IN":"mr-IN-AarohiNeural","ms-MY":"ms-MY-OsmanNeural","mt-MT":"mt-MT-GraceNeural","my-MM":"my-MM-NilarNeural","nb-NO":"nb-NO-PernilleNeural","nl-BE":"nl-BE-ArnaudNeural","nl-NL":"nl-NL-ColetteNeural","pl-PL":"pl-PL-AgnieszkaNeural","ps-AF":"ps-AF-GulNawazNeural","pt-BR":"pt-BR-FranciscaNeural","pt-PT":"pt-PT-DuarteNeural","ro-RO":"ro-RO-AlinaNeural","ru-RU":"ru-RU-SvetlanaNeural","si-LK":"si-LK-SameeraNeural","sk-SK":"sk-SK-LukasNeural","sl-SI":"sl-SI-PetraNeural","so-SO":"so-SO-MuuseNeural","sr-RS":"sr-RS-NicholasNeural","su-ID":"su-ID-JajangNeural","sv-SE":"sv-SE-SofieNeural","sw-KE":"sw-KE-RafikiNeural","sw-TZ":"sw-TZ-DaudiNeural","ta-IN":"ta-IN-PallaviNeural","ta-LK":"ta-LK-KumarNeural","ta-SG":"ta-SG-AnbuNeural","te-IN":"te-IN-MohanNeural","th-TH":"th-TH-PremwadeeNeural","tr-TR":"tr-TR-AhmetNeural","uk-UA":"uk-UA-OstapNeural","ur-IN":"ur-IN-GulNeural","ur-PK":"ur-PK-AsadNeural","uz-UZ":"uz-UZ-MadinaNeural","vi-VN":"vi-VN-HoaiMyNeural","zh-CN":"zh-CN-XiaoxiaoNeural","zh-HK":"zh-HK-HiuMaanNeural","zh-TW":"zh-TW-HsiaoChenNeural","zu-ZA":"zu-ZA-ThandoNeural"};let c=this.properties.getProperty(u.PropertyId.SpeechServiceConnection_SynthLanguage,"en-US"),p=this.properties.getProperty(u.PropertyId.SpeechServiceConnection_SynthVoice,""),h=wp.XMLEncode(r);return this.autoDetectSourceLanguage?c="en-US":p=p||o[c],p&&(h=`<voice name='${p}'>${h}</voice>`),h=`<speak version='1.0' xmlns='http://www.w3.org/2001/10/synthesis' xmlns:mstts='http://www.w3.org/2001/mstts' xmlns:emo='http://www.w3.org/2009/10/emotionml' xml:lang='${c}'>${h}</speak>`,h}async dispose(r){this.privDisposed||(r&&this.privAdapter&&await this.privAdapter.dispose(),this.privDisposed=!0)}async adapterSpeak(){if(!this.privDisposed&&!this.privSynthesizing){this.privSynthesizing=!0;const r=await this.synthesisRequestQueue.dequeue();return this.privAdapter.Speak(r.text,r.isSSML,r.requestId,r.cb,r.err,r.dataStream)}}createSynthesizerConfig(r){return new e.SynthesizerConfig(r,this.privProperties)}implCommonSynthesizeSetup(){let r=typeof window<"u"?"Browser":"Node",o="unknown",c="unknown";typeof navigator<"u"&&(r=r+"/"+navigator.platform,o=navigator.userAgent,c=navigator.appVersion);const p=this.createSynthesizerConfig(new e.SpeechServiceConfig(new e.Context(new e.OS(r,o,c)))),h=this.privProperties.getProperty(u.PropertyId.SpeechServiceConnection_Key,void 0),v=h&&h!==""?new e.CognitiveSubscriptionKeyAuthentication(h):this.tokenCredential?new e.CognitiveTokenAuthentication(async()=>{try{const d=await this.tokenCredential.getToken("https://cognitiveservices.azure.com/.default");return(d==null?void 0:d.token)??""}catch(d){throw d}},async()=>{try{const d=await this.tokenCredential.getToken("https://cognitiveservices.azure.com/.default");return(d==null?void 0:d.token)??""}catch(d){throw d}}):new e.CognitiveTokenAuthentication(()=>{const d=this.privProperties.getProperty(u.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(d)},()=>{const d=this.privProperties.getProperty(u.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(d)});this.privAdapter=this.createSynthesisAdapter(v,this.privConnectionFactory,p),this.privRestAdapter=this.createRestSynthesisAdapter(v,p)}static XMLEncode(r){return r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}};me.Synthesizer=n;class a{constructor(r,o,c,p,h,v){this.requestId=r,this.text=o,this.isSSML=c,this.cb=p,this.err=h,this.dataStream=v}}return me.SynthesisRequest=a,me}var ur={},Qa;function qv(){if(Qa)return ur;Qa=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.SpeechSynthesizer=void 0;const e=A(),t=I(),i=np(),u=yi(),n=_e(),a=b(),s=P(),r=ns();let o=class _p extends s.Synthesizer{constructor(p,h){super(p),h!==null&&(h===void 0?this.audioConfig=typeof window>"u"?void 0:s.AudioConfig.fromDefaultSpeakerOutput():this.audioConfig=h),this.privConnectionFactory=new e.SpeechSynthesisConnectionFactory,this.implCommonSynthesizeSetup()}static FromConfig(p,h,v){const d=p;return h.properties.mergeTo(d.properties),new _p(p,v)}speakTextAsync(p,h,v,d){this.speakImpl(p,!1,h,v,d)}speakSsmlAsync(p,h,v,d){this.speakImpl(p,!0,h,v,d)}async getVoicesAsync(p=""){return this.getVoices(p)}close(p,h){a.Contracts.throwIfDisposed(this.privDisposed),(0,t.marshalPromiseToCallbacks)(this.dispose(!0),p,h)}get internalData(){return this.privAdapter}createSynthesisAdapter(p,h,v){return new e.SpeechSynthesisAdapter(p,h,v,this,this.audioConfig)}createRestSynthesisAdapter(p,h){return new e.SynthesisRestAdapter(h,p)}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=u.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(s.SpeechSynthesisOutputFormat[this.properties.getProperty(s.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)])}speakImpl(p,h,v,d,f){try{a.Contracts.throwIfDisposed(this.privDisposed);const g=(0,t.createNoDashGuid)();let m;f instanceof s.PushAudioOutputStreamCallback?m=new n.PushAudioOutputStreamImpl(f):f instanceof s.PullAudioOutputStream?m=f:f!==void 0?m=new i.AudioFileWriter(f):m=void 0,this.synthesisRequestQueue.enqueue(new r.SynthesisRequest(g,p,h,l=>{if(this.privSynthesizing=!1,v)try{v(l)}catch(S){d&&d(S)}v=void 0,this.adapterSpeak().catch(()=>{})},l=>{d&&d(l)},m)),this.adapterSpeak().catch(()=>{})}catch(g){if(d)if(g instanceof Error){const m=g;d(m.name+": "+m.message)}else d(g);this.dispose(!0).catch(()=>{})}}async getVoices(p){const h=(0,t.createNoDashGuid)(),v=await this.privRestAdapter.getVoicesList(h);if(v.ok&&Array.isArray(v.json)){let d=v.json;return p&&p.length>0&&(d=d.filter(f=>!!f.Locale&&f.Locale.toLowerCase()===p.toLowerCase())),new s.SynthesisVoicesResult(h,d,void 0)}else return new s.SynthesisVoicesResult(h,void 0,`Error: ${v.status}: ${v.statusText}`)}};return ur.SpeechSynthesizer=o,ur}var pr={},Xa;function Bv(){if(Xa)return pr;Xa=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.SynthesisResult=void 0;let e=class{constructor(i,u,n,a){this.privResultId=i,this.privReason=u,this.privErrorDetails=n,this.privProperties=a}get resultId(){return this.privResultId}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get properties(){return this.privProperties}};return pr.SynthesisResult=e,pr}var hr={},Za;function Fv(){if(Za)return hr;Za=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.SpeechSynthesisResult=void 0;const e=P();let t=class extends e.SynthesisResult{constructor(u,n,a,s,r,o){super(u,n,s,r),this.privAudioData=a,this.privAudioDuration=o}get audioData(){return this.privAudioData}get audioDuration(){return this.privAudioDuration}};return hr.SpeechSynthesisResult=t,hr}var dr={},Ya;function Uv(){if(Ya)return dr;Ya=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.SpeechSynthesisEventArgs=void 0;let e=class{constructor(i){this.privResult=i}get result(){return this.privResult}};return dr.SpeechSynthesisEventArgs=e,dr}var vr={},$a;function xv(){if($a)return vr;$a=1,Object.defineProperty(vr,"__esModule",{value:!0}),vr.SpeechSynthesisWordBoundaryEventArgs=void 0;let e=class{constructor(i,u,n,a,s,r){this.privAudioOffset=i,this.privDuration=u,this.privText=n,this.privWordLength=a,this.privTextOffset=s,this.privBoundaryType=r}get audioOffset(){return this.privAudioOffset}get duration(){return this.privDuration}get text(){return this.privText}get wordLength(){return this.privWordLength}get textOffset(){return this.privTextOffset}get boundaryType(){return this.privBoundaryType}};return vr.SpeechSynthesisWordBoundaryEventArgs=e,vr}var lr={},ec;function Wv(){if(ec)return lr;ec=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.SpeechSynthesisBookmarkEventArgs=void 0;let e=class{constructor(i,u){this.privAudioOffset=i,this.privText=u}get audioOffset(){return this.privAudioOffset}get text(){return this.privText}};return lr.SpeechSynthesisBookmarkEventArgs=e,lr}var fr={},tc;function Hv(){if(tc)return fr;tc=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.SpeechSynthesisVisemeEventArgs=void 0;let e=class{constructor(i,u,n){this.privAudioOffset=i,this.privVisemeId=u,this.privAnimation=n}get audioOffset(){return this.privAudioOffset}get visemeId(){return this.privVisemeId}get animation(){return this.privAnimation}};return fr.SpeechSynthesisVisemeEventArgs=e,fr}var ln={},rc;function Kv(){return rc||(rc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpeechSynthesisBoundaryType=void 0,(function(t){t.Word="WordBoundary",t.Punctuation="PunctuationBoundary",t.Sentence="SentenceBoundary"})(e.SpeechSynthesisBoundaryType||(e.SpeechSynthesisBoundaryType={}))})(ln)),ln}var gr={},ic;function Vv(){if(ic)return gr;ic=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.SynthesisVoicesResult=void 0;const e=P();let t=class extends e.SynthesisResult{constructor(u,n,a){if(Array.isArray(n)){super(u,e.ResultReason.VoicesListRetrieved,void 0,new e.PropertyCollection),this.privVoices=[];for(const s of n)this.privVoices.push(new e.VoiceInfo(s))}else super(u,e.ResultReason.Canceled,a||"Error information unavailable",new e.PropertyCollection)}get voices(){return this.privVoices}};return gr.SynthesisVoicesResult=t,gr}var fn={},nc;function Jv(){return nc||(nc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.VoiceInfo=e.SynthesisVoiceType=e.SynthesisVoiceGender=void 0;var t;(function(s){s[s.Unknown=0]="Unknown",s[s.Female=1]="Female",s[s.Male=2]="Male",s[s.Neutral=3]="Neutral"})(t=e.SynthesisVoiceGender||(e.SynthesisVoiceGender={}));var i;(function(s){s[s.Unknown=0]="Unknown",s[s.OnlineNeural=1]="OnlineNeural",s[s.OnlineStandard=2]="OnlineStandard",s[s.OfflineNeural=3]="OfflineNeural",s[s.OfflineStandard=4]="OfflineStandard",s[s.OnlineNeuralHD=5]="OnlineNeuralHD"})(i=e.SynthesisVoiceType||(e.SynthesisVoiceType={}));const u={[t[t.Neutral]]:t.Neutral,[t[t.Male]]:t.Male,[t[t.Female]]:t.Female},n={Neural:i.OnlineNeural,NeuralHD:i.OnlineNeuralHD};class a{constructor(r){if(this.privStyleList=[],r){if(this.privName=r.Name,this.privLocale=r.Locale,this.privShortName=r.ShortName,this.privLocaleName=r.LocaleName,this.privDisplayName=r.DisplayName,this.privLocalName=r.LocalName,this.privVoiceType=n[r.VoiceType]||i.Unknown,this.privGender=u[r.Gender]||t.Unknown,r.StyleList&&Array.isArray(r.StyleList))for(const o of r.StyleList)this.privStyleList.push(o);this.privSampleRateHertz=r.SampleRateHertz,this.privStatus=r.Status,r.ExtendedPropertyMap&&(this.privExtendedPropertyMap=r.ExtendedPropertyMap),this.privWordsPerMinute=r.WordsPerMinute,Array.isArray(r.SecondaryLocaleList)&&(this.privSecondaryLocaleList=[...r.SecondaryLocaleList]),Array.isArray(r.RolePlayList)&&(this.privRolePlayList=[...r.RolePlayList]),r.VoiceTag&&(this.privVoiceTag=r.VoiceTag)}}get name(){return this.privName}get locale(){return this.privLocale}get shortName(){return this.privShortName}get displayName(){return this.privDisplayName}get localName(){return this.privLocalName}get localeName(){return this.privLocaleName}get gender(){return this.privGender}get voiceType(){return this.privVoiceType}get styleList(){return this.privStyleList}get sampleRateHertz(){return this.privSampleRateHertz}get status(){return this.privStatus}get extendedPropertyMap(){return this.privExtendedPropertyMap}get wordsPerMinute(){return this.privWordsPerMinute}get secondaryLocaleList(){return this.privSecondaryLocaleList}get rolePlayList(){return this.privRolePlayList}get voiceTag(){return this.privVoiceTag}}e.VoiceInfo=a})(fn)),fn}var mr={},sc;function Gv(){if(sc)return mr;sc=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.SpeakerAudioDestination=void 0;const e=I(),t=_e(),i=Ae(),u=1800,n={[i.AudioFormatTag.PCM]:"audio/wav",[i.AudioFormatTag.MuLaw]:"audio/x-wav",[i.AudioFormatTag.MP3]:"audio/mpeg",[i.AudioFormatTag.OGG_OPUS]:"audio/ogg",[i.AudioFormatTag.WEBM_OPUS]:"audio/webm; codecs=opus",[i.AudioFormatTag.ALaw]:"audio/x-wav",[i.AudioFormatTag.FLAC]:"audio/flac",[i.AudioFormatTag.AMR_WB]:"audio/amr-wb",[i.AudioFormatTag.G722]:"audio/G722"};let a=class{constructor(r){this.privPlaybackStarted=!1,this.privAppendingToBuffer=!1,this.privMediaSourceOpened=!1,this.privBytesReceived=0,this.privId=r||(0,e.createNoDashGuid)(),this.privIsPaused=!1,this.privIsClosed=!1}id(){return this.privId}write(r,o,c){this.privAudioBuffer!==void 0?(this.privAudioBuffer.push(r),this.updateSourceBuffer().then(()=>{o&&o()},p=>{c&&c(p)})):this.privAudioOutputStream!==void 0&&(this.privAudioOutputStream.write(r),this.privBytesReceived+=r.byteLength)}close(r,o){if(this.privIsClosed=!0,this.privSourceBuffer!==void 0)this.handleSourceBufferUpdateEnd().then(()=>{r&&r()},c=>{o&&o(c)});else if(this.privAudioOutputStream!==void 0&&typeof window<"u")if((this.privFormat.formatTag===i.AudioFormatTag.PCM||this.privFormat.formatTag===i.AudioFormatTag.MuLaw||this.privFormat.formatTag===i.AudioFormatTag.ALaw)&&this.privFormat.hasHeader===!1)console.warn("Play back is not supported for raw PCM, mulaw or alaw format without header."),this.onAudioEnd&&this.onAudioEnd(this);else{let c=new ArrayBuffer(this.privBytesReceived);this.privAudioOutputStream.read(c).then(()=>{c=this.privFormat.addHeader(c);const p=new Blob([c],{type:n[this.privFormat.formatTag]});this.privAudio.src=window.URL.createObjectURL(p),this.notifyPlayback().then(()=>{r&&r()},h=>{o&&o(h)})},p=>{o&&o(p)})}else this.onAudioEnd&&this.onAudioEnd(this)}set format(r){if(typeof AudioContext<"u"||typeof window<"u"&&typeof window.webkitAudioContext<"u"){this.privFormat=r;const o=n[this.privFormat.formatTag];o===void 0?console.warn(`Unknown mimeType for format ${i.AudioFormatTag[this.privFormat.formatTag]}; playback is not supported.`):typeof MediaSource<"u"&&MediaSource.isTypeSupported(o)?(this.privAudio=new Audio,this.privAudioBuffer=[],this.privMediaSource=new MediaSource,this.privAudio.src=URL.createObjectURL(this.privMediaSource),this.privAudio.load(),this.privMediaSource.onsourceopen=()=>{this.privMediaSourceOpened=!0,this.privMediaSource.duration=u,this.privSourceBuffer=this.privMediaSource.addSourceBuffer(o),this.privSourceBuffer.onupdate=()=>{this.updateSourceBuffer().catch(c=>{e.Events.instance.onEvent(new e.BackgroundEvent(c))})},this.privSourceBuffer.onupdateend=()=>{this.handleSourceBufferUpdateEnd().catch(c=>{e.Events.instance.onEvent(new e.BackgroundEvent(c))})},this.privSourceBuffer.onupdatestart=()=>{this.privAppendingToBuffer=!1}},this.updateSourceBuffer().catch(c=>{e.Events.instance.onEvent(new e.BackgroundEvent(c))})):(console.warn(`Format ${i.AudioFormatTag[this.privFormat.formatTag]} could not be played by MSE, streaming playback is not enabled.`),this.privAudioOutputStream=new t.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privFormat,this.privAudio=new Audio)}}get volume(){var r;return((r=this.privAudio)==null?void 0:r.volume)??-1}set volume(r){this.privAudio&&(this.privAudio.volume=r)}mute(){this.privAudio&&(this.privAudio.muted=!0)}unmute(){this.privAudio&&(this.privAudio.muted=!1)}get isClosed(){return this.privIsClosed}get currentTime(){return this.privAudio!==void 0?this.privAudio.currentTime:-1}pause(){!this.privIsPaused&&this.privAudio!==void 0&&(this.privAudio.pause(),this.privIsPaused=!0)}resume(r,o){this.privIsPaused&&this.privAudio!==void 0&&(this.privAudio.play().then(()=>{r&&r()},c=>{o&&o(c)}),this.privIsPaused=!1)}get internalAudio(){return this.privAudio}async updateSourceBuffer(){if(this.privAudioBuffer!==void 0&&this.privAudioBuffer.length>0&&this.sourceBufferAvailable()){this.privAppendingToBuffer=!0;const r=this.privAudioBuffer.shift();try{this.privSourceBuffer.appendBuffer(r)}catch{this.privAudioBuffer.unshift(r),console.log("buffer filled, pausing addition of binaries until space is made");return}await this.notifyPlayback()}else this.canEndStream()&&await this.handleSourceBufferUpdateEnd()}async handleSourceBufferUpdateEnd(){this.canEndStream()&&this.sourceBufferAvailable()&&(this.privMediaSource.endOfStream(),await this.notifyPlayback())}async notifyPlayback(){!this.privPlaybackStarted&&this.privAudio!==void 0&&(this.privPlaybackStarted=!0,this.onAudioStart&&this.onAudioStart(this),this.privAudio.onended=()=>{this.onAudioEnd&&this.onAudioEnd(this)},this.privIsPaused||await this.privAudio.play())}canEndStream(){return this.isClosed&&this.privSourceBuffer!==void 0&&this.privAudioBuffer.length===0&&this.privMediaSourceOpened&&!this.privAppendingToBuffer&&this.privMediaSource.readyState==="open"}sourceBufferAvailable(){return this.privSourceBuffer!==void 0&&!this.privSourceBuffer.updating}};return mr.SpeakerAudioDestination=a,mr}var Sr={},oc;function Qv(){if(oc)return Sr;oc=1,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.ConversationTranscriptionCanceledEventArgs=void 0;const e=Ri();let t=class extends e.CancellationEventArgsBase{};return Sr.ConversationTranscriptionCanceledEventArgs=t,Sr}var Cr={},ac;function Xv(){if(ac)return Cr;ac=1,Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.MeetingTranscriptionCanceledEventArgs=void 0;const e=Ri();let t=class extends e.CancellationEventArgsBase{};return Cr.MeetingTranscriptionCanceledEventArgs=t,Cr}var gn={},cc;function Zv(){return cc||(cc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PronunciationAssessmentGradingSystem=void 0,(function(t){t[t.FivePoint=1]="FivePoint",t[t.HundredMark=2]="HundredMark"})(e.PronunciationAssessmentGradingSystem||(e.PronunciationAssessmentGradingSystem={}))})(gn)),gn}var mn={},uc;function Yv(){return uc||(uc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PronunciationAssessmentGranularity=void 0,(function(t){t[t.Phoneme=1]="Phoneme",t[t.Word=2]="Word",t[t.FullText=3]="FullText"})(e.PronunciationAssessmentGranularity||(e.PronunciationAssessmentGranularity={}))})(mn)),mn}var yr={},pc;function $v(){if(pc)return yr;pc=1,Object.defineProperty(yr,"__esModule",{value:!0}),yr.PronunciationAssessmentConfig=void 0;const e=b(),t=P();let i=class bp{constructor(n,a=t.PronunciationAssessmentGradingSystem.FivePoint,s=t.PronunciationAssessmentGranularity.Phoneme,r=!1){e.Contracts.throwIfNullOrUndefined(n,"referenceText"),this.privProperties=new t.PropertyCollection,this.privProperties.setProperty(t.PropertyId.PronunciationAssessment_ReferenceText,n),this.privProperties.setProperty(t.PropertyId.PronunciationAssessment_GradingSystem,t.PronunciationAssessmentGradingSystem[a]),this.privProperties.setProperty(t.PropertyId.PronunciationAssessment_Granularity,t.PronunciationAssessmentGranularity[s]),this.privProperties.setProperty(t.PropertyId.PronunciationAssessment_EnableMiscue,String(r))}static fromJSON(n){e.Contracts.throwIfNullOrUndefined(n,"json");const a=new bp("");return a.privProperties=new t.PropertyCollection,a.properties.setProperty(t.PropertyId.PronunciationAssessment_Json,n),a}toJSON(){return this.updateJson(),this.privProperties.getProperty(t.PropertyId.PronunciationAssessment_Params)}applyTo(n){this.updateJson();const a=n.internalData;a.speechContext.setPronunciationAssessmentParams(this.properties.getProperty(t.PropertyId.PronunciationAssessment_Params),a.isSpeakerDiarizationEnabled)}get referenceText(){return this.properties.getProperty(t.PropertyId.PronunciationAssessment_ReferenceText)}set referenceText(n){e.Contracts.throwIfNullOrWhitespace(n,"referenceText"),this.properties.setProperty(t.PropertyId.PronunciationAssessment_ReferenceText,n)}set phonemeAlphabet(n){e.Contracts.throwIfNullOrWhitespace(n,"phonemeAlphabet"),this.privPhonemeAlphabet=n}set enableMiscue(n){const a=n?"true":"false";this.properties.setProperty(t.PropertyId.PronunciationAssessment_EnableMiscue,a)}get enableMiscue(){return this.properties.getProperty(t.PropertyId.PronunciationAssessment_EnableMiscue,"false").toLowerCase()==="true"}set nbestPhonemeCount(n){this.privNBestPhonemeCount=n}set enableProsodyAssessment(n){this.privEnableProsodyAssessment=n}get properties(){return this.privProperties}updateJson(){const n=this.privProperties.getProperty(t.PropertyId.PronunciationAssessment_Json,"{}"),a=JSON.parse(n),s=this.privProperties.getProperty(t.PropertyId.PronunciationAssessment_ReferenceText);s&&(a.referenceText=s);const r=this.privProperties.getProperty(t.PropertyId.PronunciationAssessment_GradingSystem);r&&(a.gradingSystem=r);const o=this.privProperties.getProperty(t.PropertyId.PronunciationAssessment_Granularity);o&&(a.granularity=o),this.privPhonemeAlphabet&&(a.phonemeAlphabet=this.privPhonemeAlphabet),this.privNBestPhonemeCount&&(a.nbestPhonemeCount=this.privNBestPhonemeCount),a.enableProsodyAssessment=this.privEnableProsodyAssessment,a.dimension="Comprehensive",this.privProperties.getProperty(t.PropertyId.PronunciationAssessment_EnableMiscue)&&(a.enableMiscue=this.enableMiscue),this.privProperties.setProperty(t.PropertyId.PronunciationAssessment_Params,JSON.stringify(a))}};return yr.PronunciationAssessmentConfig=i,yr}var Rr={},hc;function el(){if(hc)return Rr;hc=1,Object.defineProperty(Rr,"__esModule",{value:!0}),Rr.PronunciationAssessmentResult=void 0;const e=b(),t=P();let i=class Mp{constructor(n){const a=JSON.parse(n);e.Contracts.throwIfNullOrUndefined(a.NBest[0],"NBest"),this.privPronJson=a.NBest[0]}static fromResult(n){e.Contracts.throwIfNullOrUndefined(n,"result");const a=n.properties.getProperty(t.PropertyId.SpeechServiceResponse_JsonResult);return e.Contracts.throwIfNullOrUndefined(a,"json"),new Mp(a)}get detailResult(){return this.privPronJson}get accuracyScore(){var n;return(n=this.detailResult.PronunciationAssessment)==null?void 0:n.AccuracyScore}get pronunciationScore(){var n;return(n=this.detailResult.PronunciationAssessment)==null?void 0:n.PronScore}get completenessScore(){var n;return(n=this.detailResult.PronunciationAssessment)==null?void 0:n.CompletenessScore}get fluencyScore(){var n;return(n=this.detailResult.PronunciationAssessment)==null?void 0:n.FluencyScore}get prosodyScore(){var n;return(n=this.detailResult.PronunciationAssessment)==null?void 0:n.ProsodyScore}};return Rr.PronunciationAssessmentResult=i,Rr}var Pr={},dc;function tl(){if(dc)return Pr;dc=1,Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.AvatarConfig=void 0;const e=b(),t=P();let i=class{constructor(n,a,s){this.privCustomized=!1,this.privUseBuiltInVoice=!1,e.Contracts.throwIfNullOrWhitespace(n,"character"),this.character=n,this.style=a,s===void 0&&(s=new t.AvatarVideoFormat),this.videoFormat=s}get customized(){return this.privCustomized}set customized(n){this.privCustomized=n}get useBuiltInVoice(){return this.privUseBuiltInVoice}set useBuiltInVoice(n){this.privUseBuiltInVoice=n}get photoAvatarBaseModel(){return this.privPhotoAvatarBaseModel}set photoAvatarBaseModel(n){this.privPhotoAvatarBaseModel=n}get backgroundColor(){return this.privBackgroundColor}set backgroundColor(n){this.privBackgroundColor=n}get backgroundImage(){return this.privBackgroundImage}set backgroundImage(n){this.privBackgroundImage=n}get remoteIceServers(){return this.privRemoteIceServers}set remoteIceServers(n){this.privRemoteIceServers=n}};return Pr.AvatarConfig=i,Pr}var Sn={},vc;function rl(){return vc||(vc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AvatarEventArgs=e.AvatarEventTypes=void 0,(function(i){i.SwitchedToSpeaking="SwitchedToSpeaking",i.SwitchedToIdle="SwitchedToIdle",i.SessionClosed="SessionClosed"})(e.AvatarEventTypes||(e.AvatarEventTypes={}));class t{constructor(u,n){this.privOffset=u,this.privDescription=n}get type(){return this.privType}get offset(){return this.privOffset}get description(){return this.privDescription}}e.AvatarEventArgs=t})(Sn)),Sn}var Er={},Tr={},lc;function Op(){if(lc)return Tr;lc=1,Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.SpeechSynthesisConnectionFactory=void 0;const e=L(),t=P(),i=Y(),u=A(),n=U(),a=ie();let s=class{constructor(){this.synthesisUri="/tts/cognitiveservices/websocket/v1"}async create(o,c,p){let h=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Endpoint,void 0);const v=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Region,void 0),d=i.ConnectionFactoryBase.getHostSuffix(v),f=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_EndpointId,void 0),g=f===void 0?"tts":"voice",m=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Host,"wss://"+v+"."+g+".speech"+d),l={},S={};if(c.token!==void 0&&c.token!==""&&(S[c.headerName]=c.token),S[n.HeaderNames.ConnectionId]=p,f!==void 0&&f!==""&&(!h||h.search(a.QueryParameterNames.CustomVoiceDeploymentId)===-1)&&(l[a.QueryParameterNames.CustomVoiceDeploymentId]=f),o.avatarEnabled&&(!h||h.search(a.QueryParameterNames.EnableAvatar)===-1)&&(l[a.QueryParameterNames.EnableAvatar]="true"),h){const y=new URL(h),R=y.pathname;(R===""||R==="/")&&(y.pathname=this.synthesisUri,h=await i.ConnectionFactoryBase.getRedirectUrlFromEndpoint(y.toString()))}h||(h=m+this.synthesisUri),o.parameters.setProperty(t.PropertyId.SpeechServiceConnection_Url,h);const C=o.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new e.WebsocketConnection(h,l,S,new u.WebsocketMessageFormatter,e.ProxyInfo.fromParameters(o.parameters),C,p)}};return Tr.SpeechSynthesisConnectionFactory=s,Tr}var fc;function il(){if(fc)return Er;fc=1,Object.defineProperty(Er,"__esModule",{value:!0}),Er.AvatarSynthesizer=void 0;const e=Op(),t=A(),i=I(),u=yi(),n=P(),a=b(),s=ns();let r=class extends n.Synthesizer{constructor(c,p){super(c),a.Contracts.throwIfNullOrUndefined(p,"avatarConfig"),this.privConnectionFactory=new e.SpeechSynthesisConnectionFactory,this.privAvatarConfig=p,this.implCommonSynthesizeSetup()}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=u.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(n.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm)}async startAvatarAsync(c){a.Contracts.throwIfNullOrUndefined(c,"peerConnection"),this.privIceServers=c.getConfiguration().iceServers,a.Contracts.throwIfNullOrUndefined(this.privIceServers,"Ice servers must be set.");const p=new i.Deferred;c.onicegatheringstatechange=()=>{i.Events.instance.onEvent(new i.PlatformEvent("peer connection: ice gathering state: "+c.iceGatheringState,i.EventType.Debug)),c.iceGatheringState==="complete"&&(i.Events.instance.onEvent(new i.PlatformEvent("peer connection: ice gathering complete.",i.EventType.Info)),p.resolve())},c.onicecandidate=g=>{g.candidate?i.Events.instance.onEvent(new i.PlatformEvent("peer connection: ice candidate: "+g.candidate.candidate,i.EventType.Debug)):(i.Events.instance.onEvent(new i.PlatformEvent("peer connection: ice candidate: complete",i.EventType.Debug)),p.resolve())},setTimeout(()=>{c.iceGatheringState!=="complete"&&(i.Events.instance.onEvent(new i.PlatformEvent("peer connection: ice gathering timeout.",i.EventType.Warning)),p.resolve())},2e3);const h=await c.createOffer();await c.setLocalDescription(h),await p.promise,i.Events.instance.onEvent(new i.PlatformEvent("peer connection: got local SDP.",i.EventType.Info)),this.privProperties.setProperty(n.PropertyId.TalkingAvatarService_WebRTC_SDP,JSON.stringify(c.localDescription));const v=await this.speak("",!1);if(v.reason!==n.ResultReason.SynthesizingAudioCompleted)return new n.SynthesisResult(v.resultId,v.reason,v.errorDetails,v.properties);const d=atob(v.properties.getProperty(n.PropertyId.TalkingAvatarService_WebRTC_SDP)),f=new RTCSessionDescription(JSON.parse(d));return await c.setRemoteDescription(f),new n.SynthesisResult(v.resultId,v.reason,void 0,v.properties)}async speakTextAsync(c){const p=await this.speak(c,!1);return new n.SynthesisResult(p.resultId,p.reason,p.errorDetails,p.properties)}async speakSsmlAsync(c){const p=await this.speak(c,!0);return new n.SynthesisResult(p.resultId,p.reason,p.errorDetails,p.properties)}async stopSpeakingAsync(){for(;this.synthesisRequestQueue.length()>0;)(await this.synthesisRequestQueue.dequeue()).err("Synthesis is canceled by user.");return this.privAdapter.stopSpeaking()}async stopAvatarAsync(){return a.Contracts.throwIfDisposed(this.privDisposed),this.dispose(!0)}async close(){if(!this.privDisposed)return this.dispose(!0)}get iceServers(){return this.privIceServers}createSynthesisAdapter(c,p,h){return new t.AvatarSynthesisAdapter(c,p,h,this,this.privAvatarConfig)}createRestSynthesisAdapter(c,p){}createSynthesizerConfig(c){const p=super.createSynthesizerConfig(c);return p.avatarEnabled=!0,p}async speak(c,p){const h=(0,i.createNoDashGuid)(),v=new i.Deferred;return this.synthesisRequestQueue.enqueue(new s.SynthesisRequest(h,c,p,d=>{v.resolve(d),this.privSynthesizing=!1,this.adapterSpeak()},d=>{v.reject(d),this.privSynthesizing=!1})),this.adapterSpeak(),v.promise}};return Er.AvatarSynthesizer=r,Er}var Se={},gc;function nl(){if(gc)return Se;gc=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.AvatarVideoFormat=Se.Coordinate=void 0;class e{constructor(u,n){this.x=u,this.y=n}}Se.Coordinate=e;let t=class{constructor(u="H264",n=2e6,a=1920,s=1080){this.codec=u,this.bitrate=n,this.width=a,this.height=s}setCropRange(u,n){this.cropRange={bottomRight:n,topLeft:u}}};return Se.AvatarVideoFormat=t,Se}var Ar={},mc;function sl(){if(mc)return Ar;mc=1,Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.AvatarWebRTCConnectionResult=void 0;const e=P();let t=class extends e.SynthesisResult{constructor(u,n,a,s,r){super(n,a,s,r),this.privSDPAnswer=u}get SDPAnswer(){return this.privSDPAnswer}};return Ar.AvatarWebRTCConnectionResult=t,Ar}var Ir={},Sc;function ol(){if(Sc)return Ir;Sc=1,Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.Diagnostics=void 0;const e=L(),t=I();let i=class{static SetLoggingLevel(n){this.privListener=new e.ConsoleLoggingListener(n),t.Events.instance.attachConsoleListener(this.privListener)}static StartConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!0)}static StopConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!1)}static SetLogOutputPath(n){if(typeof window>"u")this.privListener&&(this.privListener.logPath=n);else throw new Error("File system logging not available in browser.")}static set onLogOutput(n){this.privListener&&(this.privListener.logCallback=n)}};return Ir.Diagnostics=i,i.privListener=void 0,Ir}var Cc;function P(){return Cc||(Cc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CustomCommandsConfig=e.BotFrameworkConfig=e.DialogServiceConfig=e.PhraseListGrammar=e.Connection=e.ServiceEventArgs=e.ConnectionEventArgs=e.CancellationErrorCode=e.CancellationDetails=e.CancellationDetailsBase=e.TranslationRecognitionCanceledEventArgs=e.NoMatchDetails=e.NoMatchReason=e.Translations=e.TranslationRecognizer=e.SpeechRecognizer=e.Recognizer=e.PropertyId=e.PropertyCollection=e.SpeechTranslationConfigImpl=e.SpeechTranslationConfig=e.SpeechConfigImpl=e.SpeechConfig=e.ResultReason=e.TranslationSynthesisResult=e.TranslationRecognitionResult=e.TranslationSynthesisEventArgs=e.TranslationRecognitionEventArgs=e.SpeechRecognitionCanceledEventArgs=e.MeetingTranscriptionEventArgs=e.ConversationTranscriptionEventArgs=e.SpeechRecognitionEventArgs=e.SpeechRecognitionResult=e.RecognitionResult=e.OutputFormat=e.RecognitionEventArgs=e.SessionEventArgs=e.KeywordRecognitionModel=e.PushAudioOutputStreamCallback=e.PullAudioInputStreamCallback=e.CancellationReason=e.PushAudioOutputStream=e.PullAudioOutputStream=e.AudioOutputStream=e.PushAudioInputStream=e.PullAudioInputStream=e.AudioInputStream=e.AudioFormatTag=e.AudioStreamFormat=e.AudioConfig=void 0,e.AvatarSynthesizer=e.AvatarEventArgs=e.AvatarConfig=e.LanguageIdMode=e.PronunciationAssessmentResult=e.PronunciationAssessmentConfig=e.PronunciationAssessmentGranularity=e.PronunciationAssessmentGradingSystem=e.MeetingTranscriptionCanceledEventArgs=e.ConversationTranscriptionCanceledEventArgs=e.SpeakerAudioDestination=e.VoiceInfo=e.SynthesisVoiceType=e.SynthesisVoiceGender=e.SynthesisVoicesResult=e.SpeechSynthesisBoundaryType=e.SpeechSynthesisVisemeEventArgs=e.SpeechSynthesisBookmarkEventArgs=e.SpeechSynthesisWordBoundaryEventArgs=e.SpeechSynthesisEventArgs=e.SpeechSynthesisResult=e.SynthesisResult=e.SpeechSynthesizer=e.SpeechSynthesisOutputFormat=e.Synthesizer=e.User=e.ParticipantChangedReason=e.Participant=e.MeetingTranscriber=e.Meeting=e.ConversationTranscriptionResult=e.ConversationTranscriber=e.ConversationTranslator=e.ConversationTranslationResult=e.ConversationTranslationEventArgs=e.ConversationTranslationCanceledEventArgs=e.ConversationParticipantsChangedEventArgs=e.ConversationExpirationEventArgs=e.Conversation=e.SourceLanguageConfig=e.AutoDetectSourceLanguageResult=e.AutoDetectSourceLanguageConfig=e.ConnectionMessage=e.ConnectionMessageEventArgs=e.BaseAudioPlayer=e.ProfanityOption=e.ServicePropertyChannel=e.TurnStatusReceivedEventArgs=e.ActivityReceivedEventArgs=e.DialogServiceConnector=void 0,e.LogLevel=e.Diagnostics=e.AvatarWebRTCConnectionResult=e.Coordinate=e.AvatarVideoFormat=void 0;var t=kd();Object.defineProperty(e,"AudioConfig",{enumerable:!0,get:function(){return t.AudioConfig}});var i=Ae();Object.defineProperty(e,"AudioStreamFormat",{enumerable:!0,get:function(){return i.AudioStreamFormat}}),Object.defineProperty(e,"AudioFormatTag",{enumerable:!0,get:function(){return i.AudioFormatTag}});var u=sp();Object.defineProperty(e,"AudioInputStream",{enumerable:!0,get:function(){return u.AudioInputStream}}),Object.defineProperty(e,"PullAudioInputStream",{enumerable:!0,get:function(){return u.PullAudioInputStream}}),Object.defineProperty(e,"PushAudioInputStream",{enumerable:!0,get:function(){return u.PushAudioInputStream}});var n=_e();Object.defineProperty(e,"AudioOutputStream",{enumerable:!0,get:function(){return n.AudioOutputStream}}),Object.defineProperty(e,"PullAudioOutputStream",{enumerable:!0,get:function(){return n.PullAudioOutputStream}}),Object.defineProperty(e,"PushAudioOutputStream",{enumerable:!0,get:function(){return n.PushAudioOutputStream}});var a=Nd();Object.defineProperty(e,"CancellationReason",{enumerable:!0,get:function(){return a.CancellationReason}});var s=zd();Object.defineProperty(e,"PullAudioInputStreamCallback",{enumerable:!0,get:function(){return s.PullAudioInputStreamCallback}});var r=jd();Object.defineProperty(e,"PushAudioOutputStreamCallback",{enumerable:!0,get:function(){return r.PushAudioOutputStreamCallback}});var o=Ld();Object.defineProperty(e,"KeywordRecognitionModel",{enumerable:!0,get:function(){return o.KeywordRecognitionModel}});var c=qd();Object.defineProperty(e,"SessionEventArgs",{enumerable:!0,get:function(){return c.SessionEventArgs}});var p=Bd();Object.defineProperty(e,"RecognitionEventArgs",{enumerable:!0,get:function(){return p.RecognitionEventArgs}});var h=Fd();Object.defineProperty(e,"OutputFormat",{enumerable:!0,get:function(){return h.OutputFormat}});var v=Ud();Object.defineProperty(e,"RecognitionResult",{enumerable:!0,get:function(){return v.RecognitionResult}});var d=xd();Object.defineProperty(e,"SpeechRecognitionResult",{enumerable:!0,get:function(){return d.SpeechRecognitionResult}});var f=Wd();Object.defineProperty(e,"SpeechRecognitionEventArgs",{enumerable:!0,get:function(){return f.SpeechRecognitionEventArgs}}),Object.defineProperty(e,"ConversationTranscriptionEventArgs",{enumerable:!0,get:function(){return f.ConversationTranscriptionEventArgs}}),Object.defineProperty(e,"MeetingTranscriptionEventArgs",{enumerable:!0,get:function(){return f.MeetingTranscriptionEventArgs}});var g=Hd();Object.defineProperty(e,"SpeechRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return g.SpeechRecognitionCanceledEventArgs}});var m=Kd();Object.defineProperty(e,"TranslationRecognitionEventArgs",{enumerable:!0,get:function(){return m.TranslationRecognitionEventArgs}});var l=Vd();Object.defineProperty(e,"TranslationSynthesisEventArgs",{enumerable:!0,get:function(){return l.TranslationSynthesisEventArgs}});var S=up();Object.defineProperty(e,"TranslationRecognitionResult",{enumerable:!0,get:function(){return S.TranslationRecognitionResult}});var C=Jd();Object.defineProperty(e,"TranslationSynthesisResult",{enumerable:!0,get:function(){return C.TranslationSynthesisResult}});var y=Gd();Object.defineProperty(e,"ResultReason",{enumerable:!0,get:function(){return y.ResultReason}});var R=Qd();Object.defineProperty(e,"SpeechConfig",{enumerable:!0,get:function(){return R.SpeechConfig}}),Object.defineProperty(e,"SpeechConfigImpl",{enumerable:!0,get:function(){return R.SpeechConfigImpl}});var T=Xd();Object.defineProperty(e,"SpeechTranslationConfig",{enumerable:!0,get:function(){return T.SpeechTranslationConfig}}),Object.defineProperty(e,"SpeechTranslationConfigImpl",{enumerable:!0,get:function(){return T.SpeechTranslationConfigImpl}});var w=hp();Object.defineProperty(e,"PropertyCollection",{enumerable:!0,get:function(){return w.PropertyCollection}});var E=ts();Object.defineProperty(e,"PropertyId",{enumerable:!0,get:function(){return E.PropertyId}});var M=Zd();Object.defineProperty(e,"Recognizer",{enumerable:!0,get:function(){return M.Recognizer}});var O=Yd();Object.defineProperty(e,"SpeechRecognizer",{enumerable:!0,get:function(){return O.SpeechRecognizer}});var x=$d();Object.defineProperty(e,"TranslationRecognizer",{enumerable:!0,get:function(){return x.TranslationRecognizer}});var Ie=ev();Object.defineProperty(e,"Translations",{enumerable:!0,get:function(){return Ie.Translations}});var N=tv();Object.defineProperty(e,"NoMatchReason",{enumerable:!0,get:function(){return N.NoMatchReason}});var os=rv();Object.defineProperty(e,"NoMatchDetails",{enumerable:!0,get:function(){return os.NoMatchDetails}});var Vp=iv();Object.defineProperty(e,"TranslationRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return Vp.TranslationRecognitionCanceledEventArgs}});var Jp=Sp();Object.defineProperty(e,"CancellationDetailsBase",{enumerable:!0,get:function(){return Jp.CancellationDetailsBase}});var Gp=nv();Object.defineProperty(e,"CancellationDetails",{enumerable:!0,get:function(){return Gp.CancellationDetails}});var Qp=sv();Object.defineProperty(e,"CancellationErrorCode",{enumerable:!0,get:function(){return Qp.CancellationErrorCode}});var Xp=ov();Object.defineProperty(e,"ConnectionEventArgs",{enumerable:!0,get:function(){return Xp.ConnectionEventArgs}});var Zp=av();Object.defineProperty(e,"ServiceEventArgs",{enumerable:!0,get:function(){return Zp.ServiceEventArgs}});var Yp=fp();Object.defineProperty(e,"Connection",{enumerable:!0,get:function(){return Yp.Connection}});var $p=cv();Object.defineProperty(e,"PhraseListGrammar",{enumerable:!0,get:function(){return $p.PhraseListGrammar}});var eh=rs();Object.defineProperty(e,"DialogServiceConfig",{enumerable:!0,get:function(){return eh.DialogServiceConfig}});var th=uv();Object.defineProperty(e,"BotFrameworkConfig",{enumerable:!0,get:function(){return th.BotFrameworkConfig}});var rh=pv();Object.defineProperty(e,"CustomCommandsConfig",{enumerable:!0,get:function(){return rh.CustomCommandsConfig}});var ih=dv();Object.defineProperty(e,"DialogServiceConnector",{enumerable:!0,get:function(){return ih.DialogServiceConnector}});var nh=vv();Object.defineProperty(e,"ActivityReceivedEventArgs",{enumerable:!0,get:function(){return nh.ActivityReceivedEventArgs}});var sh=fv();Object.defineProperty(e,"TurnStatusReceivedEventArgs",{enumerable:!0,get:function(){return sh.TurnStatusReceivedEventArgs}});var oh=gv();Object.defineProperty(e,"ServicePropertyChannel",{enumerable:!0,get:function(){return oh.ServicePropertyChannel}});var ah=mv();Object.defineProperty(e,"ProfanityOption",{enumerable:!0,get:function(){return ah.ProfanityOption}});var ch=Sv();Object.defineProperty(e,"BaseAudioPlayer",{enumerable:!0,get:function(){return ch.BaseAudioPlayer}});var uh=Cv();Object.defineProperty(e,"ConnectionMessageEventArgs",{enumerable:!0,get:function(){return uh.ConnectionMessageEventArgs}});var ph=lp();Object.defineProperty(e,"ConnectionMessage",{enumerable:!0,get:function(){return ph.ConnectionMessage}});var hh=yv();Object.defineProperty(e,"AutoDetectSourceLanguageConfig",{enumerable:!0,get:function(){return hh.AutoDetectSourceLanguageConfig}});var dh=Rv();Object.defineProperty(e,"AutoDetectSourceLanguageResult",{enumerable:!0,get:function(){return dh.AutoDetectSourceLanguageResult}});var vh=Pv();Object.defineProperty(e,"SourceLanguageConfig",{enumerable:!0,get:function(){return vh.SourceLanguageConfig}});var j=is();Object.defineProperty(e,"Conversation",{enumerable:!0,get:function(){return j.Conversation}}),Object.defineProperty(e,"ConversationExpirationEventArgs",{enumerable:!0,get:function(){return j.ConversationExpirationEventArgs}}),Object.defineProperty(e,"ConversationParticipantsChangedEventArgs",{enumerable:!0,get:function(){return j.ConversationParticipantsChangedEventArgs}}),Object.defineProperty(e,"ConversationTranslationCanceledEventArgs",{enumerable:!0,get:function(){return j.ConversationTranslationCanceledEventArgs}}),Object.defineProperty(e,"ConversationTranslationEventArgs",{enumerable:!0,get:function(){return j.ConversationTranslationEventArgs}}),Object.defineProperty(e,"ConversationTranslationResult",{enumerable:!0,get:function(){return j.ConversationTranslationResult}}),Object.defineProperty(e,"ConversationTranslator",{enumerable:!0,get:function(){return j.ConversationTranslator}}),Object.defineProperty(e,"ConversationTranscriber",{enumerable:!0,get:function(){return j.ConversationTranscriber}}),Object.defineProperty(e,"ConversationTranscriptionResult",{enumerable:!0,get:function(){return j.ConversationTranscriptionResult}}),Object.defineProperty(e,"Meeting",{enumerable:!0,get:function(){return j.Meeting}}),Object.defineProperty(e,"MeetingTranscriber",{enumerable:!0,get:function(){return j.MeetingTranscriber}}),Object.defineProperty(e,"Participant",{enumerable:!0,get:function(){return j.Participant}}),Object.defineProperty(e,"ParticipantChangedReason",{enumerable:!0,get:function(){return j.ParticipantChangedReason}}),Object.defineProperty(e,"User",{enumerable:!0,get:function(){return j.User}});var lh=ns();Object.defineProperty(e,"Synthesizer",{enumerable:!0,get:function(){return lh.Synthesizer}});var fh=op();Object.defineProperty(e,"SpeechSynthesisOutputFormat",{enumerable:!0,get:function(){return fh.SpeechSynthesisOutputFormat}});var gh=qv();Object.defineProperty(e,"SpeechSynthesizer",{enumerable:!0,get:function(){return gh.SpeechSynthesizer}});var mh=Bv();Object.defineProperty(e,"SynthesisResult",{enumerable:!0,get:function(){return mh.SynthesisResult}});var Sh=Fv();Object.defineProperty(e,"SpeechSynthesisResult",{enumerable:!0,get:function(){return Sh.SpeechSynthesisResult}});var Ch=Uv();Object.defineProperty(e,"SpeechSynthesisEventArgs",{enumerable:!0,get:function(){return Ch.SpeechSynthesisEventArgs}});var yh=xv();Object.defineProperty(e,"SpeechSynthesisWordBoundaryEventArgs",{enumerable:!0,get:function(){return yh.SpeechSynthesisWordBoundaryEventArgs}});var Rh=Wv();Object.defineProperty(e,"SpeechSynthesisBookmarkEventArgs",{enumerable:!0,get:function(){return Rh.SpeechSynthesisBookmarkEventArgs}});var Ph=Hv();Object.defineProperty(e,"SpeechSynthesisVisemeEventArgs",{enumerable:!0,get:function(){return Ph.SpeechSynthesisVisemeEventArgs}});var Eh=Kv();Object.defineProperty(e,"SpeechSynthesisBoundaryType",{enumerable:!0,get:function(){return Eh.SpeechSynthesisBoundaryType}});var Th=Vv();Object.defineProperty(e,"SynthesisVoicesResult",{enumerable:!0,get:function(){return Th.SynthesisVoicesResult}});var _i=Jv();Object.defineProperty(e,"SynthesisVoiceGender",{enumerable:!0,get:function(){return _i.SynthesisVoiceGender}}),Object.defineProperty(e,"SynthesisVoiceType",{enumerable:!0,get:function(){return _i.SynthesisVoiceType}}),Object.defineProperty(e,"VoiceInfo",{enumerable:!0,get:function(){return _i.VoiceInfo}});var Ah=Gv();Object.defineProperty(e,"SpeakerAudioDestination",{enumerable:!0,get:function(){return Ah.SpeakerAudioDestination}});var Ih=Qv();Object.defineProperty(e,"ConversationTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return Ih.ConversationTranscriptionCanceledEventArgs}});var wh=Xv();Object.defineProperty(e,"MeetingTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return wh.MeetingTranscriptionCanceledEventArgs}});var _h=Zv();Object.defineProperty(e,"PronunciationAssessmentGradingSystem",{enumerable:!0,get:function(){return _h.PronunciationAssessmentGradingSystem}});var bh=Yv();Object.defineProperty(e,"PronunciationAssessmentGranularity",{enumerable:!0,get:function(){return bh.PronunciationAssessmentGranularity}});var Mh=$v();Object.defineProperty(e,"PronunciationAssessmentConfig",{enumerable:!0,get:function(){return Mh.PronunciationAssessmentConfig}});var Oh=el();Object.defineProperty(e,"PronunciationAssessmentResult",{enumerable:!0,get:function(){return Oh.PronunciationAssessmentResult}});var Dh=Rp();Object.defineProperty(e,"LanguageIdMode",{enumerable:!0,get:function(){return Dh.LanguageIdMode}});var kh=tl();Object.defineProperty(e,"AvatarConfig",{enumerable:!0,get:function(){return kh.AvatarConfig}});var Nh=rl();Object.defineProperty(e,"AvatarEventArgs",{enumerable:!0,get:function(){return Nh.AvatarEventArgs}});var zh=il();Object.defineProperty(e,"AvatarSynthesizer",{enumerable:!0,get:function(){return zh.AvatarSynthesizer}});var as=nl();Object.defineProperty(e,"AvatarVideoFormat",{enumerable:!0,get:function(){return as.AvatarVideoFormat}}),Object.defineProperty(e,"Coordinate",{enumerable:!0,get:function(){return as.Coordinate}});var jh=sl();Object.defineProperty(e,"AvatarWebRTCConnectionResult",{enumerable:!0,get:function(){return jh.AvatarWebRTCConnectionResult}});var Lh=ol();Object.defineProperty(e,"Diagnostics",{enumerable:!0,get:function(){return Lh.Diagnostics}});var qh=rp();Object.defineProperty(e,"LogLevel",{enumerable:!0,get:function(){return qh.LogLevel}})})(Yi)),Yi}var yc;function al(){if(yc)return ut;yc=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.ProxyInfo=void 0;const e=P();let t=class Dp{constructor(u,n,a,s){this.privProxyHostName=u,this.privProxyPort=n,this.privProxyUserName=a,this.privProxyPassword=s}static fromParameters(u){return new Dp(u.getProperty(e.PropertyId.SpeechServiceConnection_ProxyHostName),parseInt(u.getProperty(e.PropertyId.SpeechServiceConnection_ProxyPort),10),u.getProperty(e.PropertyId.SpeechServiceConnection_ProxyUserName),u.getProperty(e.PropertyId.SpeechServiceConnection_ProxyPassword))}static fromRecognizerConfig(u){return this.fromParameters(u.parameters)}get HostName(){return this.privProxyHostName}get Port(){return this.privProxyPort}get UserName(){return this.privProxyUserName}get Password(){return this.privProxyPassword}};return ut.ProxyInfo=t,ut}var wr={},Cn,Rc;function cl(){if(Rc)return Cn;Rc=1;const e=new Set(["json","buffer","string"]);return Cn=t=>(...i)=>{const u=new Set;let n,a,s,r="";return i.forEach(o=>{if(typeof o=="string")if(o.toUpperCase()===o)if(n){const c=`Can't set method to ${o}, already set to ${n}.`;throw new Error(c)}else n=o;else if(o.startsWith("http:")||o.startsWith("https:"))r=o;else if(e.has(o))a=o;else throw new Error(`Unknown encoding, ${o}`);else if(typeof o=="number")u.add(o);else if(typeof o=="object")if(Array.isArray(o)||o instanceof Set)o.forEach(c=>u.add(c));else{if(s)throw new Error("Cannot set headers twice.");s=o}else throw new Error(`Unknown type: ${typeof o}`)}),n||(n="GET"),u.size===0&&u.add(200),t(u,n,a,s,r)},Cn}var yn,Pc;function ul(){if(Pc)return yn;Pc=1;const e=cl();class t extends Error{constructor(n,...a){super(...a),Error.captureStackTrace&&Error.captureStackTrace(this,t),this.name="StatusError",this.message=n.statusMessage,this.statusCode=n.status,this.res=n,this.json=n.json.bind(n),this.text=n.text.bind(n),this.arrayBuffer=n.arrayBuffer.bind(n);let s;Object.defineProperty(this,"responseBody",{get:()=>(s||(s=this.arrayBuffer()),s)}),this.headers={};for(const[o,c]of n.headers.entries())this.headers[o.toLowerCase()]=c}}return yn=e((u,n,a,s,r)=>async(o,c,p={})=>{o=r+(o||"");let h=new URL(o);if(s||(s={}),h.username&&(s.Authorization="Basic "+btoa(h.username+":"+h.password),h=new URL(h.protocol+"//"+h.host+h.pathname+h.search)),h.protocol!=="https:"&&h.protocol!=="http:")throw new Error(`Unknown protocol, ${h.protocol}`);if(c&&!(c instanceof ArrayBuffer||ArrayBuffer.isView(c)||typeof c=="string"))if(typeof c=="object")c=JSON.stringify(c),s["Content-Type"]="application/json";else throw new Error("Unknown body type.");p=new Headers({...s||{},...p});const v=await fetch(h,{method:n,headers:p,body:c});if(v.statusCode=v.status,!u.has(v.status))throw new t(v);return a==="json"?v.json():a==="buffer"?v.arrayBuffer():a==="string"?v.text():v}),yn}var Ec;function pl(){return Ec||(Ec=1,(function(e){var t=wr&&wr.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(e,"__esModule",{value:!0}),e.RestMessageAdapter=e.RestRequestType=void 0;const i=t(ul()),u=I();var n;(function(s){s.Get="GET",s.Post="POST",s.Delete="DELETE",s.File="file"})(n=e.RestRequestType||(e.RestRequestType={}));let a=class{constructor(r){if(!r)throw new u.ArgumentNullError("configParams");this.privHeaders=r.headers,this.privIgnoreCache=r.ignoreCache}static extractHeaderValue(r,o){let c="";try{const p=o.trim().split(/[\r\n]+/),h={};p.forEach(v=>{const d=v.split(": "),f=d.shift().toLowerCase(),g=d.join(": ");h[f]=g}),c=h[r.toLowerCase()]}catch{}return c}set options(r){this.privHeaders=r.headers,this.privIgnoreCache=r.ignoreCache}setHeaders(r,o){this.privHeaders[r]=o}request(r,o,c={},p=null){const h=new u.Deferred,v=r===n.File?"POST":r,d=(g,m={})=>{const l=g;return{data:JSON.stringify(m),headers:JSON.stringify(g.headers),json:m,ok:g.statusCode>=200&&g.statusCode<300,status:g.statusCode,statusText:m.error?m.error.message:l.statusText?l.statusText:l.statusMessage}},f=g=>{const m=(0,i.default)(o,v,this.privHeaders,200,201,202,204,400,401,402,403,404),l=this.queryParams(c)===""?"":`?${this.queryParams(c)}`;m(l,g).then(async S=>{if(r===n.Delete||S.statusCode===204)h.resolve(d(S));else try{const C=await S.json();h.resolve(d(S,C))}catch{h.resolve(d(S))}}).catch(S=>{h.reject(S)})};return this.privIgnoreCache&&(this.privHeaders["Cache-Control"]="no-cache"),r===n.Post&&p&&(this.privHeaders["content-type"]="application/json",this.privHeaders["Content-Type"]="application/json"),f(p),h.promise}queryParams(r={}){return Object.keys(r).map(o=>encodeURIComponent(o)+"="+encodeURIComponent(r[o])).join("&")}};e.RestMessageAdapter=a})(wr)),wr}var _r={},Tc;function kp(){if(Tc)return _r;Tc=1,Object.defineProperty(_r,"__esModule",{value:!0}),_r.RestConfigBase=void 0;let e=class Ti{static get requestOptions(){return Ti.privDefaultRequestOptions}static get configParams(){return Ti.privDefaultParams}static get restErrors(){return Ti.privRestErrors}};return _r.RestConfigBase=e,e.privDefaultRequestOptions={headers:{Accept:"application/json"},ignoreCache:!1,timeout:1e4},e.privRestErrors={authInvalidSubscriptionKey:"You must specify either an authentication token to use, or a Cognitive Speech subscription key.",authInvalidSubscriptionRegion:"You must specify the Cognitive Speech region to use.",invalidArgs:"Required input not found: {arg}.",invalidCreateJoinConversationResponse:"Creating/Joining conversation failed with HTTP {status}.",invalidParticipantRequest:"The requested participant was not found.",permissionDeniedConnect:"Required credentials not found.",permissionDeniedConversation:"Invalid operation: only the host can {command} the conversation.",permissionDeniedParticipant:"Invalid operation: only the host can {command} a participant.",permissionDeniedSend:"Invalid operation: the conversation is not in a connected state.",permissionDeniedStart:"Invalid operation: there is already an active conversation."},e.privDefaultParams={apiVersion:"api-version",authorization:"Authorization",clientAppId:"X-ClientAppId",contentTypeKey:"Content-Type",correlationId:"X-CorrelationId",languageCode:"language",nickname:"nickname",profanity:"profanity",requestId:"X-RequestId",roomId:"roomid",sessionToken:"token",subscriptionKey:"Ocp-Apim-Subscription-Key",subscriptionRegion:"Ocp-Apim-Subscription-Region",token:"X-CapitoToken"},_r}var Ac;function L(){return Ac||(Ac=1,(function(e){var t=ue&&ue.__createBinding||(Object.create?(function(u,n,a,s){s===void 0&&(s=a),Object.defineProperty(u,s,{enumerable:!0,get:function(){return n[a]}})}):(function(u,n,a,s){s===void 0&&(s=a),u[s]=n[a]})),i=ue&&ue.__exportStar||function(u,n){for(var a in u)a!=="default"&&!Object.prototype.hasOwnProperty.call(n,a)&&t(n,u,a)};Object.defineProperty(e,"__esModule",{value:!0}),i(Id(),e),i(wd(),e),i(_d(),e),i(bd(),e),i(Md(),e),i(Od(),e),i(ip(),e),i(Dd(),e),i(al(),e),i(pl(),e),i(kp(),e)})(ue)),ue}var br={},Ic;function wi(){if(Ic)return br;Ic=1,Object.defineProperty(br,"__esModule",{value:!0}),br.SpeechConnectionMessage=void 0;const e=I(),t=U();class i extends e.ConnectionMessage{constructor(n,a,s,r,o,c,p,h){if(!a)throw new e.ArgumentNullError("path");if(!s)throw new e.ArgumentNullError("requestId");const v={};if(v[t.HeaderNames.Path]=a,v[t.HeaderNames.RequestId]=s,v[t.HeaderNames.RequestTimestamp]=new Date().toISOString(),r&&(v[t.HeaderNames.ContentType]=r),c&&(v[t.HeaderNames.RequestStreamId]=c),p)for(const d in p)d&&(v[d]=p[d]);h?super(n,o,v,h):super(n,o,v),this.privPath=a,this.privRequestId=s,this.privContentType=r,this.privStreamId=c,this.privAdditionalHeaders=p}get path(){return this.privPath}get requestId(){return this.privRequestId}get contentType(){return this.privContentType}get streamId(){return this.privStreamId}get additionalHeaders(){return this.privAdditionalHeaders}static fromConnectionMessage(n){let a=null,s=null,r=null,o=null;const c={};if(n.headers)for(const p in n.headers)p&&(p.toLowerCase()===t.HeaderNames.Path.toLowerCase()?a=n.headers[p]:p.toLowerCase()===t.HeaderNames.RequestId.toLowerCase()?s=n.headers[p]:p.toLowerCase()===t.HeaderNames.ContentType.toLowerCase()?r=n.headers[p]:p.toLowerCase()===t.HeaderNames.RequestStreamId.toLowerCase()?o=n.headers[p]:c[p]=n.headers[p]);return new i(n.messageType,a,s,r,n.body,o,c,n.id)}}return br.SpeechConnectionMessage=i,br}var Rn={},wc;function hl(){return wc||(wc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SegmentationMode=void 0,(function(t){t.Normal="Normal",t.Disabled="Disabled",t.Custom="Custom",t.Semantic="Semantic"})(e.SegmentationMode||(e.SegmentationMode={}))})(Rn)),Rn}var Pn={},_c;function dl(){return _c||(_c=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NextAction=void 0,(function(t){t.None="None",t.Synthesize="Synthesize"})(e.NextAction||(e.NextAction={}))})(Pn)),Pn}var En={},bc;function vl(){return bc||(bc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Mode=void 0,(function(t){t.None="None",t.Always="Always"})(e.Mode||(e.Mode={}))})(En)),En}var Tn={},Mc;function ll(){return Mc||(Mc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.LanguageIdDetectionPriority=e.LanguageIdDetectionMode=void 0,(function(t){t.DetectAtAudioStart="DetectAtAudioStart",t.DetectContinuous="DetectContinuous",t.DetectSegments="DetectSegments"})(e.LanguageIdDetectionMode||(e.LanguageIdDetectionMode={})),(function(t){t.Auto="Auto",t.PrioritizeLatency="PrioritizeLatency",t.PrioritizeAccuracy="PrioritizeAccuracy"})(e.LanguageIdDetectionPriority||(e.LanguageIdDetectionPriority={}))})(Tn)),Tn}var An={},Oc;function fl(){return Oc||(Oc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NextAction=void 0,(function(t){t.Recognize="Recognize",t.None="None"})(e.NextAction||(e.NextAction={}))})(An)),An}var In={},Dc;function gl(){return Dc||(Dc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.OnUnknownAction=void 0,(function(t){t.RecognizeWithDefaultLanguage="RecognizeWithDefaultLanguage",t.None="None"})(e.OnUnknownAction||(e.OnUnknownAction={}))})(In)),In}var wn={},kc;function ml(){return kc||(kc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ResultType=void 0,(function(t){t.Auto="Auto",t.StableFragment="StableFragment",t.Hypothesis="Hypothesis",t.None="None"})(e.ResultType||(e.ResultType={}))})(wn)),wn}var _n={},Nc;function Sl(){return Nc||(Nc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PhraseResultOutputType=void 0,(function(t){t.Always="Always",t.None="None"})(e.PhraseResultOutputType||(e.PhraseResultOutputType={}))})(_n)),_n}var bn={},zc;function Cl(){return zc||(zc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NextAction=void 0,(function(t){t.None="None",t.Translate="Translate"})(e.NextAction||(e.NextAction={}))})(bn)),bn}var jc;function yl(){if(jc)return it;jc=1,Object.defineProperty(it,"__esModule",{value:!0}),it.ServiceRecognizerBase=void 0;const e=L(),t=I(),i=P(),u=A(),n=wi(),a=hl(),s=V(),r=dl(),o=vl(),c=ll(),p=fl(),h=gl(),v=ml(),d=Sl(),f=Cl();let g=class Si{constructor(l,S,C,y,R){if(this.privConnectionConfigurationPromise=void 0,this.privConnectionPromise=void 0,this.privSetTimeout=setTimeout,this.privIsLiveAudio=!1,this.privAverageBytesPerMs=0,this.privEnableSpeakerId=!1,this.privExpectContentAssessmentResponse=!1,this.recognizeOverride=void 0,this.disconnectOverride=void 0,this.receiveMessageOverride=void 0,this.sendPrePayloadJSONOverride=void 0,this.postConnectImplOverride=void 0,this.configConnectionOverride=void 0,this.handleSpeechPhraseMessage=void 0,this.handleSpeechHypothesisMessage=void 0,!l)throw new t.ArgumentNullError("authentication");if(!S)throw new t.ArgumentNullError("connectionFactory");if(!C)throw new t.ArgumentNullError("audioSource");if(!y)throw new t.ArgumentNullError("recognizerConfig");this.privEnableSpeakerId=y.isSpeakerDiarizationEnabled,this.privMustReportEndOfStream=!1,this.privAuthentication=l,this.privConnectionFactory=S,this.privAudioSource=C,this.privRecognizerConfig=y,this.privIsDisposed=!1,this.privRecognizer=R,this.privRequestSession=new u.RequestSession(this.privAudioSource.id()),this.privConnectionEvents=new t.EventSource,this.privServiceEvents=new t.EventSource,this.privDynamicGrammar=new u.DynamicGrammarBuilder,this.privSpeechContext=new u.SpeechContext(this.privDynamicGrammar),this.privAgentConfig=new u.AgentConfig,this.privRecognizerConfig.parameters.getProperty(i.PropertyId.WebWorkerLoadType,"on").toLowerCase()==="on"&&typeof Blob<"u"&&typeof Worker<"u"?this.privSetTimeout=t.Timeout.setTimeout:(typeof window<"u"&&(this.privSetTimeout=window.setTimeout.bind(window)),typeof globalThis<"u"&&(this.privSetTimeout=globalThis.setTimeout.bind(globalThis))),this.connectionEvents.attach(w=>{if(w.name==="ConnectionClosedEvent"){const E=w;(E.statusCode===1003||E.statusCode===1007||E.statusCode===1002||E.statusCode===4e3||this.privRequestSession.numConnectionAttempts>this.privRecognizerConfig.maxRetryCount)&&this.cancelRecognitionLocal(i.CancellationReason.Error,E.statusCode===1007?i.CancellationErrorCode.BadRequestParameters:i.CancellationErrorCode.ConnectionFailure,`${E.reason} websocket error code: ${E.statusCode}`)}}),this.privEnableSpeakerId&&(this.privDiarizationSessionId=(0,t.createNoDashGuid)())}setTranslationJson(){const l=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0);if(l!==void 0){const S=l.split(","),C=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationVoice,void 0),y=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationCategoryId,void 0),R=C!==void 0?r.NextAction.Synthesize:r.NextAction.None;if(this.privSpeechContext.getContext().translation={onPassthrough:{action:R},onSuccess:{action:R},output:{includePassThroughResults:!0,interimResults:{mode:o.Mode.Always}},targetLanguages:S},y!==void 0&&(this.privSpeechContext.getContext().translation.category=y),C!==void 0){const w={};for(const E of S)w[E]=C;this.privSpeechContext.getContext().synthesis={defaultVoices:w}}const T=this.privSpeechContext.getContext().phraseDetection||{};T.onSuccess={action:f.NextAction.Translate},T.onInterim={action:f.NextAction.Translate},this.privSpeechContext.getContext().phraseDetection=T}}setSpeechSegmentationTimeoutJson(){const l=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.Speech_SegmentationSilenceTimeoutMs,void 0),S=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.Speech_SegmentationMaximumTimeMs,void 0),C=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.Speech_SegmentationStrategy,void 0),y={mode:a.SegmentationMode.Normal};let R=!1;if(C!==void 0){R=!0;let T=a.SegmentationMode.Normal;switch(C.toLowerCase()){case"default":break;case"time":T=a.SegmentationMode.Custom;break;case"semantic":T=a.SegmentationMode.Semantic;break}y.mode=T}if(l!==void 0){R=!0;const T=parseInt(l,10);y.mode=a.SegmentationMode.Custom,y.segmentationSilenceTimeoutMs=T}if(S!==void 0){R=!0;const T=parseInt(S,10);y.mode=a.SegmentationMode.Custom,y.segmentationForcedTimeoutMs=T}if(R){const T=this.privSpeechContext.getContext().phraseDetection||{};switch(T.mode=this.recognitionMode,this.recognitionMode){case s.RecognitionMode.Conversation:T.conversation=T.conversation??{segmentation:{}},T.conversation.segmentation=y;break;case s.RecognitionMode.Interactive:T.interactive=T.interactive??{segmentation:{}},T.interactive.segmentation=y;break;case s.RecognitionMode.Dictation:T.dictation=T.dictation??{},T.dictation.segmentation=y;break}this.privSpeechContext.getContext().phraseDetection=T}}setLanguageIdJson(){const l=this.privSpeechContext.getContext().phraseDetection||{};if(this.privRecognizerConfig.autoDetectSourceLanguages!==void 0){const S=this.privRecognizerConfig.autoDetectSourceLanguages.split(",");S.length===1&&S[0]===u.AutoDetectSourceLanguagesOpenRangeOptionName&&(S[0]="UND");let C;this.privRecognizerConfig.languageIdMode==="Continuous"?C=c.LanguageIdDetectionMode.DetectContinuous:C=c.LanguageIdDetectionMode.DetectAtAudioStart,this.privSpeechContext.getContext().languageId={languages:S,mode:C,onSuccess:{action:p.NextAction.Recognize},onUnknown:{action:h.OnUnknownAction.None},priority:c.LanguageIdDetectionPriority.PrioritizeLatency},this.privSpeechContext.getContext().phraseOutput={interimResults:{resultType:v.ResultType.Auto},phraseResults:{resultType:d.PhraseResultOutputType.Always}};const y=this.privRecognizerConfig.sourceLanguageModels;y!==void 0&&(l.customModels=y,l.onInterim={action:f.NextAction.None},l.onSuccess={action:f.NextAction.None})}this.privSpeechContext.getContext().phraseDetection=l}setOutputDetailLevelJson(){this.privEnableSpeakerId&&(this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"false").toLowerCase()==="true"?this.privSpeechContext.setWordLevelTimings():this.privRecognizerConfig.parameters.getProperty(u.OutputFormatPropertyName,i.OutputFormat[i.OutputFormat.Simple]).toLowerCase()===i.OutputFormat[i.OutputFormat.Detailed].toLocaleLowerCase()&&this.privSpeechContext.setDetailedOutputFormat())}setSpeechStartEventSensitivityJson(){const l=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.Speech_StartEventSensitivity,void 0);if(l!==void 0){let S=!1;switch(l.toLowerCase()){case s.SpeechStartEventSensitivity.Low:case s.SpeechStartEventSensitivity.Medium:case s.SpeechStartEventSensitivity.High:S=!0;break}if(S){const C=this.privSpeechContext.getContext().phraseDetection||{};C.voiceOnsetSensitivity=l.toLowerCase(),this.privSpeechContext.getContext().phraseDetection=C}}}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}get audioSource(){return this.privAudioSource}get speechContext(){return this.privSpeechContext}get dynamicGrammar(){return this.privDynamicGrammar}get agentConfig(){return this.privAgentConfig}set conversationTranslatorToken(l){this.privRecognizerConfig.parameters.setProperty(i.PropertyId.ConversationTranslator_Token,l)}set authentication(l){this.privAuthentication=l}isDisposed(){return this.privIsDisposed}async dispose(l){if(this.privIsDisposed=!0,this.privConnectionPromise!==void 0)try{await(await this.privConnectionPromise).dispose(l)}catch{return}}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}get recognitionMode(){return this.privRecognizerConfig.recognitionMode}async recognize(l,S,C){if(this.recognizeOverride!==void 0){await this.recognizeOverride(l,S,C);return}if(this.privConnectionConfigurationPromise=void 0,this.privRecognizerConfig.recognitionMode=l,this.privRecognizerConfig.recognitionEndpointVersion==="2"){const E=this.privSpeechContext.getContext().phraseDetection||{};E.mode=l,this.privSpeechContext.getContext().phraseDetection=E}this.setLanguageIdJson(),this.setTranslationJson(),this.privRecognizerConfig.autoDetectSourceLanguages!==void 0&&this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0&&this.setupTranslationWithLanguageId(),this.setSpeechSegmentationTimeoutJson(),this.setOutputDetailLevelJson(),this.setSpeechStartEventSensitivityJson(),this.privSuccessCallback=S,this.privErrorCallback=C,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privAudioSource.events);const y=this.connectImpl();let R;try{const E=await this.audioSource.attach(this.privRequestSession.audioNodeId),M=await this.audioSource.format,O=await this.audioSource.deviceInfo;this.privIsLiveAudio=O.type&&O.type===u.type.Microphones,R=new e.ReplayableAudioNode(E,M.avgBytesPerSec),await this.privRequestSession.onAudioSourceAttachCompleted(R,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:O}}catch(E){throw await this.privRequestSession.onStopRecognizing(),E}try{await y}catch(E){await this.cancelRecognitionLocal(i.CancellationReason.Error,i.CancellationErrorCode.ConnectionFailure,E);return}const T=new i.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,T),this.receiveMessage(),this.sendAudio(R).catch(async E=>{await this.cancelRecognitionLocal(i.CancellationReason.Error,i.CancellationErrorCode.RuntimeError,E)})}async stopRecognizing(){if(this.privRequestSession.isRecognizing)try{await this.audioSource.turnOff(),await this.sendFinalAudio(),await this.privRequestSession.onStopRecognizing(),await this.privRequestSession.turnCompletionPromise}finally{await this.privRequestSession.dispose()}}async connect(){return await this.connectImpl(),Promise.resolve()}connectAsync(l,S){this.connectImpl().then(()=>{try{l&&l()}catch(C){S&&S(C)}},C=>{try{S&&S(C)}catch{}})}async disconnect(){if(await this.cancelRecognitionLocal(i.CancellationReason.Error,i.CancellationErrorCode.NoError,"Disconnecting"),this.disconnectOverride!==void 0&&await this.disconnectOverride(),this.privConnectionPromise!==void 0)try{await(await this.privConnectionPromise).dispose()}catch{}this.privConnectionPromise=void 0}sendMessage(l){}async sendNetworkMessage(l,S){const C=typeof S=="string"?t.MessageType.Text:t.MessageType.Binary,y=typeof S=="string"?"application/json":"";return(await this.fetchConnection()).send(new n.SpeechConnectionMessage(C,l,this.privRequestSession.requestId,y,S))}set activityTemplate(l){this.privActivityTemplate=l}get activityTemplate(){return this.privActivityTemplate}set expectContentAssessmentResponse(l){this.privExpectContentAssessmentResponse=l}async sendTelemetryData(){const l=this.privRequestSession.getTelemetry();if(Si.telemetryDataEnabled!==!0||this.privIsDisposed||l===null)return;if(Si.telemetryData)try{Si.telemetryData(l)}catch{}await(await this.fetchConnection()).send(new n.SpeechConnectionMessage(t.MessageType.Text,"telemetry",this.privRequestSession.requestId,"application/json",l))}async cancelRecognitionLocal(l,S,C){this.privRequestSession.isRecognizing&&(await this.privRequestSession.onStopRecognizing(),this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,l,S,C))}async receiveMessage(){try{if(this.privIsDisposed)return;let l=await this.fetchConnection();const S=await l.read();if(this.receiveMessageOverride!==void 0)return this.receiveMessageOverride();if(!S)return this.receiveMessage();this.privServiceHasSentMessage=!0;const C=n.SpeechConnectionMessage.fromConnectionMessage(S);if(C.requestId.toLowerCase()===this.privRequestSession.requestId.toLowerCase())switch(C.path.toLowerCase()){case"turn.start":this.privMustReportEndOfStream=!0,this.privRequestSession.onServiceTurnStartResponse();break;case"speech.startdetected":const y=u.SpeechDetected.fromJSON(C.textBody,this.privRequestSession.currentTurnAudioOffset),R=new i.RecognitionEventArgs(y.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,R);break;case"speech.enddetected":let T;C.textBody.length>0?T=C.textBody:T="{ Offset: 0 }";const w=u.SpeechDetected.fromJSON(T,this.privRequestSession.currentTurnAudioOffset),E=new i.RecognitionEventArgs(w.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,E);break;case"turn.end":await this.sendTelemetryData(),this.privRequestSession.isSpeechEnded&&this.privMustReportEndOfStream&&(this.privMustReportEndOfStream=!1,await this.cancelRecognitionLocal(i.CancellationReason.EndOfStream,i.CancellationErrorCode.NoError,void 0));const M=new i.SessionEventArgs(this.privRequestSession.sessionId);if(await this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition),!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing){this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,M);return}else l=await this.fetchConnection(),await this.sendPrePayloadJSON(l);break;default:await this.processTypeSpecificMessages(C)||this.privServiceEvents&&this.serviceEvents.onEvent(new t.ServiceEvent(C.path.toLowerCase(),C.textBody))}return this.receiveMessage()}catch{return null}}updateSpeakerDiarizationAudioOffset(){const l=this.privRequestSession.recognitionBytesSent,S=this.privAverageBytesPerMs!==0?l/this.privAverageBytesPerMs:0;this.privSpeechContext.setSpeakerDiarizationAudioOffsetMs(S)}sendSpeechContext(l,S){this.privEnableSpeakerId&&this.updateSpeakerDiarizationAudioOffset();const C=this.speechContext.toJSON();if(S&&this.privRequestSession.onSpeechContext(),C)return l.send(new n.SpeechConnectionMessage(t.MessageType.Text,"speech.context",this.privRequestSession.requestId,"application/json",C))}setupTranslationWithLanguageId(){const l=this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0),S=this.privRecognizerConfig.autoDetectSourceLanguages!==void 0;if(l!==void 0&&S){this.privSpeechContext.getContext().phraseOutput={interimResults:{resultType:v.ResultType.None},phraseResults:{resultType:d.PhraseResultOutputType.None}};const C=this.privSpeechContext.getContext().translation;if(C){const y=this.privRecognizerConfig.sourceLanguageModels;if(y!==void 0&&y.length>0){const T=this.privSpeechContext.getContext().phraseDetection||{};T.customModels=y,this.privSpeechContext.getContext().phraseDetection=T}this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)!==void 0&&(C.onSuccess={action:r.NextAction.Synthesize},C.onPassthrough={action:r.NextAction.Synthesize})}}}noOp(){}async sendPrePayloadJSON(l,S=!0){if(this.sendPrePayloadJSONOverride!==void 0)return this.sendPrePayloadJSONOverride(l);await this.sendSpeechContext(l,S),await this.sendWaveHeader(l)}async sendWaveHeader(l){const S=await this.audioSource.format;return l.send(new n.SpeechConnectionMessage(t.MessageType.Binary,"audio",this.privRequestSession.requestId,"audio/x-wav",S.header))}connectImpl(){return this.privConnectionPromise!==void 0?this.privConnectionPromise.then(l=>l.state()===t.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl())):(this.privConnectionPromise=this.retryableConnect(),this.privConnectionPromise.catch(()=>{}),this.postConnectImplOverride!==void 0?this.postConnectImplOverride(this.privConnectionPromise):this.privConnectionPromise)}sendSpeechServiceConfig(l,S,C){if(S.onSpeechContext(),Si.telemetryDataEnabled!==!0){const R={context:{system:JSON.parse(C).context.system}};C=JSON.stringify(R)}if(this.privRecognizerConfig.parameters.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase()==="true"){const y=JSON.parse(C);y.context.DisableReferenceChannel="True",y.context.MicSpec="1_0_0",C=JSON.stringify(y)}if(C)return l.send(new n.SpeechConnectionMessage(t.MessageType.Text,"speech.config",S.requestId,"application/json",C))}async fetchConnection(){return this.privConnectionConfigurationPromise!==void 0?this.privConnectionConfigurationPromise.then(l=>l.state()===t.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection())):(this.privConnectionConfigurationPromise=this.configureConnection(),await this.privConnectionConfigurationPromise)}async sendAudio(l){const S=await this.audioSource.format;this.privAverageBytesPerMs=S.avgBytesPerSec/1e3;let C=Date.now();const y=this.privRecognizerConfig.parameters.getProperty("SPEECH-TransmitLengthBeforThrottleMs","5000"),R=S.avgBytesPerSec/1e3*parseInt(y,10),T=this.privRequestSession.recogNumber,w=async()=>{if(!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===T){const E=await this.fetchConnection(),M=await l.read();if(this.privRequestSession.isSpeechEnded)return;let O,x;if(!M||M.isEnd?(O=null,x=0):(O=M.buffer,this.privRequestSession.onAudioSent(O.byteLength),R>=this.privRequestSession.bytesSent?x=0:x=Math.max(0,C-Date.now())),x!==0&&await this.delay(x),O!==null&&(C=Date.now()+O.byteLength*1e3/(S.avgBytesPerSec*2)),!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===T)if(E.send(new n.SpeechConnectionMessage(t.MessageType.Binary,"audio",this.privRequestSession.requestId,null,O)).catch(()=>{this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition).catch(()=>{})}),M!=null&&M.isEnd)this.privIsLiveAudio||this.privRequestSession.onSpeechEnded();else return w()}};return w()}async retryableConnect(){let l=!1;this.privAuthFetchEventId=(0,t.createNoDashGuid)();const S=this.privRequestSession.sessionId;this.privConnectionId=S!==void 0?S:(0,t.createNoDashGuid)(),this.privRequestSession.onPreConnectionStart(this.privAuthFetchEventId,this.privConnectionId);let C=0,y="";for(;this.privRequestSession.numConnectionAttempts<=this.privRecognizerConfig.maxRetryCount;){this.privRequestSession.onRetryConnection();const T=await(l?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId));await this.privRequestSession.onAuthCompleted(!1);const w=await this.privConnectionFactory.create(this.privRecognizerConfig,T,this.privConnectionId);this.privRequestSession.listenForServiceTelemetry(w.events),w.events.attach(M=>{this.connectionEvents.onEvent(M)});const E=await w.open();if(E.statusCode===200)return await this.privRequestSession.onConnectionEstablishCompleted(E.statusCode),Promise.resolve(w);E.statusCode===1006&&(l=!0),C=E.statusCode,y=E.reason}return await this.privRequestSession.onConnectionEstablishCompleted(C,y),Promise.reject(`Unable to contact server. StatusCode: ${C}, ${this.privRecognizerConfig.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Endpoint)} Reason: ${y}`)}delay(l){return new Promise(S=>this.privSetTimeout(S,l))}writeBufferToConsole(l){let S="Buffer Size: ";if(l===null)S+="null";else{const C=new Uint8Array(l);S+=`${l.byteLength}\r
`;for(let y=0;y<l.byteLength;y++)S+=C[y].toString(16).padStart(2,"0")+" ",(y+1)%16===0&&(console.info(S),S="")}console.info(S)}async sendFinalAudio(){await(await this.fetchConnection()).send(new n.SpeechConnectionMessage(t.MessageType.Binary,"audio",this.privRequestSession.requestId,null,null))}async configureConnection(){const l=await this.connectImpl();return this.configConnectionOverride!==void 0?this.configConnectionOverride(l):(await this.sendSpeechServiceConfig(l,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),await this.sendPrePayloadJSON(l,!1),l)}};return it.ServiceRecognizerBase=g,g.telemetryDataEnabled=!0,it}var Mr={},Lc;function Rl(){if(Lc)return Mr;Lc=1,Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.ConversationServiceRecognizer=void 0;const e=P(),t=A();let i=class extends t.ServiceRecognizerBase{constructor(n,a,s,r,o){super(n,a,s,r,o),this.handleSpeechPhraseMessage=async c=>this.handleSpeechPhrase(c),this.handleSpeechHypothesisMessage=c=>this.handleSpeechHypothesis(c)}processTypeSpecificMessages(n){}handleRecognizedCallback(n,a,s){}handleRecognizingCallback(n,a,s){}async processSpeechMessages(n){let a=!1;switch(n.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":this.handleSpeechHypothesisMessage&&this.handleSpeechHypothesisMessage(n.textBody),a=!0;break;case"speech.phrase":this.handleSpeechPhraseMessage&&await this.handleSpeechPhraseMessage(n.textBody),a=!0;break}return a}cancelRecognition(n,a,s,r,o){}async handleSpeechPhrase(n){const a=t.SimpleSpeechPhrase.fromJSON(n,this.privRequestSession.currentTurnAudioOffset),s=t.EnumTranslation.implTranslateRecognitionResult(a.RecognitionStatus);let r;const o=new e.PropertyCollection;if(o.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,n),this.privRequestSession.onPhraseRecognized(a.Offset+a.Duration),e.ResultReason.Canceled===s){const c=t.EnumTranslation.implTranslateCancelResult(a.RecognitionStatus),p=t.EnumTranslation.implTranslateCancelErrorCode(a.RecognitionStatus);await this.cancelRecognitionLocal(c,p,t.EnumTranslation.implTranslateErrorDetails(p))}else if(a.RecognitionStatus!==t.RecognitionStatus.EndOfDictation){if(this.privRecognizerConfig.parameters.getProperty(t.OutputFormatPropertyName)===e.OutputFormat[e.OutputFormat.Simple])r=new e.SpeechRecognitionResult(this.privRequestSession.requestId,s,a.DisplayText,a.Duration,a.Offset,a.Language,a.LanguageDetectionConfidence,a.SpeakerId,void 0,a.asJson(),o);else{const c=t.DetailedSpeechPhrase.fromJSON(n,this.privRequestSession.currentTurnAudioOffset);r=new e.SpeechRecognitionResult(this.privRequestSession.requestId,s,c.Text,c.Duration,c.Offset,c.Language,c.LanguageDetectionConfidence,c.SpeakerId,void 0,c.asJson(),o)}this.handleRecognizedCallback(r,r.offset,this.privRequestSession.sessionId)}}handleSpeechHypothesis(n){const a=t.SpeechHypothesis.fromJSON(n,this.privRequestSession.currentTurnAudioOffset),s=new e.PropertyCollection;s.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,n);const r=new e.SpeechRecognitionResult(this.privRequestSession.requestId,e.ResultReason.RecognizingSpeech,a.Text,a.Duration,a.Offset,a.Language,a.LanguageDetectionConfidence,a.SpeakerId,void 0,a.asJson(),s);this.privRequestSession.onHypothesis(a.Offset),this.handleRecognizingCallback(r,a.Duration,this.privRequestSession.sessionId)}};return Mr.ConversationServiceRecognizer=i,Mr}var Mn={},qc;function Pl(){return qc||(qc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RecognizerConfig=e.SpeechResultFormat=void 0;const t=P(),i=A(),u=V();(function(a){a[a.Simple=0]="Simple",a[a.Detailed=1]="Detailed"})(e.SpeechResultFormat||(e.SpeechResultFormat={}));class n{constructor(s,r){this.privSpeechServiceConfig=s||new i.SpeechServiceConfig(new i.Context(null)),this.privParameters=r,this.privMaxRetryCount=parseInt(r.getProperty("SPEECH-Error-MaxRetryCount","4"),10),this.privLanguageIdMode=r.getProperty(t.PropertyId.SpeechServiceConnection_LanguageIdMode,void 0),this.privEnableSpeakerId=!1}get parameters(){return this.privParameters}get recognitionMode(){return this.privRecognitionMode}set recognitionMode(s){this.privRecognitionMode=s,this.privRecognitionActivityTimeout=s===u.RecognitionMode.Interactive?8e3:25e3,this.privSpeechServiceConfig.Recognition=u.RecognitionMode[s]}get SpeechServiceConfig(){return this.privSpeechServiceConfig}get recognitionActivityTimeout(){return this.privRecognitionActivityTimeout}get isContinuousRecognition(){return this.privRecognitionMode!==u.RecognitionMode.Interactive}get languageIdMode(){return this.privLanguageIdMode}get autoDetectSourceLanguages(){return this.parameters.getProperty(t.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,void 0)}get recognitionEndpointVersion(){return this.parameters.getProperty(t.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2")}set recognitionEndpointVersion(s){this.parameters.setProperty(t.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,s)}get sourceLanguageModels(){const s=[];let r=!1;if(this.autoDetectSourceLanguages!==void 0)for(const o of this.autoDetectSourceLanguages.split(",")){const c=o+t.PropertyId.SpeechServiceConnection_EndpointId.toString(),p=this.parameters.getProperty(c,void 0);p!==void 0?(s.push({language:o,endpoint:p}),r=!0):s.push({language:o,endpoint:""})}return r?s:void 0}get maxRetryCount(){return this.privMaxRetryCount}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}set isSpeakerDiarizationEnabled(s){this.privEnableSpeakerId=s}}e.RecognizerConfig=n})(Mn)),Mn}var On={},Bc;function El(){return Bc||(Bc=1,Object.defineProperty(On,"__esModule",{value:!0})),On}var Or={},Fc;function Tl(){if(Fc)return Or;Fc=1,Object.defineProperty(Or,"__esModule",{value:!0}),Or.WebsocketMessageFormatter=void 0;const e=I(),t=`\r
`;let i=class{toConnectionMessage(n){const a=new e.Deferred;try{if(n.messageType===e.MessageType.Text){const s=n.textContent;let r={},o=null;if(s){const c=s.split(`\r
\r
`);c&&c.length>0&&(r=this.parseHeaders(c[0]),c.length>1&&(o=c[1]))}a.resolve(new e.ConnectionMessage(n.messageType,o,r,n.id))}else if(n.messageType===e.MessageType.Binary){const s=n.binaryContent;let r={},o=null;if(!s||s.byteLength<2)throw new Error("Invalid binary message format. Header length missing.");const c=new DataView(s),p=c.getInt16(0);if(s.byteLength<p+2)throw new Error("Invalid binary message format. Header content missing.");let h="";for(let v=0;v<p;v++)h+=String.fromCharCode(c.getInt8(v+2));r=this.parseHeaders(h),s.byteLength>p+2&&(o=s.slice(2+p)),a.resolve(new e.ConnectionMessage(n.messageType,o,r,n.id))}}catch(s){a.reject(`Error formatting the message. Error: ${s}`)}return a.promise}fromConnectionMessage(n){const a=new e.Deferred;try{if(n.messageType===e.MessageType.Text){const s=`${this.makeHeaders(n)}${t}${n.textBody?n.textBody:""}`;a.resolve(new e.RawWebsocketMessage(e.MessageType.Text,s,n.id))}else if(n.messageType===e.MessageType.Binary){const s=this.makeHeaders(n),r=n.binaryBody,o=this.stringToArrayBuffer(s),c=new Int8Array(o),p=c.byteLength,h=new Int8Array(2+p+(r?r.byteLength:0));if(h[0]=p>>8&255,h[1]=p&255,h.set(c,2),r){const d=new Int8Array(r);h.set(d,2+p)}const v=h.buffer;a.resolve(new e.RawWebsocketMessage(e.MessageType.Binary,v,n.id))}}catch(s){a.reject(`Error formatting the message. ${s}`)}return a.promise}makeHeaders(n){let a="";if(n.headers)for(const s in n.headers)s&&(a+=`${s}: ${n.headers[s]}${t}`);return a}parseHeaders(n){const a={};if(n){const s=n.match(/[^\r\n]+/g);if(a){for(const r of s)if(r){const o=r.indexOf(":"),c=o>0?r.substr(0,o).trim().toLowerCase():r,p=o>0&&r.length>o+1?r.substr(o+1).trim():"";a[c]=p}}}return a}stringToArrayBuffer(n){const a=new ArrayBuffer(n.length),s=new DataView(a);for(let r=0;r<n.length;r++)s.setUint8(r,n.charCodeAt(r));return a}};return Or.WebsocketMessageFormatter=i,Or}var Dr={},Uc;function Al(){if(Uc)return Dr;Uc=1,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.SpeechConnectionFactory=void 0;const e=L(),t=A(),i=P(),u=Y(),n=A(),a=U(),s=ie(),r=V();let o=class extends u.ConnectionFactoryBase{constructor(){super(...arguments),this.interactiveRelativeUri="/speech/recognition/interactive/cognitiveservices/v1",this.conversationRelativeUri="/speech/recognition/conversation/cognitiveservices/v1",this.dictationRelativeUri="/speech/recognition/dictation/cognitiveservices/v1",this.universalUri="/stt/speech/universal/v"}async create(p,h,v){let d=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Endpoint,void 0);const f=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Region,void 0),g=u.ConnectionFactoryBase.getHostSuffix(f),m=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Host,"wss://"+f+".stt.speech"+g),l={},S=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_EndpointId,void 0),C=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);if(S?(!d||d.search(s.QueryParameterNames.CustomSpeechDeploymentId)===-1)&&(l[s.QueryParameterNames.CustomSpeechDeploymentId]=S):C&&(!d||d.search(s.QueryParameterNames.Language)===-1)&&(l[s.QueryParameterNames.Language]=C),(!d||d.search(s.QueryParameterNames.Format)===-1)&&(l[s.QueryParameterNames.Format]=p.parameters.getProperty(t.OutputFormatPropertyName,i.OutputFormat[i.OutputFormat.Simple]).toLowerCase()),p.autoDetectSourceLanguages!==void 0&&(l[s.QueryParameterNames.EnableLanguageId]="true"),this.setCommonUrlParams(p,l,d),d){const E=new URL(d),M=E.pathname;(M===""||M==="/")&&(E.pathname=this.universalUri+p.recognitionEndpointVersion,d=await u.ConnectionFactoryBase.getRedirectUrlFromEndpoint(E.toString()))}if(!d)switch(p.recognitionMode){case r.RecognitionMode.Conversation:p.parameters.getProperty(t.ForceDictationPropertyName,"false")==="true"?d=m+this.dictationRelativeUri:p.recognitionEndpointVersion!==void 0&&parseInt(p.recognitionEndpointVersion,10)>1?d=`${m}${this.universalUri}${p.recognitionEndpointVersion}`:d=m+this.conversationRelativeUri;break;case r.RecognitionMode.Dictation:d=m+this.dictationRelativeUri;break;default:p.recognitionEndpointVersion!==void 0&&parseInt(p.recognitionEndpointVersion,10)>1?d=`${m}${this.universalUri}${p.recognitionEndpointVersion}`:d=m+this.interactiveRelativeUri;break}const y={};h.token!==void 0&&h.token!==""&&(y[h.headerName]=h.token),y[a.HeaderNames.ConnectionId]=v,y.connectionId=v;const R=p.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true",T=new e.WebsocketConnection(d,l,y,new n.WebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(p),R,v),w=T.uri;return p.parameters.setProperty(i.PropertyId.SpeechServiceConnection_Url,w),T}};return Dr.SpeechConnectionFactory=o,Dr}var kr={},xc;function Il(){if(xc)return kr;xc=1,Object.defineProperty(kr,"__esModule",{value:!0}),kr.ConversationTranscriberConnectionFactory=void 0;const e=L(),t=P(),i=A(),u=Y(),n=A(),a=U(),s=ie();let r=class extends u.ConnectionFactoryBase{constructor(){super(...arguments),this.universalUri="/stt/speech/universal/v2",this.conversationRelativeUriV1="/speech/recognition/conversation/cognitiveservices/v1"}async create(c,p,h){let v=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Endpoint,void 0);const d=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Region,void 0),f=u.ConnectionFactoryBase.getHostSuffix(d),g=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Host,"wss://"+d+".stt.speech"+f),m={},l=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_EndpointId,void 0),S=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);if(l?(!v||v.search(s.QueryParameterNames.CustomSpeechDeploymentId)===-1)&&(m[s.QueryParameterNames.CustomSpeechDeploymentId]=l):S&&(!v||v.search(s.QueryParameterNames.Language)===-1)&&(m[s.QueryParameterNames.Language]=S),c.autoDetectSourceLanguages!==void 0&&(m[s.QueryParameterNames.EnableLanguageId]="true"),c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,void 0)==="1")v=`${g}${this.universalUri}`;else{if(this.setV2UrlParams(c,m,v),v){const E=new URL(v),M=E.pathname;(M===""||M==="/")&&(E.pathname=this.universalUri,v=await u.ConnectionFactoryBase.getRedirectUrlFromEndpoint(E.toString()))}v||(v=`${g}${this.conversationRelativeUriV1}`)}const y={};p.token!==void 0&&p.token!==""&&(y[p.headerName]=p.token),y[a.HeaderNames.ConnectionId]=h;const R=c.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true",T=new e.WebsocketConnection(v,m,y,new n.WebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(c),R,h),w=T.uri;return c.parameters.setProperty(t.PropertyId.SpeechServiceConnection_Url,w),T}setV2UrlParams(c,p,h){new Map([[t.PropertyId.Speech_SegmentationSilenceTimeoutMs,s.QueryParameterNames.SegmentationSilenceTimeoutMs],[t.PropertyId.SpeechServiceConnection_EnableAudioLogging,s.QueryParameterNames.EnableAudioLogging],[t.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,s.QueryParameterNames.EndSilenceTimeoutMs],[t.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,s.QueryParameterNames.InitialSilenceTimeoutMs],[t.PropertyId.SpeechServiceResponse_PostProcessingOption,s.QueryParameterNames.Postprocessing],[t.PropertyId.SpeechServiceResponse_ProfanityOption,s.QueryParameterNames.Profanity],[t.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,s.QueryParameterNames.StableIntermediateThreshold]]).forEach((f,g)=>{this.setUrlParameter(g,f,c,p,h)});const d=JSON.parse(c.parameters.getProperty(i.ServicePropertiesPropertyName,"{}"));Object.keys(d).forEach(f=>{p[f]=d[f]})}};return kr.ConversationTranscriberConnectionFactory=r,kr}var Nr={},Wc;function wl(){if(Wc)return Nr;Wc=1,Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.TranscriberConnectionFactory=void 0;const e=L(),t=P(),i=Y(),u=A(),n=U(),a=ie();let s=class extends i.ConnectionFactoryBase{constructor(){super(...arguments),this.multiaudioRelativeUri="/speech/recognition/multiaudio"}create(o,c,p){let h=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Endpoint,void 0);const v=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Region,"centralus"),d=i.ConnectionFactoryBase.getHostSuffix(v),f="wss://transcribe."+v+".cts.speech"+d+this.multiaudioRelativeUri,g=o.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Host,f),m={};this.setQueryParams(m,o,h),h||(h=g);const l={};c.token!==void 0&&c.token!==""&&(l[c.headerName]=c.token),l[n.HeaderNames.ConnectionId]=p,o.parameters.setProperty(t.PropertyId.SpeechServiceConnection_Url,h);const S=o.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return Promise.resolve(new e.WebsocketConnection(h,m,l,new u.WebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(o),S,p))}setQueryParams(o,c,p){const h=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_EndpointId,void 0),v=c.parameters.getProperty(t.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);h&&!(a.QueryParameterNames.CustomSpeechDeploymentId in o)&&(o[a.QueryParameterNames.CustomSpeechDeploymentId]=h),v&&!(a.QueryParameterNames.Language in o)&&(o[a.QueryParameterNames.Language]=v);const d=c.parameters.getProperty(t.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"false").toLowerCase()==="true",f=c.parameters.getProperty(u.OutputFormatPropertyName,t.OutputFormat[t.OutputFormat.Simple])!==t.OutputFormat[t.OutputFormat.Simple];(d||f)&&(o[a.QueryParameterNames.Format]=t.OutputFormat[t.OutputFormat.Detailed].toLowerCase()),this.setCommonUrlParams(c,o,p)}};return Nr.TranscriberConnectionFactory=s,Nr}var zr={},Hc;function _l(){if(Hc)return zr;Hc=1,Object.defineProperty(zr,"__esModule",{value:!0}),zr.TranslationConnectionFactory=void 0;const e=L(),t=Tp(),i=P(),u=Y(),n=A(),a=U(),s=ie(),r=V();let o=class extends u.ConnectionFactoryBase{constructor(){super(...arguments),this.universalUri="/stt/speech/universal/v2",this.translationV1Uri="/speech/translation/cognitiveservices/v1"}async create(p,h,v){let d=this.getEndpointUrl(p);const f={};if(this.setQueryParams(f,p,d),d){const S=new URL(d),C=S.pathname;(C===""||C==="/")&&(S.pathname=this.universalUri,d=await u.ConnectionFactoryBase.getRedirectUrlFromEndpoint(S.toString()))}const g={};h.token!==void 0&&h.token!==""&&(g[h.headerName]=h.token),g[a.HeaderNames.ConnectionId]=v,p.parameters.setProperty(i.PropertyId.SpeechServiceConnection_Url,d);const m=p.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new e.WebsocketConnection(d,f,g,new n.WebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(p),m,v)}getEndpointUrl(p,h){const v=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Region),d=u.ConnectionFactoryBase.getHostSuffix(v);let f=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Endpoint,void 0);return f?h===!0?f:t.StringUtils.formatString(f,{region:v}):(p.parameters.getProperty("SPEECH-ForceV1Endpoint","false")==="true"?f=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Host,"wss://{region}.s2s.speech"+d)+this.translationV1Uri:f=p.parameters.getProperty(i.PropertyId.SpeechServiceConnection_Host,"wss://{region}.stt.speech"+d)+this.universalUri,h===!0?f:t.StringUtils.formatString(f,{region:v}))}setQueryParams(p,h,v){p.from=h.parameters.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage),p.to=h.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationToLanguages),p.scenario=h.recognitionMode===r.RecognitionMode.Interactive?"interactive":h.recognitionMode===r.RecognitionMode.Conversation?"conversation":"",this.setCommonUrlParams(h,p,v),this.setUrlParameter(i.PropertyId.SpeechServiceResponse_TranslationRequestStablePartialResult,s.QueryParameterNames.StableTranslation,h,p,v);const d=h.parameters.getProperty(i.PropertyId.SpeechServiceConnection_TranslationVoice,void 0);d!==void 0&&(p.voice=d,p.features="requireVoice")}};return zr.TranslationConnectionFactory=o,zr}var jr={},Kc;function bl(){if(Kc)return jr;Kc=1,Object.defineProperty(jr,"__esModule",{value:!0}),jr.EnumTranslation=void 0;const e=P(),t=A();let i=class{static implTranslateRecognitionResult(n,a=!1){let s=e.ResultReason.Canceled;switch(n){case t.RecognitionStatus.Success:s=e.ResultReason.RecognizedSpeech;break;case t.RecognitionStatus.EndOfDictation:s=a?e.ResultReason.RecognizedSpeech:e.ResultReason.NoMatch;break;case t.RecognitionStatus.NoMatch:case t.RecognitionStatus.InitialSilenceTimeout:case t.RecognitionStatus.BabbleTimeout:s=e.ResultReason.NoMatch;break;case t.RecognitionStatus.Error:case t.RecognitionStatus.BadRequest:case t.RecognitionStatus.Forbidden:default:s=e.ResultReason.Canceled;break}return s}static implTranslateCancelResult(n){let a=e.CancellationReason.EndOfStream;switch(n){case t.RecognitionStatus.Success:case t.RecognitionStatus.EndOfDictation:case t.RecognitionStatus.NoMatch:a=e.CancellationReason.EndOfStream;break;case t.RecognitionStatus.InitialSilenceTimeout:case t.RecognitionStatus.BabbleTimeout:case t.RecognitionStatus.Error:case t.RecognitionStatus.BadRequest:case t.RecognitionStatus.Forbidden:default:a=e.CancellationReason.Error;break}return a}static implTranslateCancelErrorCode(n){let a=e.CancellationErrorCode.NoError;switch(n){case t.RecognitionStatus.Error:a=e.CancellationErrorCode.ServiceError;break;case t.RecognitionStatus.TooManyRequests:a=e.CancellationErrorCode.TooManyRequests;break;case t.RecognitionStatus.BadRequest:a=e.CancellationErrorCode.BadRequestParameters;break;case t.RecognitionStatus.Forbidden:a=e.CancellationErrorCode.Forbidden;break;default:a=e.CancellationErrorCode.NoError;break}return a}static implTranslateErrorDetails(n){let a="The speech service encountered an internal error and could not continue.";switch(n){case e.CancellationErrorCode.Forbidden:a="The recognizer is using a free subscription that ran out of quota.";break;case e.CancellationErrorCode.BadRequestParameters:a="Invalid parameter or unsupported audio format in the request.";break;case e.CancellationErrorCode.TooManyRequests:a="The number of parallel requests exceeded the number of allowed concurrent transcriptions.";break}return a}};return jr.EnumTranslation=i,jr}var Dn={},Vc;function Ml(){return Vc||(Vc=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RecognitionStatus=e.SynthesisStatus=void 0,(function(t){t[t.Success=0]="Success",t[t.SynthesisEnd=1]="SynthesisEnd",t[t.Error=2]="Error"})(e.SynthesisStatus||(e.SynthesisStatus={})),(function(t){t[t.Success=0]="Success",t[t.NoMatch=1]="NoMatch",t[t.InitialSilenceTimeout=2]="InitialSilenceTimeout",t[t.BabbleTimeout=3]="BabbleTimeout",t[t.Error=4]="Error",t[t.EndOfDictation=5]="EndOfDictation",t[t.TooManyRequests=6]="TooManyRequests",t[t.BadRequest=7]="BadRequest",t[t.Forbidden=8]="Forbidden"})(e.RecognitionStatus||(e.RecognitionStatus={}))})(Dn)),Dn}var Lr={},Jc;function Ol(){if(Jc)return Lr;Jc=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.TranslationSynthesisEnd=void 0;const e=A();let t=class Np{constructor(u){this.privSynthesisEnd=JSON.parse(u),this.privSynthesisEnd.SynthesisStatus&&(this.privSynthesisEnd.SynthesisStatus=e.SynthesisStatus[this.privSynthesisEnd.SynthesisStatus]),this.privSynthesisEnd.Status&&(this.privSynthesisEnd.SynthesisStatus=e.SynthesisStatus[this.privSynthesisEnd.Status])}static fromJSON(u){return new Np(u)}get SynthesisStatus(){return this.privSynthesisEnd.SynthesisStatus}get FailureReason(){return this.privSynthesisEnd.FailureReason}};return Lr.TranslationSynthesisEnd=t,Lr}var qr={},Gc;function Dl(){if(Gc)return qr;Gc=1,Object.defineProperty(qr,"__esModule",{value:!0}),qr.TranslationHypothesis=void 0;const e=b(),t=Yn();let i=class Qn{constructor(n,a){this.privTranslationHypothesis=n,this.privTranslationHypothesis.Offset+=a,this.privTranslationHypothesis.Translation.TranslationStatus=this.mapTranslationStatus(this.privTranslationHypothesis.Translation.TranslationStatus)}static fromJSON(n,a){return new Qn(JSON.parse(n),a)}static fromTranslationResponse(n,a){e.Contracts.throwIfNullOrUndefined(n,"translationHypothesis");const s=n.SpeechHypothesis;return n.SpeechHypothesis=void 0,s.Translation=n,new Qn(s,a)}get Duration(){return this.privTranslationHypothesis.Duration}get Offset(){return this.privTranslationHypothesis.Offset}get Text(){return this.privTranslationHypothesis.Text}get Translation(){return this.privTranslationHypothesis.Translation}get Language(){var n;return(n=this.privTranslationHypothesis.PrimaryLanguage)==null?void 0:n.Language}asJson(){const n={...this.privTranslationHypothesis};return n.Translation!==void 0?JSON.stringify({...n,TranslationStatus:t.TranslationStatus[n.Translation.TranslationStatus]}):JSON.stringify(n)}mapTranslationStatus(n){if(typeof n=="string")return t.TranslationStatus[n];if(typeof n=="number")return n}};return qr.TranslationHypothesis=i,qr}var Br={},Qc;function kl(){if(Qc)return Br;Qc=1,Object.defineProperty(Br,"__esModule",{value:!0}),Br.TranslationPhrase=void 0;const e=b(),t=A(),i=Yn();let u=class Xn{constructor(a,s){this.privTranslationPhrase=a,this.privTranslationPhrase.Offset+=s,this.privTranslationPhrase.RecognitionStatus=this.mapRecognitionStatus(this.privTranslationPhrase.RecognitionStatus),this.privTranslationPhrase.Translation!==void 0&&(this.privTranslationPhrase.Translation.TranslationStatus=this.mapTranslationStatus(this.privTranslationPhrase.Translation.TranslationStatus))}static fromJSON(a,s){return new Xn(JSON.parse(a),s)}static fromTranslationResponse(a,s){e.Contracts.throwIfNullOrUndefined(a,"translationResponse");const r=a.SpeechPhrase;return a.SpeechPhrase=void 0,r.Translation=a,r.Text=r.DisplayText,new Xn(r,s)}get RecognitionStatus(){return this.privTranslationPhrase.RecognitionStatus}get Offset(){return this.privTranslationPhrase.Offset}get Duration(){return this.privTranslationPhrase.Duration}get Text(){return this.privTranslationPhrase.Text}get Language(){var a;return(a=this.privTranslationPhrase.PrimaryLanguage)==null?void 0:a.Language}get Confidence(){var a;return(a=this.privTranslationPhrase.PrimaryLanguage)==null?void 0:a.Confidence}get Translation(){return this.privTranslationPhrase.Translation}asJson(){const a={...this.privTranslationPhrase},s={...a,RecognitionStatus:t.RecognitionStatus[a.RecognitionStatus]};return a.Translation&&(s.Translation={...a.Translation,TranslationStatus:i.TranslationStatus[a.Translation.TranslationStatus]}),JSON.stringify(s)}mapRecognitionStatus(a){if(typeof a=="string")return t.RecognitionStatus[a];if(typeof a=="number")return a}mapTranslationStatus(a){if(typeof a=="string")return i.TranslationStatus[a];if(typeof a=="number")return a}};return Br.TranslationPhrase=u,Br}var Fr={},Xc;function Nl(){if(Xc)return Fr;Xc=1,Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.TranslationServiceRecognizer=void 0;const e=I(),t=P(),i=A();let u=class extends i.ConversationServiceRecognizer{constructor(a,s,r,o,c){super(a,s,r,o,c),this.privTranslationRecognizer=c,this.connectionEvents.attach(p=>{p.name==="ConnectionEstablishedEvent"&&this.privTranslationRecognizer.onConnection()})}async processTypeSpecificMessages(a){const s=new t.PropertyCollection;let r=await this.processSpeechMessages(a);if(r)return!0;const o=async p=>{if(s.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,p.asJson()),this.privRequestSession.onPhraseRecognized(p.Offset+p.Duration),p.RecognitionStatus===i.RecognitionStatus.Success){const h=this.fireEventForResult(p,s);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,h)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(h.result)}catch(v){this.privErrorCallback&&this.privErrorCallback(v)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}else{const h=i.EnumTranslation.implTranslateRecognitionResult(p.RecognitionStatus),v=new t.TranslationRecognitionResult(void 0,this.privRequestSession.requestId,h,p.Text,p.Duration,p.Offset,p.Language,p.Confidence,void 0,p.asJson(),s);if(h===t.ResultReason.Canceled){const d=i.EnumTranslation.implTranslateCancelResult(p.RecognitionStatus),f=i.EnumTranslation.implTranslateCancelErrorCode(p.RecognitionStatus);await this.cancelRecognitionLocal(d,f,i.EnumTranslation.implTranslateErrorDetails(f))}else if(p.RecognitionStatus!==i.RecognitionStatus.EndOfDictation){const d=new t.TranslationRecognitionEventArgs(v,v.offset,this.privRequestSession.sessionId);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,d)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(v)}catch(f){this.privErrorCallback&&this.privErrorCallback(f)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}r=!0}},c=p=>{s.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,p.asJson());const h=this.fireEventForResult(p,s);if(this.privRequestSession.onHypothesis(h.offset),this.privTranslationRecognizer.recognizing)try{this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,h)}catch{}r=!0};switch(a.messageType===e.MessageType.Text&&s.setProperty(t.PropertyId.SpeechServiceResponse_JsonResult,a.textBody),a.path.toLowerCase()){case"translation.hypothesis":c(i.TranslationHypothesis.fromJSON(a.textBody,this.privRequestSession.currentTurnAudioOffset));break;case"translation.response":const p=JSON.parse(a.textBody);if(p.SpeechPhrase)await o(i.TranslationPhrase.fromTranslationResponse(p,this.privRequestSession.currentTurnAudioOffset));else{const v=JSON.parse(a.textBody);v.SpeechHypothesis&&c(i.TranslationHypothesis.fromTranslationResponse(v,this.privRequestSession.currentTurnAudioOffset))}break;case"translation.phrase":await o(i.TranslationPhrase.fromJSON(a.textBody,this.privRequestSession.currentTurnAudioOffset));break;case"translation.synthesis":case"audio":this.sendSynthesisAudio(a.binaryBody,this.privRequestSession.sessionId),r=!0;break;case"audio.end":case"translation.synthesis.end":const h=i.TranslationSynthesisEnd.fromJSON(a.textBody);switch(h.SynthesisStatus){case i.SynthesisStatus.Error:if(this.privTranslationRecognizer.synthesizing){const v=new t.TranslationSynthesisResult(t.ResultReason.Canceled,void 0),d=new t.TranslationSynthesisEventArgs(v,this.privRequestSession.sessionId);try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,d)}catch{}}if(this.privTranslationRecognizer.canceled){const v=new t.TranslationRecognitionCanceledEventArgs(this.privRequestSession.sessionId,t.CancellationReason.Error,h.FailureReason,t.CancellationErrorCode.ServiceError,null);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,v)}catch{}}break;case i.SynthesisStatus.Success:this.sendSynthesisAudio(void 0,this.privRequestSession.sessionId);break}r=!0;break}return r}cancelRecognition(a,s,r,o,c){const p=new t.PropertyCollection;if(p.setProperty(i.CancellationErrorCodePropertyName,t.CancellationErrorCode[o]),this.privTranslationRecognizer.canceled){const h=new t.TranslationRecognitionCanceledEventArgs(a,r,c,o,void 0);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,h)}catch{}}if(this.privSuccessCallback){const h=new t.TranslationRecognitionResult(void 0,s,t.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,c,void 0,p);try{this.privSuccessCallback(h),this.privSuccessCallback=void 0}catch{}}}handleRecognizingCallback(a,s,r){try{const o=new t.TranslationRecognitionEventArgs(t.TranslationRecognitionResult.fromSpeechRecognitionResult(a),s,r);this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,o)}catch{}}handleRecognizedCallback(a,s,r){try{const o=new t.TranslationRecognitionEventArgs(t.TranslationRecognitionResult.fromSpeechRecognitionResult(a),s,r);this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,o)}catch{}}fireEventForResult(a,s){let r;if(a.Translation.Translations!==void 0){r=new t.Translations;for(const d of a.Translation.Translations)r.set(d.Language,d.Text||d.DisplayText)}let o,c;a instanceof i.TranslationPhrase?(a.Translation&&a.Translation.TranslationStatus===e.TranslationStatus.Success?o=t.ResultReason.TranslatedSpeech:o=t.ResultReason.RecognizedSpeech,c=a.Confidence):o=t.ResultReason.TranslatingSpeech;const p=a.Language,h=new t.TranslationRecognitionResult(r,this.privRequestSession.requestId,o,a.Text,a.Duration,a.Offset,p,c,a.Translation.FailureReason,a.asJson(),s);return new t.TranslationRecognitionEventArgs(h,a.Offset,this.privRequestSession.sessionId)}sendSynthesisAudio(a,s){const r=a===void 0?t.ResultReason.SynthesizingAudioCompleted:t.ResultReason.SynthesizingAudio,o=new t.TranslationSynthesisResult(r,a),c=new t.TranslationSynthesisEventArgs(o,s);if(this.privTranslationRecognizer.synthesizing)try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,c)}catch{}}};return Fr.TranslationServiceRecognizer=u,Fr}var Ur={},Zc;function zl(){if(Zc)return Ur;Zc=1,Object.defineProperty(Ur,"__esModule",{value:!0}),Ur.SpeechDetected=void 0;let e=class zp{constructor(i,u){this.privSpeechStartDetected=JSON.parse(i),this.privSpeechStartDetected.Offset+=u}static fromJSON(i,u){return new zp(i,u)}get Offset(){return this.privSpeechStartDetected.Offset}};return Ur.SpeechDetected=e,Ur}var xr={},Yc;function jl(){if(Yc)return xr;Yc=1,Object.defineProperty(xr,"__esModule",{value:!0}),xr.SpeechHypothesis=void 0;let e=class jp{constructor(i,u){this.privSpeechHypothesis=JSON.parse(i),this.updateOffset(u)}static fromJSON(i,u){return new jp(i,u)}updateOffset(i){this.privSpeechHypothesis.Offset+=i}asJson(){return JSON.stringify(this.privSpeechHypothesis)}get Text(){return this.privSpeechHypothesis.Text}get Offset(){return this.privSpeechHypothesis.Offset}get Duration(){return this.privSpeechHypothesis.Duration}get Language(){return this.privSpeechHypothesis.PrimaryLanguage===void 0?void 0:this.privSpeechHypothesis.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privSpeechHypothesis.PrimaryLanguage===void 0?void 0:this.privSpeechHypothesis.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSpeechHypothesis.SpeakerId}};return xr.SpeechHypothesis=e,xr}var Wr={},$c;function Ll(){if($c)return Wr;$c=1,Object.defineProperty(Wr,"__esModule",{value:!0}),Wr.SpeechKeyword=void 0;let e=class Lp{constructor(i,u){this.privSpeechKeyword=JSON.parse(i),this.privSpeechKeyword.Offset+=u}static fromJSON(i,u){return new Lp(i,u)}get Status(){return this.privSpeechKeyword.Status}get Text(){return this.privSpeechKeyword.Text}get Offset(){return this.privSpeechKeyword.Offset}get Duration(){return this.privSpeechKeyword.Duration}asJson(){return JSON.stringify(this.privSpeechKeyword)}};return Wr.SpeechKeyword=e,Wr}var Hr={},eu;function ql(){if(eu)return Hr;eu=1,Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.SpeechServiceRecognizer=void 0;const e=P(),t=A();let i=class extends t.ServiceRecognizerBase{constructor(n,a,s,r,o){super(n,a,s,r,o),this.privSpeechRecognizer=o}async processTypeSpecificMessages(n){let a;const s=new e.PropertyCollection;let r=!1;switch(n.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":const o=t.SpeechHypothesis.fromJSON(n.textBody,this.privRequestSession.currentTurnAudioOffset);s.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,o.asJson()),a=new e.SpeechRecognitionResult(this.privRequestSession.requestId,e.ResultReason.RecognizingSpeech,o.Text,o.Duration,o.Offset,o.Language,o.LanguageDetectionConfidence,void 0,void 0,o.asJson(),s),this.privRequestSession.onHypothesis(o.Offset);const c=new e.SpeechRecognitionEventArgs(a,o.Offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognizing)try{this.privSpeechRecognizer.recognizing(this.privSpeechRecognizer,c)}catch{}r=!0;break;case"speech.phrase":const p=t.SimpleSpeechPhrase.fromJSON(n.textBody,this.privRequestSession.currentTurnAudioOffset);s.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,p.asJson());const h=t.EnumTranslation.implTranslateRecognitionResult(p.RecognitionStatus,this.privExpectContentAssessmentResponse);if(this.privRequestSession.onPhraseRecognized(p.Offset+p.Duration),e.ResultReason.Canceled===h){const v=t.EnumTranslation.implTranslateCancelResult(p.RecognitionStatus),d=t.EnumTranslation.implTranslateCancelErrorCode(p.RecognitionStatus);await this.cancelRecognitionLocal(v,d,t.EnumTranslation.implTranslateErrorDetails(d))}else{if(p.RecognitionStatus===t.RecognitionStatus.EndOfDictation)break;if(this.privRecognizerConfig.parameters.getProperty(t.OutputFormatPropertyName)===e.OutputFormat[e.OutputFormat.Simple])a=new e.SpeechRecognitionResult(this.privRequestSession.requestId,h,p.DisplayText,p.Duration,p.Offset,p.Language,p.LanguageDetectionConfidence,void 0,void 0,p.asJson(),s);else{const d=t.DetailedSpeechPhrase.fromJSON(n.textBody,this.privRequestSession.currentTurnAudioOffset);s.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,d.asJson()),a=new e.SpeechRecognitionResult(this.privRequestSession.requestId,h,d.RecognitionStatus===t.RecognitionStatus.Success?d.NBest[0].Display:"",d.Duration,d.Offset,d.Language,d.LanguageDetectionConfidence,void 0,void 0,d.asJson(),s)}const v=new e.SpeechRecognitionEventArgs(a,a.offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognized)try{this.privSpeechRecognizer.recognized(this.privSpeechRecognizer,v)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(a)}catch(d){this.privErrorCallback&&this.privErrorCallback(d)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}r=!0;break}return r}cancelRecognition(n,a,s,r,o){const c=new e.PropertyCollection;if(c.setProperty(t.CancellationErrorCodePropertyName,e.CancellationErrorCode[r]),this.privSpeechRecognizer.canceled){const p=new e.SpeechRecognitionCanceledEventArgs(s,o,r,void 0,n);try{this.privSpeechRecognizer.canceled(this.privSpeechRecognizer,p)}catch{}}if(this.privSuccessCallback){const p=new e.SpeechRecognitionResult(a,e.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,o,void 0,c);try{this.privSuccessCallback(p),this.privSuccessCallback=void 0}catch{}}}};return Hr.SpeechServiceRecognizer=i,Hr}var Kr={},kn={},tu;function Bl(){return tu||(tu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.IdentityProvider=e.SpeakerDiarizationMode=void 0,(function(t){t.None="None",t.Identity="Identity",t.Anonymous="Anonymous"})(e.SpeakerDiarizationMode||(e.SpeakerDiarizationMode={})),(function(t){t.CallCenter="CallCenter"})(e.IdentityProvider||(e.IdentityProvider={}))})(kn)),kn}var ru;function Fl(){if(ru)return Kr;ru=1,Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.ConversationTranscriptionServiceRecognizer=void 0;const e=P(),t=A(),i=Bl(),u=V();let n=class extends t.ServiceRecognizerBase{constructor(s,r,o,c,p){super(s,r,o,c,p),this.privConversationTranscriber=p,this.setSpeakerDiarizationJson()}setSpeakerDiarizationJson(){if(this.privEnableSpeakerId){const s=this.privSpeechContext.getContext().phraseDetection||{};s.mode=u.RecognitionMode.Conversation;const r={};r.mode=i.SpeakerDiarizationMode.Anonymous,r.audioSessionId=this.privDiarizationSessionId,r.audioOffsetMs=0,r.diarizeIntermediates=this.privRecognizerConfig.parameters.getProperty(e.PropertyId.SpeechServiceResponse_DiarizeIntermediateResults,"false")==="true",s.speakerDiarization=r,this.privSpeechContext.getContext().phraseDetection=s}}async processTypeSpecificMessages(s){let r;const o=new e.PropertyCollection;o.setProperty(e.PropertyId.SpeechServiceResponse_JsonResult,s.textBody);let c=!1;switch(s.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":const p=t.SpeechHypothesis.fromJSON(s.textBody,this.privRequestSession.currentTurnAudioOffset);r=new e.ConversationTranscriptionResult(this.privRequestSession.requestId,e.ResultReason.RecognizingSpeech,p.Text,p.Duration,p.Offset,p.Language,p.LanguageDetectionConfidence,p.SpeakerId,void 0,p.asJson(),o),this.privRequestSession.onHypothesis(p.Offset);const h=new e.ConversationTranscriptionEventArgs(r,p.Duration,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribing)try{this.privConversationTranscriber.transcribing(this.privConversationTranscriber,h)}catch{}c=!0;break;case"speech.phrase":const v=t.SimpleSpeechPhrase.fromJSON(s.textBody,this.privRequestSession.currentTurnAudioOffset),d=t.EnumTranslation.implTranslateRecognitionResult(v.RecognitionStatus);if(this.privRequestSession.onPhraseRecognized(v.Offset+v.Duration),e.ResultReason.Canceled===d){const f=t.EnumTranslation.implTranslateCancelResult(v.RecognitionStatus),g=t.EnumTranslation.implTranslateCancelErrorCode(v.RecognitionStatus);await this.cancelRecognitionLocal(f,g,t.EnumTranslation.implTranslateErrorDetails(g))}else if(!(this.privRequestSession.isSpeechEnded&&d===e.ResultReason.NoMatch&&v.RecognitionStatus!==t.RecognitionStatus.InitialSilenceTimeout)){if(this.privRecognizerConfig.parameters.getProperty(t.OutputFormatPropertyName)===e.OutputFormat[e.OutputFormat.Simple])r=new e.ConversationTranscriptionResult(this.privRequestSession.requestId,d,v.DisplayText,v.Duration,v.Offset,v.Language,v.LanguageDetectionConfidence,v.SpeakerId,void 0,v.asJson(),o);else{const g=t.DetailedSpeechPhrase.fromJSON(s.textBody,this.privRequestSession.currentTurnAudioOffset);r=new e.ConversationTranscriptionResult(this.privRequestSession.requestId,d,g.RecognitionStatus===t.RecognitionStatus.Success?g.NBest[0].Display:void 0,g.Duration,g.Offset,g.Language,g.LanguageDetectionConfidence,v.SpeakerId,void 0,g.asJson(),o)}const f=new e.ConversationTranscriptionEventArgs(r,r.offset,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribed)try{this.privConversationTranscriber.transcribed(this.privConversationTranscriber,f)}catch{}}c=!0;break}return c}cancelRecognition(s,r,o,c,p){if(new e.PropertyCollection().setProperty(t.CancellationErrorCodePropertyName,e.CancellationErrorCode[c]),this.privConversationTranscriber.canceled){const v=new e.ConversationTranscriptionCanceledEventArgs(o,p,c,void 0,s);try{this.privConversationTranscriber.canceled(this.privConversationTranscriber,v)}catch{}}}};return Kr.ConversationTranscriptionServiceRecognizer=n,Kr}var Vr={},iu;function Ul(){if(iu)return Vr;iu=1,Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.TranscriptionServiceRecognizer=void 0;const e=I(),t=P(),i=A(),u=wi();let n=class extends i.ConversationServiceRecognizer{constructor(s,r,o,c,p){super(s,r,o,c,p),this.privTranscriberRecognizer=p,this.sendPrePayloadJSONOverride=h=>this.sendTranscriptionStartJSON(h),this.privRecognizerConfig.parameters.getProperty(t.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps)==="true"&&this.privSpeechContext.setWordLevelTimings()}async sendSpeechEventAsync(s,r){if(this.privRequestSession.isRecognizing){const o=await this.fetchConnection();await this.sendSpeechEvent(o,this.createSpeechEventPayload(s,r))}}async sendMeetingSpeechEventAsync(s,r){if(this.privRequestSession.isRecognizing){const o=await this.fetchConnection();await this.sendSpeechEvent(o,this.createMeetingSpeechEventPayload(s,r))}}processTypeSpecificMessages(s){return this.processSpeechMessages(s)}handleRecognizedCallback(s,r,o){try{const c=new t.SpeechRecognitionEventArgs(s,r,o);if(this.privTranscriberRecognizer.recognized(this.privTranscriberRecognizer,c),this.privSuccessCallback){try{this.privSuccessCallback(s)}catch(p){this.privErrorCallback&&this.privErrorCallback(p)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}catch{}}handleRecognizingCallback(s,r,o){try{const c=new t.SpeechRecognitionEventArgs(s,r,o);this.privTranscriberRecognizer.recognizing(this.privTranscriberRecognizer,c)}catch{}}cancelRecognition(s,r,o,c,p){const h=new t.PropertyCollection;if(h.setProperty(i.CancellationErrorCodePropertyName,t.CancellationErrorCode[c]),this.privTranscriberRecognizer.IsMeetingRecognizer()){if(this.privTranscriberRecognizer.canceled){const v=new t.MeetingTranscriptionCanceledEventArgs(o,p,c,void 0,s);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,v)}catch{}}}else if(this.privTranscriberRecognizer.canceled){const v=new t.ConversationTranscriptionCanceledEventArgs(o,p,c,void 0,s);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,v)}catch{}}if(this.privSuccessCallback){const v=new t.SpeechRecognitionResult(r,t.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,p,void 0,h);try{this.privSuccessCallback(v),this.privSuccessCallback=void 0}catch{}}}async sendTranscriptionStartJSON(s){if(await this.sendSpeechContext(s,!0),this.privTranscriberRecognizer.IsMeetingRecognizer()){const r=this.privTranscriberRecognizer.getMeetingInfo(),o=this.createMeetingSpeechEventPayload(r,"start");await this.sendSpeechEvent(s,o)}else{const r=this.privTranscriberRecognizer.getConversationInfo(),o=this.createSpeechEventPayload(r,"start");await this.sendSpeechEvent(s,o)}await this.sendWaveHeader(s)}sendSpeechEvent(s,r){const o=JSON.stringify(r);if(o)return s.send(new u.SpeechConnectionMessage(e.MessageType.Text,"speech.event",this.privRequestSession.requestId,"application/json",o))}createSpeechEventPayload(s,r){const o={id:"meeting",name:r,meeting:s.conversationProperties};return o.meeting.id=s.id,o.meeting.attendees=s.participants,o}createMeetingSpeechEventPayload(s,r){const o={id:"meeting",name:r,meeting:s.meetingProperties};return o.meeting.id=s.id,o.meeting.attendees=s.participants,o}};return Vr.TranscriptionServiceRecognizer=n,Vr}var Jr={},nu;function xl(){if(nu)return Jr;nu=1,Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.DetailedSpeechPhrase=void 0;const e=A();let t=class qp{constructor(u,n){this.privDetailedSpeechPhrase=JSON.parse(u),this.privDetailedSpeechPhrase.RecognitionStatus=this.mapRecognitionStatus(this.privDetailedSpeechPhrase.RecognitionStatus),this.updateOffsets(n)}static fromJSON(u,n){return new qp(u,n)}updateOffsets(u){if(this.privDetailedSpeechPhrase.Offset+=u,this.privDetailedSpeechPhrase.NBest)for(const n of this.privDetailedSpeechPhrase.NBest){if(n.Words)for(const a of n.Words)a.Offset+=u;if(n.DisplayWords)for(const a of n.DisplayWords)a.Offset+=u}}asJson(){const u={...this.privDetailedSpeechPhrase};return JSON.stringify({...u,RecognitionStatus:e.RecognitionStatus[u.RecognitionStatus]})}get RecognitionStatus(){return this.privDetailedSpeechPhrase.RecognitionStatus}get NBest(){return this.privDetailedSpeechPhrase.NBest}get Duration(){return this.privDetailedSpeechPhrase.Duration}get Offset(){return this.privDetailedSpeechPhrase.Offset}get Language(){return this.privDetailedSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privDetailedSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Confidence}get Text(){return this.privDetailedSpeechPhrase.NBest&&this.privDetailedSpeechPhrase.NBest[0]?this.privDetailedSpeechPhrase.NBest[0].Display||this.privDetailedSpeechPhrase.NBest[0].DisplayText:this.privDetailedSpeechPhrase.DisplayText}get SpeakerId(){return this.privDetailedSpeechPhrase.SpeakerId}mapRecognitionStatus(u){if(typeof u=="string")return e.RecognitionStatus[u];if(typeof u=="number")return u}};return Jr.DetailedSpeechPhrase=t,Jr}var Gr={},su;function Wl(){if(su)return Gr;su=1,Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.SimpleSpeechPhrase=void 0;const e=A();let t=class Bp{constructor(u,n=0){this.privSimpleSpeechPhrase=JSON.parse(u),this.privSimpleSpeechPhrase.RecognitionStatus=this.mapRecognitionStatus(this.privSimpleSpeechPhrase.RecognitionStatus),this.updateOffset(n)}static fromJSON(u,n){return new Bp(u,n)}updateOffset(u){this.privSimpleSpeechPhrase.Offset+=u}asJson(){const u={...this.privSimpleSpeechPhrase};return JSON.stringify({...u,RecognitionStatus:e.RecognitionStatus[u.RecognitionStatus]})}get RecognitionStatus(){return this.privSimpleSpeechPhrase.RecognitionStatus}get DisplayText(){return this.privSimpleSpeechPhrase.DisplayText}get Offset(){return this.privSimpleSpeechPhrase.Offset}get Duration(){return this.privSimpleSpeechPhrase.Duration}get Language(){return this.privSimpleSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privSimpleSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSimpleSpeechPhrase.SpeakerId}mapRecognitionStatus(u){if(typeof u=="string")return e.RecognitionStatus[u];if(typeof u=="number")return u}};return Gr.SimpleSpeechPhrase=t,Gr}var Qr={},Xr={},ou;function Hl(){if(ou)return Xr;ou=1,Object.defineProperty(Xr,"__esModule",{value:!0}),Xr.ServiceTelemetryListener=void 0;const e=I(),t=es();class i{constructor(n,a,s){this.privIsDisposed=!1,this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privRequestId=n,this.privAudioSourceId=a,this.privAudioNodeId=s,this.privReceivedMessages={},this.privPhraseLatencies=[],this.privHypothesisLatencies=[]}phraseReceived(n){n>0&&this.privPhraseLatencies.push(Date.now()-n)}hypothesisReceived(n){n>0&&this.privHypothesisLatencies.push(Date.now()-n)}onEvent(n){this.privIsDisposed||(n instanceof t.RecognitionTriggeredEvent&&n.requestId===this.privRequestId&&(this.privListeningTriggerMetric={End:n.eventTime,Name:"ListeningTrigger",Start:n.eventTime}),n instanceof e.AudioStreamNodeAttachingEvent&&n.audioSourceId===this.privAudioSourceId&&n.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=n.eventTime),n instanceof e.AudioStreamNodeAttachedEvent&&n.audioSourceId===this.privAudioSourceId&&n.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=n.eventTime),n instanceof e.AudioSourceErrorEvent&&n.audioSourceId===this.privAudioSourceId&&(this.privMicMetric||(this.privMicMetric={End:n.eventTime,Error:n.error,Name:"Microphone",Start:this.privMicStartTime})),n instanceof e.AudioStreamNodeErrorEvent&&n.audioSourceId===this.privAudioSourceId&&n.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:n.eventTime,Error:n.error,Name:"Microphone",Start:this.privMicStartTime})),n instanceof e.AudioStreamNodeDetachedEvent&&n.audioSourceId===this.privAudioSourceId&&n.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:n.eventTime,Name:"Microphone",Start:this.privMicStartTime})),n instanceof t.ConnectingToServiceEvent&&n.requestId===this.privRequestId&&(this.privConnectionId=n.sessionId),n instanceof e.ConnectionStartEvent&&n.connectionId===this.privConnectionId&&(this.privConnectionStartTime=n.eventTime),n instanceof e.ConnectionEstablishedEvent&&n.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:n.eventTime,Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),n instanceof e.ConnectionEstablishErrorEvent&&n.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:n.eventTime,Error:this.getConnectionError(n.statusCode),Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),n instanceof e.ConnectionMessageReceivedEvent&&n.connectionId===this.privConnectionId&&n.message&&n.message.headers&&n.message.headers.path&&(this.privReceivedMessages[n.message.headers.path]||(this.privReceivedMessages[n.message.headers.path]=new Array),this.privReceivedMessages[n.message.headers.path].length<50&&this.privReceivedMessages[n.message.headers.path].push(n.networkReceivedTime)))}getTelemetry(){const n=new Array;this.privListeningTriggerMetric&&n.push(this.privListeningTriggerMetric),this.privMicMetric&&n.push(this.privMicMetric),this.privConnectionEstablishMetric&&n.push(this.privConnectionEstablishMetric),this.privPhraseLatencies.length>0&&n.push({PhraseLatencyMs:this.privPhraseLatencies}),this.privHypothesisLatencies.length>0&&n.push({FirstHypothesisLatencyMs:this.privHypothesisLatencies});const a={Metrics:n,ReceivedMessages:this.privReceivedMessages},s=JSON.stringify(a);return this.privReceivedMessages={},this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privPhraseLatencies=[],this.privHypothesisLatencies=[],s}get hasTelemetry(){return Object.keys(this.privReceivedMessages).length!==0||this.privListeningTriggerMetric!==null||this.privMicMetric!==null||this.privConnectionEstablishMetric!==null||this.privPhraseLatencies.length!==0||this.privHypothesisLatencies.length!==0}dispose(){this.privIsDisposed=!0}getConnectionError(n){switch(n){case 400:case 1002:case 1003:case 1005:case 1007:case 1008:case 1009:return"BadRequest";case 401:return"Unauthorized";case 403:return"Forbidden";case 503:case 1001:return"ServerUnavailable";case 500:case 1011:return"ServerError";case 408:case 504:return"Timeout";default:return"statuscode:"+n.toString()}}}return Xr.ServiceTelemetryListener=i,Xr}var au;function Kl(){if(au)return Qr;au=1,Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.RequestSession=void 0;const e=I(),t=es(),i=Hl();let u=class{constructor(a){this.privIsDisposed=!1,this.privDetachables=new Array,this.privIsAudioNodeDetached=!1,this.privIsRecognizing=!1,this.privIsSpeechEnded=!1,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privHypothesisReceived=!1,this.privBytesSent=0,this.privRecognitionBytesSent=0,this.privRecogNumber=0,this.privInTurn=!1,this.privConnectionAttempts=0,this.privAudioSourceId=a,this.privRequestId=(0,e.createNoDashGuid)(),this.privAudioNodeId=(0,e.createNoDashGuid)(),this.privTurnDeferral=new e.Deferred,this.privTurnDeferral.resolve()}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get audioNodeId(){return this.privAudioNodeId}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSpeechEnded(){return this.privIsSpeechEnded}get isRecognizing(){return this.privIsRecognizing}get currentTurnAudioOffset(){return this.privTurnStartAudioOffset}get recogNumber(){return this.privRecogNumber}get numConnectionAttempts(){return this.privConnectionAttempts}get bytesSent(){return this.privBytesSent}get recognitionBytesSent(){return this.privRecognitionBytesSent}listenForServiceTelemetry(a){this.privServiceTelemetryListener&&this.privDetachables.push(a.attachListener(this.privServiceTelemetryListener))}startNewRecognition(){this.privRecognitionBytesSent=0,this.privIsSpeechEnded=!1,this.privIsRecognizing=!0,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privRecogNumber++,this.privServiceTelemetryListener=new i.ServiceTelemetryListener(this.privRequestId,this.privAudioSourceId,this.privAudioNodeId),this.onEvent(new t.RecognitionTriggeredEvent(this.requestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}async onAudioSourceAttachCompleted(a,s){this.privAudioNode=a,this.privIsAudioNodeDetached=!1,s?await this.onComplete():this.onEvent(new t.ListeningStartedEvent(this.privRequestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}onPreConnectionStart(a,s){this.privAuthFetchEventId=a,this.privSessionId=s,this.onEvent(new t.ConnectingToServiceEvent(this.privRequestId,this.privAuthFetchEventId,this.privSessionId))}async onAuthCompleted(a){a&&await this.onComplete()}async onConnectionEstablishCompleted(a,s){if(a===200){this.onEvent(new t.RecognitionStartedEvent(this.requestId,this.privAudioSourceId,this.privAudioNodeId,this.privAuthFetchEventId,this.privSessionId)),this.privAudioNode&&this.privAudioNode.replay(),this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privBytesSent=0;return}else a===403&&await this.onComplete()}async onServiceTurnEndResponse(a){this.privTurnDeferral.resolve(),!a||this.isSpeechEnded?(await this.onComplete(),this.privInTurn=!1):(this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privAudioNode.replay())}onSpeechContext(){this.privRequestId=(0,e.createNoDashGuid)()}onServiceTurnStartResponse(){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new e.Deferred}onHypothesis(a){this.privHypothesisReceived||(this.privHypothesisReceived=!0,this.privServiceTelemetryListener.hypothesisReceived(this.privAudioNode.findTimeAtOffset(a)))}onPhraseRecognized(a){this.privServiceTelemetryListener.phraseReceived(this.privAudioNode.findTimeAtOffset(a)),this.onServiceRecognized(a)}onServiceRecognized(a){this.privLastRecoOffset=a,this.privHypothesisReceived=!1,this.privAudioNode.shrinkBuffers(a),this.privConnectionAttempts=0}onAudioSent(a){this.privBytesSent+=a,this.privRecognitionBytesSent+=a}onRetryConnection(){this.privConnectionAttempts++}async dispose(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(const a of this.privDetachables)await a.detach();this.privServiceTelemetryListener&&this.privServiceTelemetryListener.dispose(),this.privIsRecognizing=!1}}getTelemetry(){return this.privServiceTelemetryListener.hasTelemetry?this.privServiceTelemetryListener.getTelemetry():null}async onStopRecognizing(){await this.onComplete()}onSpeechEnded(){this.privIsSpeechEnded=!0}onEvent(a){this.privServiceTelemetryListener&&this.privServiceTelemetryListener.onEvent(a),e.Events.instance.onEvent(a)}async onComplete(){this.privIsRecognizing&&(this.privIsRecognizing=!1,await this.detachAudioNode())}async detachAudioNode(){this.privIsAudioNodeDetached||(this.privIsAudioNodeDetached=!0,this.privAudioNode&&await this.privAudioNode.detach())}};return Qr.RequestSession=u,Qr}var Zr={},Nn={},cu;function Vl(){return cu||(cu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TentativePhraseResultsOption=e.OutputFormat=e.PhraseExtension=e.PhraseOption=void 0,(function(t){t.WordTimings="WordTimings",t.SNR="SNR",t.Pronunciation="Pronunciation",t.WordPronunciation="WordPronunciation",t.WordConfidence="WordConfidence",t.Words="Words",t.Sentiment="Sentiment",t.PronunciationAssessment="PronunciationAssessment",t.ContentAssessment="ContentAssessment",t.PhraseAMScore="PhraseAMScore",t.PhraseLMScore="PhraseLMScore",t.WordAMScore="WordAMScore",t.WordLMScore="WordLMScore",t.RuleTree="RuleTree",t.NBestTimings="NBestTimings",t.DecoderDiagnostics="DecoderDiagnostics",t.DisplayWordTimings="DisplayWordTimings",t.DisplayWords="DisplayWords"})(e.PhraseOption||(e.PhraseOption={})),(function(t){t.Graph="Graph",t.Corrections="Corrections",t.Sentiment="Sentiment"})(e.PhraseExtension||(e.PhraseExtension={})),(function(t){t.Simple="Simple",t.Detailed="Detailed"})(e.OutputFormat||(e.OutputFormat={})),(function(t){t.None="None",t.Always="Always"})(e.TentativePhraseResultsOption||(e.TentativePhraseResultsOption={}))})(Nn)),Nn}var uu;function Jl(){if(uu)return Zr;uu=1,Object.defineProperty(Zr,"__esModule",{value:!0}),Zr.SpeechContext=void 0;const e=V(),t=Vl();let i=class{constructor(n){this.privContext={},this.privDynamicGrammar=n}getContext(){return this.privContext}setPronunciationAssessmentParams(n,a=!1){this.privContext.phraseDetection===void 0&&(this.privContext.phraseDetection={enrichment:{pronunciationAssessment:{}}}),this.privContext.phraseDetection.enrichment===void 0&&(this.privContext.phraseDetection.enrichment={pronunciationAssessment:{}}),this.privContext.phraseDetection.enrichment.pronunciationAssessment=JSON.parse(n)||{},a&&(this.privContext.phraseDetection.mode=e.RecognitionMode.Conversation),this.setWordLevelTimings(),this.privContext.phraseOutput.detailed.options.push(t.PhraseOption.PronunciationAssessment),this.privContext.phraseOutput.detailed.options.indexOf(t.PhraseOption.SNR)===-1&&this.privContext.phraseOutput.detailed.options.push(t.PhraseOption.SNR)}setDetailedOutputFormat(){this.privContext.phraseOutput===void 0&&(this.privContext.phraseOutput={detailed:{options:[]}}),this.privContext.phraseOutput.detailed===void 0&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format=t.OutputFormat.Detailed}setWordLevelTimings(){this.privContext.phraseOutput===void 0&&(this.privContext.phraseOutput={detailed:{options:[]}}),this.privContext.phraseOutput.detailed===void 0&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format=t.OutputFormat.Detailed,this.privContext.phraseOutput.detailed.options.indexOf(t.PhraseOption.WordTimings)===-1&&this.privContext.phraseOutput.detailed.options.push(t.PhraseOption.WordTimings)}setSpeakerDiarizationAudioOffsetMs(n){this.privContext.phraseDetection.speakerDiarization.audioOffsetMs=n}toJSON(){const n=this.privDynamicGrammar.generateGrammarObject();return this.privContext.dgi=n,JSON.stringify(this.privContext)}};return Zr.SpeechContext=i,Zr}var Yr={},zn={},pu;function Gl(){return pu||(pu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SubstringMatchType=e.GroupType=void 0,(function(t){t.IntentText="IntentText",t.IntentEntity="IntentEntity",t.Generic="Generic",t.People="People",t.Place="Place",t.DynamicEntity="DynamicEntity"})(e.GroupType||(e.GroupType={})),(function(t){t.None="None",t.LeftRooted="LeftRooted",t.PartialName="PartialName",t.MiddleOfSentence="MiddleOfSentence"})(e.SubstringMatchType||(e.SubstringMatchType={}))})(zn)),zn}var hu;function Ql(){if(hu)return Yr;hu=1,Object.defineProperty(Yr,"__esModule",{value:!0}),Yr.DynamicGrammarBuilder=void 0;const e=Gl();let t=class{constructor(){this.privWeight=1}addPhrase(u){this.privPhrases||(this.privPhrases=[]),u instanceof Array?this.privPhrases=this.privPhrases.concat(u):this.privPhrases.push(u)}clearPhrases(){this.privPhrases=void 0}addReferenceGrammar(u){this.privGrammars||(this.privGrammars=[]),u instanceof Array?this.privGrammars=this.privGrammars.concat(u):this.privGrammars.push(u)}clearGrammars(){this.privGrammars=void 0}setWeight(u){this.privWeight=u}generateGrammarObject(){if(this.privGrammars===void 0&&this.privPhrases===void 0)return;const u={};if(u.referenceGrammars=this.privGrammars,this.privPhrases!==void 0&&this.privPhrases.length!==0){const n=[];this.privPhrases.forEach(a=>{n.push({text:a})}),u.groups=[{type:e.GroupType.Generic,items:n}],u.bias=this.privWeight}return u}};return Yr.DynamicGrammarBuilder=t,Yr}var $r={},ei={},ti={},jn={},du;function Fp(){return du||(du=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MessageDataStreamType=e.ActivityPayloadResponse=void 0;class t{constructor(u){this.privActivityResponse=JSON.parse(u)}static fromJSON(u){return new t(u)}get conversationId(){return this.privActivityResponse.conversationId}get messageDataStreamType(){return this.privActivityResponse.messageDataStreamType}get messagePayload(){return this.privActivityResponse.messagePayload}get version(){return this.privActivityResponse.version}}e.ActivityPayloadResponse=t,(function(i){i[i.None=0]="None",i[i.TextToSpeechAudio=1]="TextToSpeechAudio"})(e.MessageDataStreamType||(e.MessageDataStreamType={}))})(jn)),jn}var vu;function Xl(){if(vu)return ti;vu=1,Object.defineProperty(ti,"__esModule",{value:!0}),ti.DialogServiceTurnState=void 0;const e=yi(),t=_e(),i=Fp();let u=class{constructor(a,s){this.privRequestId=s,this.privIsCompleted=!1,this.privAudioStream=null,this.privTurnManager=a,this.resetTurnEndTimeout()}get audioStream(){return this.resetTurnEndTimeout(),this.privAudioStream}processActivityPayload(a,s){return a.messageDataStreamType===i.MessageDataStreamType.TextToSpeechAudio&&(this.privAudioStream=t.AudioOutputStream.createPullStream(),this.privAudioStream.format=s!==void 0?s:e.AudioOutputFormatImpl.getDefaultOutputFormat()),this.privAudioStream}endAudioStream(){this.privAudioStream!==null&&!this.privAudioStream.isClosed&&this.privAudioStream.close()}complete(){this.privTimeoutToken!==void 0&&clearTimeout(this.privTimeoutToken),this.endAudioStream()}resetTurnEndTimeout(){this.privTimeoutToken!==void 0&&clearTimeout(this.privTimeoutToken),this.privTimeoutToken=setTimeout(()=>{this.privTurnManager.CompleteTurn(this.privRequestId)},2e3)}};return ti.DialogServiceTurnState=u,ti}var lu;function Zl(){if(lu)return ei;lu=1,Object.defineProperty(ei,"__esModule",{value:!0}),ei.DialogServiceTurnStateManager=void 0;const e=J(),t=Xl();let i=class{constructor(){this.privTurnMap=new Map}StartTurn(n){if(this.privTurnMap.has(n))throw new e.InvalidOperationError("Service error: There is already a turn with id:"+n);const a=new t.DialogServiceTurnState(this,n);return this.privTurnMap.set(n,a),this.privTurnMap.get(n)}GetTurn(n){return this.privTurnMap.get(n)}CompleteTurn(n){if(!this.privTurnMap.has(n))throw new e.InvalidOperationError("Service error: Received turn end for an unknown turn id:"+n);const a=this.privTurnMap.get(n);return a.complete(),this.privTurnMap.delete(n),a}};return ei.DialogServiceTurnStateManager=i,ei}var Ln={},fu;function Yl(){return fu||(fu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.InvocationSource=void 0,(function(t){t.None="None",t.VoiceActivationWithKeyword="VoiceActivationWithKeyword"})(e.InvocationSource||(e.InvocationSource={}))})(Ln)),Ln}var qn={},gu;function $l(){return gu||(gu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.OnRejectAction=e.KeywordDetectionType=void 0,(function(t){t.StartTrigger="StartTrigger"})(e.KeywordDetectionType||(e.KeywordDetectionType={})),(function(t){t.EndOfTurn="EndOfTurn",t.Continue="Continue"})(e.OnRejectAction||(e.OnRejectAction={}))})(qn)),qn}var mu;function ef(){if(mu)return $r;mu=1,Object.defineProperty($r,"__esModule",{value:!0}),$r.DialogServiceAdapter=void 0;const e=L(),t=Zu(),i=I(),u=yi(),n=P(),a=Zl(),s=A(),r=Fp(),o=Yl(),c=$l(),p=wi();let h=class extends s.ServiceRecognizerBase{constructor(d,f,g,m,l){super(d,f,g,m,l),this.privEvents=new i.EventSource,this.privDialogServiceConnector=l,this.receiveMessageOverride=()=>this.receiveDialogMessageOverride(),this.privTurnStateManager=new a.DialogServiceTurnStateManager,this.recognizeOverride=(S,C,y)=>this.listenOnce(S,C,y),this.postConnectImplOverride=S=>this.dialogConnectImpl(S),this.configConnectionOverride=S=>this.configConnection(S),this.disconnectOverride=()=>this.privDisconnect(),this.privDialogAudioSource=g,this.agentConfigSent=!1,this.privLastResult=null,this.connectionEvents.attach(S=>{S.name==="ConnectionClosedEvent"&&(this.terminateMessageLoop=!0)})}async sendMessage(d){const f=(0,i.createGuid)(),g=(0,i.createNoDashGuid)(),m={context:{interactionId:f},messagePayload:JSON.parse(d),version:.5},l=JSON.stringify(m);await(await this.fetchConnection()).send(new p.SpeechConnectionMessage(i.MessageType.Text,"agent",g,"application/json",l))}async privDisconnect(){await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,this.agentConfigSent=!1}processTypeSpecificMessages(d){const f=new n.PropertyCollection;d.messageType===i.MessageType.Text&&f.setProperty(n.PropertyId.SpeechServiceResponse_JsonResult,d.textBody);let g,m;switch(d.path.toLowerCase()){case"speech.phrase":const S=s.SimpleSpeechPhrase.fromJSON(d.textBody,this.privRequestSession.currentTurnAudioOffset);if(this.privRequestSession.onPhraseRecognized(S.Offset+S.Duration),S.RecognitionStatus!==s.RecognitionStatus.TooManyRequests&&S.RecognitionStatus!==s.RecognitionStatus.Error){const w=this.fireEventForResult(S,f);if(this.privLastResult=w.result,this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,w)}catch{}}m=!0;break;case"speech.hypothesis":const C=s.SpeechHypothesis.fromJSON(d.textBody,this.privRequestSession.currentTurnAudioOffset);g=new n.SpeechRecognitionResult(this.privRequestSession.requestId,n.ResultReason.RecognizingSpeech,C.Text,C.Duration,C.Offset,C.Language,C.LanguageDetectionConfidence,void 0,void 0,C.asJson(),f),this.privRequestSession.onHypothesis(C.Offset);const y=new n.SpeechRecognitionEventArgs(g,C.Offset,this.privRequestSession.sessionId);if(this.privDialogServiceConnector.recognizing)try{this.privDialogServiceConnector.recognizing(this.privDialogServiceConnector,y)}catch{}m=!0;break;case"speech.keyword":const R=s.SpeechKeyword.fromJSON(d.textBody,this.privRequestSession.currentTurnAudioOffset);g=new n.SpeechRecognitionResult(this.privRequestSession.requestId,R.Status==="Accepted"?n.ResultReason.RecognizedKeyword:n.ResultReason.NoMatch,R.Text,R.Duration,R.Offset,void 0,void 0,void 0,void 0,R.asJson(),f),R.Status!=="Accepted"&&(this.privLastResult=g);const T=new n.SpeechRecognitionEventArgs(g,g.duration,g.resultId);if(this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,T)}catch{}m=!0;break;case"audio":{const w=d.requestId.toUpperCase(),E=this.privTurnStateManager.GetTurn(w);try{d.binaryBody?E.audioStream.write(d.binaryBody):E.endAudioStream()}catch{}}m=!0;break;case"response":this.handleResponseMessage(d),m=!0;break}const l=new i.Deferred;return l.resolve(m),l.promise}async cancelRecognition(d,f,g,m,l){if(this.terminateMessageLoop=!0,this.privRequestSession.isRecognizing&&await this.privRequestSession.onStopRecognizing(),this.privDialogServiceConnector.canceled){const S=new n.PropertyCollection;S.setProperty(s.CancellationErrorCodePropertyName,n.CancellationErrorCode[m]);const C=new n.SpeechRecognitionCanceledEventArgs(g,l,m,void 0,d);try{this.privDialogServiceConnector.canceled(this.privDialogServiceConnector,C)}catch{}if(this.privSuccessCallback){const y=new n.SpeechRecognitionResult(void 0,n.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,l,void 0,S);try{this.privSuccessCallback(y),this.privSuccessCallback=void 0}catch{}}}}async listenOnce(d,f,g){this.privRecognizerConfig.recognitionMode=d,this.privSuccessCallback=f,this.privErrorCallback=g,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privDialogAudioSource.events),this.privRecognizerConfig.parameters.setProperty(n.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);const m=this.connectImpl(),l=this.sendPreAudioMessages(),S=await this.privDialogAudioSource.attach(this.privRequestSession.audioNodeId),C=await this.privDialogAudioSource.format,y=await this.privDialogAudioSource.deviceInfo,R=new e.ReplayableAudioNode(S,C.avgBytesPerSec);await this.privRequestSession.onAudioSourceAttachCompleted(R,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:y};try{await m,await l}catch(E){return await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.ConnectionFailure,E),Promise.resolve()}const T=new n.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,T),this.sendAudio(R).then(()=>{},async E=>{await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.RuntimeError,E)})}dialogConnectImpl(d){return this.privConnectionLoop=this.startMessageLoop(),d}receiveDialogMessageOverride(){const d=new i.Deferred,f=async()=>{try{const g=this.isDisposed(),m=!this.isDisposed()&&this.terminateMessageLoop;if(g||m){d.resolve(void 0);return}const S=await(await this.fetchConnection()).read();if(!S)return f();const C=p.SpeechConnectionMessage.fromConnectionMessage(S);switch(C.path.toLowerCase()){case"turn.start":{const O=C.requestId.toUpperCase(),x=this.privRequestSession.requestId.toUpperCase();O!==x?this.privTurnStateManager.StartTurn(O):this.privRequestSession.onServiceTurnStartResponse()}break;case"speech.startdetected":const R=s.SpeechDetected.fromJSON(C.textBody,this.privRequestSession.currentTurnAudioOffset),T=new n.RecognitionEventArgs(R.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,T);break;case"speech.enddetected":let w;C.textBody.length>0?w=C.textBody:w="{ Offset: 0 }";const E=s.SpeechDetected.fromJSON(w,this.privRequestSession.currentTurnAudioOffset);this.privRequestSession.onServiceRecognized(E.Offset);const M=new n.RecognitionEventArgs(E.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,M);break;case"turn.end":{const O=C.requestId.toUpperCase(),x=this.privRequestSession.requestId.toUpperCase();if(O!==x)this.privTurnStateManager.CompleteTurn(O);else{const Ie=new n.SessionEventArgs(this.privRequestSession.sessionId);if(await this.privRequestSession.onServiceTurnEndResponse(!1),(!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing)&&this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,Ie),this.privSuccessCallback&&this.privLastResult){try{this.privSuccessCallback(this.privLastResult),this.privLastResult=null}catch(N){this.privErrorCallback&&this.privErrorCallback(N)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}}break;default:try{await this.processTypeSpecificMessages(C)||this.serviceEvents&&this.serviceEvents.onEvent(new i.ServiceEvent(C.path.toLowerCase(),C.textBody))}catch{}}return f()}catch{this.terminateMessageLoop=!0,d.resolve()}};return f().catch(g=>{i.Events.instance.onEvent(new i.BackgroundEvent(g))}),d.promise}async startMessageLoop(){this.terminateMessageLoop=!1;try{await this.receiveDialogMessageOverride()}catch(d){await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,n.CancellationReason.Error,n.CancellationErrorCode.RuntimeError,d)}return Promise.resolve()}async configConnection(d){return this.terminateMessageLoop?(this.terminateMessageLoop=!1,Promise.reject("Connection to service terminated.")):(await this.sendSpeechServiceConfig(d,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),await this.sendAgentConfig(d),d)}async sendPreAudioMessages(){const d=await this.fetchConnection();this.addKeywordContextData(),await this.sendSpeechContext(d,!0),await this.sendAgentContext(d),await this.sendWaveHeader(d)}sendAgentConfig(d){if(this.agentConfig&&!this.agentConfigSent){if(this.privRecognizerConfig.parameters.getProperty(n.PropertyId.Conversation_DialogType)===n.DialogServiceConfig.DialogTypes.CustomCommands){const g=this.agentConfig.get();g.botInfo.commandsCulture=this.privRecognizerConfig.parameters.getProperty(n.PropertyId.SpeechServiceConnection_RecoLanguage,"en-us"),this.agentConfig.set(g)}this.onEvent(new t.SendingAgentContextMessageEvent(this.agentConfig));const f=this.agentConfig.toJsonString();return this.agentConfigSent=!0,d.send(new p.SpeechConnectionMessage(i.MessageType.Text,"agent.config",this.privRequestSession.requestId,"application/json",f))}}sendAgentContext(d){const f=(0,i.createGuid)(),g=this.privDialogServiceConnector.properties.getProperty(n.PropertyId.Conversation_Speech_Activity_Template),l=JSON.stringify({channelData:"",context:{interactionId:f},messagePayload:typeof g===void 0?void 0:g,version:.5});return d.send(new p.SpeechConnectionMessage(i.MessageType.Text,"speech.agent.context",this.privRequestSession.requestId,"application/json",l))}fireEventForResult(d,f){const g=s.EnumTranslation.implTranslateRecognitionResult(d.RecognitionStatus),m=new n.SpeechRecognitionResult(this.privRequestSession.requestId,g,d.DisplayText,d.Duration,d.Offset,d.Language,d.LanguageDetectionConfidence,void 0,void 0,d.asJson(),f);return new n.SpeechRecognitionEventArgs(m,d.Offset,this.privRequestSession.sessionId)}handleResponseMessage(d){const f=JSON.parse(d.textBody);switch(f.messageType.toLowerCase()){case"message":const g=d.requestId.toUpperCase(),m=r.ActivityPayloadResponse.fromJSON(d.textBody),l=this.privTurnStateManager.GetTurn(g);if(m.conversationId){const y=this.agentConfig.get();y.botInfo.conversationId=m.conversationId,this.agentConfig.set(y)}const S=l.processActivityPayload(m,u.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormatString(this.privDialogServiceConnector.properties.getProperty(n.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0))),C=new n.ActivityReceivedEventArgs(m.messagePayload,S);if(this.privDialogServiceConnector.activityReceived)try{this.privDialogServiceConnector.activityReceived(this.privDialogServiceConnector,C)}catch{}break;case"messagestatus":if(this.privDialogServiceConnector.turnStatusReceived)try{this.privDialogServiceConnector.turnStatusReceived(this.privDialogServiceConnector,new n.TurnStatusReceivedEventArgs(d.textBody))}catch{}break;default:i.Events.instance.onEvent(new i.BackgroundEvent(`Unexpected response of type ${f.messageType}. Ignoring.`));break}}onEvent(d){this.privEvents.onEvent(d),i.Events.instance.onEvent(d)}addKeywordContextData(){const d=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect");if(d===void 0)return;const f=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Offsets"),g=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Durations"),m=d.split(";"),l=f===void 0?[]:f.split(";"),S=g===void 0?[]:g.split(";"),C=[];for(let y=0;y<m.length;y++){const R={text:m[y]};y<l.length&&(R.startOffset=Number(l[y])),y<S.length&&(R.duration=Number(S[y])),C.push(R)}this.speechContext.getContext().invocationSource=o.InvocationSource.VoiceActivationWithKeyword,this.speechContext.getContext().keywordDetection=[{clientDetectedKeywords:C,onReject:{action:c.OnRejectAction.EndOfTurn},type:c.KeywordDetectionType.StartTrigger}]}};return $r.DialogServiceAdapter=h,$r}var ri={},Su;function tf(){if(Su)return ri;Su=1,Object.defineProperty(ri,"__esModule",{value:!0}),ri.AgentConfig=void 0;let e=class{toJsonString(){return JSON.stringify(this.iPrivConfig)}get(){return this.iPrivConfig}set(i){this.iPrivConfig=i}};return ri.AgentConfig=e,ri}var Bn={},ii={},ni={},Cu;function ss(){if(Cu)return ni;Cu=1,Object.defineProperty(ni,"__esModule",{value:!0}),ni.ConversationConnectionConfig=void 0;const e=kp();let t=class re extends e.RestConfigBase{static get host(){return re.privHost}static get apiVersion(){return re.privApiVersion}static get clientAppId(){return re.privClientAppId}static get defaultLanguageCode(){return re.privDefaultLanguageCode}static get restPath(){return re.privRestPath}static get webSocketPath(){return re.privWebSocketPath}static get transcriptionEventKeys(){return re.privTranscriptionEventKeys}};return ni.ConversationConnectionConfig=t,t.privHost="dev.microsofttranslator.com",t.privRestPath="/capito/room",t.privApiVersion="2.0",t.privDefaultLanguageCode="en-US",t.privClientAppId="FC539C22-1767-4F1F-84BC-B4D811114F15",t.privWebSocketPath="/capito/translate",t.privTranscriptionEventKeys=["iCalUid","callId","organizer","FLAC","MTUri","DifferentiateGuestSpeakers","audiorecording","Threadid","OrganizerMri","OrganizerTenantId","UserToken"],ni}var yu;function rf(){if(yu)return ii;yu=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.ConversationManager=void 0;const e=L(),t=b(),i=P(),u=ss();let n=class{constructor(){this.privRequestParams=u.ConversationConnectionConfig.configParams,this.privErrors=u.ConversationConnectionConfig.restErrors,this.privHost=u.ConversationConnectionConfig.host,this.privApiVersion=u.ConversationConnectionConfig.apiVersion,this.privRestPath=u.ConversationConnectionConfig.restPath,this.privRestAdapter=new e.RestMessageAdapter({})}createOrJoin(s,r,o,c){try{t.Contracts.throwIfNullOrUndefined(s,"args");const p=s.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage,u.ConversationConnectionConfig.defaultLanguageCode),h=s.getProperty(i.PropertyId.ConversationTranslator_Name,"conversation_host"),v=s.getProperty(i.PropertyId.ConversationTranslator_Host,this.privHost),d=s.getProperty(i.PropertyId.ConversationTranslator_CorrelationId),f=s.getProperty(i.PropertyId.SpeechServiceConnection_Key),g=s.getProperty(i.PropertyId.SpeechServiceConnection_Region),m=s.getProperty(i.PropertyId.SpeechServiceAuthorization_Token);t.Contracts.throwIfNullOrWhitespace(p,"languageCode"),t.Contracts.throwIfNullOrWhitespace(h,"nickname"),t.Contracts.throwIfNullOrWhitespace(v,"endpointHost");const l={};l[this.privRequestParams.apiVersion]=this.privApiVersion,l[this.privRequestParams.languageCode]=p,l[this.privRequestParams.nickname]=h;const S={};d&&(S[this.privRequestParams.correlationId]=d),S[this.privRequestParams.clientAppId]=u.ConversationConnectionConfig.clientAppId,r!==void 0?l[this.privRequestParams.roomId]=r:(t.Contracts.throwIfNullOrUndefined(g,this.privErrors.authInvalidSubscriptionRegion),S[this.privRequestParams.subscriptionRegion]=g,f?S[this.privRequestParams.subscriptionKey]=f:m?S[this.privRequestParams.authorization]=`Bearer ${m}`:t.Contracts.throwIfNullOrUndefined(f,this.privErrors.authInvalidSubscriptionKey));const C={};C.headers=S,this.privRestAdapter.options=C;const y=`https://${v}${this.privRestPath}`;this.privRestAdapter.request(e.RestRequestType.Post,y,l,null).then(R=>{const T=e.RestMessageAdapter.extractHeaderValue(this.privRequestParams.requestId,R.headers);if(!R.ok){if(c){let E=this.privErrors.invalidCreateJoinConversationResponse.replace("{status}",R.status.toString()),M;try{M=JSON.parse(R.data),E+=` [${M.error.code}: ${M.error.message}]`}catch{E+=` [${R.data}]`}T&&(E+=` ${T}`),c(E)}return}const w=JSON.parse(R.data);if(w&&(w.requestId=T),o){try{o(w)}catch(E){c&&c(E)}o=void 0}}).catch(()=>{})}catch(p){if(c)if(p instanceof Error){const h=p;c(h.name+": "+h.message)}else c(p)}}leave(s,r){return new Promise((o,c)=>{try{t.Contracts.throwIfNullOrUndefined(s,this.privErrors.invalidArgs.replace("{arg}","config")),t.Contracts.throwIfNullOrWhitespace(r,this.privErrors.invalidArgs.replace("{arg}","token"));const p=s.getProperty(i.PropertyId.ConversationTranslator_Host,this.privHost),h=s.getProperty(i.PropertyId.ConversationTranslator_CorrelationId),v={};v[this.privRequestParams.apiVersion]=this.privApiVersion,v[this.privRequestParams.sessionToken]=r;const d={};h&&(d[this.privRequestParams.correlationId]=h);const f={};f.headers=d,this.privRestAdapter.options=f;const g=`https://${p}${this.privRestPath}`;this.privRestAdapter.request(e.RestRequestType.Delete,g,v,null).then(m=>{m.ok,o()}).catch(()=>{})}catch(p){if(p instanceof Error){const h=p;c(h.name+": "+h.message)}else c(p)}})}};return ii.ConversationManager=n,ii}var Ce={},si={},oi={},ai={},Ru;function Up(){if(Ru)return ai;Ru=1,Object.defineProperty(ai,"__esModule",{value:!0}),ai.ConversationConnectionMessage=void 0;const e=I();let t=class extends e.ConnectionMessage{constructor(u,n,a,s){super(u,n,a,s);const r=JSON.parse(this.textBody);r.type!==void 0&&(this.privConversationMessageType=r.type)}get conversationMessageType(){return this.privConversationMessageType}};return ai.ConversationConnectionMessage=t,ai}var Pu;function nf(){if(Pu)return oi;Pu=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.ConversationWebsocketMessageFormatter=void 0;const e=I(),t=Up();let i=class{toConnectionMessage(n){const a=new e.Deferred;try{if(n.messageType===e.MessageType.Text){const s=new t.ConversationConnectionMessage(n.messageType,n.textContent,{},n.id);a.resolve(s)}else n.messageType===e.MessageType.Binary&&a.resolve(new t.ConversationConnectionMessage(n.messageType,n.binaryContent,void 0,n.id))}catch(s){a.reject(`Error formatting the message. Error: ${s}`)}return a.promise}fromConnectionMessage(n){const a=new e.Deferred;try{if(n.messageType===e.MessageType.Text){const s=`${n.textBody?n.textBody:""}`;a.resolve(new e.RawWebsocketMessage(e.MessageType.Text,s,n.id))}}catch(s){a.reject(`Error formatting the message. ${s}`)}return a.promise}};return oi.ConversationWebsocketMessageFormatter=i,oi}var Eu;function sf(){if(Eu)return si;Eu=1,Object.defineProperty(si,"__esModule",{value:!0}),si.ConversationConnectionFactory=void 0;const e=L(),t=I(),i=b(),u=P(),n=Y(),a=ss(),s=nf();let r=class extends n.ConnectionFactoryBase{create(c,p,h){const v=c.parameters.getProperty(u.PropertyId.ConversationTranslator_Host,a.ConversationConnectionConfig.host),d=c.parameters.getProperty(u.PropertyId.ConversationTranslator_CorrelationId,(0,t.createGuid)()),f=`wss://${v}${a.ConversationConnectionConfig.webSocketPath}`,g=c.parameters.getProperty(u.PropertyId.ConversationTranslator_Token,void 0);i.Contracts.throwIfNullOrUndefined(g,"token");const m={};m[a.ConversationConnectionConfig.configParams.apiVersion]=a.ConversationConnectionConfig.apiVersion,m[a.ConversationConnectionConfig.configParams.token]=g,m[a.ConversationConnectionConfig.configParams.correlationId]=d;const l=c.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return Promise.resolve(new e.WebsocketConnection(f,m,{},new s.ConversationWebsocketMessageFormatter,e.ProxyInfo.fromRecognizerConfig(c),l,h))}};return si.ConversationConnectionFactory=r,si}var ci={},ui={},Tu;function of(){if(Tu)return ui;Tu=1,Object.defineProperty(ui,"__esModule",{value:!0}),ui.ConversationRequestSession=void 0;const e=I();let t=class{constructor(u){this.privIsDisposed=!1,this.privDetachables=new Array,this.privSessionId=u,this.privRequestId=(0,e.createNoDashGuid)(),this.privRequestCompletionDeferral=new e.Deferred}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get completionPromise(){return this.privRequestCompletionDeferral.promise}onPreConnectionStart(u,n){this.privSessionId=n}onAuthCompleted(u){u&&this.onComplete()}onConnectionEstablishCompleted(u){u!==200&&u===403&&this.onComplete()}onServiceTurnEndResponse(u){u?this.privRequestId=(0,e.createNoDashGuid)():this.onComplete()}async dispose(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(const u of this.privDetachables)await u.detach()}}onComplete(){}};return ui.ConversationRequestSession=t,ui}var z={},Au;function xp(){if(Au)return z;Au=1,Object.defineProperty(z,"__esModule",{value:!0}),z.ConversationReceivedTranslationEventArgs=z.ParticipantsListEventArgs=z.ParticipantAttributeEventArgs=z.ParticipantEventArgs=z.LockRoomEventArgs=z.MuteAllEventArgs=void 0;const e=P();class t extends e.SessionEventArgs{constructor(o,c){super(c),this.privIsMuted=o}get isMuted(){return this.privIsMuted}}z.MuteAllEventArgs=t;class i extends e.SessionEventArgs{constructor(o,c){super(c),this.privIsLocked=o}get isMuted(){return this.privIsLocked}}z.LockRoomEventArgs=i;class u extends e.SessionEventArgs{constructor(o,c){super(c),this.privParticipant=o}get participant(){return this.privParticipant}}z.ParticipantEventArgs=u;class n extends e.SessionEventArgs{constructor(o,c,p,h){super(h),this.privKey=c,this.privValue=p,this.privParticipantId=o}get value(){return this.privValue}get key(){return this.privKey}get id(){return this.privParticipantId}}z.ParticipantAttributeEventArgs=n;class a extends e.SessionEventArgs{constructor(o,c,p,h,v,d,f,g,m){super(m),this.privRoomId=o,this.privSessionToken=c,this.privTranslateTo=p,this.privProfanityFilter=h,this.privRoomProfanityFilter=v,this.privIsRoomLocked=d,this.privIsRoomLocked=f,this.privParticipants=g}get sessionToken(){return this.privSessionToken}get conversationId(){return this.privRoomId}get translateTo(){return this.privTranslateTo}get profanityFilter(){return this.privProfanityFilter}get roomProfanityFilter(){return this.privRoomProfanityFilter}get isRoomLocked(){return this.privIsRoomLocked}get isMuteAll(){return this.privIsMuteAll}get participants(){return this.privParticipants}}z.ParticipantsListEventArgs=a;class s{constructor(o,c,p){this.privPayload=c,this.privCommand=o,this.privSessionId=p}get payload(){return this.privPayload}get command(){return this.privCommand}get sessionId(){return this.privSessionId}}return z.ConversationReceivedTranslationEventArgs=s,z}var Z={},Iu;function Wp(){if(Iu)return Z;Iu=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.ConversationTranslatorCommandTypes=Z.ConversationTranslatorMessageTypes=Z.InternalParticipants=void 0;class e{constructor(i=[],u){this.participants=i,this.meId=u}addOrUpdateParticipant(i){if(i===void 0)return;const u=this.getParticipantIndex(i.id);return u>-1?this.participants.splice(u,1,i):this.participants.push(i),this.getParticipant(i.id)}getParticipantIndex(i){return this.participants.findIndex(u=>u.id===i)}getParticipant(i){return this.participants.find(u=>u.id===i)}deleteParticipant(i){this.participants=this.participants.filter(u=>u.id!==i)}get host(){return this.participants.find(i=>i.isHost===!0)}get me(){return this.getParticipant(this.meId)}}return Z.InternalParticipants=e,Z.ConversationTranslatorMessageTypes={command:"command",final:"final",info:"info",instantMessage:"instant_message",keepAlive:"keep_alive",partial:"partial",participantCommand:"participant_command",translatedMessage:"translated_message"},Z.ConversationTranslatorCommandTypes={changeNickname:"ChangeNickname",disconnectSession:"DisconnectSession",ejectParticipant:"EjectParticipant",instant_message:"instant_message",joinSession:"JoinSession",leaveSession:"LeaveSession",participantList:"ParticipantList",roomExpirationWarning:"RoomExpirationWarning",setLockState:"SetLockState",setMute:"SetMute",setMuteAll:"SetMuteAll",setProfanityFiltering:"SetProfanityFiltering",setTranslateToLanguages:"SetTranslateToLanguages",setUseTTS:"SetUseTTS"},Z}var Fn={},pi={},wu;function af(){if(wu)return pi;wu=1,Object.defineProperty(pi,"__esModule",{value:!0}),pi.CommandResponsePayload=void 0;const e=i=>JSON.parse(i);let t=class Hp{constructor(u){this.privCommandResponse=e(u)}get type(){return this.privCommandResponse.type}get command(){return this.privCommandResponse.command}get id(){return this.privCommandResponse.id}get nickname(){return this.privCommandResponse.nickname}get participantId(){return this.privCommandResponse.participantId}get roomid(){return this.privCommandResponse.roomid}get value(){return this.privCommandResponse.value}get token(){return this.privCommandResponse.token}static fromJSON(u){return new Hp(u)}};return pi.CommandResponsePayload=t,pi}var ye={},_u;function cf(){if(_u)return ye;_u=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.ParticipantPayloadResponse=ye.ParticipantsListPayloadResponse=void 0;const e=n=>JSON.parse(n),t=n=>JSON.parse(n);class i{constructor(a){this.privParticipantsPayloadResponse=e(a)}get roomid(){return this.privParticipantsPayloadResponse.roomid}get id(){return this.privParticipantsPayloadResponse.id}get command(){return this.privParticipantsPayloadResponse.command}get participants(){return this.privParticipantsPayloadResponse.participants}get token(){return this.privParticipantsPayloadResponse.token}get translateTo(){return this.privParticipantsPayloadResponse.translateTo}get profanityFilter(){return this.privParticipantsPayloadResponse.profanityFilter}get roomProfanityFilter(){return this.privParticipantsPayloadResponse.roomProfanityFilter}get roomLocked(){return this.privParticipantsPayloadResponse.roomLocked}get muteAll(){return this.privParticipantsPayloadResponse.muteAll}get type(){return this.privParticipantsPayloadResponse.type}static fromJSON(a){return new i(a)}}ye.ParticipantsListPayloadResponse=i;class u{constructor(a){this.privParticipantPayloadResponse=t(a)}get nickname(){return this.privParticipantPayloadResponse.nickname}get locale(){return this.privParticipantPayloadResponse.locale}get usetts(){return this.privParticipantPayloadResponse.usetts}get ismuted(){return this.privParticipantPayloadResponse.ismuted}get ishost(){return this.privParticipantPayloadResponse.ishost}get participantId(){return this.privParticipantPayloadResponse.participantId}get avatar(){return this.privParticipantPayloadResponse.avatar}static fromJSON(a){return new u(a)}}return ye.ParticipantPayloadResponse=u,ye}var Re={},bu;function uf(){if(bu)return Re;bu=1,Object.defineProperty(Re,"__esModule",{value:!0}),Re.TextResponsePayload=Re.SpeechResponsePayload=void 0;const e=n=>JSON.parse(n),t=n=>JSON.parse(n);class i{constructor(a){this.privSpeechResponse=e(a)}get recognition(){return this.privSpeechResponse.recognition}get translations(){return this.privSpeechResponse.translations}get id(){return this.privSpeechResponse.id}get language(){return this.privSpeechResponse.language}get nickname(){return this.privSpeechResponse.nickname}get participantId(){return this.privSpeechResponse.participantId}get roomid(){return this.privSpeechResponse.roomid}get timestamp(){return this.privSpeechResponse.timestamp}get type(){return this.privSpeechResponse.type}get isFinal(){return this.privSpeechResponse.type==="final"}static fromJSON(a){return new i(a)}}Re.SpeechResponsePayload=i;class u{constructor(a){this.privTextResponse=t(a)}get originalText(){return this.privTextResponse.originalText}get translations(){return this.privTextResponse.translations}get id(){return this.privTextResponse.id}get language(){return this.privTextResponse.language}get nickname(){return this.privTextResponse.nickname}get participantId(){return this.privTextResponse.participantId}get roomid(){return this.privTextResponse.roomid}get timestamp(){return this.privTextResponse.timestamp}get type(){return this.privTextResponse.type}static fromJSON(a){return new u(a)}}return Re.TextResponsePayload=u,Re}var Mu;function pf(){return Mu||(Mu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TextResponsePayload=e.SpeechResponsePayload=e.ParticipantPayloadResponse=e.ParticipantsListPayloadResponse=e.CommandResponsePayload=void 0;var t=af();Object.defineProperty(e,"CommandResponsePayload",{enumerable:!0,get:function(){return t.CommandResponsePayload}});var i=cf();Object.defineProperty(e,"ParticipantsListPayloadResponse",{enumerable:!0,get:function(){return i.ParticipantsListPayloadResponse}}),Object.defineProperty(e,"ParticipantPayloadResponse",{enumerable:!0,get:function(){return i.ParticipantPayloadResponse}});var u=uf();Object.defineProperty(e,"SpeechResponsePayload",{enumerable:!0,get:function(){return u.SpeechResponsePayload}}),Object.defineProperty(e,"TextResponsePayload",{enumerable:!0,get:function(){return u.TextResponsePayload}})})(Fn)),Fn}var Ou;function hf(){if(Ou)return ci;Ou=1,Object.defineProperty(ci,"__esModule",{value:!0}),ci.ConversationServiceAdapter=void 0;const e=I(),t=P(),i=A(),u=Up(),n=of(),a=xp(),s=Wp(),r=pf();let o=class extends i.ServiceRecognizerBase{constructor(p,h,v,d,f){super(p,h,v,d,f),this.privConnectionConfigPromise=void 0,this.privLastPartialUtteranceId="",this.privConversationServiceConnector=f,this.privConversationAuthentication=p,this.receiveMessageOverride=()=>this.receiveConversationMessageOverride(),this.recognizeOverride=()=>this.noOp(),this.postConnectImplOverride=g=>this.conversationConnectImpl(g),this.configConnectionOverride=()=>this.configConnection(),this.disconnectOverride=()=>this.privDisconnect(),this.privConversationRequestSession=new n.ConversationRequestSession((0,e.createNoDashGuid)()),this.privConversationConnectionFactory=h,this.privConversationIsDisposed=!1}isDisposed(){return super.isDisposed()||this.privConversationIsDisposed}async dispose(p){this.privConversationIsDisposed=!0,this.privConnectionConfigPromise!==void 0&&await(await this.privConnectionConfigPromise).dispose(p),await super.dispose(p)}async sendMessage(p){return(await this.fetchConnection()).send(new u.ConversationConnectionMessage(e.MessageType.Text,p))}async sendMessageAsync(p){await(await this.fetchConnection()).send(new u.ConversationConnectionMessage(e.MessageType.Text,p))}privDisconnect(){if(!this.terminateMessageLoop)return this.cancelRecognition(this.privConversationRequestSession.sessionId,this.privConversationRequestSession.requestId,t.CancellationReason.Error,t.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,Promise.resolve()}async processTypeSpecificMessages(){return!0}cancelRecognition(p,h,v,d,f){this.terminateMessageLoop=!0;const g=new t.ConversationTranslationCanceledEventArgs(v,f,d,void 0,p);try{this.privConversationServiceConnector.canceled&&this.privConversationServiceConnector.canceled(this.privConversationServiceConnector,g)}catch{}}async conversationConnectImpl(p){return this.privConnectionLoop=this.startMessageLoop(),p}async receiveConversationMessageOverride(){if(this.isDisposed()||this.terminateMessageLoop)return Promise.resolve();const p=new e.Deferred;try{const v=await(await this.fetchConnection()).read();if(this.isDisposed()||this.terminateMessageLoop)return p.resolve(),Promise.resolve();if(!v)return this.receiveConversationMessageOverride();const d=this.privConversationRequestSession.sessionId,f=v.conversationMessageType.toLowerCase();let g=!1;try{switch(f){case"info":case"participant_command":case"command":const m=r.CommandResponsePayload.fromJSON(v.textBody);switch(m.command.toLowerCase()){case"participantlist":const T=r.ParticipantsListPayloadResponse.fromJSON(v.textBody),w=T.participants.map(N=>({avatar:N.avatar,displayName:N.nickname,id:N.participantId,isHost:N.ishost,isMuted:N.ismuted,isUsingTts:N.usetts,preferredLanguage:N.locale}));this.privConversationServiceConnector.participantsListReceived&&this.privConversationServiceConnector.participantsListReceived(this.privConversationServiceConnector,new a.ParticipantsListEventArgs(T.roomid,T.token,T.translateTo,T.profanityFilter,T.roomProfanityFilter,T.roomLocked,T.muteAll,w,d));break;case"settranslatetolanguages":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new a.ParticipantAttributeEventArgs(m.participantId,s.ConversationTranslatorCommandTypes.setTranslateToLanguages,m.value,d));break;case"setprofanityfiltering":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new a.ParticipantAttributeEventArgs(m.participantId,s.ConversationTranslatorCommandTypes.setProfanityFiltering,m.value,d));break;case"setmute":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new a.ParticipantAttributeEventArgs(m.participantId,s.ConversationTranslatorCommandTypes.setMute,m.value,d));break;case"setmuteall":this.privConversationServiceConnector.muteAllCommandReceived&&this.privConversationServiceConnector.muteAllCommandReceived(this.privConversationServiceConnector,new a.MuteAllEventArgs(m.value,d));break;case"roomexpirationwarning":this.privConversationServiceConnector.conversationExpiration&&this.privConversationServiceConnector.conversationExpiration(this.privConversationServiceConnector,new t.ConversationExpirationEventArgs(m.value,this.privConversationRequestSession.sessionId));break;case"setusetts":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new a.ParticipantAttributeEventArgs(m.participantId,s.ConversationTranslatorCommandTypes.setUseTTS,m.value,d));break;case"setlockstate":this.privConversationServiceConnector.lockRoomCommandReceived&&this.privConversationServiceConnector.lockRoomCommandReceived(this.privConversationServiceConnector,new a.LockRoomEventArgs(m.value,d));break;case"changenickname":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new a.ParticipantAttributeEventArgs(m.participantId,s.ConversationTranslatorCommandTypes.changeNickname,m.value,d));break;case"joinsession":const E=r.ParticipantPayloadResponse.fromJSON(v.textBody),M={avatar:E.avatar,displayName:E.nickname,id:E.participantId,isHost:E.ishost,isMuted:E.ismuted,isUsingTts:E.usetts,preferredLanguage:E.locale};this.privConversationServiceConnector.participantJoinCommandReceived&&this.privConversationServiceConnector.participantJoinCommandReceived(this.privConversationServiceConnector,new a.ParticipantEventArgs(M,d));break;case"leavesession":const O={id:m.participantId};this.privConversationServiceConnector.participantLeaveCommandReceived&&this.privConversationServiceConnector.participantLeaveCommandReceived(this.privConversationServiceConnector,new a.ParticipantEventArgs(O,d));break;case"disconnectsession":const x={id:m.participantId};break;case"token":const Ie=new i.CognitiveTokenAuthentication(()=>{const N=m.token;return Promise.resolve(N)},()=>{const N=m.token;return Promise.resolve(N)});this.authentication=Ie,this.privConversationServiceConnector.onToken(Ie);break;default:break}break;case"partial":case"final":const l=r.SpeechResponsePayload.fromJSON(v.textBody),S=f==="final"?t.ResultReason.TranslatedParticipantSpeech:t.ResultReason.TranslatingParticipantSpeech,C=new t.ConversationTranslationResult(l.participantId,this.getTranslations(l.translations),l.language,l.id,S,l.recognition,void 0,void 0,v.textBody,void 0);l.isFinal?((C.text!==void 0&&C.text.length>0||l.id===this.privLastPartialUtteranceId)&&(g=!0),g&&this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new a.ConversationReceivedTranslationEventArgs(s.ConversationTranslatorMessageTypes.final,C,d))):C.text!==void 0&&(this.privLastPartialUtteranceId=l.id,this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new a.ConversationReceivedTranslationEventArgs(s.ConversationTranslatorMessageTypes.partial,C,d)));break;case"translated_message":const y=r.TextResponsePayload.fromJSON(v.textBody),R=new t.ConversationTranslationResult(y.participantId,this.getTranslations(y.translations),y.language,void 0,void 0,y.originalText,void 0,void 0,void 0,v.textBody,void 0);this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new a.ConversationReceivedTranslationEventArgs(s.ConversationTranslatorMessageTypes.instantMessage,R,d));break;default:break}}catch{}return this.receiveConversationMessageOverride()}catch{this.terminateMessageLoop=!0}return p.promise}async startMessageLoop(){if(this.isDisposed())return Promise.resolve();this.terminateMessageLoop=!1;const p=this.receiveConversationMessageOverride();try{return await p}catch(h){return this.cancelRecognition(this.privRequestSession?this.privRequestSession.sessionId:"",this.privRequestSession?this.privRequestSession.requestId:"",t.CancellationReason.Error,t.CancellationErrorCode.RuntimeError,h),null}}configConnection(){return this.isDisposed()?Promise.resolve(void 0):this.privConnectionConfigPromise!==void 0?this.privConnectionConfigPromise.then(p=>p.state()===e.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection()):this.privConnectionConfigPromise,()=>(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection())):this.terminateMessageLoop?Promise.resolve(void 0):(this.privConnectionConfigPromise=this.connectImpl().then(p=>p),this.privConnectionConfigPromise)}getTranslations(p){let h;if(p!==void 0){h=new t.Translations;for(const v of p)h.set(v.lang,v.translation)}return h}};return ci.ConversationServiceAdapter=o,ci}var Du;function df(){if(Du)return Ce;Du=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.ConversationTranslatorRecognizer=Ce.ConversationRecognizerFactory=void 0;const e=A(),t=I(),i=b(),u=P(),n=sf(),a=hf();class s{static fromConfig(c,p,h){return new r(c,p,h)}}Ce.ConversationRecognizerFactory=s;let r=class extends u.Recognizer{constructor(c,p,h){const v=p;i.Contracts.throwIfNull(v,"speechConfig");const d=c;i.Contracts.throwIfNull(d,"conversationImpl"),super(h,v.properties,new n.ConversationConnectionFactory),this.privConversation=d,this.privIsDisposed=!1,this.privProperties=v.properties.clone(),this.privConnection=u.Connection.fromRecognizer(this),this.privProperties.getProperty(u.PropertyId.WebWorkerLoadType,"on").toLowerCase()==="on"&&typeof Blob<"u"&&typeof Worker<"u"?(this.privSetTimeout=t.Timeout.setTimeout,this.privClearTimeout=t.Timeout.clearTimeout):typeof window<"u"?(this.privSetTimeout=window.setTimeout.bind(window),this.privClearTimeout=window.clearTimeout.bind(window)):(this.privSetTimeout=setTimeout,this.privClearTimeout=clearTimeout)}set connected(c){this.privConnection.connected=c}set disconnected(c){this.privConnection.disconnected=c}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get properties(){return this.privProperties}isDisposed(){return this.privIsDisposed}connect(c,p,h){try{i.Contracts.throwIfDisposed(this.privIsDisposed),i.Contracts.throwIfNullOrWhitespace(c,"token"),this.privReco.conversationTranslatorToken=c,this.resetConversationTimeout(),this.privReco.connectAsync(p,h)}catch(v){if(h)if(v instanceof Error){const d=v;h(d.name+": "+d.message)}else h(v)}}disconnect(c,p){try{i.Contracts.throwIfDisposed(this.privIsDisposed),this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privReco.disconnect().then(()=>{c&&c()},h=>{p&&p(h)})}catch(h){if(p)if(h instanceof Error){const v=h;p(v.name+": "+v.message)}else p(h);this.dispose(!0).catch(v=>{t.Events.instance.onEvent(new t.BackgroundEvent(v))})}}sendRequest(c,p,h){try{i.Contracts.throwIfDisposed(this.privIsDisposed),this.sendMessage(c,p,h)}catch(v){if(h)if(v instanceof Error){const d=v;h(d.name+": "+d.message)}else h(v);this.dispose(!0).catch(d=>{t.Events.instance.onEvent(new t.BackgroundEvent(d))})}}onToken(c){this.privConversation.onToken(c)}async close(){this.privIsDisposed||(this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close()),this.privConnection=void 0,await this.dispose(!0))}async dispose(c){this.privIsDisposed||c&&(this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privIsDisposed=!0,this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close(),this.privConnection=void 0),await super.dispose(c))}createRecognizerConfig(c){return new e.RecognizerConfig(c,this.privProperties)}createServiceRecognizer(c,p,h,v){const d=h;return new a.ConversationServiceAdapter(c,p,d,v,this)}sendMessage(c,p,h){const v=this.privReco;((f,g,m)=>{f!==void 0?f.then(()=>{try{g&&g()}catch(l){m&&m(`'Unhandled error on promise callback: ${l}'`)}},l=>{try{m&&m(l)}catch{}}):m&&m("Null promise")})(v.sendMessageAsync(c),p,h),this.resetConversationTimeout()}resetConversationTimeout(){this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privTimeoutToken=this.privSetTimeout(()=>{this.sendRequest(this.privConversation.getKeepAlive())},6e4)}};return Ce.ConversationTranslatorRecognizer=r,Ce}var hi={},ku;function vf(){if(ku)return hi;ku=1,Object.defineProperty(hi,"__esModule",{value:!0}),hi.TranscriberRecognizer=void 0;const e=I(),t=b(),i=P(),u=A(),n=V();let a=class extends i.Recognizer{constructor(r,o){const c=r;t.Contracts.throwIfNull(c,"speechTranslationConfig");const p=o;t.Contracts.throwIfNull(p,"audioConfigImpl"),t.Contracts.throwIfNullOrWhitespace(c.speechRecognitionLanguage,i.PropertyId[i.PropertyId.SpeechServiceConnection_RecoLanguage]),super(o,c.properties,new u.TranscriberConnectionFactory),this.privDisposedRecognizer=!1,this.isMeetingRecognizer=!1}get speechRecognitionLanguage(){return t.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(i.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(i.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(r){t.Contracts.throwIfNullOrWhitespace(r,"token"),this.properties.setProperty(i.PropertyId.SpeechServiceAuthorization_Token,r)}set conversation(r){t.Contracts.throwIfNullOrUndefined(r,"Conversation"),this.isMeetingRecognizer=!1,this.privConversation=r}getConversationInfo(){return t.Contracts.throwIfNullOrUndefined(this.privConversation,"Conversation"),this.privConversation.conversationInfo}set meeting(r){t.Contracts.throwIfNullOrUndefined(r,"Meeting"),this.isMeetingRecognizer=!0,this.privMeeting=r}getMeetingInfo(){return t.Contracts.throwIfNullOrUndefined(this.privMeeting,"Meeting"),this.privMeeting.meetingInfo}IsMeetingRecognizer(){return this.isMeetingRecognizer}startContinuousRecognitionAsync(r,o){(0,e.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(n.RecognitionMode.Conversation),r,o)}stopContinuousRecognitionAsync(r,o){(0,e.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),r,o)}async close(){this.privDisposedRecognizer||await this.dispose(!0)}async pushConversationEvent(r,o){const c=this.privReco;t.Contracts.throwIfNullOrUndefined(c,"serviceRecognizer"),await c.sendSpeechEventAsync(r,o)}async pushMeetingEvent(r,o){const c=this.privReco;t.Contracts.throwIfNullOrUndefined(c,"serviceRecognizer"),await c.sendMeetingSpeechEventAsync(r,o)}async enforceAudioGating(){const c=(await this.audioConfig.format).channels;if(c===1){if(this.properties.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase()!=="true")throw new Error("Single channel audio configuration for MeetingTranscriber is currently under private preview, please contact diarizationrequest@microsoft.com for more details")}else if(c!==8)throw new Error(`Unsupported audio configuration: Detected ${c}-channel audio`)}connectMeetingCallbacks(r){this.isMeetingRecognizer=!0,this.canceled=(o,c)=>{r.canceled&&r.canceled(r,c)},this.recognizing=(o,c)=>{r.transcribing&&r.transcribing(r,c)},this.recognized=(o,c)=>{r.transcribed&&r.transcribed(r,c)},this.sessionStarted=(o,c)=>{r.sessionStarted&&r.sessionStarted(r,c)},this.sessionStopped=(o,c)=>{r.sessionStopped&&r.sessionStopped(r,c)}}disconnectCallbacks(){this.canceled=void 0,this.recognizing=void 0,this.recognized=void 0,this.sessionStarted=void 0,this.sessionStopped=void 0}async dispose(r){this.privDisposedRecognizer||(r&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(r))}createRecognizerConfig(r){return new u.RecognizerConfig(r,this.properties)}createServiceRecognizer(r,o,c,p){const h=c;return new u.TranscriptionServiceRecognizer(r,o,h,p,this)}};return hi.TranscriberRecognizer=a,hi}var Nu;function lf(){return Nu||(Nu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.InternalParticipants=e.ConversationTranslatorMessageTypes=e.ConversationTranslatorCommandTypes=e.ParticipantsListEventArgs=e.ParticipantEventArgs=e.ParticipantAttributeEventArgs=e.MuteAllEventArgs=e.LockRoomEventArgs=e.ConversationReceivedTranslationEventArgs=e.TranscriberRecognizer=e.ConversationRecognizerFactory=e.ConversationConnectionConfig=e.ConversationManager=void 0;var t=rf();Object.defineProperty(e,"ConversationManager",{enumerable:!0,get:function(){return t.ConversationManager}});var i=ss();Object.defineProperty(e,"ConversationConnectionConfig",{enumerable:!0,get:function(){return i.ConversationConnectionConfig}});var u=df();Object.defineProperty(e,"ConversationRecognizerFactory",{enumerable:!0,get:function(){return u.ConversationRecognizerFactory}});var n=vf();Object.defineProperty(e,"TranscriberRecognizer",{enumerable:!0,get:function(){return n.TranscriberRecognizer}});var a=xp();Object.defineProperty(e,"ConversationReceivedTranslationEventArgs",{enumerable:!0,get:function(){return a.ConversationReceivedTranslationEventArgs}}),Object.defineProperty(e,"LockRoomEventArgs",{enumerable:!0,get:function(){return a.LockRoomEventArgs}}),Object.defineProperty(e,"MuteAllEventArgs",{enumerable:!0,get:function(){return a.MuteAllEventArgs}}),Object.defineProperty(e,"ParticipantAttributeEventArgs",{enumerable:!0,get:function(){return a.ParticipantAttributeEventArgs}}),Object.defineProperty(e,"ParticipantEventArgs",{enumerable:!0,get:function(){return a.ParticipantEventArgs}}),Object.defineProperty(e,"ParticipantsListEventArgs",{enumerable:!0,get:function(){return a.ParticipantsListEventArgs}});var s=Wp();Object.defineProperty(e,"ConversationTranslatorCommandTypes",{enumerable:!0,get:function(){return s.ConversationTranslatorCommandTypes}}),Object.defineProperty(e,"ConversationTranslatorMessageTypes",{enumerable:!0,get:function(){return s.ConversationTranslatorMessageTypes}}),Object.defineProperty(e,"InternalParticipants",{enumerable:!0,get:function(){return s.InternalParticipants}})})(Bn)),Bn}var Un={},zu;function Kp(){return zu||(zu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SynthesisAudioMetadata=e.MetadataType=void 0,(function(i){i.WordBoundary="WordBoundary",i.Bookmark="Bookmark",i.Viseme="Viseme",i.SentenceBoundary="SentenceBoundary",i.SessionEnd="SessionEnd",i.AvatarSignal="TalkingAvatarSignal"})(e.MetadataType||(e.MetadataType={}));class t{constructor(u){this.privSynthesisAudioMetadata=JSON.parse(u)}static fromJSON(u){return new t(u)}get Metadata(){return this.privSynthesisAudioMetadata.Metadata}}e.SynthesisAudioMetadata=t})(Un)),Un}var di={},K={},ju;function ff(){if(ju)return K;ju=1,Object.defineProperty(K,"__esModule",{value:!0}),K.SynthesisStartedEvent=K.ConnectingToSynthesisServiceEvent=K.SynthesisTriggeredEvent=K.SpeechSynthesisEvent=void 0;const e=I();class t extends e.PlatformEvent{constructor(s,r,o=e.EventType.Info){super(s,o),this.privRequestId=r}get requestId(){return this.privRequestId}}K.SpeechSynthesisEvent=t;class i extends t{constructor(s,r,o){super("SynthesisTriggeredEvent",s),this.privSessionAudioDestinationId=r,this.privTurnAudioDestinationId=o}get audioSessionDestinationId(){return this.privSessionAudioDestinationId}get audioTurnDestinationId(){return this.privTurnAudioDestinationId}}K.SynthesisTriggeredEvent=i;class u extends t{constructor(s,r){super("ConnectingToSynthesisServiceEvent",s),this.privAuthFetchEventId=r}get authFetchEventId(){return this.privAuthFetchEventId}}K.ConnectingToSynthesisServiceEvent=u;class n extends t{constructor(s,r){super("SynthesisStartedEvent",s),this.privAuthFetchEventId=r}get authFetchEventId(){return this.privAuthFetchEventId}}return K.SynthesisStartedEvent=n,K}var Lu;function gf(){if(Lu)return di;Lu=1,Object.defineProperty(di,"__esModule",{value:!0}),di.SynthesisTurn=void 0;const e=I(),t=_e(),i=P(),u=Kp(),n=ff();let a=class Zn{constructor(){this.privIsDisposed=!1,this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!1,this.privBytesReceived=0,this.privInTurn=!1,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privRequestId=(0,e.createNoDashGuid)(),this.privTurnDeferral=new e.Deferred,this.privTurnDeferral.resolve()}get requestId(){return this.privRequestId}get streamId(){return this.privStreamId}set streamId(r){this.privStreamId=r}get audioOutputFormat(){return this.privAudioOutputFormat}set audioOutputFormat(r){this.privAudioOutputFormat=r}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSynthesisEnded(){return this.privIsSynthesisEnded}get isSynthesizing(){return this.privIsSynthesizing}get currentTextOffset(){return this.privTextOffset}get currentSentenceOffset(){return this.privSentenceOffset}get bytesReceived(){return this.privBytesReceived}get audioDuration(){return this.privAudioDuration}get extraProperties(){if(this.privWebRTCSDP){const r=new i.PropertyCollection;return r.setProperty(i.PropertyId.TalkingAvatarService_WebRTC_SDP,this.privWebRTCSDP),r}}async getAllReceivedAudio(){return this.privReceivedAudio?Promise.resolve(this.privReceivedAudio):this.privIsSynthesisEnded?(await this.readAllAudioFromStream(),Promise.resolve(this.privReceivedAudio)):null}async getAllReceivedAudioWithHeader(){if(this.privReceivedAudioWithHeader)return this.privReceivedAudioWithHeader;if(!this.privIsSynthesisEnded)return null;if(this.audioOutputFormat.hasHeader){const r=await this.getAllReceivedAudio();return this.privReceivedAudioWithHeader=this.audioOutputFormat.addHeader(r),this.privReceivedAudioWithHeader}else return this.getAllReceivedAudio()}startNewSynthesis(r,o,c,p){this.privIsSynthesisEnded=!1,this.privIsSynthesizing=!0,this.privRequestId=r,this.privRawText=o,this.privIsSSML=c,this.privAudioOutputStream=new t.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privAudioOutputFormat,this.privReceivedAudio=null,this.privReceivedAudioWithHeader=null,this.privBytesReceived=0,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privPartialVisemeAnimation="",this.privWebRTCSDP="",p!==void 0&&(this.privTurnAudioDestination=p,this.privTurnAudioDestination.format=this.privAudioOutputFormat),this.onEvent(new n.SynthesisTriggeredEvent(this.requestId,void 0,p===void 0?void 0:p.id()))}onPreConnectionStart(r){this.privAuthFetchEventId=r,this.onEvent(new n.ConnectingToSynthesisServiceEvent(this.privRequestId,this.privAuthFetchEventId))}onAuthCompleted(r){r&&this.onComplete()}onConnectionEstablishCompleted(r){if(r===200){this.onEvent(new n.SynthesisStartedEvent(this.requestId,this.privAuthFetchEventId)),this.privBytesReceived=0;return}else r===403&&this.onComplete()}onServiceResponseMessage(r){const o=JSON.parse(r);this.streamId=o.audio.streamId}onServiceTurnEndResponse(){this.privInTurn=!1,this.privTurnDeferral.resolve(),this.onComplete()}onServiceTurnStartResponse(r){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new e.Deferred;const o=JSON.parse(r);o.webrtc&&(this.privWebRTCSDP=o.webrtc.connectionString)}onAudioChunkReceived(r){this.isSynthesizing&&(this.privAudioOutputStream.write(r),this.privBytesReceived+=r.byteLength,this.privTurnAudioDestination!==void 0&&this.privTurnAudioDestination.write(r))}onTextBoundaryEvent(r){this.updateTextOffset(r.Data.text.Text,r.Type)}onVisemeMetadataReceived(r){r.Data.AnimationChunk!==void 0&&(this.privPartialVisemeAnimation+=r.Data.AnimationChunk)}onSessionEnd(r){this.privAudioDuration=r.Data.Offset}async constructSynthesisResult(){const r=await this.getAllReceivedAudioWithHeader();return new i.SpeechSynthesisResult(this.requestId,i.ResultReason.SynthesizingAudioCompleted,r,void 0,this.extraProperties,this.audioDuration)}dispose(){this.privIsDisposed||(this.privIsDisposed=!0)}onStopSynthesizing(){this.onComplete()}getAndClearVisemeAnimation(){const r=this.privPartialVisemeAnimation;return this.privPartialVisemeAnimation="",r}onEvent(r){e.Events.instance.onEvent(r)}static isXmlTag(r){return r.length>=2&&r[0]==="<"&&r[r.length-1]===">"}updateTextOffset(r,o){o===u.MetadataType.WordBoundary?(this.privTextOffset=this.privRawText.indexOf(r,this.privNextSearchTextIndex),this.privTextOffset>=0&&(this.privNextSearchTextIndex=this.privTextOffset+r.length,this.privIsSSML&&this.withinXmlTag(this.privTextOffset)&&!Zn.isXmlTag(r)&&this.updateTextOffset(r,o))):(this.privSentenceOffset=this.privRawText.indexOf(r,this.privNextSearchSentenceIndex),this.privSentenceOffset>=0&&(this.privNextSearchSentenceIndex=this.privSentenceOffset+r.length,this.privIsSSML&&this.withinXmlTag(this.privSentenceOffset)&&!Zn.isXmlTag(r)&&this.updateTextOffset(r,o)))}onComplete(){this.privIsSynthesizing&&(this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!0,this.privAudioOutputStream.close(),this.privInTurn=!1,this.privTurnAudioDestination!==void 0&&(this.privTurnAudioDestination.close(),this.privTurnAudioDestination=void 0))}async readAllAudioFromStream(){if(this.privIsSynthesisEnded){this.privReceivedAudio=new ArrayBuffer(this.bytesReceived);try{await this.privAudioOutputStream.read(this.privReceivedAudio)}catch{this.privReceivedAudio=new ArrayBuffer(0)}}}withinXmlTag(r){return this.privRawText.indexOf("<",r+1)>this.privRawText.indexOf(">",r+1)}};return di.SynthesisTurn=a,di}var vi={},qu;function mf(){if(qu)return vi;qu=1,Object.defineProperty(vi,"__esModule",{value:!0}),vi.SynthesisAdapterBase=void 0;const e=I(),t=P(),i=A(),u=wi();let n=class{constructor(s,r,o,c){if(this.speakOverride=void 0,this.receiveMessageOverride=void 0,this.connectImplOverride=void 0,this.configConnectionOverride=void 0,this.privConnectionConfigurationPromise=void 0,!s)throw new e.ArgumentNullError("authentication");if(!r)throw new e.ArgumentNullError("connectionFactory");if(!o)throw new e.ArgumentNullError("synthesizerConfig");this.privAuthentication=s,this.privConnectionFactory=r,this.privSynthesizerConfig=o,this.privIsDisposed=!1,this.privSessionAudioDestination=c,this.privSynthesisTurn=new i.SynthesisTurn,this.privConnectionEvents=new e.EventSource,this.privServiceEvents=new e.EventSource,this.privSynthesisContext=new i.SynthesisContext,this.privAgentConfig=new i.AgentConfig,this.connectionEvents.attach(p=>{if(p.name==="ConnectionClosedEvent"){const h=p;h.statusCode!==1e3&&this.cancelSynthesisLocal(t.CancellationReason.Error,h.statusCode===1007?t.CancellationErrorCode.BadRequestParameters:t.CancellationErrorCode.ConnectionFailure,`${h.reason} websocket error code: ${h.statusCode}`)}})}get synthesizerConfig(){return this.privSynthesizerConfig}get synthesisContext(){return this.privSynthesisContext}get agentConfig(){return this.privAgentConfig}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}set activityTemplate(s){this.privActivityTemplate=s}get activityTemplate(){return this.privActivityTemplate}set audioOutputFormat(s){this.privAudioOutputFormat=s,this.privSynthesisTurn.audioOutputFormat=s,this.privSessionAudioDestination!==void 0&&(this.privSessionAudioDestination.format=s),this.synthesisContext!==void 0&&(this.synthesisContext.audioOutputFormat=s)}isDisposed(){return this.privIsDisposed}async dispose(s){this.privIsDisposed=!0,this.privSessionAudioDestination!==void 0&&this.privSessionAudioDestination.close(),this.privConnectionConfigurationPromise!==void 0&&await(await this.privConnectionConfigurationPromise).dispose(s)}async connect(){await this.connectImpl()}async sendNetworkMessage(s,r){const o=typeof r=="string"?e.MessageType.Text:e.MessageType.Binary,c=typeof r=="string"?"application/json":"";return(await this.fetchConnection()).send(new u.SpeechConnectionMessage(o,s,this.privSynthesisTurn.requestId,c,r))}async Speak(s,r,o,c,p,h){let v;if(r?v=s:v=this.privSynthesizer.buildSsml(s),this.speakOverride!==void 0)return this.speakOverride(v,o,c,p);this.privSuccessCallback=c,this.privErrorCallback=p,this.privSynthesisTurn.startNewSynthesis(o,s,r,h);try{await this.connectImpl();const d=await this.fetchConnection();await this.sendSynthesisContext(d),await this.sendSsmlMessage(d,v,o),this.onSynthesisStarted(o),this.receiveMessage()}catch(d){return this.cancelSynthesisLocal(t.CancellationReason.Error,t.CancellationErrorCode.ConnectionFailure,d),Promise.reject(d)}}async stopSpeaking(){return await this.connectImpl(),(await this.fetchConnection()).send(new u.SpeechConnectionMessage(e.MessageType.Text,"synthesis.control",this.privSynthesisTurn.requestId,"application/json",JSON.stringify({action:"stop"})))}cancelSynthesis(s,r,o,c){const p=new t.PropertyCollection;p.setProperty(i.CancellationErrorCodePropertyName,t.CancellationErrorCode[o]);const h=new t.SpeechSynthesisResult(s,t.ResultReason.Canceled,void 0,c,p);if(this.onSynthesisCancelled(h),this.privSuccessCallback)try{this.privSuccessCallback(h)}catch{}}cancelSynthesisLocal(s,r,o){this.privSynthesisTurn.isSynthesizing&&(this.privSynthesisTurn.onStopSynthesizing(),this.cancelSynthesis(this.privSynthesisTurn.requestId,s,r,o))}processTypeSpecificMessages(s){return!0}async receiveMessage(){try{const r=await(await this.fetchConnection()).read();if(this.receiveMessageOverride!==void 0)return this.receiveMessageOverride();if(this.privIsDisposed)return;if(!r)return this.privSynthesisTurn.isSynthesizing?this.receiveMessage():void 0;const o=u.SpeechConnectionMessage.fromConnectionMessage(r);if(o.requestId.toLowerCase()===this.privSynthesisTurn.requestId.toLowerCase())switch(o.path.toLowerCase()){case"turn.start":this.privSynthesisTurn.onServiceTurnStartResponse(o.textBody);break;case"response":this.privSynthesisTurn.onServiceResponseMessage(o.textBody);break;case"audio":this.privSynthesisTurn.streamId.toLowerCase()===o.streamId.toLowerCase()&&o.binaryBody&&(this.privSynthesisTurn.onAudioChunkReceived(o.binaryBody),this.onSynthesizing(o.binaryBody),this.privSessionAudioDestination!==void 0&&this.privSessionAudioDestination.write(o.binaryBody));break;case"audio.metadata":const c=i.SynthesisAudioMetadata.fromJSON(o.textBody).Metadata;for(const h of c)switch(h.Type){case i.MetadataType.WordBoundary:case i.MetadataType.SentenceBoundary:this.privSynthesisTurn.onTextBoundaryEvent(h);const v=new t.SpeechSynthesisWordBoundaryEventArgs(h.Data.Offset,h.Data.Duration,h.Data.text.Text,h.Data.text.Length,h.Type===i.MetadataType.WordBoundary?this.privSynthesisTurn.currentTextOffset:this.privSynthesisTurn.currentSentenceOffset,h.Data.text.BoundaryType);this.onWordBoundary(v);break;case i.MetadataType.Bookmark:const d=new t.SpeechSynthesisBookmarkEventArgs(h.Data.Offset,h.Data.Bookmark);this.onBookmarkReached(d);break;case i.MetadataType.Viseme:if(this.privSynthesisTurn.onVisemeMetadataReceived(h),h.Data.IsLastAnimation){const f=new t.SpeechSynthesisVisemeEventArgs(h.Data.Offset,h.Data.VisemeId,this.privSynthesisTurn.getAndClearVisemeAnimation());this.onVisemeReceived(f)}break;case i.MetadataType.AvatarSignal:this.onAvatarEvent(h);break;case i.MetadataType.SessionEnd:this.privSynthesisTurn.onSessionEnd(h);break}break;case"turn.end":this.privSynthesisTurn.onServiceTurnEndResponse();let p;try{p=await this.privSynthesisTurn.constructSynthesisResult(),this.privSuccessCallback&&this.privSuccessCallback(p)}catch(h){this.privErrorCallback&&this.privErrorCallback(h)}this.onSynthesisCompleted(p);break;default:this.processTypeSpecificMessages(o)||this.privServiceEvents&&this.serviceEvents.onEvent(new e.ServiceEvent(o.path.toLowerCase(),o.textBody))}return this.receiveMessage()}catch{}}sendSynthesisContext(s){this.setSynthesisContextSynthesisSection();const r=this.synthesisContext.toJSON();if(r)return s.send(new u.SpeechConnectionMessage(e.MessageType.Text,"synthesis.context",this.privSynthesisTurn.requestId,"application/json",r))}setSpeechConfigSynthesisSection(){}connectImpl(s=!1){if(this.privConnectionPromise!=null)return this.privConnectionPromise.then(o=>o.state()===e.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()));this.privAuthFetchEventId=(0,e.createNoDashGuid)(),this.privConnectionId=(0,e.createNoDashGuid)(),this.privSynthesisTurn.onPreConnectionStart(this.privAuthFetchEventId);const r=s?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId);return this.privConnectionPromise=r.then(async o=>{this.privSynthesisTurn.onAuthCompleted(!1);const c=await this.privConnectionFactory.create(this.privSynthesizerConfig,o,this.privConnectionId);c.events.attach(h=>{this.connectionEvents.onEvent(h)});const p=await c.open();return p.statusCode===200?(this.privSynthesisTurn.onConnectionEstablishCompleted(p.statusCode),Promise.resolve(c)):p.statusCode===403&&!s?this.connectImpl(!0):(this.privSynthesisTurn.onConnectionEstablishCompleted(p.statusCode),Promise.reject(`Unable to contact server. StatusCode: ${p.statusCode},
                    ${this.privSynthesizerConfig.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Url)} Reason: ${p.reason}`))},o=>{throw this.privSynthesisTurn.onAuthCompleted(!0),new Error(o)}),this.privConnectionPromise.catch(()=>{}),this.privConnectionPromise}sendSpeechServiceConfig(s,r){if(r)return s.send(new u.SpeechConnectionMessage(e.MessageType.Text,"speech.config",this.privSynthesisTurn.requestId,"application/json",r))}sendSsmlMessage(s,r,o){return s.send(new u.SpeechConnectionMessage(e.MessageType.Text,"ssml",o,"application/ssml+xml",r))}async fetchConnection(){return this.privConnectionConfigurationPromise!==void 0?this.privConnectionConfigurationPromise.then(s=>s.state()===e.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection())):(this.privConnectionConfigurationPromise=this.configureConnection(),await this.privConnectionConfigurationPromise)}async configureConnection(){const s=await this.connectImpl();return this.configConnectionOverride!==void 0?this.configConnectionOverride(s):(this.setSpeechConfigSynthesisSection(),await this.sendSpeechServiceConfig(s,this.privSynthesizerConfig.SpeechServiceConfig.serialize()),s)}onAvatarEvent(s){}onSynthesisStarted(s){}onSynthesizing(s){}onSynthesisCancelled(s){}onSynthesisCompleted(s){}onWordBoundary(s){}onVisemeReceived(s){}onBookmarkReached(s){}};return vi.SynthesisAdapterBase=n,n.telemetryDataEnabled=!0,vi}var li={},Bu;function Sf(){if(Bu)return li;Bu=1,Object.defineProperty(li,"__esModule",{value:!0}),li.AvatarSynthesisAdapter=void 0;const e=P(),t=A();let i=class extends t.SynthesisAdapterBase{constructor(n,a,s,r,o){super(n,a,s,void 0),this.privAvatarSynthesizer=r,this.privSynthesizer=r,this.privAvatarConfig=o}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(void 0)}setSpeechConfigSynthesisSection(){var n,a,s,r,o,c,p,h,v,d,f,g,m,l,S,C,y;this.privSynthesizerConfig.synthesisVideoSection={format:{bitrate:(n=this.privAvatarConfig.videoFormat)==null?void 0:n.bitrate,codec:(a=this.privAvatarConfig.videoFormat)==null?void 0:a.codec,crop:{bottomRight:{x:(o=(r=(s=this.privAvatarConfig.videoFormat)==null?void 0:s.cropRange)==null?void 0:r.bottomRight)==null?void 0:o.x,y:(h=(p=(c=this.privAvatarConfig.videoFormat)==null?void 0:c.cropRange)==null?void 0:p.bottomRight)==null?void 0:h.y},topLeft:{x:(f=(d=(v=this.privAvatarConfig.videoFormat)==null?void 0:v.cropRange)==null?void 0:d.topLeft)==null?void 0:f.x,y:(l=(m=(g=this.privAvatarConfig.videoFormat)==null?void 0:g.cropRange)==null?void 0:m.topLeft)==null?void 0:l.y}},resolution:{height:(S=this.privAvatarConfig.videoFormat)==null?void 0:S.height,width:(C=this.privAvatarConfig.videoFormat)==null?void 0:C.width}},protocol:{name:"WebRTC",webrtcConfig:{clientDescription:btoa(this.privSynthesizerConfig.parameters.getProperty(e.PropertyId.TalkingAvatarService_WebRTC_SDP)),iceServers:this.privAvatarConfig.remoteIceServers??this.privAvatarSynthesizer.iceServers}},talkingAvatar:{background:{color:this.privAvatarConfig.backgroundColor,image:{url:(y=this.privAvatarConfig.backgroundImage)==null?void 0:y.toString()}},character:this.privAvatarConfig.character,customized:this.privAvatarConfig.customized,photoAvatarBaseModel:this.privAvatarConfig.photoAvatarBaseModel,style:this.privAvatarConfig.style,useBuiltInVoice:this.privAvatarConfig.useBuiltInVoice}}}onAvatarEvent(n){if(this.privAvatarSynthesizer.avatarEventReceived){const a=new e.AvatarEventArgs(n.Data.Offset,n.Data.Name);try{this.privAvatarSynthesizer.avatarEventReceived(this.privAvatarSynthesizer,a)}catch{}}}};return li.AvatarSynthesisAdapter=i,li}var fi={},Fu;function Cf(){if(Fu)return fi;Fu=1,Object.defineProperty(fi,"__esModule",{value:!0}),fi.SpeechSynthesisAdapter=void 0;const e=P(),t=A();let i=class extends t.SynthesisAdapterBase{constructor(n,a,s,r,o){super(n,a,s,o),this.privSpeechSynthesizer=r,this.privSynthesizer=r}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(this.privSpeechSynthesizer)}onSynthesisStarted(n){const a=new e.SpeechSynthesisEventArgs(new e.SpeechSynthesisResult(n,e.ResultReason.SynthesizingAudioStarted));this.privSpeechSynthesizer.synthesisStarted&&this.privSpeechSynthesizer.synthesisStarted(this.privSpeechSynthesizer,a)}onSynthesizing(n){if(this.privSpeechSynthesizer.synthesizing)try{const a=this.privSynthesisTurn.audioOutputFormat.addHeader(n),s=new e.SpeechSynthesisEventArgs(new e.SpeechSynthesisResult(this.privSynthesisTurn.requestId,e.ResultReason.SynthesizingAudio,a));this.privSpeechSynthesizer.synthesizing(this.privSpeechSynthesizer,s)}catch{}}onSynthesisCancelled(n){if(this.privSpeechSynthesizer.SynthesisCanceled){const a=new e.SpeechSynthesisEventArgs(n);try{this.privSpeechSynthesizer.SynthesisCanceled(this.privSpeechSynthesizer,a)}catch{}}}onSynthesisCompleted(n){if(this.privSpeechSynthesizer.synthesisCompleted)try{this.privSpeechSynthesizer.synthesisCompleted(this.privSpeechSynthesizer,new e.SpeechSynthesisEventArgs(n))}catch{}}onWordBoundary(n){if(this.privSpeechSynthesizer.wordBoundary)try{this.privSpeechSynthesizer.wordBoundary(this.privSpeechSynthesizer,n)}catch{}}onVisemeReceived(n){if(this.privSpeechSynthesizer.visemeReceived)try{this.privSpeechSynthesizer.visemeReceived(this.privSpeechSynthesizer,n)}catch{}}onBookmarkReached(n){if(this.privSpeechSynthesizer.bookmarkReached)try{this.privSpeechSynthesizer.bookmarkReached(this.privSpeechSynthesizer,n)}catch{}}};return fi.SpeechSynthesisAdapter=i,fi}var gi={},Uu;function yf(){if(Uu)return gi;Uu=1,Object.defineProperty(gi,"__esModule",{value:!0}),gi.SynthesisRestAdapter=void 0;const e=L(),t=P(),i=Y(),u=U();let n=class{constructor(s,r){let o=s.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Endpoint,void 0);if(!o){const p=s.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Region,"westus"),h=i.ConnectionFactoryBase.getHostSuffix(p);o=s.parameters.getProperty(t.PropertyId.SpeechServiceConnection_Host,`https://${p}.tts.speech${h}`)}this.privUri=`${o}/cognitiveservices/voices/list`;const c=e.RestConfigBase.requestOptions;this.privRestAdapter=new e.RestMessageAdapter(c),this.privAuthentication=r}getVoicesList(s){return this.privRestAdapter.setHeaders(u.HeaderNames.ConnectionId,s),this.privAuthentication.fetch(s).then(r=>(this.privRestAdapter.setHeaders(r.headerName,r.token),this.privRestAdapter.request(e.RestRequestType.Get,this.privUri)))}};return gi.SynthesisRestAdapter=n,gi}var xn={},xu;function Rf(){return xu||(xu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SynthesizerConfig=e.SynthesisServiceType=void 0;const t=A();var i;(function(n){n[n.Standard=0]="Standard",n[n.Custom=1]="Custom"})(i=e.SynthesisServiceType||(e.SynthesisServiceType={}));class u{constructor(a,s){this.privSynthesisServiceType=i.Standard,this.avatarEnabled=!1,this.privSpeechServiceConfig=a||new t.SpeechServiceConfig(new t.Context(null)),this.privParameters=s}get parameters(){return this.privParameters}get synthesisServiceType(){return this.privSynthesisServiceType}set synthesisServiceType(a){this.privSynthesisServiceType=a}set synthesisVideoSection(a){this.privSpeechServiceConfig.Context.synthesis={video:a}}get SpeechServiceConfig(){return this.privSpeechServiceConfig}setContextFromJson(a){const s=JSON.parse(a);s.system&&(this.privSpeechServiceConfig.Context.system=s.system),s.os&&(this.privSpeechServiceConfig.Context.os=s.os),s.audio&&(this.privSpeechServiceConfig.Context.audio=s.audio),s.synthesis&&(this.privSpeechServiceConfig.Context.synthesis=s.synthesis)}}e.SynthesizerConfig=u})(xn)),xn}var mi={},Wu;function Pf(){if(Wu)return mi;Wu=1,Object.defineProperty(mi,"__esModule",{value:!0}),mi.SynthesisContext=void 0;const e=P();let t=class{constructor(){this.privContext={}}setSection(u,n){this.privContext[u]=n}set audioOutputFormat(u){this.privAudioOutputFormat=u}toJSON(){return JSON.stringify(this.privContext)}setSynthesisSection(u){const n=this.buildSynthesisContext(u);this.setSection("synthesis",n)}buildSynthesisContext(u){return{audio:{metadataOptions:{bookmarkEnabled:!!(u!=null&&u.bookmarkReached),punctuationBoundaryEnabled:u==null?void 0:u.properties.getProperty(e.PropertyId.SpeechServiceResponse_RequestPunctuationBoundary,!!(u!=null&&u.wordBoundary)),sentenceBoundaryEnabled:u==null?void 0:u.properties.getProperty(e.PropertyId.SpeechServiceResponse_RequestSentenceBoundary,!1),sessionEndEnabled:!0,visemeEnabled:!!(u!=null&&u.visemeReceived),wordBoundaryEnabled:u==null?void 0:u.properties.getProperty(e.PropertyId.SpeechServiceResponse_RequestWordBoundary,!!(u!=null&&u.wordBoundary))},outputFormat:this.privAudioOutputFormat.requestAudioFormatString},language:{autoDetection:u==null?void 0:u.autoDetectSourceLanguage}}}};return mi.SynthesisContext=t,mi}var Wn={},Hu;function Ef(){return Hu||(Hu=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.type=e.connectivity=e.Device=e.OS=e.System=e.Context=e.SpeechServiceConfig=void 0;class t{constructor(r){this.context=r}serialize(){return JSON.stringify(this,(r,o)=>{if(o&&typeof o=="object"&&!Array.isArray(o)){const c={};for(const p in o)Object.hasOwnProperty.call(o,p)&&(c[p&&p.charAt(0).toLowerCase()+p.substring(1)]=o[p]);return c}return o})}get Context(){return this.context}get Recognition(){return this.recognition}set Recognition(r){this.recognition=r.toLowerCase()}}e.SpeechServiceConfig=t;class i{constructor(r){this.system=new u,this.os=r}}e.Context=i;class u{constructor(){const r="1.47.0";this.name="SpeechSDK",this.version=r,this.build="JavaScript",this.lang="JavaScript"}}e.System=u;class n{constructor(r,o,c){this.platform=r,this.name=o,this.version=c}}e.OS=n;class a{constructor(r,o,c){this.manufacturer=r,this.model=o,this.version=c}}e.Device=a,(function(s){s.Bluetooth="Bluetooth",s.Wired="Wired",s.WiFi="WiFi",s.Cellular="Cellular",s.InBuilt="InBuilt",s.Unknown="Unknown"})(e.connectivity||(e.connectivity={})),(function(s){s.Phone="Phone",s.Speaker="Speaker",s.Car="Car",s.Headset="Headset",s.Thermostat="Thermostat",s.Microphones="Microphones",s.Deskphone="Deskphone",s.RemoteControl="RemoteControl",s.Unknown="Unknown",s.File="File",s.Stream="Stream"})(e.type||(e.type={}))})(Wn)),Wn}var Ku;function A(){return Ku||(Ku=1,(function(e){var t=se&&se.__createBinding||(Object.create?(function(a,s,r,o){o===void 0&&(o=r),Object.defineProperty(a,o,{enumerable:!0,get:function(){return s[r]}})}):(function(a,s,r,o){o===void 0&&(o=r),a[o]=s[r]})),i=se&&se.__exportStar||function(a,s){for(var r in a)r!=="default"&&!Object.prototype.hasOwnProperty.call(s,r)&&t(s,a,r)};Object.defineProperty(e,"__esModule",{value:!0}),e.AutoDetectSourceLanguagesOpenRangeOptionName=e.ForceDictationPropertyName=e.ServicePropertiesPropertyName=e.CancellationErrorCodePropertyName=e.OutputFormatPropertyName=e.SpeechSynthesisAdapter=e.AvatarSynthesisAdapter=void 0,i(yd(),e),i(Rd(),e),i($n(),e),i(Pd(),e),i(Ed(),e),i(es(),e),i(yl(),e),i(Rl(),e),i(Pl(),e),i(El(),e),i(Tl(),e),i(Al(),e),i(Il(),e),i(wl(),e),i(_l(),e),i(Op(),e),i(bl(),e),i(Ml(),e),i(Ol(),e),i(Dl(),e),i(kl(),e),i(Nl(),e),i(zl(),e),i(jl(),e),i(Ll(),e),i(ql(),e),i(Fl(),e),i(Ul(),e),i(xl(),e),i(Wl(),e),i(Kl(),e),i(Jl(),e),i(Ql(),e),i(ef(),e),i(tf(),e),i(lf(),e),i(Kp(),e),i(gf(),e),i(mf(),e);var u=Sf();Object.defineProperty(e,"AvatarSynthesisAdapter",{enumerable:!0,get:function(){return u.AvatarSynthesisAdapter}});var n=Cf();Object.defineProperty(e,"SpeechSynthesisAdapter",{enumerable:!0,get:function(){return n.SpeechSynthesisAdapter}}),i(yf(),e),i(Rf(),e),i(Pf(),e),i(Ef(),e),e.OutputFormatPropertyName="OutputFormat",e.CancellationErrorCodePropertyName="CancellationErrorCode",e.ServicePropertiesPropertyName="ServiceProperties",e.ForceDictationPropertyName="ForceDictation",e.AutoDetectSourceLanguagesOpenRangeOptionName="UND"})(se)),se}var Vu;function Tm(){return Vu||(Vu=1,(function(e){var t=ne&&ne.__createBinding||(Object.create?(function(n,a,s,r){r===void 0&&(r=s),Object.defineProperty(n,r,{enumerable:!0,get:function(){return a[s]}})}):(function(n,a,s,r){r===void 0&&(r=s),n[r]=a[s]})),i=ne&&ne.__exportStar||function(n,a){for(var s in n)s!=="default"&&!Object.prototype.hasOwnProperty.call(a,s)&&t(a,n,s)};Object.defineProperty(e,"__esModule",{value:!0});const u=A();new u.AgentConfig,i(P(),e)})(ne)),ne}export{Tf as g,Tm as r};
