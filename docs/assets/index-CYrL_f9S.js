const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Assistant-XMl3gQGA.js","assets/ionic-core-DuVah5lt.js","assets/vue-vendor-BZt2NHGb.js","assets/speech-sdk-SapOic_u.js","assets/Assistant-D2kYHlrP.css"])))=>i.map(i=>d[i]);
import{l as w,n as r,d as ge,q as u,t as f,v as a,x as M,y as g,z as l,A as ye,B as ve,C as D,D as p,E as k,F as Y,G as Z,H as we}from"./vue-vendor-BZt2NHGb.js";import{I as _e,a as Se,b as be,c as ke,d as Me,e as xe,f as Ce,g as Ae,h as Ie,i as Ee,j as Te,k as Pe,l as Le,m as Be,n as He,o as Re,p as Ne,q as Oe,r as De,s as ze,t as Fe,u as Ue,v as qe,w as je,x as Qe,y as Ge,z as Ve,_ as We,A as Ke}from"./ionic-core-DuVah5lt.js";import{r as Xe}from"./speech-sdk-SapOic_u.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const U=(e,t)=>{const n=e.__vccOpts||e;for(const[o,s]of t)n[o]=s;return n},Ye=ge({name:"App",components:{IonApp:Se,IonRouterOutlet:_e}});function Ze(e,t,n,o,s,i){const c=u("ion-router-outlet"),m=u("ion-app");return f(),w(m,null,{default:r(()=>[a(c)]),_:1})}const Je=U(Ye,[["render",Ze]]),$e={name:"BotFace",props:{botState:{type:String,default:"neutral"},text:{type:String,default:""},isPlayMode:{type:Boolean,default:!0},audioLevel:{type:Number,default:0}},computed:{mouthClass(){return this.botState!=="speaking"||this.audioLevel===0?"":this.audioLevel>.7?"mouth-wide":this.audioLevel>.4?"mouth-medium":this.audioLevel>.15?"mouth-small":"mouth-closed"},mouthStyle(){if(this.botState!=="speaking")return{};const e=Math.min(this.audioLevel,1),t=4,o=t+e*(12-t),s=10,c=s+e*(25-s);return{width:`${c}%`,height:`${o}%`,left:`${50-c/2}%`,borderRadius:e>.3?"50%":"0.5em",transition:"all 0.05s ease-out"}}}},et={class:"bubble speech"},tt={id:"head"},st={id:"face"};function it(e,t,n,o,s,i){return f(),M("div",{id:"bot",class:D([n.botState,i.mouthClass])},[g("p",et,l(n.text),1),g("div",tt,[t[1]||(t[1]=g("div",{id:"left-ear"},[g("div",{id:"left-ear-inner"})],-1)),g("div",st,[t[0]||(t[0]=ye('<div id="eyebrows" data-v-5fca9a8a><div id="left-eyebrow" data-v-5fca9a8a></div><div id="right-eyebrow" data-v-5fca9a8a></div></div><div id="eyes" data-v-5fca9a8a><div id="left-eye" data-v-5fca9a8a><div id="left-pupil" data-v-5fca9a8a></div></div><div id="right-eye" data-v-5fca9a8a><div id="right-pupil" data-v-5fca9a8a></div></div></div><div id="cheeks" data-v-5fca9a8a><div id="left-cheek" data-v-5fca9a8a></div><div id="right-cheek" data-v-5fca9a8a></div></div>',3)),g("div",{id:"mouth",style:ve(i.mouthStyle)},null,4)]),t[2]||(t[2]=g("div",{id:"right-ear"},[g("div",{id:"right-ear-inner"})],-1))])],2)}const nt=U($e,[["render",it],["__scopeId","data-v-5fca9a8a"]]);var L=Xe();const ot="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M256 48C141.31 48 48 141.31 48 256s93.31 208 208 208 208-93.31 208-208S370.69 48 256 48m0 319.91a20 20 0 1 1 20-20 20 20 0 0 1-20 20m21.72-201.15-5.74 122a16 16 0 0 1-32 0l-5.74-121.94v-.05a21.74 21.74 0 1 1 43.44 0Z'/></svg>",at="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M416 80a48.05 48.05 0 0 0-48-48H144a48.05 48.05 0 0 0-48 48v352a48.05 48.05 0 0 0 48 48h224a48.05 48.05 0 0 0 48-48ZM168 432a24 24 0 1 1 24-24 24 24 0 0 1-24 24m0-80a24 24 0 1 1 24-24 24 24 0 0 1-24 24m0-80a24 24 0 1 1 24-24 24 24 0 0 1-24 24m88 160a24 24 0 1 1 24-24 24 24 0 0 1-24 24m0-80a24 24 0 1 1 24-24 24 24 0 0 1-24 24m0-80a24 24 0 1 1 24-24 24 24 0 0 1-24 24m112 136a24 24 0 0 1-48 0v-80a24 24 0 0 1 48 0Zm-24-136a24 24 0 1 1 24-24 24 24 0 0 1-24 24m19.31-100.69A16 16 0 0 1 352 176H160a16 16 0 0 1-16-16V96a16 16 0 0 1 16-16h192a16 16 0 0 1 16 16v64a16 16 0 0 1-4.69 11.31'/></svg>",rt="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M340.75 344.49c5.91-20.7 9.82-44.75 11.31-67.84a4.41 4.41 0 0 0-4.46-4.65h-71.06a4.43 4.43 0 0 0-4.47 4.39v55.3a4.44 4.44 0 0 0 4.14 4.38 273.5 273.5 0 0 1 59 11.39 4.45 4.45 0 0 0 5.54-2.97M323.58 377.31a260 260 0 0 0-46.6-9.09 4.42 4.42 0 0 0-4.91 4.29v65.24a4.47 4.47 0 0 0 6.76 3.7c15.9-9.27 29-24.84 40.84-45.43 1.94-3.36 4.89-9.15 6.67-12.69a4.29 4.29 0 0 0-2.76-6.02M235.29 368.4a257 257 0 0 0-46.56 8.82c-2.64.76-3.75 4.4-2.55 6.79 1.79 3.56 4 8.11 5.89 11.51 13 23 26.84 37.5 41.24 45.93a4.47 4.47 0 0 0 6.76-3.7v-65.27a4.16 4.16 0 0 0-4.78-4.08M235.6 272h-71.06a4.41 4.41 0 0 0-4.46 4.64c1.48 23.06 5.37 47.16 11.26 67.84a4.46 4.46 0 0 0 5.59 3 272.2 272.2 0 0 1 59-11.36 4.44 4.44 0 0 0 4.15-4.38V276.4a4.43 4.43 0 0 0-4.48-4.4M277 143.78a235.8 235.8 0 0 0 46.5-9.14 4.3 4.3 0 0 0 2.76-6c-1.79-3.57-4.27-8.68-6.17-12.09-12.29-22-26.14-37.35-41.24-46a4.48 4.48 0 0 0-6.76 3.7v65.23a4.43 4.43 0 0 0 4.91 4.3M276.54 240h71.06a4.39 4.39 0 0 0 4.46-4.58c-1.48-22.77-5.27-47.8-11.16-68.22a4.46 4.46 0 0 0-5.59-2.95c-19 5.74-38.79 10.43-59.09 12a4.4 4.4 0 0 0-4.15 4.32v55.11a4.4 4.4 0 0 0 4.47 4.32M233.31 70.56c-15.42 8.57-29.17 24.43-41.47 46.37-1.91 3.41-4.19 8.11-6 11.67a4.31 4.31 0 0 0 2.76 6 225.4 225.4 0 0 0 46.54 9.17 4.43 4.43 0 0 0 4.91-4.29V74.26a4.49 4.49 0 0 0-6.74-3.7M235.92 176.26c-20.3-1.55-40.11-6.24-59.09-12a4.46 4.46 0 0 0-5.59 2.95c-5.89 20.42-9.68 45.45-11.16 68.22a4.39 4.39 0 0 0 4.46 4.58h71.06a4.4 4.4 0 0 0 4.47-4.34v-55.09a4.4 4.4 0 0 0-4.15-4.32'/><path d='M414.39 97.61A224 224 0 1 0 97.61 414.39 224 224 0 1 0 414.39 97.61M176.6 430.85a219 219 0 0 1-12.48-19.66c-2-3.69-4.84-9.26-6.73-13.13a7.29 7.29 0 0 0-10.31-3.16c-4.3 2.41-10 5.72-14.13 8.43a147.3 147.3 0 0 1-23.57-22.43 249 249 0 0 1 30.41-18.36c1.86-1 2.77-2.14 2.18-4.18a374.8 374.8 0 0 1-14.09-82.17 4.36 4.36 0 0 0-4.3-4.17H66.84a2 2 0 0 1-2-1.7A98 98 0 0 1 64 256a96 96 0 0 1 .86-14.29 2 2 0 0 1 2-1.7h56.74c2.29 0 4.17-1.32 4.29-3.63a372.7 372.7 0 0 1 14-81.83 4.36 4.36 0 0 0-2.19-5.11 261 261 0 0 1-29.84-17.9 170 170 0 0 1 23.14-22.8c4.08 2.68 9.4 5.71 13.66 8.11a7.89 7.89 0 0 0 11-3.42c1.88-3.87 4-8.18 6.06-11.88a222 222 0 0 1 12.54-19.91A185 185 0 0 1 256 64c28.94 0 55.9 7 80.53 18.46a202 202 0 0 1 12 19c2.59 4.66 5.34 10.37 7.66 15.32a4.29 4.29 0 0 0 5.92 1.94c5.38-2.91 11.21-6.26 16.34-9.63a171.4 171.4 0 0 1 23.2 23 245 245 0 0 1-29.06 17.31 4.35 4.35 0 0 0-2.18 5.12 348.7 348.7 0 0 1 13.85 81.4 4.33 4.33 0 0 0 4.3 4.12l56.62-.07a2 2 0 0 1 2 1.7 117.5 117.5 0 0 1 0 28.62 2 2 0 0 1-2 1.72h-56.67a4.35 4.35 0 0 0-4.3 4.17 367.4 367.4 0 0 1-13.87 81.3 4.45 4.45 0 0 0 2.19 5.19c5 2.59 10.57 5.48 15.37 8.42s9.55 6.08 14.13 9.34a172.7 172.7 0 0 1-23 22.93c-2.44-1.61-5.34-3.44-7.84-4.94-1.72-1-4.89-2.77-6.65-3.76-3.82-2.14-7.88-.54-9.79 3.4s-4.83 9.59-6.87 13.25a212 212 0 0 1-12.35 19.53C310.91 442.37 284.94 448 256 448s-54.77-5.63-79.4-17.15'/></svg>",ct="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M192 448h128M384 208v32c0 70.4-57.6 128-128 128h0c-70.4 0-128-57.6-128-128v-32M256 368v80' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/><path d='M256 320a78.83 78.83 0 0 1-56.55-24.1A80.9 80.9 0 0 1 176 239V128a79.69 79.69 0 0 1 80-80c44.86 0 80 35.14 80 80v111c0 44.66-35.89 81-80 81'/></svg>",lt="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M133 440a35.37 35.37 0 0 1-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0 1 35.77.45l247.85 148.36a36 36 0 0 1 0 61l-247.89 148.4A35.5 35.5 0 0 1 133 440'/></svg>",ut="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M320 146s24.36-12-64-12a160 160 0 1 0 160 160' stroke-linecap='round' stroke-miterlimit='10' class='ionicon-fill-none ionicon-stroke-width'/><path d='m256 58 80 80-80 80' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/></svg>",dt="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M425.7 118.25A240 240 0 0 0 76.32 447l.18.2c.33.35.64.71 1 1.05.74.84 1.58 1.79 2.57 2.78a41.17 41.17 0 0 0 60.36-.42 157.13 157.13 0 0 1 231.26 0 41.18 41.18 0 0 0 60.65.06l3.21-3.5.18-.2a239.93 239.93 0 0 0-10-328.76ZM240 128a16 16 0 0 1 32 0v32a16 16 0 0 1-32 0ZM128 304H96a16 16 0 0 1 0-32h32a16 16 0 0 1 0 32m48.8-95.2a16 16 0 0 1-22.62 0l-22.63-22.62a16 16 0 0 1 22.63-22.63l22.62 22.63a16 16 0 0 1 0 22.62m149.3 23.1-47.5 75.5a31 31 0 0 1-7 7 30.11 30.11 0 0 1-35-49l75.5-47.5a10.23 10.23 0 0 1 11.7 0 10.06 10.06 0 0 1 2.3 14m31.72-23.1a16 16 0 0 1-22.62-22.62l22.62-22.63a16 16 0 0 1 22.63 22.63ZM416 304h-32a16 16 0 0 1 0-32h32a16 16 0 0 1 0 32'/></svg>",ht="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M394 480a16 16 0 0 1-9.39-3L256 383.76 127.39 477a16 16 0 0 1-24.55-18.08L153 310.35 23 221.2a16 16 0 0 1 9-29.2h160.38l48.4-148.95a16 16 0 0 1 30.44 0l48.4 149H480a16 16 0 0 1 9.05 29.2L359 310.35l50.13 148.53A16 16 0 0 1 394 480'/></svg>",mt="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M434.67 285.59v-29.8c0-98.73-80.24-178.79-179.2-178.79a179 179 0 0 0-140.14 67.36m-38.53 82v29.8C76.8 355 157 435 256 435a180.45 180.45 0 0 0 140-66.92' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/><path d='m32 256 44-44 46 44M480 256l-44 44-46-44' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/></svg>",pt="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M256 64C150 64 64 150 64 256s86 192 192 192 192-86 192-192S362 64 256 64Z' stroke-miterlimit='10' class='ionicon-fill-none ionicon-stroke-width'/><path d='M256 128v144h96' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/></svg>",ft="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='m112 112 20 320c.95 18.49 14.4 32 32 32h184c17.67 0 30.87-13.51 32-32l20-320' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/><path d='M80 112h352' stroke-linecap='round' stroke-miterlimit='10' class='ionicon-stroke-width'/><path d='M192 112V72h0a23.93 23.93 0 0 1 24-24h80a23.93 23.93 0 0 1 24 24h0v40M256 176v224M184 176l8 224M328 176l-8 224' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/></svg>",gt="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M232 416a23.88 23.88 0 0 1-14.2-4.68 8 8 0 0 1-.66-.51L125.76 336H56a24 24 0 0 1-24-24V200a24 24 0 0 1 24-24h69.75l91.37-74.81a8 8 0 0 1 .66-.51A24 24 0 0 1 256 120v272a24 24 0 0 1-24 24M320 336a16 16 0 0 1-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0 1 28.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 0 1 320 336'/><path d='M368 384a16 16 0 0 1-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0 1 27.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 0 1-13.87 8'/><path d='M416 432a16 16 0 0 1-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1 1 27-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 0 1 416 432'/></svg>",yt="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M416 432 64 80' stroke-linecap='round' stroke-miterlimit='10' class='ionicon-fill-none ionicon-stroke-width'/><path d='M243.33 98.86a23.89 23.89 0 0 0-25.55 1.82l-.66.51-28.52 23.35a8 8 0 0 0-.59 11.85l54.33 54.33a8 8 0 0 0 13.66-5.66v-64.49a24.51 24.51 0 0 0-12.67-21.71M251.33 335.29 96.69 180.69A16 16 0 0 0 85.38 176H56a24 24 0 0 0-24 24v112a24 24 0 0 0 24 24h69.76l92 75.31a23.9 23.9 0 0 0 25.87 1.69A24.51 24.51 0 0 0 256 391.45v-44.86a16 16 0 0 0-4.67-11.3M352 256c0-24.56-5.81-47.87-17.75-71.27a16 16 0 1 0-28.5 14.55C315.34 218.06 320 236.62 320 256q0 4-.31 8.13a8 8 0 0 0 2.32 6.25l14.36 14.36a8 8 0 0 0 13.55-4.31A146 146 0 0 0 352 256M416 256c0-51.18-13.08-83.89-34.18-120.06a16 16 0 0 0-27.64 16.12C373.07 184.44 384 211.83 384 256c0 23.83-3.29 42.88-9.37 60.65a8 8 0 0 0 1.9 8.26L389 337.4a8 8 0 0 0 13.13-2.79C411 311.76 416 287.26 416 256'/><path d='M480 256c0-74.25-20.19-121.11-50.51-168.61a16 16 0 1 0-27 17.22C429.82 147.38 448 189.5 448 256c0 46.19-8.43 80.27-22.43 110.53a8 8 0 0 0 1.59 9l11.92 11.92a8 8 0 0 0 12.92-2.16C471.6 344.9 480 305 480 256'/></svg>",A={TIMES:"times",PLUS:"plus",MINUS:"minus",DIVIDE:"divide"},h={BEGINNER:"beginner",MEDIUM:"medium",EXPERT:"expert"},J={[A.TIMES]:{[h.BEGINNER]:{min1:1,max1:12,min2:1,max2:12},[h.MEDIUM]:{min1:3,max1:12,min2:3,max2:12},[h.EXPERT]:{min1:5,max1:20,min2:5,max2:20}},[A.PLUS]:{[h.BEGINNER]:{min1:1,max1:50,min2:1,max2:50},[h.MEDIUM]:{min1:1,max1:100,min2:1,max2:100},[h.EXPERT]:{min1:1,max1:1e3,min2:1,max2:1e3}},[A.MINUS]:{[h.BEGINNER]:{min1:10,max1:20,min2:1,max2:10},[h.MEDIUM]:{min1:20,max1:100,min2:1,max2:20},[h.EXPERT]:{min1:100,max1:500,min2:1,max2:100}},[A.DIVIDE]:{[h.BEGINNER]:{min1:1,max1:10,min2:1,max2:10},[h.MEDIUM]:{min1:2,max1:12,min2:2,max2:12},[h.EXPERT]:{min1:3,max1:15,min2:3,max2:15}}},x={BASE_POINTS:1,STREAK_BONUS_THRESHOLD:3,STREAK_BONUS_MULTIPLIER:.5,MAX_STREAK_BONUS:3,LEVEL_MULTIPLIER:{[h.BEGINNER]:1,[h.MEDIUM]:1.5,[h.EXPERT]:2}};function B(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}const vt=1e4;function q(){return"https://olivermath-api.azurewebsites.net"}async function j(e,t={},n=vt){const o=new AbortController,s=setTimeout(()=>o.abort(),n);try{return await fetch(e,{...t,signal:o.signal})}finally{clearTimeout(s)}}async function wt(){const e=await j(`${q()}/api/speechToken`);if(!e.ok)throw new Error(`Speech token request failed: ${e.status}`);return e.json()}async function _t(e,t="en-GB-RyanNeural",n="default"){if(!e||e.trim().length===0)throw new Error("Text is required for speech synthesis");const o=e.slice(0,500),s=await j(`${q()}/api/speak`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:o,voice:t,style:n})});if(!s.ok){const i=await s.json().catch(()=>({}));throw new Error(i.error||`TTS request failed: ${s.status}`)}return s.json()}async function St(e,t,n){if(!e)return{correct:!1,understood:!1,interpretedNumber:null,confidence:"low"};const o=await j(`${q()}/api/validateAnswer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spokenText:e,expectedAnswer:t,question:n})});if(!o.ok){console.warn("validateAnswer API failed, falling back to simple extraction");const s=String(e).match(/\d+/),i=s?parseInt(s[0],10):null;return{correct:i===t,understood:i!==null,interpretedNumber:i,confidence:"low"}}return o.json()}const C=new Map,bt=20,$={"en-GB":"en-GB-RyanNeural","en-US":"en-US-GuyNeural","es-ES":"es-ES-AlvaroNeural","fr-FR":"fr-FR-HenriNeural","de-DE":"de-DE-ConradNeural","pt-BR":"pt-BR-AntonioNeural"};function kt(e){return $[e]||$["en-GB"]}async function Mt(e,t="en-GB"){const n=`${t}:${e.toLowerCase().trim()}`;if(C.has(n)){const c=C.get(n);return c.currentTime=0,c}const o=kt(t),s=await _t(e,o),i=new Audio(`data:audio/mpeg;base64,${s.audio}`);if(C.size>=bt){const c=C.keys().next().value;C.delete(c)}return C.set(n,i),i}const xt={en:{name:"English",flag:"ï¿½ðŸ‡§"},es:{name:"EspaÃ±ol",flag:"ðŸ‡ªðŸ‡¸"},fr:{name:"FranÃ§ais",flag:"ðŸ‡«ðŸ‡·"},de:{name:"Deutsch",flag:"ðŸ‡©ðŸ‡ª"},pt:{name:"PortuguÃªs",flag:"ðŸ‡§ðŸ‡·"}},_={en:{title:"OliverMath",play:"Play",stop:"Stop",listening:"Listening...",thinking:"Thinking...",speaking:"Speaking...",ready:"Ready to play!",settings:"Settings",difficulty:"Difficulty",level:"Level",language:"Language",easy:"Easy",medium:"Medium",hard:"Hard",operators:"Operators",addition:"Addition",subtraction:"Subtraction",multiplication:"Multiplication",division:"Division",score:"Score",streak:"Streak",best:"Best",accuracy:"Accuracy",highScore:"High Score",bestStreak:"Best Streak",history:"History",problemHistory:"Problem History",noHistory:"No problems yet. Start playing!",clearHistory:"Clear History",correct:"Correct",incorrect:"Incorrect",yourAnswer:"Your answer",correctAnswer:"Correct answer",correctPhrases:["That's right!","Excellent!","You got it!","Great job!","Perfect!","Amazing!","Wonderful!","Fantastic!","Super!","Brilliant!","You're a math star!","Outstanding!"],incorrectPhrases:["Not quite, the answer is {answer}","Close! It's {answer}","Good try! The answer is {answer}","Almost! It was {answer}","Nice effort! It's {answer}"],streakPhrases:["You're on fire! {count} in a row!","Incredible streak of {count}!","Unstoppable! {count} correct!","{count} in a row! Keep going!"],hintPhrases:["Take your time!","You can do it!","Think carefully!","Almost there!"],whatIs:"What is",plus:"plus",minus:"minus",times:"times",dividedBy:"divided by"},es:{title:"OliverMath",play:"Jugar",stop:"Parar",listening:"Escuchando...",thinking:"Pensando...",speaking:"Hablando...",ready:"Â¡Listo para jugar!",settings:"Ajustes",difficulty:"Dificultad",level:"Nivel",language:"Idioma",easy:"FÃ¡cil",medium:"Medio",hard:"DifÃ­cil",operators:"Operadores",addition:"Suma",subtraction:"Resta",multiplication:"MultiplicaciÃ³n",division:"DivisiÃ³n",score:"Puntos",streak:"Racha",best:"Mejor",accuracy:"PrecisiÃ³n",highScore:"RÃ©cord",bestStreak:"Mejor Racha",history:"Historial",problemHistory:"Historial de Problemas",noHistory:"Â¡AÃºn no hay problemas. Empieza a jugar!",clearHistory:"Borrar Historial",correct:"Correcto",incorrect:"Incorrecto",yourAnswer:"Tu respuesta",correctAnswer:"Respuesta correcta",correctPhrases:["Â¡Correcto!","Â¡Excelente!","Â¡Lo lograste!","Â¡Muy bien!","Â¡Perfecto!","Â¡IncreÃ­ble!","Â¡Maravilloso!","Â¡FantÃ¡stico!","Â¡SÃºper!","Â¡Brillante!","Â¡Eres una estrella de las matemÃ¡ticas!","Â¡Extraordinario!"],incorrectPhrases:["Casi, la respuesta es {answer}","Â¡Cerca! Es {answer}","Â¡Buen intento! La respuesta es {answer}","Â¡Casi! Era {answer}","Â¡Buen esfuerzo! Es {answer}"],streakPhrases:["Â¡EstÃ¡s en racha! Â¡{count} seguidas!","Â¡Racha increÃ­ble de {count}!","Â¡Imparable! Â¡{count} correctas!","Â¡{count} seguidas! Â¡Sigue asÃ­!"],hintPhrases:["Â¡TÃ³mate tu tiempo!","Â¡TÃº puedes!","Â¡Piensa bien!","Â¡Ya casi!"],whatIs:"Â¿CuÃ¡nto es",plus:"mÃ¡s",minus:"menos",times:"por",dividedBy:"dividido entre"},fr:{title:"OliverMath",play:"Jouer",stop:"ArrÃªter",listening:"Ã‰coute...",thinking:"RÃ©flexion...",speaking:"Parle...",ready:"PrÃªt Ã  jouer!",settings:"ParamÃ¨tres",difficulty:"DifficultÃ©",level:"Niveau",language:"Langue",easy:"Facile",medium:"Moyen",hard:"Difficile",operators:"OpÃ©rateurs",addition:"Addition",subtraction:"Soustraction",multiplication:"Multiplication",division:"Division",score:"Score",streak:"SÃ©rie",best:"Meilleur",accuracy:"PrÃ©cision",highScore:"Meilleur Score",bestStreak:"Meilleure SÃ©rie",history:"Historique",problemHistory:"Historique des ProblÃ¨mes",noHistory:"Pas encore de problÃ¨mes. Commencez Ã  jouer!",clearHistory:"Effacer l'Historique",correct:"Correct",incorrect:"Incorrect",yourAnswer:"Votre rÃ©ponse",correctAnswer:"Bonne rÃ©ponse",correctPhrases:["C'est exact!","Excellent!","Tu l'as!","TrÃ¨s bien!","Parfait!","Incroyable!","Merveilleux!","Fantastique!","Super!","Brillant!","Tu es une star des maths!","Extraordinaire!"],incorrectPhrases:["Pas tout Ã  fait, la rÃ©ponse est {answer}","Presque! C'est {answer}","Bon essai! La rÃ©ponse est {answer}","Presque! C'Ã©tait {answer}","Bel effort! C'est {answer}"],streakPhrases:["Tu es en feu! {count} d'affilÃ©e!","SÃ©rie incroyable de {count}!","InarrÃªtable! {count} correctes!","{count} d'affilÃ©e! Continue!"],hintPhrases:["Prends ton temps!","Tu peux le faire!","RÃ©flÃ©chis bien!","Presque!"],whatIs:"Combien fait",plus:"plus",minus:"moins",times:"fois",dividedBy:"divisÃ© par"},de:{title:"OliverMath",play:"Spielen",stop:"Stoppen",listening:"HÃ¶re zu...",thinking:"Denke nach...",speaking:"Spreche...",ready:"Bereit zum Spielen!",settings:"Einstellungen",difficulty:"Schwierigkeit",level:"Stufe",language:"Sprache",easy:"Leicht",medium:"Mittel",hard:"Schwer",operators:"Operatoren",addition:"Addition",subtraction:"Subtraktion",multiplication:"Multiplikation",division:"Division",score:"Punkte",streak:"Serie",best:"Beste",accuracy:"Genauigkeit",highScore:"Highscore",bestStreak:"Beste Serie",history:"Verlauf",problemHistory:"Problemverlauf",noHistory:"Noch keine Aufgaben. Fang an zu spielen!",clearHistory:"Verlauf lÃ¶schen",correct:"Richtig",incorrect:"Falsch",yourAnswer:"Deine Antwort",correctAnswer:"Richtige Antwort",correctPhrases:["Das stimmt!","Ausgezeichnet!","Du hast es!","Sehr gut!","Perfekt!","Erstaunlich!","Wunderbar!","Fantastisch!","Super!","Brilliant!","Du bist ein Mathe-Star!","Hervorragend!"],incorrectPhrases:["Nicht ganz, die Antwort ist {answer}","Fast! Es ist {answer}","Guter Versuch! Die Antwort ist {answer}","Beinahe! Es war {answer}","Gute BemÃ¼hung! Es ist {answer}"],streakPhrases:["Du bist on fire! {count} hintereinander!","Unglaubliche Serie von {count}!","Nicht zu stoppen! {count} richtig!","{count} hintereinander! Weiter so!"],hintPhrases:["Lass dir Zeit!","Du schaffst das!","Denk gut nach!","Fast geschafft!"],whatIs:"Was ist",plus:"plus",minus:"minus",times:"mal",dividedBy:"geteilt durch"},pt:{title:"OliverMath",play:"Jogar",stop:"Parar",listening:"Ouvindo...",thinking:"Pensando...",speaking:"Falando...",ready:"Pronto para jogar!",settings:"ConfiguraÃ§Ãµes",difficulty:"Dificuldade",level:"NÃ­vel",language:"Idioma",easy:"FÃ¡cil",medium:"MÃ©dio",hard:"DifÃ­cil",operators:"Operadores",addition:"AdiÃ§Ã£o",subtraction:"SubtraÃ§Ã£o",multiplication:"MultiplicaÃ§Ã£o",division:"DivisÃ£o",score:"Pontos",streak:"SequÃªncia",best:"Melhor",accuracy:"PrecisÃ£o",highScore:"Recorde",bestStreak:"Melhor SequÃªncia",history:"HistÃ³rico",problemHistory:"HistÃ³rico de Problemas",noHistory:"Sem problemas ainda. Comece a jogar!",clearHistory:"Limpar HistÃ³rico",correct:"Correto",incorrect:"Incorreto",yourAnswer:"Sua resposta",correctAnswer:"Resposta correta",correctPhrases:["Isso mesmo!","Excelente!","VocÃª conseguiu!","Muito bem!","Perfeito!","IncrÃ­vel!","Maravilhoso!","FantÃ¡stico!","Super!","Brilhante!","VocÃª Ã© uma estrela da matemÃ¡tica!","ExtraordinÃ¡rio!"],incorrectPhrases:["Quase, a resposta Ã© {answer}","Perto! Ã‰ {answer}","Boa tentativa! A resposta Ã© {answer}","Quase! Era {answer}","Bom esforÃ§o! Ã‰ {answer}"],streakPhrases:["VocÃª estÃ¡ pegando fogo! {count} seguidas!","SequÃªncia incrÃ­vel de {count}!","ImparÃ¡vel! {count} corretas!","{count} seguidas! Continue assim!"],hintPhrases:["NÃ£o tenha pressa!","VocÃª consegue!","Pense bem!","Quase lÃ¡!"],whatIs:"Quanto Ã©",plus:"mais",minus:"menos",times:"vezes",dividedBy:"dividido por"}},ee={en:"en-GB",es:"es-ES",fr:"fr-FR",de:"de-DE",pt:"pt-BR"};function Ct(){const e=localStorage.getItem("olivermath_language");if(e&&_[e])return e;const t=navigator.language.split("-")[0];return _[t]?t:"en"}function At(e){return _[e]?(localStorage.setItem("olivermath_language",e),!0):!1}function It(e,t,n={}){let s=(_[e]||_.en)[t]||_.en[t]||t;return Object.keys(n).forEach(i=>{s=s.replace(new RegExp(`{${i}}`,"g"),n[i])}),s}function Et(e,t,n={}){const s=(_[e]||_.en)[t]||_.en[t]||[];if(!Array.isArray(s)||s.length===0)return"";let i=s[Math.floor(Math.random()*s.length)];return Object.keys(n).forEach(c=>{i=i.replace(new RegExp(`{${c}}`,"g"),n[c])}),i}const Q="olivermath_problem_history",Tt=100;function z(){try{const e=localStorage.getItem(Q);return e?JSON.parse(e):[]}catch{return[]}}function Pt(e){try{const t=z();t.unshift({id:Date.now(),question:e.question,num1:e.num1,operator:e.operator,num2:e.num2,correctAnswer:e.correctAnswer,userAnswer:e.userAnswer||"",interpretedAnswer:e.interpretedAnswer,isCorrect:e.isCorrect,difficulty:e.difficulty,timestamp:e.timestamp||Date.now()});const n=t.slice(0,Tt);return localStorage.setItem(Q,JSON.stringify(n)),!0}catch{return console.error("Failed to save problem to history"),!1}}function Lt(){try{return localStorage.removeItem(Q),!0}catch{return!1}}function Bt(e){const t=new Date(e),o=new Date-t,s=Math.floor(o/6e4),i=Math.floor(o/36e5),c=Math.floor(o/864e5);return s<1?"Just now":s<60?`${s}m ago`:i<24?`${i}h ago`:c<7?`${c}d ago`:t.toLocaleDateString()}function Ht(e){return{"+":"+","-":"âˆ’","Ã—":"Ã—","Ã·":"Ã·","*":"Ã—","/":"Ã·"}[e]||e}const T="/OliverMath/",se={correct:`${T}assets/sound/correct.mp3`,incorrect:`${T}assets/sound/incorrect.mp3`,streak:`${T}assets/sound/streak.mp3`,levelUp:`${T}assets/sound/levelup.mp3`,laugh:`${T}assets/sound/laugh.wav`};let y=null;const ie=new Map;let H=!1;function Rt(){return y||(y=new(window.AudioContext||window.webkitAudioContext)),y}async function Nt(){Rt();const e=Object.entries(se).map(async([t,n])=>{try{const o=await fetch(n);if(!o.ok){console.warn(`Sound file not found: ${n}`);return}const s=await o.arrayBuffer(),i=await y.decodeAudioData(s);ie.set(t,i)}catch(o){console.warn(`Failed to load sound: ${t}`,o.message)}});await Promise.allSettled(e)}function F(e,t=.5){if(H||!y)return;const n=ie.get(e);if(!n){const i=se[e];if(i){const c=new Audio(i);c.volume=t,c.play().catch(()=>{})}return}y.state==="suspended"&&y.resume();const o=y.createBufferSource(),s=y.createGain();o.buffer=n,s.gain.value=t,o.connect(s),s.connect(y.destination),o.start(0)}function Ot(e=0){e>=5?F("streak",.6):F("correct",.5)}function Dt(){F("incorrect",.4)}function zt(){return H=!H,H}const te=["#FFD700","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8"];function Ft(e){const t=document.createElement("div");t.className="confetti-particle";const n=te[Math.floor(Math.random()*te.length)],o=Math.random()*10+5,s=Math.random()*100,i=Math.random()*2+2,c=Math.random()*.5;t.style.cssText=`
    position: fixed;
    width: ${o}px;
    height: ${o}px;
    background-color: ${n};
    left: ${s}%;
    top: -20px;
    border-radius: ${Math.random()>.5?"50%":"0"};
    transform: rotate(${Math.random()*360}deg);
    animation: confetti-fall ${i}s ease-out ${c}s forwards;
    pointer-events: none;
    z-index: 9999;
  `,e.appendChild(t),setTimeout(()=>{t.remove()},(i+c)*1e3+100)}function G(){if(document.getElementById("confetti-styles"))return;const e=document.createElement("style");e.id="confetti-styles",e.textContent=`
    @keyframes confetti-fall {
      0% {
        transform: translateY(0) rotate(0deg) scale(1);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg) scale(0.5);
        opacity: 0;
      }
    }
    
    @keyframes confetti-burst {
      0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 1;
      }
      50% {
        opacity: 1;
      }
      100% {
        transform: translate(-50%, -50%) scale(2);
        opacity: 0;
      }
    }
    
    .confetti-burst {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,215,0,0.8) 0%, transparent 70%);
      animation: confetti-burst 0.5s ease-out forwards;
      pointer-events: none;
      z-index: 9998;
    }
    
    .star-burst {
      position: fixed;
      font-size: 48px;
      animation: star-pop 0.6s ease-out forwards;
      pointer-events: none;
      z-index: 9999;
    }
    
    @keyframes star-pop {
      0% {
        transform: translate(-50%, -50%) scale(0) rotate(0deg);
        opacity: 1;
      }
      50% {
        transform: translate(-50%, -50%) scale(1.5) rotate(180deg);
        opacity: 1;
      }
      100% {
        transform: translate(-50%, -50%) scale(0.5) rotate(360deg);
        opacity: 0;
      }
    }
  `,document.head.appendChild(e)}function ne(e=30){G();const t=document.createElement("div");t.className="confetti-container",document.body.appendChild(t);for(let n=0;n<e;n++)setTimeout(()=>Ft(t),n*30);setTimeout(()=>{t.remove()},4e3)}function Ut(){G();const e=document.createElement("div");e.className="confetti-burst",document.body.appendChild(e),setTimeout(()=>e.remove(),500)}function oe(e,t){G();const n=document.createElement("div");n.className="star-burst",n.textContent="â­",n.style.left=`${e}px`,n.style.top=`${t}px`,document.body.appendChild(n),setTimeout(()=>n.remove(),600)}function qt(e){Ut();const t=Math.min(e*10,100);setTimeout(()=>ne(t),200);for(let n=0;n<Math.min(e,5);n++)setTimeout(()=>{const o=Math.random()*window.innerWidth*.6+window.innerWidth*.2,s=Math.random()*window.innerHeight*.4+window.innerHeight*.2;oe(o,s)},n*150)}const jt={name:"Math",components:{BotFace:nt,IonHeader:je,IonToolbar:qe,IonTitle:Ue,IonContent:Fe,IonPage:ze,IonChip:De,IonLabel:Oe,IonIcon:Ne,IonItem:Re,IonSelect:He,IonSelectOption:Be,IonButton:Le,IonFooter:Pe,IonCard:Te,IonCardContent:Ee,IonGrid:Ie,IonRow:Ae,IonCol:Ce,IonSpinner:xe,IonModal:Me,IonPopover:ke,IonList:be},setup(){return{star:ht,playIcon:lt,speedometerIcon:dt,calculatorIcon:at,micIcon:ct,volumeIcon:gt,syncIcon:mt,alertIcon:ot,refreshIcon:ut,muteIcon:yt,historyIcon:pt,trashIcon:ft,globeIcon:rt}},data(){return{typeText:[],isLoading:!0,isOnBoundary:!1,isTalking:!1,isListening:!1,isComputing:!1,isLaughing:!1,isError:!1,isQuery:!1,isPlayMode:!0,isResolved:!1,isHappy:!1,isSad:!1,isExcited:!1,isProud:!1,isSurprised:!1,isConfused:!1,text:"",selectedLevel:h.MEDIUM,selectedOperator:A.TIMES,selectedLanguage:"en",speech_phrases:"Click play, listen the question and respond back by talking your answer.",number1:2,number2:3,stars:0,highScore:0,bestStreak:0,previousPosition:-1,consecutiveCorrect:0,totalQuestionsAnswered:0,totalCorrectAnswers:0,isMuted:!1,currentQuestion:"",showHistoryModal:!1,problemHistory:[],availableLanguages:xt,synth:window.speechSynthesis,greetingSpeech:new window.SpeechSynthesisUtterance,audioConfig:null,speechConfig:null,speechRecognizer:null,speechRecording:null,token:null,speechRegion:null,audioPlayer:null,audioContext:null,audioAnalyser:null,audioSource:null,audioLevel:0,animationFrameId:null,isMicrophoneEnabled:!1,publicPath:"/OliverMath/",timeout:null,expressionTimeout:null}},computed:{botState(){return this.isError?"broken":this.isLaughing?"laughing":this.isHappy?"happy":this.isSad?"sad":this.isExcited?"excited":this.isProud?"proud":this.isSurprised?"surprised":this.isConfused?"confused":this.isTalking?"speaking":this.isListening?"listening":this.isComputing?"computing":"thinking"},expectedResultAsNumber(){return this.selectedOperator=="plus"?this.number1+this.number2:this.selectedOperator=="minus"?this.number1-this.number2:this.selectedOperator=="divide"?this.number1/this.number2:this.number1*this.number2},accuracy(){return this.totalQuestionsAnswered===0?0:Math.round(this.totalCorrectAnswers/this.totalQuestionsAnswered*100)},statusColor(){switch(this.botState){case"speaking":return"primary";case"listening":return"success";case"computing":return"warning";case"broken":return"danger";case"laughing":return"tertiary";case"happy":return"success";case"sad":return"primary";case"excited":return"secondary";case"proud":return"warning";case"surprised":return"tertiary";case"confused":return"medium";default:return"medium"}},statusText(){switch(this.botState){case"speaking":return this.t("speaking");case"listening":return this.t("listening");case"computing":return this.t("thinking");case"broken":return"Error";case"laughing":return"Haha!";case"happy":return this.t("correct")+"! ðŸŽ‰";case"sad":return"...";case"excited":return"ðŸŽ‰";case"proud":return"â­";case"surprised":return"!";case"confused":return"?";default:return this.t("ready")}},statusIcon(){switch(this.botState){case"speaking":return this.volumeIcon;case"listening":return this.micIcon;case"computing":return this.syncIcon;case"broken":return this.alertIcon;case"happy":return this.starIcon;case"sad":return this.alertIcon;case"excited":return this.starIcon;case"proud":return this.starIcon;case"surprised":return this.starIcon;case"confused":return this.syncIcon;default:return this.syncIcon}}},methods:{showExpression(e,t=2e3){switch(this.isHappy=!1,this.isSad=!1,this.isExcited=!1,this.isProud=!1,this.isSurprised=!1,this.isConfused=!1,e){case"happy":this.isHappy=!0;break;case"sad":this.isSad=!0;break;case"excited":this.isExcited=!0;break;case"proud":this.isProud=!0;break;case"surprised":this.isSurprised=!0;break;case"confused":this.isConfused=!0;break}this.expressionTimeout&&clearTimeout(this.expressionTimeout),this.expressionTimeout=setTimeout(()=>{this.isHappy=!1,this.isSad=!1,this.isExcited=!1,this.isProud=!1,this.isSurprised=!1,this.isConfused=!1},t)},initAudioAnalysis(){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioAnalyser=this.audioContext.createAnalyser(),this.audioAnalyser.fftSize=256,this.audioAnalyser.smoothingTimeConstant=.3)},startAudioAnalysis(e){if(this.initAudioAnalysis(),this.audioSource)try{this.audioSource.disconnect()}catch{}try{this.audioSource=this.audioContext.createMediaElementSource(e),this.audioSource.connect(this.audioAnalyser),this.audioAnalyser.connect(this.audioContext.destination)}catch(t){console.warn("Audio source already connected:",t.message)}this.audioContext.state==="suspended"&&this.audioContext.resume(),this.analyzeAudio()},analyzeAudio(){if(!this.isTalking||!this.audioAnalyser){this.audioLevel=0;return}(!this._audioDataArray||this._audioDataArray.length!==this.audioAnalyser.frequencyBinCount)&&(this._audioDataArray=new Uint8Array(this.audioAnalyser.frequencyBinCount),this._voiceStart=Math.floor(80/(this.audioContext.sampleRate/this.audioAnalyser.fftSize)),this._voiceEnd=Math.floor(3e3/(this.audioContext.sampleRate/this.audioAnalyser.fftSize))),this.audioAnalyser.getByteFrequencyData(this._audioDataArray);let e=0;const t=Math.min(this._voiceEnd,this._audioDataArray.length);for(let s=this._voiceStart;s<t;s++)e+=this._audioDataArray[s];const n=t-this._voiceStart,o=n>0?e/n:0;this.audioLevel=Math.min(1,o/128*1.5),this.animationFrameId=requestAnimationFrame(()=>this.analyzeAudio())},stopAudioAnalysis(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.audioLevel=0,this._audioDataArray=null,this._voiceStart=null,this._voiceEnd=null},changeStatus(e){if(this.timeout&&e=="laughing"){var t=new Audio(window.location.origin+this.$route.path+this.publicPath+"assets/sound/laugh.wav");t.play(),this.isLaughing=!0}clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.isLaughing=!1},1500)},keyDownHandler(e){let t=e.key*1;!isNaN(parseFloat(t))&&isFinite(t)&&(this.typeText.push(t),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(async()=>{if(this.typeText.length>0){var n=this.typeText.join("");this.showToast("Your typed response: "+n,"secondary");const o=parseInt(n,10);!isNaN(o)&&o===this.expectedResultAsNumber&&(this.isResolved=!0,await this.validateSpeechRecording(n,!0)),this.typeText=[]}},400))},async showToast(e,t){return(await Qe.create({message:e,duration:5e3,color:t,translucent:!1,cssClass:"toast-custom-position",animated:!1})).present()},async enableMicrophone(){var e=this;this.isMicrophoneEnabled||(e.speech_phrases="enabling microphone..",e.isMicrophoneEnabled=!0,await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(t){e.audioConfig=L.AudioConfig.fromMicrophoneInput(t.id),e.speech_phrases="microphone enabled"}).catch(function(){e.speech_phrases="microphone disabled",e.isError=!0,e.showToast("Microphone disabled","danger"),e.isMicrophoneEnabled=!1}))},async askQuestion(){this.audioConfig=L.AudioConfig.fromDefaultMicrophoneInput(),this.isResolved=!1;var e=this;this.isComputing=!0,this.showExpression("surprised",800),await this.enableMicrophone().then(function(){var t;if(e.isMicrophoneEnabled){e.isComputing=!1,e.isQuery=!0,e.isPlayMode=!1,e.speech_phrases="";const n=((t=J[e.selectedOperator])==null?void 0:t[e.selectedLevel])||J[A.TIMES][h.BEGINNER];if(e.selectedOperator==="divide"){const i=B(n.min2,n.max2),c=B(n.min1,n.max1);e.number1=i*c,e.number2=i}else e.number1=B(n.min1,n.max1),e.number2=B(n.min2,n.max2);const s={plus:e.t("plus"),minus:e.t("minus"),times:e.t("times"),divide:e.t("dividedBy")}[e.selectedOperator]||e.selectedOperator;e.text=`${e.t("whatIs")} ${e.number1} ${s} ${e.number2}?`,e.currentQuestion=e.text,e.speak()}else e.speech_phrases="microphone not available",e.isError=!0,e.showToast("Microphone not available","danger")}).catch(function(t){console.error("Failed to ask question:",t),e.isError=!0,e.text="Something went wrong. Please try again.",e.showToast(e.text,"danger")})},async speak(){if(!(this.audioPlayer&&!this.audioPlayer.paused)){this.speech_phrases=this.text,this.isTalking=!0,this.isOnBoundary=!0;try{const e=ee[this.selectedLanguage]||"en-GB",t=await Mt(this.text,e);this.audioPlayer=t,t.crossOrigin="anonymous",t.onplay=()=>{this.startAudioAnalysis(t)},t.onended=()=>{this.isTalking=!1,this.stopAudioAnalysis(),this.isQuery&&(this.isQuery=!1,this.listen())},t.onerror=()=>{this.isTalking=!1,this.stopAudioAnalysis(),this.speakWithBrowser()},await t.play()}catch(e){console.error("Azure TTS error:",e),this.isTalking=!1,this.stopAudioAnalysis(),this.speakWithBrowser()}}},speakWithBrowser(){this.synth.speaking||(this.greetingSpeech.text=this.text,this.synth.speak(this.greetingSpeech))},listen(){this.showToast(this.t("listening"),"warning"),this.isComputing=!0,this.isListening=!1;var e=L.SpeechConfig.fromAuthorizationToken(this.token,this.speechRegion);e.speechRecognitionLanguage=ee[this.selectedLanguage]||"en-GB",this.speechConfig=e,this.speechRecording=new L.SpeechRecognizer(this.speechConfig,this.audioConfig),this.listenForSpeechRecordingEvents()},listenForSpeechRecordingEvents(){const e=this;this.speechRecording.speechStartDetected=function(){console.log("speechStartDetected"),e.showToast("I'm Listening","success"),e.isListening=!0,e.isComputing=!1},this.speechRecording.recognizing=function(t,n){window.console.log("recognizing ",n.result.text),e.validateSpeechRecording(n.result.text,!1)},this.speechRecording.recognizeOnceAsync(function(t){e.validateSpeechRecording(t.text,!0),e.isListening=!1,e.isComputing=!1,e.speechRecording.close(),e.speechRecording=null},function(t){console.log("err recognizeOnceAsync",t),e.showToast("Unable to connect to the server.","danger"),e.isListening=!1,e.isComputing=!1,e.isQuery=!1,e.isError=!0,e.text="Unable to recognized the voice. Internal error",e.showToast(e.text),e.speechRecording.close(),e.speechRecording=null})},listenForSpeechEvents(){this.greetingSpeech.onstart=()=>{this.isTalking=!0,this.isOnBoundary=!1,this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.isOnBoundary||(this.speech_phrases=this.text,this.isOnBoundary=!0)},600)},this.greetingSpeech.onend=()=>{this.isTalking=!1,this.isQuery&&(this.isQuery=!1,this.listen())},this.greetingSpeech.onboundary=e=>{if(this.isOnBoundary=!0,e.name=="word"){var t=this.getWordAt(this.text,e.charIndex).toLowerCase();t=="times"&&(t="x"),t=="plus"&&(t="+"),t=="minus"&&(t="-"),this.speech_phrases+=t+" "}}},calculatePoints(){const e=x.LEVEL_MULTIPLIER[this.selectedLevel]||1;let t=1;if(this.consecutiveCorrect>=x.STREAK_BONUS_THRESHOLD){const n=this.consecutiveCorrect-x.STREAK_BONUS_THRESHOLD+1;t=Math.min(1+n*x.STREAK_BONUS_MULTIPLIER,x.MAX_STREAK_BONUS)}return Math.round(x.BASE_POINTS*e*t)},checkDifficultyAdjustment(){if(this.consecutiveCorrect>=5&&this.selectedLevel!==h.EXPERT){const e=this.selectedLevel===h.BEGINNER?h.MEDIUM:h.EXPERT;this.showToast(`Great job! Consider trying ${e} level! ðŸš€`,"success")}},repeatQuestion(){this.currentQuestion&&!this.isTalking&&(this.text=this.currentQuestion,this.speak())},handleToggleMute(){this.isMuted=zt(),this.showToast(this.isMuted?"Sound muted ðŸ”‡":"Sound on ðŸ”Š","medium")},openHistoryModal(){this.problemHistory=z(),this.showHistoryModal=!0},handleClearHistory(){Lt(),this.problemHistory=[],this.showToast(this.t("clearHistory")+" âœ“","success")},changeLanguage(e){At(e),this.selectedLanguage=e,this.showToast(`${this.availableLanguages[e].flag} ${this.availableLanguages[e].name}`,"success")},t(e,t={}){return It(this.selectedLanguage,e,t)},getPhrase(e,t={}){return Et(this.selectedLanguage,e,t)},getOperatorSymbol:Ht,formatTimestamp:Bt,triggerHaptic(e="light"){if("vibrate"in navigator){const t={light:[10],medium:[20],heavy:[50],success:[10,50,10],error:[50,30,50]};navigator.vibrate(t[e]||t.light)}},async validateWordWithLLM(e){if(!(!e||this.isResolved))try{const t=await St(e,this.expectedResultAsNumber,this.text);return t.correct&&(this.isResolved=!0),t.understood&&t.interpretedNumber!==null&&console.log(`LLM interpreted "${e}" as ${t.interpretedNumber} (confidence: ${t.confidence})`),t}catch(t){console.error("LLM validation failed:",t);const n=String(e).match(/\d+/),o=n?parseInt(n[0],10):null;return o!==null&&o===this.expectedResultAsNumber&&(this.isResolved=!0),{correct:this.isResolved,understood:o!==null}}},async validateSpeechRecording(e,t){const n=e===void 0||e==="",o=n?"(silent)":String(e);let s=null;if(n)t&&this.showExpression("confused",2e3);else if(this.showToast(`I heard: "${o}"`,"secondary"),this.isComputing=!0,s=await this.validateWordWithLLM(e),this.isComputing=!1,s!=null&&s.understood&&s.interpretedNumber!==null){const i=s.interpretedNumber;this.showToast(`Interpreted as: ${i}`,s.correct?"success":"warning")}if(t&&(this.totalQuestionsAnswered++,localStorage.totalQuestions=this.totalQuestionsAnswered),this.isResolved){this.consecutiveCorrect++,this.totalCorrectAnswers++,localStorage.totalCorrect=this.totalCorrectAnswers;const i=this.calculatePoints();this.stars+=i,Ot(this.consecutiveCorrect),this.consecutiveCorrect>=5?qt(this.consecutiveCorrect):this.consecutiveCorrect>=3?ne(40):oe(window.innerWidth/2,window.innerHeight/2),this.consecutiveCorrect>this.bestStreak&&(this.bestStreak=this.consecutiveCorrect,localStorage.bestStreak=this.bestStreak),this.stars>this.highScore&&(this.highScore=this.stars,localStorage.highScore=this.highScore),localStorage.stars=this.stars,this.triggerHaptic(this.consecutiveCorrect>=5?"success":"light");const c=this.getPhrase("correctPhrases");let m="";if(this.consecutiveCorrect>=5){const v=this.getPhrase("streakPhrases",{count:this.consecutiveCorrect});m=`${c}! ${v} +${i} â­!`,this.showExpression("excited",3e3)}else this.consecutiveCorrect>=3?(m=`${c}! ${this.t("streak")}: ${this.consecutiveCorrect}! +${i} â­!`,this.showExpression("proud",2500)):(m=`${c}! +${i} â­`,this.showExpression("happy",2e3));this.text=m,this.checkDifficultyAdjustment()}else if(t){this.consecutiveCorrect=0,Dt(),this.triggerHaptic("error");const i=this.getPhrase("incorrectPhrases",{answer:this.expectedResultAsNumber}),c=this.getPhrase("hintPhrases");this.text=`${i}. ${c}`,n||this.showExpression("sad",2e3)}t&&Pt({question:this.currentQuestion,num1:this.number1,operator:this.getOperatorSymbolForHistory(this.selectedOperator),num2:this.number2,correctAnswer:this.expectedResultAsNumber,userAnswer:e||"",interpretedAnswer:(s==null?void 0:s.interpretedNumber)??null,isCorrect:this.isResolved,difficulty:this.selectedLevel,timestamp:Date.now()}),t&&(this.speak(),this.isPlayMode=!0)},getOperatorSymbolForHistory(e){return{plus:"+",minus:"-",times:"Ã—",divide:"Ã·"}[e]||e},getWordAt(e,t){if(e=String(e),t=Number(t)>>>0,this.previousPosition===t)return this.isTalking=!1,"";this.previousPosition=t;const n=e.slice(0,t+1).search(/\S+$/),o=e.slice(t).search(/\s/);return o<0?(this.isQuery||(this.isPlayMode=!0),this.isTalking=!1,e.slice(n)):e.slice(n,o+t)}},async mounted(){try{await navigator.mediaDevices.getUserMedia({audio:!0}),this.isMicrophoneEnabled=!0}catch{console.warn("Microphone not available")}this.listenForSpeechEvents();const e=localStorage.getItem("stars");e&&(this.stars=parseInt(e,10)||0);const t=localStorage.getItem("highScore");t&&(this.highScore=parseInt(t,10)||0);const n=localStorage.getItem("bestStreak");n&&(this.bestStreak=parseInt(n,10)||0);const o=localStorage.getItem("totalQuestions");o&&(this.totalQuestionsAnswered=parseInt(o,10)||0);const s=localStorage.getItem("totalCorrect");s&&(this.totalCorrectAnswers=parseInt(s,10)||0),this.selectedLanguage=Ct(),this.problemHistory=z(),Nt().catch(i=>console.warn("Sound preload failed:",i));try{const{token:i,region:c}=await wt();this.token=i,this.speechRegion=c}catch(i){console.error("Failed to get speech token:",i),this.isError=!0,this.speech_phrases="Server is unavailable. Please refresh the page.",this.showToast(this.speech_phrases,"danger")}},created(){window.addEventListener("keydown",this.keyDownHandler)},unmounted(){window.removeEventListener("keydown",this.keyDownHandler),this.audioPlayer&&(this.audioPlayer.pause(),this.audioPlayer=null),this.stopAudioAnalysis(),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.timeout&&clearTimeout(this.timeout),this.expressionTimeout&&clearTimeout(this.expressionTimeout)}},Qt={key:0,class:"action-buttons"},Gt={class:"language-selector"},Vt={class:"language-flag"},Wt={class:"language-flag"},Kt={key:0,class:"no-history"},Xt={class:"problem-equation"},Yt={key:0,class:"user-answer"},Zt={class:"problem-time"},Jt={class:"bot-container"},$t={key:1,class:"status-indicator"};function es(e,t,n,o,s,i){const c=u("ion-title"),m=u("ion-icon"),v=u("ion-label"),I=u("ion-chip"),R=u("ion-toolbar"),V=u("ion-header"),S=u("ion-select-option"),W=u("ion-select"),P=u("ion-item"),E=u("ion-col"),K=u("ion-row"),re=u("ion-grid"),ce=u("ion-card-content"),le=u("ion-card"),b=u("ion-button"),X=u("ion-list"),N=u("ion-content"),ue=u("ion-popover"),de=u("ion-modal"),he=u("BotFace"),me=u("ion-spinner"),pe=u("ion-footer"),fe=u("ion-page");return f(),w(fe,null,{default:r(()=>[a(V,null,{default:r(()=>[a(R,{color:"primary"},{default:r(()=>[a(c,null,{default:r(()=>[p(l(i.t("title")),1)]),_:1}),a(I,{slot:"end",color:"warning","aria-label":"Stars earned"},{default:r(()=>[a(m,{icon:o.star,"aria-hidden":"true"},null,8,["icon"]),a(v,null,{default:r(()=>[p(l(s.stars),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(N,{fullscreen:!0,class:"ion-padding",role:"main"},{default:r(()=>[a(le,{class:"settings-card"},{default:r(()=>[a(ce,null,{default:r(()=>[a(re,null,{default:r(()=>[a(K,{class:"ion-align-items-center"},{default:r(()=>[a(E,{size:"6"},{default:r(()=>[a(P,{lines:"none",class:"setting-item"},{default:r(()=>[a(m,{icon:o.speedometerIcon,slot:"start",color:"primary"},null,8,["icon"]),a(W,{interface:"popover",value:s.selectedLevel,onIonChange:t[0]||(t[0]=d=>s.selectedLevel=d.target.value),label:i.t("level"),"label-placement":"stacked"},{default:r(()=>[a(S,{value:"beginner"},{default:r(()=>[p(l(i.t("easy")),1)]),_:1}),a(S,{value:"medium"},{default:r(()=>[p(l(i.t("medium")),1)]),_:1}),a(S,{value:"expert"},{default:r(()=>[p(l(i.t("hard")),1)]),_:1})]),_:1},8,["value","label"])]),_:1})]),_:1}),a(E,{size:"6"},{default:r(()=>[a(P,{lines:"none",class:"setting-item"},{default:r(()=>[a(m,{icon:o.calculatorIcon,slot:"start",color:"secondary"},null,8,["icon"]),a(W,{interface:"popover",value:s.selectedOperator,onIonChange:t[1]||(t[1]=d=>s.selectedOperator=d.target.value),label:i.t("operators"),"label-placement":"stacked"},{default:r(()=>[a(S,{value:"times"},{default:r(()=>[p("Ã— "+l(i.t("multiplication")),1)]),_:1}),a(S,{value:"plus"},{default:r(()=>[p("+ "+l(i.t("addition")),1)]),_:1}),a(S,{value:"minus"},{default:r(()=>[p("âˆ’ "+l(i.t("subtraction")),1)]),_:1}),a(S,{value:"divide"},{default:r(()=>[p("Ã· "+l(i.t("division")),1)]),_:1})]),_:1},8,["value","label"])]),_:1})]),_:1})]),_:1}),a(K,{class:"stats-row ion-align-items-center ion-justify-content-center"},{default:r(()=>[a(E,{size:"auto"},{default:r(()=>[a(I,{color:"tertiary",outline:"",class:"stat-chip"},{default:r(()=>[a(v,null,{default:r(()=>[p("ðŸ† "+l(i.t("best"))+": "+l(s.highScore),1)]),_:1})]),_:1})]),_:1}),a(E,{size:"auto"},{default:r(()=>[a(I,{color:"secondary",outline:"",class:"stat-chip"},{default:r(()=>[a(v,null,{default:r(()=>[p("ðŸ”¥ "+l(i.t("streak"))+": "+l(s.consecutiveCorrect),1)]),_:1})]),_:1})]),_:1}),a(E,{size:"auto"},{default:r(()=>[a(I,{color:"success",outline:"",class:"stat-chip"},{default:r(()=>[a(v,null,{default:r(()=>[p("ðŸŽ¯ "+l(i.t("accuracy"))+": "+l(i.accuracy)+"%",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),!s.isPlayMode&&!s.isComputing?(f(),M("div",Qt,[a(b,{fill:"clear",size:"small",onClick:i.repeatQuestion,disabled:!s.currentQuestion||s.isTalking,title:"Repeat question"},{default:r(()=>[a(m,{icon:o.refreshIcon,slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick","disabled"]),a(b,{fill:"clear",size:"small",onClick:i.handleToggleMute,title:"Toggle sound"},{default:r(()=>[a(m,{icon:s.isMuted?o.muteIcon:o.volumeIcon,slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"]),a(b,{fill:"clear",size:"small",onClick:i.openHistoryModal,title:"Problem history"},{default:r(()=>[a(m,{icon:o.historyIcon,slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])])):k("",!0),g("div",Gt,[a(b,{fill:"clear",size:"small",id:"language-trigger"},{default:r(()=>{var d;return[g("span",Vt,l((d=s.availableLanguages[s.selectedLanguage])==null?void 0:d.flag),1)]}),_:1}),a(ue,{trigger:"language-trigger","trigger-action":"click"},{default:r(()=>[a(N,{class:"ion-padding"},{default:r(()=>[a(X,null,{default:r(()=>[(f(!0),M(Y,null,Z(s.availableLanguages,(d,O)=>(f(),w(P,{key:O,button:"",onClick:os=>i.changeLanguage(O),class:D({"selected-language":O===s.selectedLanguage})},{default:r(()=>[g("span",Wt,l(d.flag),1),a(v,null,{default:r(()=>[p(l(d.name),1)]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1})]),_:1})]),_:1})]),a(de,{"is-open":s.showHistoryModal,onDidDismiss:t[3]||(t[3]=d=>s.showHistoryModal=!1)},{default:r(()=>[a(V,null,{default:r(()=>[a(R,{color:"primary"},{default:r(()=>[a(c,null,{default:r(()=>[p(l(i.t("problemHistory")),1)]),_:1}),a(b,{slot:"end",fill:"clear",onClick:t[2]||(t[2]=d=>s.showHistoryModal=!1)},{default:r(()=>[a(m,{icon:o.alertIcon,slot:"icon-only",style:{color:"white"}},null,8,["icon"])]),_:1})]),_:1})]),_:1}),a(N,{class:"ion-padding"},{default:r(()=>[s.problemHistory.length===0?(f(),M("div",Kt,[g("p",null,l(i.t("noHistory")),1)])):(f(),w(X,{key:1},{default:r(()=>[(f(!0),M(Y,null,Z(s.problemHistory,d=>(f(),w(P,{key:d.id,class:D(d.isCorrect?"correct-item":"incorrect-item")},{default:r(()=>[a(v,null,{default:r(()=>[g("h2",Xt,l(d.num1)+" "+l(i.getOperatorSymbol(d.operator))+" "+l(d.num2)+" = "+l(d.correctAnswer),1),d.isCorrect?k("",!0):(f(),M("p",Yt,l(i.t("yourAnswer"))+": "+l(d.userAnswer||"?"),1)),g("p",Zt,l(i.formatTimestamp(d.timestamp)),1)]),_:2},1024),a(m,{slot:"end",icon:d.isCorrect?o.star:o.alertIcon,color:d.isCorrect?"success":"danger"},null,8,["icon","color"])]),_:2},1032,["class"]))),128))]),_:1})),s.problemHistory.length>0?(f(),w(b,{key:2,expand:"block",color:"danger",fill:"outline",onClick:i.handleClearHistory,class:"clear-history-btn"},{default:r(()=>[a(m,{icon:o.trashIcon,slot:"start"},null,8,["icon"]),p(" "+l(i.t("clearHistory")),1)]),_:1},8,["onClick"])):k("",!0)]),_:1})]),_:1},8,["is-open"]),g("div",Jt,[a(he,{botState:i.botState,isPlayMode:s.isPlayMode,text:s.speech_phrases,audioLevel:s.audioLevel,onAsk_question:i.askQuestion,onClick:t[4]||(t[4]=d=>i.changeStatus("laughing")),"aria-live":"polite"},null,8,["botState","isPlayMode","text","audioLevel","onAsk_question"])]),i.botState!=="thinking"?(f(),M("div",$t,[a(I,{color:i.statusColor,outline:""},{default:r(()=>[a(m,{icon:i.statusIcon,"aria-hidden":"true"},null,8,["icon"]),a(v,null,{default:r(()=>[p(l(i.statusText),1)]),_:1})]),_:1},8,["color"])])):k("",!0)]),_:1}),a(pe,{class:"ion-no-border"},{default:r(()=>[a(R,null,{default:r(()=>[s.isPlayMode&&i.botState!=="broken"?(f(),w(b,{key:0,expand:"block",size:"large",onClick:i.askQuestion,disabled:s.isComputing,class:"play-button","aria-label":"Start a new math question"},{default:r(()=>[s.isComputing?k("",!0):(f(),w(m,{key:0,icon:o.playIcon,slot:"start"},null,8,["icon"])),s.isComputing?(f(),w(me,{key:1,name:"crescent"})):k("",!0),p(" "+l(s.isComputing?i.t("thinking"):i.t("play")+" Math!"),1)]),_:1},8,["onClick","disabled"])):k("",!0)]),_:1})]),_:1})]),_:1})}const ts=U(jt,[["render",es],["__scopeId","data-v-4899d4eb"]]),ss=()=>We(()=>import("./Assistant-XMl3gQGA.js"),__vite__mapDeps([0,1,2,3,4])),is=[{path:"/",name:"Home",component:ts},{path:"/assistant",name:"Assistant",component:ss}],ae=Ge({history:Ve("/OliverMath/"),routes:is}),ns=we(Je).use(Ke).use(ae);ae.isReady().then(()=>{ns.mount("#app")});export{U as _};
