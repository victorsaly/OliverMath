const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Assistant-BhsRS6BS.js","assets/ionic-core-CxxmTmYJ.js","assets/vue-vendor-D6lqZCUP.js","assets/speech-sdk-SapOic_u.js","assets/Assistant-D2kYHlrP.css"])))=>i.map(i=>d[i]);
import{l as v,n as r,d as Z,q as c,t as m,v as o,x as B,y as h,z as b,A as X,B as K,C as Y,D as d,E as _,F as J}from"./vue-vendor-D6lqZCUP.js";import{I as ee,a as te,b as se,c as ie,d as ne,e as oe,f as ae,g as re,h as ce,i as le,j as ue,k as de,l as he,m as pe,n as me,o as fe,p as ge,q as ve,r as ye,s as we,t as _e,u as xe,v as be,w as Se,_ as Ce,x as ke}from"./ionic-core-CxxmTmYJ.js";import{r as Ie}from"./speech-sdk-SapOic_u.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();const k=(e,t)=>{const i=e.__vccOpts||e;for(const[a,s]of t)i[a]=s;return i},Ee=Z({name:"App",components:{IonApp:te,IonRouterOutlet:ee}});function Me(e,t,i,a,s,n){const l=c("ion-router-outlet"),p=c("ion-app");return m(),v(p,null,{default:r(()=>[o(l)]),_:1})}const Te=k(Ee,[["render",Me]]),Ae={name:"BotFace",props:{botState:{type:String,default:"neutral"},text:{type:String,default:""},isPlayMode:{type:Boolean,default:!0},audioLevel:{type:Number,default:0}},computed:{mouthClass(){return this.botState!=="speaking"||this.audioLevel===0?"":this.audioLevel>.7?"mouth-wide":this.audioLevel>.4?"mouth-medium":this.audioLevel>.15?"mouth-small":"mouth-closed"},mouthStyle(){if(this.botState!=="speaking")return{};const e=Math.min(this.audioLevel,1),t=4,a=t+e*(12-t),s=10,l=s+e*(25-s);return{width:`${l}%`,height:`${a}%`,left:`${50-l/2}%`,borderRadius:e>.3?"50%":"0.5em",transition:"all 0.05s ease-out"}}}},Re={class:"bubble speech"},Le={id:"head"},Pe={id:"face"};function Be(e,t,i,a,s,n){return m(),B("div",{id:"bot",class:Y([i.botState,n.mouthClass])},[h("p",Re,b(i.text),1),h("div",Le,[t[1]||(t[1]=h("div",{id:"left-ear"},[h("div",{id:"left-ear-inner"})],-1)),h("div",Pe,[t[0]||(t[0]=X('<div id="eyebrows" data-v-5fca9a8a><div id="left-eyebrow" data-v-5fca9a8a></div><div id="right-eyebrow" data-v-5fca9a8a></div></div><div id="eyes" data-v-5fca9a8a><div id="left-eye" data-v-5fca9a8a><div id="left-pupil" data-v-5fca9a8a></div></div><div id="right-eye" data-v-5fca9a8a><div id="right-pupil" data-v-5fca9a8a></div></div></div><div id="cheeks" data-v-5fca9a8a><div id="left-cheek" data-v-5fca9a8a></div><div id="right-cheek" data-v-5fca9a8a></div></div>',3)),h("div",{id:"mouth",style:K(n.mouthStyle)},null,4)]),t[2]||(t[2]=h("div",{id:"right-ear"},[h("div",{id:"right-ear-inner"})],-1))])],2)}const Oe=k(Ae,[["render",Be],["__scopeId","data-v-5fca9a8a"]]);var x=Ie();const Ne="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M256 48C141.31 48 48 141.31 48 256s93.31 208 208 208 208-93.31 208-208S370.69 48 256 48m0 319.91a20 20 0 1 1 20-20 20 20 0 0 1-20 20m21.72-201.15-5.74 122a16 16 0 0 1-32 0l-5.74-121.94v-.05a21.74 21.74 0 1 1 43.44 0Z'/></svg>",ze="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M416 80a48.05 48.05 0 0 0-48-48H144a48.05 48.05 0 0 0-48 48v352a48.05 48.05 0 0 0 48 48h224a48.05 48.05 0 0 0 48-48ZM168 432a24 24 0 1 1 24-24 24 24 0 0 1-24 24m0-80a24 24 0 1 1 24-24 24 24 0 0 1-24 24m0-80a24 24 0 1 1 24-24 24 24 0 0 1-24 24m88 160a24 24 0 1 1 24-24 24 24 0 0 1-24 24m0-80a24 24 0 1 1 24-24 24 24 0 0 1-24 24m0-80a24 24 0 1 1 24-24 24 24 0 0 1-24 24m112 136a24 24 0 0 1-48 0v-80a24 24 0 0 1 48 0Zm-24-136a24 24 0 1 1 24-24 24 24 0 0 1-24 24m19.31-100.69A16 16 0 0 1 352 176H160a16 16 0 0 1-16-16V96a16 16 0 0 1 16-16h192a16 16 0 0 1 16 16v64a16 16 0 0 1-4.69 11.31'/></svg>",He="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M192 448h128M384 208v32c0 70.4-57.6 128-128 128h0c-70.4 0-128-57.6-128-128v-32M256 368v80' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/><path d='M256 320a78.83 78.83 0 0 1-56.55-24.1A80.9 80.9 0 0 1 176 239V128a79.69 79.69 0 0 1 80-80c44.86 0 80 35.14 80 80v111c0 44.66-35.89 81-80 81'/></svg>",Fe="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M133 440a35.37 35.37 0 0 1-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0 1 35.77.45l247.85 148.36a36 36 0 0 1 0 61l-247.89 148.4A35.5 35.5 0 0 1 133 440'/></svg>",Ue="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M425.7 118.25A240 240 0 0 0 76.32 447l.18.2c.33.35.64.71 1 1.05.74.84 1.58 1.79 2.57 2.78a41.17 41.17 0 0 0 60.36-.42 157.13 157.13 0 0 1 231.26 0 41.18 41.18 0 0 0 60.65.06l3.21-3.5.18-.2a239.93 239.93 0 0 0-10-328.76ZM240 128a16 16 0 0 1 32 0v32a16 16 0 0 1-32 0ZM128 304H96a16 16 0 0 1 0-32h32a16 16 0 0 1 0 32m48.8-95.2a16 16 0 0 1-22.62 0l-22.63-22.62a16 16 0 0 1 22.63-22.63l22.62 22.63a16 16 0 0 1 0 22.62m149.3 23.1-47.5 75.5a31 31 0 0 1-7 7 30.11 30.11 0 0 1-35-49l75.5-47.5a10.23 10.23 0 0 1 11.7 0 10.06 10.06 0 0 1 2.3 14m31.72-23.1a16 16 0 0 1-22.62-22.62l22.62-22.63a16 16 0 0 1 22.63 22.63ZM416 304h-32a16 16 0 0 1 0-32h32a16 16 0 0 1 0 32'/></svg>",qe="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M394 480a16 16 0 0 1-9.39-3L256 383.76 127.39 477a16 16 0 0 1-24.55-18.08L153 310.35 23 221.2a16 16 0 0 1 9-29.2h160.38l48.4-148.95a16 16 0 0 1 30.44 0l48.4 149H480a16 16 0 0 1 9.05 29.2L359 310.35l50.13 148.53A16 16 0 0 1 394 480'/></svg>",De="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M434.67 285.59v-29.8c0-98.73-80.24-178.79-179.2-178.79a179 179 0 0 0-140.14 67.36m-38.53 82v29.8C76.8 355 157 435 256 435a180.45 180.45 0 0 0 140-66.92' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/><path d='m32 256 44-44 46 44M480 256l-44 44-46-44' stroke-linecap='round' stroke-linejoin='round' class='ionicon-fill-none ionicon-stroke-width'/></svg>",We="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M232 416a23.88 23.88 0 0 1-14.2-4.68 8 8 0 0 1-.66-.51L125.76 336H56a24 24 0 0 1-24-24V200a24 24 0 0 1 24-24h69.75l91.37-74.81a8 8 0 0 1 .66-.51A24 24 0 0 1 256 120v272a24 24 0 0 1-24 24M320 336a16 16 0 0 1-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0 1 28.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 0 1 320 336'/><path d='M368 384a16 16 0 0 1-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0 1 27.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 0 1-13.87 8'/><path d='M416 432a16 16 0 0 1-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1 1 27-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 0 1 416 432'/></svg>",y={TIMES:"times",PLUS:"plus",MINUS:"minus"},u={BEGINNER:"beginner",MEDIUM:"medium",EXPERT:"expert"},L={[y.TIMES]:{[u.BEGINNER]:{min1:1,max1:12,min2:1,max2:12},[u.MEDIUM]:{min1:3,max1:12,min2:3,max2:12},[u.EXPERT]:{min1:5,max1:20,min2:5,max2:20}},[y.PLUS]:{[u.BEGINNER]:{min1:1,max1:50,min2:1,max2:50},[u.MEDIUM]:{min1:1,max1:100,min2:1,max2:100},[u.EXPERT]:{min1:1,max1:1e3,min2:1,max2:1e3}},[y.MINUS]:{[u.BEGINNER]:{min1:10,max1:20,min2:1,max2:10},[u.MEDIUM]:{min1:20,max1:100,min2:1,max2:20},[u.EXPERT]:{min1:100,max1:500,min2:1,max2:100}}},S={ENCOURAGEMENT:["Well done!","Great work!","Good job!","Keep up the good work!","You've really got this!","Amazing!","Fantastic!"],CORRECT:["That's correct","That's right","Exactly!","Flawless","Perfect"],INCORRECT:["Not quite","Maybe next time","I'm sure you can get the next one right","Incorrect","Close, but not quite"]};function P(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function C(e){return e[Math.floor(Math.random()*e.length)]}function Ge(e){if(!e)return null;const t=String(e).match(/\d+/);return t?parseInt(t[0],10):null}function Ve(e){return`${e} star${e===1?"":"s"}`}const Qe=1e4;function O(){return"https://olivermath-api.azurewebsites.net"}async function N(e,t={},i=Qe){const a=new AbortController,s=setTimeout(()=>a.abort(),i);try{return await fetch(e,{...t,signal:a.signal})}finally{clearTimeout(s)}}async function je(){const e=await N(`${O()}/api/speechToken`);if(!e.ok)throw new Error(`Speech token request failed: ${e.status}`);return e.json()}async function $e(e,t="en-GB-RyanNeural",i="default"){if(!e||e.trim().length===0)throw new Error("Text is required for speech synthesis");const a=e.slice(0,500),s=await N(`${O()}/api/speak`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:a,voice:t,style:i})});if(!s.ok){const n=await s.json().catch(()=>({}));throw new Error(n.error||`TTS request failed: ${s.status}`)}return s.json()}const g=new Map,Ze=20;async function Xe(e){const t=e.toLowerCase().trim();if(g.has(t)){const s=g.get(t);return s.currentTime=0,s}const i=await $e(e),a=new Audio(`data:audio/mpeg;base64,${i.audio}`);if(g.size>=Ze){const s=g.keys().next().value;g.delete(s)}return g.set(t,a),a}const Ke={name:"Math",components:{BotFace:Oe,IonHeader:_e,IonToolbar:we,IonTitle:ye,IonContent:ve,IonPage:ge,IonChip:fe,IonLabel:me,IonIcon:pe,IonItem:he,IonSelect:de,IonSelectOption:ue,IonButton:le,IonFooter:ce,IonCard:re,IonCardContent:ae,IonGrid:oe,IonRow:ne,IonCol:ie,IonSpinner:se},setup(){return{star:qe,playIcon:Fe,speedometerIcon:Ue,calculatorIcon:ze,micIcon:He,volumeIcon:We,syncIcon:De,alertIcon:Ne}},data(){return{typeText:[],isLoading:!0,isOnBoundary:!1,isTalking:!1,isListening:!1,isComputing:!1,isLaughing:!1,isError:!1,isQuery:!1,isPlayMode:!0,isResolved:!1,isHappy:!1,isSad:!1,isExcited:!1,isProud:!1,isSurprised:!1,isConfused:!1,text:"",selectedLevel:u.MEDIUM,selectedOperator:y.TIMES,speech_phrases:"Click play, listen the question and respond back by talking your answer.",number1:2,number2:3,stars:0,previousPosition:-1,consecutiveCorrect:0,synth:window.speechSynthesis,greetingSpeech:new window.SpeechSynthesisUtterance,audioConfig:null,speechConfig:null,speechRecognizer:null,speechRecording:null,token:null,speechRegion:null,audioPlayer:null,audioContext:null,audioAnalyser:null,audioSource:null,audioLevel:0,animationFrameId:null,isMicrophoneEnabled:!1,publicPath:"/OliverMath/",timeout:null,expressionTimeout:null}},computed:{botState(){return this.isError?"broken":this.isLaughing?"laughing":this.isHappy?"happy":this.isSad?"sad":this.isExcited?"excited":this.isProud?"proud":this.isSurprised?"surprised":this.isConfused?"confused":this.isTalking?"speaking":this.isListening?"listening":this.isComputing?"computing":"thinking"},expectedResultAsNumber(){return this.selectedOperator=="plus"?this.number1+this.number2:this.selectedOperator=="minus"?this.number1-this.number2:this.number1*this.number2},statusColor(){switch(this.botState){case"speaking":return"primary";case"listening":return"success";case"computing":return"warning";case"broken":return"danger";case"laughing":return"tertiary";case"happy":return"success";case"sad":return"primary";case"excited":return"secondary";case"proud":return"warning";case"surprised":return"tertiary";case"confused":return"medium";default:return"medium"}},statusText(){switch(this.botState){case"speaking":return"Speaking...";case"listening":return"Listening...";case"computing":return"Processing...";case"broken":return"Error";case"laughing":return"Haha!";case"happy":return"Correct! ðŸŽ‰";case"sad":return"Try again...";case"excited":return"Amazing!";case"proud":return"Great streak!";case"surprised":return"Wow!";case"confused":return"Hmm...";default:return"Ready"}},statusIcon(){switch(this.botState){case"speaking":return this.volumeIcon;case"listening":return this.micIcon;case"computing":return this.syncIcon;case"broken":return this.alertIcon;case"happy":return this.starIcon;case"sad":return this.alertIcon;case"excited":return this.starIcon;case"proud":return this.starIcon;case"surprised":return this.starIcon;case"confused":return this.syncIcon;default:return this.syncIcon}}},methods:{showExpression(e,t=2e3){switch(this.isHappy=!1,this.isSad=!1,this.isExcited=!1,this.isProud=!1,this.isSurprised=!1,this.isConfused=!1,e){case"happy":this.isHappy=!0;break;case"sad":this.isSad=!0;break;case"excited":this.isExcited=!0;break;case"proud":this.isProud=!0;break;case"surprised":this.isSurprised=!0;break;case"confused":this.isConfused=!0;break}this.expressionTimeout&&clearTimeout(this.expressionTimeout),this.expressionTimeout=setTimeout(()=>{this.isHappy=!1,this.isSad=!1,this.isExcited=!1,this.isProud=!1,this.isSurprised=!1,this.isConfused=!1},t)},initAudioAnalysis(){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioAnalyser=this.audioContext.createAnalyser(),this.audioAnalyser.fftSize=256,this.audioAnalyser.smoothingTimeConstant=.3)},startAudioAnalysis(e){if(this.initAudioAnalysis(),this.audioSource)try{this.audioSource.disconnect()}catch{}try{this.audioSource=this.audioContext.createMediaElementSource(e),this.audioSource.connect(this.audioAnalyser),this.audioAnalyser.connect(this.audioContext.destination)}catch(t){console.warn("Audio source already connected:",t.message)}this.audioContext.state==="suspended"&&this.audioContext.resume(),this.analyzeAudio()},analyzeAudio(){if(!this.isTalking){this.audioLevel=0;return}const e=new Uint8Array(this.audioAnalyser.frequencyBinCount);this.audioAnalyser.getByteFrequencyData(e);const t=Math.floor(80/(this.audioContext.sampleRate/this.audioAnalyser.fftSize)),i=Math.floor(3e3/(this.audioContext.sampleRate/this.audioAnalyser.fftSize));let a=0,s=0;for(let l=t;l<Math.min(i,e.length);l++)a+=e[l],s++;const n=s>0?a/s:0;this.audioLevel=Math.min(1,n/128*1.5),this.animationFrameId=requestAnimationFrame(()=>this.analyzeAudio())},stopAudioAnalysis(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.audioLevel=0},changeStatus(e){if(this.timeout&&e=="laughing"){var t=new Audio(window.location.origin+this.$route.path+this.publicPath+"assets/sound/laugh.wav");t.play(),this.isLaughing=!0}clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.isLaughing=!1},1500)},keyDownHandler(e){let t=e.key*1;!isNaN(parseFloat(t))&&isFinite(t)&&(this.typeText.push(t),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{if(this.typeText.length>0){var i=this.typeText.join("");this.showToast("Your writing response is : "+i,"secondary"),this.validateWord(i),this.typeText=[]}},400))},async showToast(e,t){return(await xe.create({message:e,duration:5e3,color:t,translucent:!1,cssClass:"toast-custom-position",animated:!1})).present()},async enableMicrophone(){var e=this;this.isMicrophoneEnabled||(e.speech_phrases="enabling microphone..",e.isMicrophoneEnabled=!0,await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(t){e.audioConfig=x.AudioConfig.fromMicrophoneInput(t.id),e.speech_phrases="microphone enabled"}).catch(function(){e.speech_phrases="microphone disabled",e.isError=!0,e.showToast("Microphone disabled","danger"),e.isMicrophoneEnabled=!1}))},async askQuestion(){this.audioConfig=x.AudioConfig.fromDefaultMicrophoneInput(),this.isResolved=!1;var e=this;this.isComputing=!0,this.showExpression("surprised",800),await this.enableMicrophone().then(function(){var t;if(e.isMicrophoneEnabled){e.isComputing=!1,e.isQuery=!0,e.isPlayMode=!1,e.speech_phrases="";const i=((t=L[e.selectedOperator])==null?void 0:t[e.selectedLevel])||L[y.TIMES][u.BEGINNER];e.number1=P(i.min1,i.max1),e.number2=P(i.min2,i.max2),e.text=`What's ${e.number1} ${e.selectedOperator} ${e.number2}?`,e.speak()}else e.speech_phrases="microphone not available",e.isError=!0,e.showToast("Microphone not available","danger")}).catch(function(t){console.error("Failed to ask question:",t),e.isError=!0,e.text="Something went wrong. Please try again.",e.showToast(e.text,"danger")})},async speak(){if(!(this.audioPlayer&&!this.audioPlayer.paused)){this.speech_phrases=this.text,this.isTalking=!0,this.isOnBoundary=!0;try{const e=await Xe(this.text);this.audioPlayer=e,e.crossOrigin="anonymous",e.onplay=()=>{this.startAudioAnalysis(e)},e.onended=()=>{this.isTalking=!1,this.stopAudioAnalysis(),this.isQuery&&(this.isQuery=!1,this.listen())},e.onerror=()=>{this.isTalking=!1,this.stopAudioAnalysis(),this.speakWithBrowser()},await e.play()}catch(e){console.error("Azure TTS error:",e),this.isTalking=!1,this.stopAudioAnalysis(),this.speakWithBrowser()}}},speakWithBrowser(){this.synth.speaking||(this.greetingSpeech.text=this.text,this.synth.speak(this.greetingSpeech))},listen(){this.showToast("Listening...","warning"),this.isComputing=!0,this.isListening=!1;var e=x.SpeechConfig.fromAuthorizationToken(this.token,this.speechRegion);e.speechRecognitionLanguage="en-GB",this.speechConfig=e,this.speechRecording=new x.SpeechRecognizer(this.speechConfig,this.audioConfig),this.listenForSpeechRecordingEvents()},listenForSpeechRecordingEvents(){const e=this;this.speechRecording.speechStartDetected=function(){console.log("speechStartDetected"),e.showToast("I'm Listening","success"),e.isListening=!0,e.isComputing=!1},this.speechRecording.recognizing=function(t,i){window.console.log("recognizing ",i.result.text),e.validateSpeechRecording(i.result.text,!1)},this.speechRecording.recognizeOnceAsync(function(t){e.validateSpeechRecording(t.text,!0),e.isListening=!1,e.isComputing=!1,e.speechRecording.close(),e.speechRecording=null},function(t){console.log("err recognizeOnceAsync",t),e.showToast("Unable to connect to the server.","danger"),e.isListening=!1,e.isComputing=!1,e.isQuery=!1,e.isError=!0,e.text="Unable to recognized the voice. Internal error",e.showToast(e.text),e.speechRecording.close(),e.speechRecording=null})},listenForSpeechEvents(){this.greetingSpeech.onstart=()=>{this.isTalking=!0,this.isOnBoundary=!1,this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.isOnBoundary||(this.speech_phrases=this.text,this.isOnBoundary=!0)},600)},this.greetingSpeech.onend=()=>{this.isTalking=!1,this.isQuery&&(this.isQuery=!1,this.listen())},this.greetingSpeech.onboundary=e=>{if(this.isOnBoundary=!0,e.name=="word"){var t=this.getWordAt(this.text,e.charIndex).toLowerCase();t=="times"&&(t="x"),t=="plus"&&(t="+"),t=="minus"&&(t="-"),this.speech_phrases+=t+" "}}},validateWord(e){if(!e||this.isResolved)return;const t=Ge(e);t!==null&&t===this.expectedResultAsNumber&&(this.isResolved=!0)},validateSpeechRecording(e,t){const i=e===void 0,a=i?"(silent)":String(e);if(i?t&&this.showExpression("confused",2e3):(this.showToast(`Your response: ${a}`,"secondary"),this.validateWord(e)),this.isResolved){this.stars++,this.consecutiveCorrect++,localStorage.stars=this.stars;const s=C(S.CORRECT),n=C(S.ENCOURAGEMENT);this.text=`${s}, ${n}; You earned ${Ve(this.stars)}.`,this.consecutiveCorrect>=5?this.showExpression("excited",3e3):this.consecutiveCorrect>=3?this.showExpression("proud",2500):this.showExpression("happy",2e3)}else if(t){this.consecutiveCorrect=0;const s=C(S.INCORRECT);this.text=`${s}, the correct answer is ${this.expectedResultAsNumber}.`,i||this.showExpression("sad",2e3)}t&&(this.speak(),this.isPlayMode=!0)},getWordAt(e,t){if(e=String(e),t=Number(t)>>>0,this.previousPosition===t)return this.isTalking=!1,"";this.previousPosition=t;const i=e.slice(0,t+1).search(/\S+$/),a=e.slice(t).search(/\s/);return a<0?(this.isQuery||(this.isPlayMode=!0),this.isTalking=!1,e.slice(i)):e.slice(i,a+t)}},async mounted(){try{await navigator.mediaDevices.getUserMedia({audio:!0}),this.isMicrophoneEnabled=!0}catch{console.warn("Microphone not available")}this.listenForSpeechEvents();const e=localStorage.getItem("stars");e&&(this.stars=parseInt(e,10)||0);try{const{token:t,region:i}=await je();this.token=t,this.speechRegion=i}catch(t){console.error("Failed to get speech token:",t),this.isError=!0,this.speech_phrases="Server is unavailable. Please refresh the page.",this.showToast(this.speech_phrases,"danger")}},created(){window.addEventListener("keydown",this.keyDownHandler)},unmounted(){window.removeEventListener("keydown",this.keyDownHandler),this.audioPlayer&&(this.audioPlayer.pause(),this.audioPlayer=null),this.stopAudioAnalysis(),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.timeout&&clearTimeout(this.timeout),this.expressionTimeout&&clearTimeout(this.expressionTimeout)}},Ye={class:"bot-container"},Je={key:0,class:"status-indicator"};function et(e,t,i,a,s,n){const l=c("ion-title"),p=c("ion-icon"),I=c("ion-label"),E=c("ion-chip"),M=c("ion-toolbar"),H=c("ion-header"),f=c("ion-select-option"),T=c("ion-select"),A=c("ion-item"),R=c("ion-col"),F=c("ion-row"),U=c("ion-grid"),q=c("ion-card-content"),D=c("ion-card"),W=c("BotFace"),G=c("ion-content"),V=c("ion-spinner"),Q=c("ion-button"),j=c("ion-footer"),$=c("ion-page");return m(),v($,null,{default:r(()=>[o(H,null,{default:r(()=>[o(M,{color:"primary"},{default:r(()=>[o(l,null,{default:r(()=>[...t[3]||(t[3]=[d("Math Game",-1)])]),_:1}),o(E,{slot:"end",color:"warning","aria-label":"Stars earned"},{default:r(()=>[o(p,{icon:a.star,"aria-hidden":"true"},null,8,["icon"]),o(I,null,{default:r(()=>[d(b(s.stars),1)]),_:1})]),_:1})]),_:1})]),_:1}),o(G,{fullscreen:!0,class:"ion-padding",role:"main"},{default:r(()=>[o(D,{class:"settings-card"},{default:r(()=>[o(q,null,{default:r(()=>[o(U,null,{default:r(()=>[o(F,{class:"ion-align-items-center"},{default:r(()=>[o(R,{size:"6"},{default:r(()=>[o(A,{lines:"none",class:"setting-item"},{default:r(()=>[o(p,{icon:a.speedometerIcon,slot:"start",color:"primary"},null,8,["icon"]),o(T,{interface:"popover",value:s.selectedLevel,onIonChange:t[0]||(t[0]=w=>s.selectedLevel=w.target.value),label:"Level","label-placement":"stacked"},{default:r(()=>[o(f,{value:"beginner"},{default:r(()=>[...t[4]||(t[4]=[d("Beginner",-1)])]),_:1}),o(f,{value:"medium"},{default:r(()=>[...t[5]||(t[5]=[d("Medium",-1)])]),_:1}),o(f,{value:"expert"},{default:r(()=>[...t[6]||(t[6]=[d("Expert",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),o(R,{size:"6"},{default:r(()=>[o(A,{lines:"none",class:"setting-item"},{default:r(()=>[o(p,{icon:a.calculatorIcon,slot:"start",color:"secondary"},null,8,["icon"]),o(T,{interface:"popover",value:s.selectedOperator,onIonChange:t[1]||(t[1]=w=>s.selectedOperator=w.target.value),label:"Operator","label-placement":"stacked"},{default:r(()=>[o(f,{value:"times"},{default:r(()=>[...t[7]||(t[7]=[d("Ã— Multiply",-1)])]),_:1}),o(f,{value:"plus"},{default:r(()=>[...t[8]||(t[8]=[d("+ Addition",-1)])]),_:1}),o(f,{value:"minus"},{default:r(()=>[...t[9]||(t[9]=[d("âˆ’ Subtract",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),h("div",Ye,[o(W,{botState:n.botState,isPlayMode:s.isPlayMode,text:s.speech_phrases,audioLevel:s.audioLevel,onAsk_question:n.askQuestion,onClick:t[2]||(t[2]=w=>n.changeStatus("laughing")),"aria-live":"polite"},null,8,["botState","isPlayMode","text","audioLevel","onAsk_question"])]),n.botState!=="thinking"?(m(),B("div",Je,[o(E,{color:n.statusColor,outline:""},{default:r(()=>[o(p,{icon:n.statusIcon,"aria-hidden":"true"},null,8,["icon"]),o(I,null,{default:r(()=>[d(b(n.statusText),1)]),_:1})]),_:1},8,["color"])])):_("",!0)]),_:1}),o(j,{class:"ion-no-border"},{default:r(()=>[o(M,null,{default:r(()=>[s.isPlayMode&&n.botState!=="broken"?(m(),v(Q,{key:0,expand:"block",size:"large",onClick:n.askQuestion,disabled:s.isComputing,class:"play-button","aria-label":"Start a new math question"},{default:r(()=>[s.isComputing?_("",!0):(m(),v(p,{key:0,icon:a.playIcon,slot:"start"},null,8,["icon"])),s.isComputing?(m(),v(V,{key:1,name:"crescent"})):_("",!0),d(" "+b(s.isComputing?"Thinking...":"Play Math!"),1)]),_:1},8,["onClick","disabled"])):_("",!0)]),_:1})]),_:1})]),_:1})}const tt=k(Ke,[["render",et],["__scopeId","data-v-7042c7a1"]]),st=()=>Ce(()=>import("./Assistant-BhsRS6BS.js"),__vite__mapDeps([0,1,2,3,4])),it=[{path:"/",name:"Home",component:tt},{path:"/assistant",name:"Assistant",component:st}],z=be({history:Se("/OliverMath/"),routes:it}),nt=J(Te).use(ke).use(z);z.isReady().then(()=>{nt.mount("#app")});export{k as _};
