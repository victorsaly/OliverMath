const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Assistant-DiWiP7-D.js","assets/ionic-core-Dgu_u4L7.js","assets/vue-vendor-CgvblAhS.js","assets/speech-sdk-SapOic_u.js","assets/Assistant-D2kYHlrP.css"])))=>i.map(i=>d[i]);
import{l as w,n as o,d as z,q as l,t as v,v as a,x as F,y as q,z as S,A as G,B as W,C as c,D as Q,E as H}from"./vue-vendor-CgvblAhS.js";import{I as V,a as j,b as X,c as K,d as Y,e as J,f as Z,g as ee,h as te,i as ie,j as se,k as ne,l as oe,m as ae,n as re,t as le,o as ce,p as ue,_ as he,q as de}from"./ionic-core-Dgu_u4L7.js";import{r as pe}from"./speech-sdk-SapOic_u.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function s(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=s(i);fetch(i.href,n)}})();const T=(e,t)=>{const s=e.__vccOpts||e;for(const[r,i]of t)s[r]=i;return s},fe=z({name:"App",components:{IonApp:j,IonRouterOutlet:V}});function me(e,t,s,r,i,n){const h=l("ion-router-outlet"),y=l("ion-app");return v(),w(y,null,{default:o(()=>[a(h)]),_:1})}const ge=T(fe,[["render",me]]),ve={name:"BotFace",props:{botState:{type:String,default:"neutral"},text:{type:String,default:""},isPlayMode:{type:Boolean,default:!0}}},ye={class:"bubble speech"};function _e(e,t,s,r,i,n){return v(),F("div",{id:"bot",class:W(s.botState)},[q("p",ye,S(s.text),1),t[0]||(t[0]=G('<div id="head" data-v-a1ac0ce1><div id="left-ear" data-v-a1ac0ce1><div id="left-ear-inner" data-v-a1ac0ce1></div></div><div id="face" data-v-a1ac0ce1><div id="eyes" data-v-a1ac0ce1><div id="left-eye" data-v-a1ac0ce1></div><div id="right-eye" data-v-a1ac0ce1></div></div><div id="mouth" data-v-a1ac0ce1></div></div><div id="right-ear" data-v-a1ac0ce1><div id="right-ear-inner" data-v-a1ac0ce1></div></div></div>',1))],2)}const be=T(ve,[["render",_e],["__scopeId","data-v-a1ac0ce1"]]);var g=pe();const Ee="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' class='ionicon'><path d='M394 480a16 16 0 0 1-9.39-3L256 383.76 127.39 477a16 16 0 0 1-24.55-18.08L153 310.35 23 221.2a16 16 0 0 1 9-29.2h160.38l48.4-148.95a16 16 0 0 1 30.44 0l48.4 149H480a16 16 0 0 1 9.05 29.2L359 310.35l50.13 148.53A16 16 0 0 1 394 480'/></svg>",f={TIMES:"times",PLUS:"plus",MINUS:"minus"},u={BEGINNER:"beginner",MEDIUM:"medium",EXPERT:"expert"},k={[f.TIMES]:{[u.BEGINNER]:{min1:1,max1:12,min2:1,max2:12},[u.MEDIUM]:{min1:3,max1:12,min2:3,max2:12},[u.EXPERT]:{min1:5,max1:20,min2:5,max2:20}},[f.PLUS]:{[u.BEGINNER]:{min1:1,max1:50,min2:1,max2:50},[u.MEDIUM]:{min1:1,max1:100,min2:1,max2:100},[u.EXPERT]:{min1:1,max1:1e3,min2:1,max2:1e3}},[f.MINUS]:{[u.BEGINNER]:{min1:10,max1:20,min2:1,max2:10},[u.MEDIUM]:{min1:20,max1:100,min2:1,max2:20},[u.EXPERT]:{min1:100,max1:500,min2:1,max2:100}}},b={ENCOURAGEMENT:["Well done!","Great work!","Good job!","Keep up the good work!","You've really got this!","Amazing!","Fantastic!"],CORRECT:["That's correct","That's right","Exactly!","Flawless","Perfect"],INCORRECT:["Not quite","Maybe next time","I'm sure you can get the next one right","Incorrect","Close, but not quite"]};function I(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function E(e){return e[Math.floor(Math.random()*e.length)]}function we(e){if(!e)return null;const t=String(e).match(/\d+/);return t?parseInt(t[0],10):null}function Se(e){return`${e} star${e===1?"":"s"}`}const Te=1e4;function R(){return"https://olivermath-api.azurewebsites.net"}async function C(e,t={},s=Te){const r=new AbortController,i=setTimeout(()=>r.abort(),s);try{return await fetch(e,{...t,signal:r.signal})}finally{clearTimeout(i)}}async function xe(){const e=await C(`${R()}/api/speechToken`);if(!e.ok)throw new Error(`Speech token request failed: ${e.status}`);return e.json()}async function Me(e,t="en-US-AnaNeural",s="friendly"){if(!e||e.trim().length===0)throw new Error("Text is required for speech synthesis");const r=e.slice(0,500),i=await C(`${R()}/api/speak`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:r,voice:t,style:s})});if(!i.ok){const n=await i.json().catch(()=>({}));throw new Error(n.error||`TTS request failed: ${i.status}`)}return i.json()}const p=new Map,ke=20;async function Ie(e){const t=e.toLowerCase().trim();if(p.has(t)){const i=p.get(t);return i.currentTime=0,i}const s=await Me(e),r=new Audio(`data:audio/mpeg;base64,${s.audio}`);if(p.size>=ke){const i=p.keys().next().value;p.delete(i)}return p.set(t,r),r}const Re={name:"Math",components:{BotFace:be,IonHeader:re,IonToolbar:ae,IonTitle:oe,IonContent:ne,IonPage:se,IonChip:ie,IonLabel:te,IonIcon:ee,IonItem:Z,IonSelect:J,IonSelectOption:Y,IonButton:K,IonFooter:X},data(){return{typeText:[],isLoading:!0,isOnBoundary:!1,isTalking:!1,isListening:!1,isComputing:!1,isLaughing:!1,isError:!1,isQuery:!1,isPlayMode:!0,isResolved:!1,text:"",selectedLevel:u.MEDIUM,selectedOperator:f.TIMES,speech_phrases:"Click play, listen the question and respond back by talking your answer.",number1:2,number2:3,stars:0,previousPosition:-1,synth:window.speechSynthesis,greetingSpeech:new window.SpeechSynthesisUtterance,audioConfig:null,speechConfig:null,speechRecognizer:null,speechRecording:null,token:null,speechRegion:null,audioPlayer:null,isMicrophoneEnabled:!1,publicPath:"/OliverMath/",timeout:null}},computed:{botState(){return this.isError?"broken":this.isLaughing?"laughing":this.isTalking?"speaking":this.isListening?"listening":this.isComputing?"computing":"thinking"},expectedResultAsNumber(){return this.selectedOperator=="plus"?this.number1+this.number2:this.selectedOperator=="minus"?this.number1-this.number2:this.number1*this.number2}},methods:{changeStatus(e){if(this.timeout&&e=="laughing"){var t=new Audio(window.location.origin+this.$route.path+this.publicPath+"assets/sound/laugh.wav");t.play(),this.isLaughing=!0}clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.isLaughing=!1},1500)},keyDownHandler(e){let t=e.key*1;!isNaN(parseFloat(t))&&isFinite(t)&&(this.typeText.push(t),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{if(this.typeText.length>0){var s=this.typeText.join("");this.showToast("Your writing response is : "+s,"secondary"),this.validateWord(s),this.typeText=[]}},400))},async showToast(e,t){return(await le.create({message:e,duration:5e3,color:t,translucent:!1,cssClass:"toast-custom-position",animated:!1})).present()},async enableMicrophone(){var e=this;this.isMicrophoneEnabled||(e.speech_phrases="enabling microphone..",e.isMicrophoneEnabled=!0,await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(t){e.audioConfig=g.AudioConfig.fromMicrophoneInput(t.id),e.speech_phrases="microphone enabled"}).catch(function(){e.speech_phrases="microphone disabled",e.isError=!0,e.showToast("Microphone disabled","danger"),e.isMicrophoneEnabled=!1}))},async askQuestion(){this.audioConfig=g.AudioConfig.fromDefaultMicrophoneInput(),this.isResolved=!1;var e=this;this.isComputing=!0,await this.enableMicrophone().then(function(){var t;if(e.isMicrophoneEnabled){e.isComputing=!1,e.isQuery=!0,e.isPlayMode=!1,e.speech_phrases="";const s=((t=k[e.selectedOperator])==null?void 0:t[e.selectedLevel])||k[f.TIMES][u.BEGINNER];e.number1=I(s.min1,s.max1),e.number2=I(s.min2,s.max2),e.text=`What's ${e.number1} ${e.selectedOperator} ${e.number2}?`,e.speak()}else e.speech_phrases="microphone not available",e.isError=!0,e.showToast("Microphone not available","danger")}).catch(function(t){console.error("Failed to ask question:",t),e.isError=!0,e.text="Something went wrong. Please try again.",e.showToast(e.text,"danger")})},async speak(){if(!(this.audioPlayer&&!this.audioPlayer.paused)){this.speech_phrases=this.text,this.isTalking=!0,this.isOnBoundary=!0;try{const e=await Ie(this.text);this.audioPlayer=e,e.onended=()=>{this.isTalking=!1,this.isQuery&&(this.isQuery=!1,this.listen())},e.onerror=()=>{this.isTalking=!1,this.speakWithBrowser()},await e.play()}catch(e){console.error("Azure TTS error:",e),this.isTalking=!1,this.speakWithBrowser()}}},speakWithBrowser(){this.synth.speaking||(this.greetingSpeech.text=this.text,this.synth.speak(this.greetingSpeech))},listen(){this.showToast("Listening...","warning"),this.isComputing=!0,this.isListening=!1;var e=g.SpeechConfig.fromAuthorizationToken(this.token,this.speechRegion);e.speechRecognitionLanguage="en-GB",this.speechConfig=e,this.speechRecording=new g.SpeechRecognizer(this.speechConfig,this.audioConfig),this.listenForSpeechRecordingEvents()},listenForSpeechRecordingEvents(){const e=this;this.speechRecording.speechStartDetected=function(){console.log("speechStartDetected"),e.showToast("I'm Listening","success"),e.isListening=!0,e.isComputing=!1},this.speechRecording.recognizing=function(t,s){window.console.log("recognizing ",s.result.text),e.validateSpeechRecording(s.result.text,!1)},this.speechRecording.recognizeOnceAsync(function(t){e.validateSpeechRecording(t.text,!0),e.isListening=!1,e.isComputing=!1,e.speechRecording.close(),e.speechRecording=null},function(t){console.log("err recognizeOnceAsync",t),e.showToast("Unable to connect to the server.","danger"),e.isListening=!1,e.isComputing=!1,e.isQuery=!1,e.isError=!0,e.text="Unable to recognized the voice. Internal error",e.showToast(e.text),e.speechRecording.close(),e.speechRecording=null})},listenForSpeechEvents(){this.greetingSpeech.onstart=()=>{this.isTalking=!0,this.isOnBoundary=!1,this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.isOnBoundary||(this.speech_phrases=this.text,this.isOnBoundary=!0)},600)},this.greetingSpeech.onend=()=>{this.isTalking=!1,this.isQuery&&(this.isQuery=!1,this.listen())},this.greetingSpeech.onboundary=e=>{if(this.isOnBoundary=!0,e.name=="word"){var t=this.getWordAt(this.text,e.charIndex).toLowerCase();t=="times"&&(t="x"),t=="plus"&&(t="+"),t=="minus"&&(t="-"),this.speech_phrases+=t+" "}}},validateWord(e){if(!e||this.isResolved)return;const t=we(e);t!==null&&t===this.expectedResultAsNumber&&(this.isResolved=!0)},validateSpeechRecording(e,t){const s=e===void 0,r=s?"(silent)":String(e);if(s||(this.showToast(`Your response: ${r}`,"secondary"),this.validateWord(e)),this.isResolved){this.stars++,localStorage.stars=this.stars;const i=E(b.CORRECT),n=E(b.ENCOURAGEMENT);this.text=`${i}, ${n}; You earned ${Se(this.stars)}.`}else if(t){const i=E(b.INCORRECT);this.text=`${i}, the correct answer is ${this.expectedResultAsNumber}.`}t&&(this.speak(),this.isPlayMode=!0)},getWordAt(e,t){if(e=String(e),t=Number(t)>>>0,this.previousPosition===t)return this.isTalking=!1,"";this.previousPosition=t;const s=e.slice(0,t+1).search(/\S+$/),r=e.slice(t).search(/\s/);return r<0?(this.isQuery||(this.isPlayMode=!0),this.isTalking=!1,e.slice(s)):e.slice(s,r+t)}},async mounted(){try{await navigator.mediaDevices.getUserMedia({audio:!0}),this.isMicrophoneEnabled=!0}catch{console.warn("Microphone not available")}this.listenForSpeechEvents();const e=localStorage.getItem("stars");e&&(this.stars=parseInt(e,10)||0);try{const{token:t,region:s}=await xe();this.token=t,this.speechRegion=s}catch(t){console.error("Failed to get speech token:",t),this.isError=!0,this.speech_phrases="Server is unavailable. Please refresh the page.",this.showToast(this.speech_phrases,"danger")}},setup(){return{star:Ee}},created(){window.addEventListener("keydown",this.keyDownHandler)},unmounted(){window.removeEventListener("keydown",this.keyDownHandler),this.audioPlayer&&(this.audioPlayer.pause(),this.audioPlayer=null),this.timeout&&clearTimeout(this.timeout)}};function Ce(e,t,s,r,i,n){const h=l("ion-title"),y=l("ion-icon"),_=l("ion-label"),O=l("ion-chip"),A=l("ion-toolbar"),N=l("ion-header"),d=l("ion-select-option"),x=l("ion-select"),M=l("ion-item"),L=l("BotFace"),B=l("ion-content"),U=l("ion-button"),D=l("ion-footer"),$=l("ion-page");return v(),w($,null,{default:o(()=>[a(N,null,{default:o(()=>[a(A,null,{default:o(()=>[a(h,null,{default:o(()=>[...t[3]||(t[3]=[c("Math Game",-1)])]),_:1}),a(O,{slot:"end","aria-label":"Stars earned"},{default:o(()=>[a(y,{icon:r.star,color:"warning","aria-hidden":"true"},null,8,["icon"]),a(_,null,{default:o(()=>[c(S(i.stars),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(M,null,{default:o(()=>[a(_,{id:"level-label"},{default:o(()=>[...t[4]||(t[4]=[c("Difficulty",-1)])]),_:1}),a(x,{interface:"popover",value:i.selectedLevel,onIonChange:t[0]||(t[0]=m=>i.selectedLevel=m.target.value),"aria-labelledby":"level-label"},{default:o(()=>[a(d,{value:"beginner"},{default:o(()=>[...t[5]||(t[5]=[c("Beginner",-1)])]),_:1}),a(d,{value:"medium"},{default:o(()=>[...t[6]||(t[6]=[c("Medium",-1)])]),_:1}),a(d,{value:"expert"},{default:o(()=>[...t[7]||(t[7]=[c("Expert",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(M,null,{default:o(()=>[a(_,{id:"operator-label"},{default:o(()=>[...t[8]||(t[8]=[c("Operator",-1)])]),_:1}),a(x,{interface:"popover",value:i.selectedOperator,onIonChange:t[1]||(t[1]=m=>i.selectedOperator=m.target.value),"aria-labelledby":"operator-label"},{default:o(()=>[a(d,{value:"times"},{default:o(()=>[...t[9]||(t[9]=[c("Multiply (×)",-1)])]),_:1}),a(d,{value:"plus"},{default:o(()=>[...t[10]||(t[10]=[c("Addition (+)",-1)])]),_:1}),a(d,{value:"minus"},{default:o(()=>[...t[11]||(t[11]=[c("Subtraction (−)",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(B,{fullscreen:!0,role:"main"},{default:o(()=>[a(L,{botState:n.botState,isPlayMode:i.isPlayMode,text:i.speech_phrases,onAsk_question:n.askQuestion,onClick:t[2]||(t[2]=m=>n.changeStatus("laughing")),"aria-live":"polite"},null,8,["botState","isPlayMode","text","onAsk_question"])]),_:1}),a(D,{"no-padding":"",style:{"margin-bottom":"5px"}},{default:o(()=>[i.isPlayMode&&n.botState!=="broken"?(v(),w(U,{key:0,expand:"full",onClick:n.askQuestion,disabled:i.isComputing,"aria-label":"Start a new math question"},{default:o(()=>[c(S(i.isComputing?"Loading...":"Play Math"),1)]),_:1},8,["onClick","disabled"])):Q("",!0)]),_:1})]),_:1})}const Pe=T(Re,[["render",Ce]]),Oe=()=>he(()=>import("./Assistant-DiWiP7-D.js"),__vite__mapDeps([0,1,2,3,4])),Ae=[{path:"/",name:"Home",component:Pe},{path:"/assistant",name:"Assistant",component:Oe}],P=ce({history:ue("/OliverMath/"),routes:Ae}),Ne=H(ge).use(de).use(P);P.isReady().then(()=>{Ne.mount("#app")});export{T as _};
